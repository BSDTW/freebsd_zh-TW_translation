<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org" />
<title>使用者資源限制</title>
<meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.79" />
<link rel="HOME" title="FreeBSD 使用手冊" href="index.html" />
<link rel="UP" title="使用者與基本帳號管理" href="users.html" />
<link rel="PREVIOUS" title="更改帳號" href="users-modifying.html" />
<link rel="NEXT" title="群組" href="users-groups.html" />
<link rel="STYLESHEET" type="text/css" href="docbook.css" />
<meta http-equiv="Content-Type" content="text/html; charset=Big5" />
</head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084"
alink="#0000FF">
<div class="NAVHEADER">
<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">FreeBSD 使用手冊</th>
</tr>

<tr>
<td width="10%" align="left" valign="bottom"><a href="users-modifying.html"
accesskey="P">Prev</a></td>
<td width="80%" align="center" valign="bottom">Chapter 13 使用者與基本帳號管理</td>
<td width="10%" align="right" valign="bottom"><a href="users-groups.html"
accesskey="N">Next</a></td>
</tr>
</table>

<hr align="LEFT" width="100%" />
</div>

<div class="SECT1">
<h1 class="SECT1"><a id="USERS-LIMITING" name="USERS-LIMITING">13.7
使用者資源限制</a></h1>

<p>若您擁有許多使用者，接下會想到該如何限制使用的資源。 FreeBSD
提供管理者許多方法來限制系統的資源給每個人使用。 這些限制分為兩個部份:
磁碟限額，以及其他資源限制。</p>

<p>磁碟限額可以限制使用者的磁碟用量， 它提供了一種方法可以快速的檢查並計算用量
而不需每次重新計算， 關於磁碟限額將於 <a href="quotas.html">Section 18.15</a>
會討論。</p>

<p>其他資源限制包含了 CPU、記憶體、以及其他每個使用者可使用 的資源做限制，這些限制可使用
Login class 來定義並於在本章討論。</p>

<p>Login class 定義於 <tt class="FILENAME">/etc/login.conf</tt>。 明確語意不會在本節說明
但詳細的描述會在 <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">login.conf</span>(5)</span></a> 文件中。
每使用者預設被 分配到一個 Login class 中 (預設為 <tt class="LITERAL">default</tt>)，
而每個 Login class 都有其資源的限制(Login capabilitiy)。 Login capabilitiy 以 <tt
class="LITERAL"><tt class="REPLACEABLE"><i>名稱</i></tt>=<tt
class="REPLACEABLE"><i>值</i></tt></tt> 成對， <tt class="REPLACEABLE"><i>名稱</i></tt>
代表資源的種類，而 <tt class="REPLACEABLE"><i>值</i></tt>
為任意的字串，為對應名稱的參數。 設定 Login class 及 Login capability 相當簡單，並同樣在
<a href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">login.conf</span>(5)</span></a>
中詳細說明。</p>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> 系統不會直接讀取 <tt class="FILENAME">/etc/login.conf</tt> 的組態
而是讀取提供查詢較快的 <tt class="FILENAME">/etc/login.conf.db</tt> 資料庫檔。 要從 <tt
class="FILENAME">/etc/login.conf</tt> 產生 <tt class="FILENAME">/etc/login.conf.db</tt>
需要執行以下指令:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cap_mkdb /etc/login.conf</kbd>
</pre>
</blockquote>
</div>

<p>資源限制於一般的 Login capability 有兩點不同。 第一，每種限制分為軟性限制及硬性限制。
軟性限制可由使用者或應用程式調整，但不能高於硬性限制。
後者限制可被使用者降低，但無法再提高。
第二，多數資源限制是針對每個使用者的個別行程限制，而不是使用者的所有行程。
注意，這些差異是由指定的限制程式托管，並非實作於 Login capability 的架構 (例如，這些不是
<span class="emphasis"><b class="EMPHASIS">真正</b></span> 登入容量的特例)。</p>

<p>另外，為了避免麻煩，以下為幾個常用的資源限制 (剩下及其他的 Login capability 可在 <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">login.conf</span>(5)</span></a>
中找到說明)。</p>

<div class="VARIABLELIST">
<dl>
<dt><tt class="LITERAL">coredumpsize</tt></dt>

<dd>
<p>The limit on the size of a core file generated by a program is, for obvious reasons,
subordinate to other limits on disk usage (e.g., <tt class="LITERAL">filesize</tt>, or
disk quotas). Nevertheless, it is often used as a less-severe method of controlling disk
space consumption: since users do not generate core files themselves, and often do not
delete them, setting this may save them from running out of disk space should a large
program (e.g., <b class="APPLICATION">emacs</b>) crash.</p>
</dd>

<dt><tt class="LITERAL">cputime</tt></dt>

<dd>
<p>This is the maximum amount of CPU time a user's process may consume. Offending
processes will be killed by the kernel.</p>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> This is a limit on CPU <span class="emphasis"><b
class="EMPHASIS">time</b></span> consumed, not percentage of the CPU as displayed in some
fields by <a href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">top</span>(1)</span></a> and <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">ps</span>(1)</span></a>. A limit on the
latter is, at the time of this writing, not possible, and would be rather useless: a
compiler——probably a legitimate task——can easily use almost 100% of a CPU for some
time.</p>
</blockquote>
</div>
</dd>

<dt><tt class="LITERAL">filesize</tt></dt>

<dd>
<p>This is the maximum size of a file the user may possess. Unlike <a
href="quotas.html">disk quotas</a>, this limit is enforced on individual files, not the
set of all files a user owns.</p>
</dd>

<dt><tt class="LITERAL">maxproc</tt></dt>

<dd>
<p>This is the maximum number of processes a user may be running. This includes
foreground and background processes alike. For obvious reasons, this may not be larger
than the system limit specified by the <code class="VARNAME">kern.maxproc</code> <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">sysctl</span>(8)</span></a>. Also note
that setting this too small may hinder a user's productivity: it is often useful to be
logged in multiple times or execute pipelines. Some tasks, such as compiling a large
program, also spawn multiple processes (e.g., <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">make</span>(1)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=cc&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">cc</span>(1)</span></a>, and other
intermediate preprocessors).</p>
</dd>

<dt><tt class="LITERAL">memorylocked</tt></dt>

<dd>
<p>This is the maximum amount a memory a process may have requested to be locked into
main memory (e.g., see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mlock&amp;sektion=2"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mlock</span>(2)</span></a>). Some
system-critical programs, such as <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">amd</span>(8)</span></a>, lock into main
memory such that in the event of being swapped out, they do not contribute to a system's
trashing in time of trouble.</p>
</dd>

<dt><tt class="LITERAL">memoryuse</tt></dt>

<dd>
<p>This is the maximum amount of memory a process may consume at any given time. It
includes both core memory and swap usage. This is not a catch-all limit for restricting
memory consumption, but it is a good start.</p>
</dd>

<dt><tt class="LITERAL">openfiles</tt></dt>

<dd>
<p>This is the maximum amount of files a process may have open. In FreeBSD, files are
also used to represent sockets and IPC channels; thus, be careful not to set this too
low. The system-wide limit for this is defined by the <code
class="VARNAME">kern.maxfiles</code> <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">sysctl</span>(8)</span></a>.</p>
</dd>

<dt><tt class="LITERAL">sbsize</tt></dt>

<dd>
<p>This is the limit on the amount of network memory, and thus mbufs, a user may consume.
This originated as a response to an old DoS attack by creating a lot of sockets, but can
be generally used to limit network communications.</p>
</dd>

<dt><tt class="LITERAL">stacksize</tt></dt>

<dd>
<p>This is the maximum size a process' stack may grow to. This alone is not sufficient to
limit the amount of memory a program may use; consequently, it should be used in
conjunction with other limits.</p>
</dd>
</dl>
</div>

<p>There are a few other things to remember when setting resource limits. Following are
some general tips, suggestions, and miscellaneous comments.</p>

<ul>
<li>
<p>Processes started at system startup by <tt class="FILENAME">/etc/rc</tt> are assigned
to the <tt class="LITERAL">daemon</tt> login class.</p>
</li>

<li>
<p>Although the <tt class="FILENAME">/etc/login.conf</tt> that comes with the system is a
good source of reasonable values for most limits, only you, the administrator, can know
what is appropriate for your system. Setting a limit too high may open your system up to
abuse, while setting it too low may put a strain on productivity.</p>
</li>

<li>
<p>Users of the X Window System (X11) should probably be granted more resources than
other users. X11 by itself takes a lot of resources, but it also encourages users to run
more programs simultaneously.</p>
</li>

<li>
<p>Remember that many limits apply to individual processes, not the user as a whole. For
example, setting <code class="VARNAME">openfiles</code> to 50 means that each process the
user runs may open up to 50 files. Thus, the gross amount of files a user may open is the
value of <tt class="LITERAL">openfiles</tt> multiplied by the value of <tt
class="LITERAL">maxproc</tt>. This also applies to memory consumption.</p>
</li>
</ul>

<p>For further information on resource limits and login classes and capabilities in
general, please consult the relevant manual pages: <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">cap_mkdb</span>(1)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=getrlimit&amp;sektion=2"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">getrlimit</span>(2)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">login.conf</span>(5)</span></a>.</p>
</div>

<div class="NAVFOOTER">
<hr align="LEFT" width="100%" />
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="users-modifying.html"
accesskey="P">Prev</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Home</a></td>
<td width="33%" align="right" valign="top"><a href="users-groups.html"
accesskey="N">Next</a></td>
</tr>

<tr>
<td width="33%" align="left" valign="top">更改帳號</td>
<td width="34%" align="center" valign="top"><a href="users.html"
accesskey="U">Up</a></td>
<td width="33%" align="right" valign="top">群組</td>
</tr>
</table>
</div>

<p align="center"><small>本文及其他文件，可由此下載：<a
href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p>

<p align="center"><small>若有 FreeBSD 方面疑問，請先閱讀 <a
href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
&#60;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&#62;。<br />
關於本文件的問題，請洽詢 &#60;<a
href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&#62;。</small></p>
</body>
</html>


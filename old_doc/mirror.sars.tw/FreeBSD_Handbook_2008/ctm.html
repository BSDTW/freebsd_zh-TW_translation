<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org" />
<title>使用 CTM</title>
<meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.79" />
<link rel="HOME" title="FreeBSD 使用手冊" href="index.html" />
<link rel="UP" title="取得 FreeBSD 的方式" href="mirrors.html" />
<link rel="PREVIOUS" title="匿名 CVS" href="anoncvs.html" />
<link rel="NEXT" title="使用 CVSup" href="cvsup.html" />
<link rel="STYLESHEET" type="text/css" href="docbook.css" />
<meta http-equiv="Content-Type" content="text/html; charset=Big5" />
</head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084"
alink="#0000FF">
<div class="NAVHEADER">
<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">FreeBSD 使用手冊</th>
</tr>

<tr>
<td width="10%" align="left" valign="bottom"><a href="anoncvs.html"
accesskey="P">Prev</a></td>
<td width="80%" align="center" valign="bottom">Appendix A. 取得 FreeBSD 的方式</td>
<td width="10%" align="right" valign="bottom"><a href="cvsup.html"
accesskey="N">Next</a></td>
</tr>
</table>

<hr align="LEFT" width="100%" />
</div>

<div class="SECT1">
<h1 class="SECT1"><a id="CTM" name="CTM">A.4 使用 CTM</a></h1>

<p><b class="APPLICATION">CTM</b> is a method for keeping a remote directory tree in sync
with a central one. It has been developed for usage with FreeBSD's source trees, though
other people may find it useful for other purposes as time goes by. Little, if any,
documentation currently exists at this time on the process of creating deltas, so contact
the <a href="http://lists.FreeBSD.org/mailman/listinfo/ctm-users"
target="_top">ctm-users</a> mailing list for more information and if you wish to use <b
class="APPLICATION">CTM</b> for other things.</p>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN42952" name="AEN42952">A.4.1 Why Should I Use <b
class="APPLICATION">CTM</b>?</a></h2>

<p><b class="APPLICATION">CTM</b> will give you a local copy of the FreeBSD source trees.
There are a number of “flavors” of the tree available. Whether you wish to track the
entire CVS tree or just one of the branches, <b class="APPLICATION">CTM</b> can provide
you the information. If you are an active developer on FreeBSD, but have lousy or
non-existent TCP/IP connectivity, or simply wish to have the changes automatically sent
to you, <b class="APPLICATION">CTM</b> was made for you. You will need to obtain up to
three deltas per day for the most active branches. However, you should consider having
them sent by automatic email. The sizes of the updates are always kept as small as
possible. This is typically less than 5K, with an occasional (one in ten) being 10-50K
and every now and then a large 100K+ or more coming around.</p>

<p>You will also need to make yourself aware of the various caveats related to working
directly from the development sources rather than a pre-packaged release. This is
particularly true if you choose the “current” sources. It is recommended that you read
<a href="current-stable.html#CURRENT">Staying current with FreeBSD</a>.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN42963" name="AEN42963">A.4.2 What Do I Need to Use <b
class="APPLICATION">CTM</b>?</a></h2>

<p>You will need two things: The <b class="APPLICATION">CTM</b> program, and the initial
deltas to feed it (to get up to “current” levels).</p>

<p>The <b class="APPLICATION">CTM</b> program has been part of FreeBSD ever since version
2.0 was released, and lives in <tt class="FILENAME">/usr/src/usr.sbin/ctm</tt> if you
have a copy of the source available.</p>

<p>The “deltas” you feed <b class="APPLICATION">CTM</b> can be had two ways, FTP or
email. If you have general FTP access to the Internet then the following FTP sites
support access to <b class="APPLICATION">CTM</b>:</p>

<p><a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/CTM/"
target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/CTM/</a></p>

<p>or see section <a href="ctm.html#MIRRORS-CTM">mirrors</a>.</p>

<p>FTP the relevant directory and fetch the <tt class="FILENAME">README</tt> file,
starting from there.</p>

<p>If you wish to get your deltas via email:</p>

<p>Subscribe to one of the <b class="APPLICATION">CTM</b> distribution lists. <a
href="http://lists.FreeBSD.org/mailman/listinfo/ctm-cvs-cur"
target="_top">ctm-cvs-cur</a> supports the entire CVS tree. <a
href="http://lists.FreeBSD.org/mailman/listinfo/ctm-src-cur"
target="_top">ctm-src-cur</a> supports the head of the development branch. <a
href="http://lists.FreeBSD.org/mailman/listinfo/ctm-src-4" target="_top">ctm-src-4</a>
supports the 4.X release branch, etc.. (If you do not know how to subscribe yourself to a
list, click on the list name above or go to <a
href="http://lists.FreeBSD.org/mailman/listinfo"
target="_top">http://lists.FreeBSD.org/mailman/listinfo</a> and click on the list that
you wish to subscribe to. The list page should contain all of the necessary subscription
instructions.)</p>

<p>When you begin receiving your <b class="APPLICATION">CTM</b> updates in the mail, you
may use the <tt class="COMMAND">ctm_rmail</tt> program to unpack and apply them. You can
actually use the <tt class="COMMAND">ctm_rmail</tt> program directly from a entry in <tt
class="FILENAME">/etc/aliases</tt> if you want to have the process run in a fully
automated fashion. Check the <tt class="COMMAND">ctm_rmail</tt> manual page for more
details.</p>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> No matter what method you use to get the <b class="APPLICATION">CTM</b>
deltas, you should subscribe to the <a
href="http://lists.FreeBSD.org/mailman/listinfo/ctm-announce"
target="_top">ctm-announce</a> mailing list. In the future, this will be the only place
where announcements concerning the operations of the <b class="APPLICATION">CTM</b>
system will be posted. Click on the list name above and follow the instructions to
subscribe to the list.</p>
</blockquote>
</div>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43000" name="AEN43000">A.4.3 第一次使用 <b
class="APPLICATION">CTM</b></a></h2>

<p>Before you can start using <b class="APPLICATION">CTM</b> deltas, you will need to get
to a starting point for the deltas produced subsequently to it.</p>

<p>First you should determine what you already have. Everyone can start from an “empty”
directory. You must use an initial “Empty” delta to start off your <b
class="APPLICATION">CTM</b> supported tree. At some point it is intended that one of
these “started” deltas be distributed on the CD for your convenience, however, this
does not currently happen.</p>

<p>Since the trees are many tens of megabytes, you should prefer to start from something
already at hand. If you have a -RELEASE CD, you can copy or extract an initial source
from it. This will save a significant transfer of data.</p>

<p>You can recognize these “starter” deltas by the <tt class="LITERAL">X</tt> appended
to the number (<tt class="FILENAME">src-cur.3210XEmpty.gz</tt> for instance). The
designation following the <tt class="LITERAL">X</tt> corresponds to the origin of your
initial “seed”. <tt class="FILENAME">Empty</tt> is an empty directory. As a rule a base
transition from <tt class="LITERAL">Empty</tt> is produced every 100 deltas. By the way,
they are large! 70 to 80 Megabytes of <tt class="COMMAND">gzip</tt>'d data is common for
the <tt class="FILENAME">XEmpty</tt> deltas.</p>

<p>Once you have picked a base delta to start from, you will also need all deltas with
higher numbers following it.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43022" name="AEN43022">A.4.4 Using <b
class="APPLICATION">CTM</b> in Your Daily Life</a></h2>

<p>To apply the deltas, simply say:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">cd /where/ever/you/want/the/stuff</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">ctm -v -v /where/you/store/your/deltas/src-xxx.*</kbd>
</pre>

<p><b class="APPLICATION">CTM</b> understands deltas which have been put through <tt
class="COMMAND">gzip</tt>, so you do not need to <tt class="COMMAND">gunzip</tt> them
first, this saves disk space.</p>

<p>Unless it feels very secure about the entire process, <b class="APPLICATION">CTM</b>
will not touch your tree. To verify a delta you can also use the <code
class="OPTION">-c</code> flag and <b class="APPLICATION">CTM</b> will not actually touch
your tree; it will merely verify the integrity of the delta and see if it would apply
cleanly to your current tree.</p>

<p>There are other options to <b class="APPLICATION">CTM</b> as well, see the manual
pages or look in the sources for more information.</p>

<p>That is really all there is to it. Every time you get a new delta, just run it through
<b class="APPLICATION">CTM</b> to keep your sources up to date.</p>

<p>Do not remove the deltas if they are hard to download again. You just might want to
keep them around in case something bad happens. Even if you only have floppy disks,
consider using <tt class="COMMAND">fdwrite</tt> to make a copy.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43045" name="AEN43045">A.4.5 Keeping Your Local
Changes</a></h2>

<p>As a developer one would like to experiment with and change files in the source tree.
<b class="APPLICATION">CTM</b> supports local modifications in a limited way: before
checking for the presence of a file <tt class="FILENAME">foo</tt>, it first looks for <tt
class="FILENAME">foo.ctm</tt>. If this file exists, <b class="APPLICATION">CTM</b> will
operate on it instead of <tt class="FILENAME">foo</tt>.</p>

<p>This behavior gives us a simple way to maintain local changes: simply copy the files
you plan to modify to the corresponding file names with a <tt class="FILENAME">.ctm</tt>
suffix. Then you can freely hack the code, while <b class="APPLICATION">CTM</b> keeps the
<tt class="FILENAME">.ctm</tt> file up-to-date.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43057" name="AEN43057">A.4.6 其他有趣的 <b
class="APPLICATION">CTM</b> 選項</a></h2>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN43060" name="AEN43060">A.4.6.1 Finding Out Exactly What Would
Be Touched by an Update</a></h3>

<p>You can determine the list of changes that <b class="APPLICATION">CTM</b> will make on
your source repository using the <code class="OPTION">-l</code> option to <b
class="APPLICATION">CTM</b>.</p>

<p>This is useful if you would like to keep logs of the changes, pre- or post- process
the modified files in any manner, or just are feeling a tad paranoid.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN43067" name="AEN43067">A.4.6.2 Making Backups Before
Updating</a></h3>

<p>Sometimes you may want to backup all the files that would be changed by a <b
class="APPLICATION">CTM</b> update.</p>

<p>Specifying the <code class="OPTION">-B backup-file</code> option causes <b
class="APPLICATION">CTM</b> to backup all files that would be touched by a given <b
class="APPLICATION">CTM</b> delta to <tt class="FILENAME">backup-file</tt>.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN43076" name="AEN43076">A.4.6.3 Restricting the Files Touched
by an Update</a></h3>

<p>Sometimes you would be interested in restricting the scope of a given <b
class="APPLICATION">CTM</b> update, or may be interested in extracting just a few files
from a sequence of deltas.</p>

<p>You can control the list of files that <b class="APPLICATION">CTM</b> would operate on
by specifying filtering regular expressions using the <code class="OPTION">-e</code> and
<code class="OPTION">-x</code> options.</p>

<p>For example, to extract an up-to-date copy of <tt
class="FILENAME">lib/libc/Makefile</tt> from your collection of saved <b
class="APPLICATION">CTM</b> deltas, run the commands:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">cd /where/ever/you/want/to/extract/it/</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">ctm -e '^lib/libc/Makefile' ~ctm/src-xxx.*</kbd>
</pre>

<p>For every file specified in a <b class="APPLICATION">CTM</b> delta, the <code
class="OPTION">-e</code> and <code class="OPTION">-x</code> options are applied in the
order given on the command line. The file is processed by <b class="APPLICATION">CTM</b>
only if it is marked as eligible after all the <code class="OPTION">-e</code> and <code
class="OPTION">-x</code> options are applied to it.</p>
</div>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43099" name="AEN43099">A.4.7 Future Plans for <b
class="APPLICATION">CTM</b></a></h2>

<p>Tons of them:</p>

<ul>
<li>
<p>Use some kind of authentication into the <b class="APPLICATION">CTM</b> system, so as
to allow detection of spoofed <b class="APPLICATION">CTM</b> updates.</p>
</li>

<li>
<p>Clean up the options to <b class="APPLICATION">CTM</b>, they became confusing and
counter intuitive.</p>
</li>
</ul>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="AEN43111" name="AEN43111">A.4.8 Miscellaneous Stuff</a></h2>

<p>There is a sequence of deltas for the <tt class="LITERAL">ports</tt> collection too,
but interest has not been all that high yet.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="MIRRORS-CTM" name="MIRRORS-CTM">A.4.9 CTM Mirrors</a></h2>

<p><a href="ctm.html">CTM</a>/FreeBSD is available via anonymous FTP from the following
mirror sites. If you choose to obtain <b class="APPLICATION">CTM</b> via anonymous FTP,
please try to use a site near you.</p>

<p>In case of problems, please contact the <a
href="http://lists.FreeBSD.org/mailman/listinfo/ctm-users" target="_top">ctm-users</a>
mailing list.</p>

<div class="VARIABLELIST">
<dl>
<dt>California, Bay Area, official source</dt>

<dd>
<ul>
<li>
<p><a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/development/CTM/"
target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/development/CTM/</a></p>
</li>
</ul>
</dd>

<dt>South Africa, backup server for old deltas</dt>

<dd>
<ul>
<li>
<p><a href="ftp://ftp.za.FreeBSD.org/pub/FreeBSD/CTM/"
target="_top">ftp://ftp.za.FreeBSD.org/pub/FreeBSD/CTM/</a></p>
</li>
</ul>
</dd>

<dt>Taiwan/R.O.C.</dt>

<dd>
<ul>
<li>
<p><a href="ftp://ctm.tw.FreeBSD.org/pub/FreeBSD/development/CTM/"
target="_top">ftp://ctm.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></p>
</li>

<li>
<p><a href="ftp://ctm2.tw.FreeBSD.org/pub/FreeBSD/development/CTM/"
target="_top">ftp://ctm2.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></p>
</li>

<li>
<p><a href="ftp://ctm3.tw.FreeBSD.org/pub/FreeBSD/development/CTM/"
target="_top">ftp://ctm3.tw.FreeBSD.org/pub/FreeBSD/development/CTM/</a></p>
</li>
</ul>
</dd>
</dl>
</div>

<p>If you did not find a mirror near to you or the mirror is incomplete, try to use a
search engine such as <a href="http://www.alltheweb.com/"
target="_top">alltheweb</a>.</p>
</div>
</div>

<div class="NAVFOOTER">
<hr align="LEFT" width="100%" />
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="anoncvs.html"
accesskey="P">Prev</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Home</a></td>
<td width="33%" align="right" valign="top"><a href="cvsup.html"
accesskey="N">Next</a></td>
</tr>

<tr>
<td width="33%" align="left" valign="top">匿名 CVS</td>
<td width="34%" align="center" valign="top"><a href="mirrors.html"
accesskey="U">Up</a></td>
<td width="33%" align="right" valign="top">使用 CVSup</td>
</tr>
</table>
</div>

<p align="center"><small>本文及其他文件，可由此下載：<a
href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p>

<p align="center"><small>若有 FreeBSD 方面疑問，請先閱讀 <a
href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
&#60;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&#62;。<br />
關於本文件的問題，請洽詢 &#60;<a
href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&#62;。</small></p>
</body>
</html>


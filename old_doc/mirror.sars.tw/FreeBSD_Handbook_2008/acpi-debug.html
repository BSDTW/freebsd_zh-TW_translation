<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org" />
<title>Using and Debugging FreeBSD ACPI</title>
<meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.79" />
<link rel="HOME" title="FreeBSD 使用手冊" href="index.html" />
<link rel="UP" title="設定與效能調校(Tuning)" href="config-tuning.html" />
<link rel="PREVIOUS" title="Power and Resource Management" href="acpi-overview.html" />
<link rel="NEXT" title="FreeBSD 開機流程篇" href="boot.html" />
<link rel="STYLESHEET" type="text/css" href="docbook.css" />
<meta http-equiv="Content-Type" content="text/html; charset=Big5" />
</head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084"
alink="#0000FF">
<div class="NAVHEADER">
<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">FreeBSD 使用手冊</th>
</tr>

<tr>
<td width="10%" align="left" valign="bottom"><a href="acpi-overview.html"
accesskey="P">Prev</a></td>
<td width="80%" align="center" valign="bottom">Chapter 11 設定與效能調校(Tuning)</td>
<td width="10%" align="right" valign="bottom"><a href="boot.html"
accesskey="N">Next</a></td>
</tr>
</table>

<hr align="LEFT" width="100%" />
</div>

<div class="SECT1">
<h1 class="SECT1"><a id="ACPI-DEBUG" name="ACPI-DEBUG">11.16 Using and Debugging FreeBSD
<acronym class="ACRONYM">ACPI</acronym></a></h1>

<i class="AUTHORGROUP"><span class="CONTRIB">Written by</span> Nate Lawson.</i> <i
class="AUTHORGROUP"><span class="CONTRIB">With contributions from</span> Peter Schultz
and Tom Rhodes.</i> 

<p><acronym class="ACRONYM">ACPI</acronym> is a fundamentally new way of discovering
devices, managing power usage, and providing standardized access to various hardware
previously managed by the <acronym class="ACRONYM">BIOS</acronym>. Progress is being made
toward <acronym class="ACRONYM">ACPI</acronym> working on all systems, but bugs in some
motherboards' <i class="FIRSTTERM"><acronym class="ACRONYM">ACPI</acronym> Machine
Language</i> (<acronym class="ACRONYM">AML</acronym>) bytecode, incompleteness in
FreeBSD's kernel subsystems, and bugs in the <span class="TRADEMARK">Intel</span>&reg;
<acronym class="ACRONYM">ACPI-CA</acronym> interpreter continue to appear.</p>

<p>This document is intended to help you assist the FreeBSD <acronym
class="ACRONYM">ACPI</acronym> maintainers in identifying the root cause of problems you
observe and debugging and developing a solution. Thanks for reading this and we hope we
can solve your system's problems.</p>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-SUBMITDEBUG" name="ACPI-SUBMITDEBUG">11.16.1 Submitting
Debugging Information</a></h2>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> Before submitting a problem, be sure you are running the latest <acronym
class="ACRONYM">BIOS</acronym> version and, if available, embedded controller firmware
version.</p>
</blockquote>
</div>

<p>For those of you that want to submit a problem right away, please send the following
information to <a href="mailto:freebsd-acpi@FreeBSD.org"
target="_top">freebsd-acpi@FreeBSD.org</a>:</p>

<ul>
<li>
<p>Description of the buggy behavior, including system type and model and anything that
causes the bug to appear. Also, please note as accurately as possible when the bug began
occurring if it is new for you.</p>
</li>

<li>
<p>The <a href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dmesg</span>(8)</span></a> output after
<tt class="COMMAND">boot -v</tt>, including any error messages generated by you
exercising the bug.</p>
</li>

<li>
<p>The <a href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dmesg</span>(8)</span></a> output from
<tt class="COMMAND">boot -v</tt> with <acronym class="ACRONYM">ACPI</acronym> disabled,
if disabling it helps fix the problem.</p>
</li>

<li>
<p>Output from <tt class="COMMAND">sysctl hw.acpi</tt>. This is also a good way of
figuring out what features your system offers.</p>
</li>

<li>
<p><acronym class="ACRONYM">URL</acronym> where your <i class="FIRSTTERM"><acronym
class="ACRONYM">ACPI</acronym> Source Language</i> (<acronym
class="ACRONYM">ASL</acronym>) can be found. Do <span class="emphasis"><b
class="EMPHASIS">not</b></span> send the <acronym class="ACRONYM">ASL</acronym> directly
to the list as it can be very large. Generate a copy of your <acronym
class="ACRONYM">ASL</acronym> by running this command:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">acpidump -t -d &gt; <tt
class="REPLACEABLE"><i>name</i></tt>-<tt class="REPLACEABLE"><i>system</i></tt>.asl</kbd>
</pre>

<p>(Substitute your login name for <tt class="REPLACEABLE"><i>name</i></tt> and
manufacturer/model for <tt class="REPLACEABLE"><i>system</i></tt>. Example: <tt
class="FILENAME">njl-FooCo6000.asl</tt>)</p>
</li>
</ul>

<p>Most of the developers watch the <a
href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current"
target="_top">FreeBSD-CURRENT 郵遞論壇</a> but please submit problems to <a
href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi"
target="_top">freebsd-acpi</a> to be sure it is seen. Please be patient, all of us have
full-time jobs elsewhere. If your bug is not immediately apparent, we will probably ask
you to submit a <acronym class="ACRONYM">PR</acronym> via <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">send-pr</span>(1)</span></a>. When
entering a <acronym class="ACRONYM">PR</acronym>, please include the same information as
requested above. This will help us track the problem and resolve it. Do not send a
<acronym class="ACRONYM">PR</acronym> without emailing <a
href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi"
target="_top">freebsd-acpi</a> first as we use <acronym class="ACRONYM">PR</acronym>s as
reminders of existing problems, not a reporting mechanism. It is likely that your problem
has been reported by someone before.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-BACKGROUND" name="ACPI-BACKGROUND">11.16.2
Background</a></h2>

<p><acronym class="ACRONYM">ACPI</acronym> is present in all modern computers that
conform to the ia32 (x86), ia64 (Itanium), and amd64 (AMD) architectures. The full
standard has many features including <acronym class="ACRONYM">CPU</acronym> performance
management, power planes control, thermal zones, various battery systems, embedded
controllers, and bus enumeration. Most systems implement less than the full standard. For
instance, a desktop system usually only implements the bus enumeration parts while a
laptop might have cooling and battery management support as well. Laptops also have
suspend and resume, with their own associated complexity.</p>

<p>An <acronym class="ACRONYM">ACPI</acronym>-compliant system has various components.
The <acronym class="ACRONYM">BIOS</acronym> and chipset vendors provide various fixed
tables (e.g., <acronym class="ACRONYM">FADT</acronym>) in memory that specify things like
the <acronym class="ACRONYM">APIC</acronym> map (used for <acronym
class="ACRONYM">SMP</acronym>), config registers, and simple configuration values.
Additionally, a table of bytecode (the <i class="FIRSTTERM">Differentiated System
Description Table</i> <acronym class="ACRONYM">DSDT</acronym>) is provided that specifies
a tree-like name space of devices and methods.</p>

<p>The <acronym class="ACRONYM">ACPI</acronym> driver must parse the fixed tables,
implement an interpreter for the bytecode, and modify device drivers and the kernel to
accept information from the <acronym class="ACRONYM">ACPI</acronym> subsystem. For
FreeBSD, <span class="TRADEMARK">Intel</span> has provided an interpreter (<acronym
class="ACRONYM">ACPI-CA</acronym>) that is shared with Linux and NetBSD. The path to the
<acronym class="ACRONYM">ACPI-CA</acronym> source code is <tt
class="FILENAME">src/sys/contrib/dev/acpica</tt>. The glue code that allows <acronym
class="ACRONYM">ACPI-CA</acronym> to work on FreeBSD is in <tt
class="FILENAME">src/sys/dev/acpica/Osd</tt>. Finally, drivers that implement various
<acronym class="ACRONYM">ACPI</acronym> devices are found in <tt
class="FILENAME">src/sys/dev/acpica</tt>.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-COMPROB" name="ACPI-COMPROB">11.16.3 Common
Problems</a></h2>

<p>For <acronym class="ACRONYM">ACPI</acronym> to work correctly, all the parts have to
work correctly. Here are some common problems, in order of frequency of appearance, and
some possible workarounds or fixes.</p>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16674" name="AEN16674">11.16.3.1 Mouse Issues</a></h3>

<p>In some cases, resuming from a suspend operation will cause the mouse to fail. A known
work around is to add <tt class="LITERAL">hint.psm.0.flags="0x3000"</tt> to the <tt
class="FILENAME">/boot/loader.conf</tt> file. If this does not work then please consider
sending a bug report as described above.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16679" name="AEN16679">11.16.3.2 Suspend/Resume</a></h3>

<p><acronym class="ACRONYM">ACPI</acronym> has three suspend to <acronym
class="ACRONYM">RAM</acronym> (<acronym class="ACRONYM">STR</acronym>) states, <tt
class="LITERAL">S1</tt>-<tt class="LITERAL">S3</tt>, and one suspend to disk state (<tt
class="LITERAL">STD</tt>), called <tt class="LITERAL">S4</tt>. <tt
class="LITERAL">S5</tt> is “soft off” and is the normal state your system is in when
plugged in but not powered up. <tt class="LITERAL">S4</tt> can actually be implemented
two separate ways. <tt class="LITERAL">S4</tt><acronym class="ACRONYM">BIOS</acronym> is
a <acronym class="ACRONYM">BIOS</acronym>-assisted suspend to disk. <tt
class="LITERAL">S4</tt><acronym class="ACRONYM">OS</acronym> is implemented entirely by
the operating system.</p>

<p>Start by checking <tt class="COMMAND">sysctl hw.acpi</tt> for the suspend-related
items. Here are the results for a Thinkpad:</p>

<pre class="SCREEN">
hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0
</pre>

<p>This means that we can use <tt class="COMMAND">acpiconf -s</tt> to test <tt
class="LITERAL">S3</tt>, <tt class="LITERAL">S4</tt><acronym
class="ACRONYM">OS</acronym>, and <tt class="LITERAL">S5</tt>. If <code
class="OPTION">s4bios</code> was one (<tt class="LITERAL">1</tt>), we would have <tt
class="LITERAL">S4</tt><acronym class="ACRONYM">BIOS</acronym> support instead of <tt
class="LITERAL">S4</tt> <acronym class="ACRONYM">OS</acronym>.</p>

<p>When testing suspend/resume, start with <tt class="LITERAL">S1</tt>, if supported.
This state is most likely to work since it does not require much driver support. No one
has implemented <tt class="LITERAL">S2</tt> but if you have it, it is similar to <tt
class="LITERAL">S1</tt>. The next thing to try is <tt class="LITERAL">S3</tt>. This is
the deepest <acronym class="ACRONYM">STR</acronym> state and requires a lot of driver
support to properly reinitialize your hardware. If you have problems resuming, feel free
to email the <a href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi"
target="_top">freebsd-acpi</a> list but do not expect the problem to be resolved since
there are a lot of drivers/hardware that need more testing and work.</p>

<p>To help isolate the problem, remove as many drivers from your kernel as possible. If
it works, you can narrow down which driver is the problem by loading drivers until it
fails again. Typically binary drivers like <tt class="FILENAME">nvidia.ko</tt>, X11
display drivers, and <acronym class="ACRONYM">USB</acronym> will have the most problems
while Ethernet interfaces usually work fine. If you can properly load/unload the drivers,
you can automate this by putting the appropriate commands in <tt
class="FILENAME">/etc/rc.suspend</tt> and <tt class="FILENAME">/etc/rc.resume</tt>. There
is a commented-out example for unloading and loading a driver. Try setting <code
class="OPTION">hw.acpi.reset_video</code> to zero (<tt class="LITERAL">0</tt>) if your
display is messed up after resume. Try setting longer or shorter values for <code
class="OPTION">hw.acpi.sleep_delay</code> to see if that helps.</p>

<p>Another thing to try is load a recent Linux distribution with <acronym
class="ACRONYM">ACPI</acronym> support and test their suspend/resume support on the same
hardware. If it works on Linux, it is likely a FreeBSD driver problem and narrowing down
which driver causes the problems will help us fix the problem. Note that the <acronym
class="ACRONYM">ACPI</acronym> maintainers do not usually maintain other drivers (e.g
sound, <acronym class="ACRONYM">ATA</acronym>, etc.) so any work done on tracking down a
driver problem should probably eventually be posted to the <a
href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current"
target="_top">freebsd-current</a> list and mailed to the driver maintainer. If you are
feeling adventurous, go ahead and start putting some debugging <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">printf</span>(3)</span></a>s in a
problematic driver to track down where in its resume function it hangs.</p>

<p>Finally, try disabling <acronym class="ACRONYM">ACPI</acronym> and enabling <acronym
class="ACRONYM">APM</acronym> instead. If suspend/resume works with <acronym
class="ACRONYM">APM</acronym>, you may be better off sticking with <acronym
class="ACRONYM">APM</acronym>, especially on older hardware (pre-2000). It took vendors a
while to get <acronym class="ACRONYM">ACPI</acronym> support correct and older hardware
is more likely to have <acronym class="ACRONYM">BIOS</acronym> problems with <acronym
class="ACRONYM">ACPI</acronym>.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16743" name="AEN16743">11.16.3.3 System Hangs (temporary or
permanent)</a></h3>

<p>Most system hangs are a result of lost interrupts or an interrupt storm. Chipsets have
a lot of problems based on how the <acronym class="ACRONYM">BIOS</acronym> configures
interrupts before boot, correctness of the <acronym class="ACRONYM">APIC</acronym>
(<acronym class="ACRONYM">MADT</acronym>) table, and routing of the <i
class="FIRSTTERM">System Control Interrupt</i> (<acronym
class="ACRONYM">SCI</acronym>).</p>

<p>Interrupt storms can be distinguished from lost interrupts by checking the output of
<tt class="COMMAND">vmstat -i</tt> and looking at the line that has <tt
class="LITERAL">acpi0</tt>. If the counter is increasing at more than a couple per
second, you have an interrupt storm. If the system appears hung, try breaking to <acronym
class="ACRONYM">DDB</acronym> (<b class="KEYCAP">CTRL</b>+<b class="KEYCAP">ALT</b>+<b
class="KEYCAP">ESC</b> on console) and type <tt class="LITERAL">show interrupts</tt>.</p>

<p>Your best hope when dealing with interrupt problems is to try disabling <acronym
class="ACRONYM">APIC</acronym> support with <tt
class="LITERAL">hint.apic.0.disabled="1"</tt> in <tt
class="FILENAME">loader.conf</tt>.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16769" name="AEN16769">11.16.3.4 Panics</a></h3>

<p>Panics are relatively rare for <acronym class="ACRONYM">ACPI</acronym> and are the top
priority to be fixed. The first step is to isolate the steps to reproduce the panic (if
possible) and get a backtrace. Follow the advice for enabling <tt class="LITERAL">options
DDB</tt> and setting up a serial console (see <a
href="serialconsole-setup.html#SERIALCONSOLE-DDB">Section 24.6.5.3</a>) or setting up a
<a href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a> partition. You
can get a backtrace in <acronym class="ACRONYM">DDB</acronym> with <tt
class="LITERAL">tr</tt>. If you have to handwrite the backtrace, be sure to at least get
the lowest five (5) and top five (5) lines in the trace.</p>

<p>Then, try to isolate the problem by booting with <acronym
class="ACRONYM">ACPI</acronym> disabled. If that works, you can isolate the <acronym
class="ACRONYM">ACPI</acronym> subsystem by using various values of <code
class="OPTION">debug.acpi.disable</code>. See the <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpi</span>(4)</span></a> manual page
for some examples.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16787" name="AEN16787">11.16.3.5 System Powers Up After
Suspend or Shutdown</a></h3>

<p>First, try setting <tt class="LITERAL">hw.acpi.disable_on_poweroff="0"</tt> in <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">loader.conf</span>(5)</span></a>. This
keeps <acronym class="ACRONYM">ACPI</acronym> from disabling various events during the
shutdown process. Some systems need this value set to <tt class="LITERAL">1</tt> (the
default) for the same reason. This usually fixes the problem of a system powering up
spontaneously after a suspend or poweroff.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16796" name="AEN16796">11.16.3.6 Other Problems</a></h3>

<p>If you have other problems with <acronym class="ACRONYM">ACPI</acronym> (working with
a docking station, devices not detected, etc.), please email a description to the mailing
list as well; however, some of these issues may be related to unfinished parts of the
<acronym class="ACRONYM">ACPI</acronym> subsystem so they might take a while to be
implemented. Please be patient and prepared to test patches we may send you.</p>
</div>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-ASLANDDUMP" name="ACPI-ASLANDDUMP">11.16.4 <acronym
class="ACRONYM">ASL</acronym>, <tt class="COMMAND">acpidump</tt>, and <acronym
class="ACRONYM">IASL</acronym></a></h2>

<p>The most common problem is the <acronym class="ACRONYM">BIOS</acronym> vendors
providing incorrect (or outright buggy!) bytecode. This is usually manifested by kernel
console messages like this:</p>

<pre class="SCREEN">
ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND
</pre>

<p>Often, you can resolve these problems by updating your <acronym
class="ACRONYM">BIOS</acronym> to the latest revision. Most console messages are harmless
but if you have other problems like battery status not working, they are a good place to
start looking for problems in the <acronym class="ACRONYM">AML</acronym>. The bytecode,
known as <acronym class="ACRONYM">AML</acronym>, is compiled from a source language
called <acronym class="ACRONYM">ASL</acronym>. The <acronym class="ACRONYM">AML</acronym>
is found in the table known as the <acronym class="ACRONYM">DSDT</acronym>. To get a copy
of your <acronym class="ACRONYM">ASL</acronym>, use <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpidump</span>(8)</span></a>. You
should use both the <code class="OPTION">-t</code> (show contents of the fixed tables)
and <code class="OPTION">-d</code> (disassemble <acronym class="ACRONYM">AML</acronym> to
<acronym class="ACRONYM">ASL</acronym>) options. See the <a
href="acpi-debug.html#ACPI-SUBMITDEBUG">Submitting Debugging Information</a> section for
an example syntax.</p>

<p>The simplest first check you can do is to recompile your <acronym
class="ACRONYM">ASL</acronym> to check for errors. Warnings can usually be ignored but
errors are bugs that will usually prevent <acronym class="ACRONYM">ACPI</acronym> from
working correctly. To recompile your <acronym class="ACRONYM">ASL</acronym>, issue the
following command:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">iasl your.asl</kbd>
</pre>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-FIXASL" name="ACPI-FIXASL">11.16.5 Fixing Your <acronym
class="ACRONYM">ASL</acronym></a></h2>

<p>In the long run, our goal is for almost everyone to have <acronym
class="ACRONYM">ACPI</acronym> work without any user intervention. At this point,
however, we are still developing workarounds for common mistakes made by the <acronym
class="ACRONYM">BIOS</acronym> vendors. The <span class="TRADEMARK">Microsoft</span>&reg;
interpreter (<tt class="FILENAME">acpi.sys</tt> and <tt class="FILENAME">acpiec.sys</tt>)
does not strictly check for adherence to the standard, and thus many <acronym
class="ACRONYM">BIOS</acronym> vendors who only test <acronym
class="ACRONYM">ACPI</acronym> under <span class="TRADEMARK">Windows</span>&reg; never
fix their <acronym class="ACRONYM">ASL</acronym>. We hope to continue to identify and
document exactly what non-standard behavior is allowed by <span
class="TRADEMARK">Microsoft</span>'s interpreter and replicate it so FreeBSD can work
without forcing users to fix the <acronym class="ACRONYM">ASL</acronym>. As a workaround
and to help us identify behavior, you can fix the <acronym class="ACRONYM">ASL</acronym>
manually. If this works for you, please send a <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">diff</span>(1)</span></a> of the old and
new <acronym class="ACRONYM">ASL</acronym> so we can possibly work around the buggy
behavior in <acronym class="ACRONYM">ACPI-CA</acronym> and thus make your fix
unnecessary.</p>

<p>Here is a list of common error messages, their cause, and how to fix them:</p>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16863" name="AEN16863">11.16.5.1 _OS dependencies</a></h3>

<p>Some <acronym class="ACRONYM">AML</acronym> assumes the world consists of various
<span class="TRADEMARK">Windows</span> versions. You can tell FreeBSD to claim it is any
<acronym class="ACRONYM">OS</acronym> to see if this fixes problems you may have. An easy
way to override this is to set <tt class="LITERAL">hw.acpi.osname="Windows 2001"</tt> in
<tt class="FILENAME">/boot/loader.conf</tt> or other similar strings you find in the
<acronym class="ACRONYM">ASL</acronym>.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16872" name="AEN16872">11.16.5.2 Missing Return
statements</a></h3>

<p>Some methods do not explicitly return a value as the standard requires. While <acronym
class="ACRONYM">ACPI-CA</acronym> does not handle this, FreeBSD has a workaround that
allows it to return the value implicitly. You can also add explicit Return statements
where required if you know what value should be returned. To force <tt
class="COMMAND">iasl</tt> to compile the <acronym class="ACRONYM">ASL</acronym>, use the
<code class="OPTION">-f</code> flag.</p>
</div>

<div class="SECT3">
<h3 class="SECT3"><a id="AEN16879" name="AEN16879">11.16.5.3 Overriding the Default
<acronym class="ACRONYM">AML</acronym></a></h3>

<p>After you customize <tt class="FILENAME">your.asl</tt>, you will want to compile it,
run:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">iasl your.asl</kbd>
</pre>

<p>You can add the <code class="OPTION">-f</code> flag to force creation of the <acronym
class="ACRONYM">AML</acronym>, even if there are errors during compilation. Remember that
some errors (e.g., missing Return statements) are automatically worked around by the
interpreter.</p>

<p><tt class="FILENAME">DSDT.aml</tt> is the default output filename for <tt
class="COMMAND">iasl</tt>. You can load this instead of your <acronym
class="ACRONYM">BIOS</acronym>'s buggy copy (which is still present in flash memory) by
editing <tt class="FILENAME">/boot/loader.conf</tt> as follows:</p>

<pre class="PROGRAMLISTING">
acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"
</pre>

<p>Be sure to copy your <tt class="FILENAME">DSDT.aml</tt> to the <tt
class="FILENAME">/boot</tt> directory.</p>
</div>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-DEBUGOUTPUT" name="ACPI-DEBUGOUTPUT">11.16.6 Getting
Debugging Output From <acronym class="ACRONYM">ACPI</acronym></a></h2>

<p>The <acronym class="ACRONYM">ACPI</acronym> driver has a very flexible debugging
facility. It allows you to specify a set of subsystems as well as the level of verbosity.
The subsystems you wish to debug are specified as “layers” and are broken down into
<acronym class="ACRONYM">ACPI-CA</acronym> components (ACPI_ALL_COMPONENTS) and <acronym
class="ACRONYM">ACPI</acronym> hardware support (ACPI_ALL_DRIVERS). The verbosity of
debugging output is specified as the “level” and ranges from ACPI_LV_ERROR (just report
errors) to ACPI_LV_VERBOSE (everything). The “level” is a bitmask so multiple options
can be set at once, separated by spaces. In practice, you will want to use a serial
console to log the output if it is so long it flushes the console message buffer. A full
list of the individual layers and levels is found in the <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpi</span>(4)</span></a> manual
page.</p>

<p>Debugging output is not enabled by default. To enable it, add <tt
class="LITERAL">options ACPI_DEBUG</tt> to your kernel configuration file if <acronym
class="ACRONYM">ACPI</acronym> is compiled into the kernel. You can add <tt
class="LITERAL">ACPI_DEBUG=1</tt> to your <tt class="FILENAME">/etc/make.conf</tt> to
enable it globally. If it is a module, you can recompile just your <tt
class="FILENAME">acpi.ko</tt> module as follows:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /sys/modules/acpi/acpi
&amp;&amp; make clean &amp;&amp;
make ACPI_DEBUG=1</kbd>
</pre>

<p>Install <tt class="FILENAME">acpi.ko</tt> in <tt class="FILENAME">/boot/kernel</tt>
and add your desired level and layer to <tt class="FILENAME">loader.conf</tt>. This
example enables debug messages for all <acronym class="ACRONYM">ACPI-CA</acronym>
components and all <acronym class="ACRONYM">ACPI</acronym> hardware drivers (<acronym
class="ACRONYM">CPU</acronym>, <acronym class="ACRONYM">LID</acronym>, etc.) It will only
output error messages, the least verbose level.</p>

<pre class="PROGRAMLISTING">
debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"
</pre>

<p>If the information you want is triggered by a specific event (say, a suspend and then
resume), you can leave out changes to <tt class="FILENAME">loader.conf</tt> and instead
use <tt class="COMMAND">sysctl</tt> to specify the layer and level after booting and
preparing your system for the specific event. The <tt class="COMMAND">sysctl</tt>s are
named the same as the tunables in <tt class="FILENAME">loader.conf</tt>.</p>
</div>

<div class="SECT2">
<h2 class="SECT2"><a id="ACPI-REFERENCES" name="ACPI-REFERENCES">11.16.7
References</a></h2>

<p>More information about <acronym class="ACRONYM">ACPI</acronym> may be found in the
following locations:</p>

<ul>
<li>
<p>The <a href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi"
target="_top">FreeBSD ACPI 郵遞論壇</a></p>
</li>

<li>
<p>The <acronym class="ACRONYM">ACPI</acronym> Mailing List Archives <a
href="http://lists.freebsd.org/pipermail/freebsd-acpi/"
target="_top">http://lists.freebsd.org/pipermail/freebsd-acpi/</a></p>
</li>

<li>
<p>The old <acronym class="ACRONYM">ACPI</acronym> Mailing List Archives <a
href="http://home.jp.FreeBSD.org/mail-list/acpi-jp/"
target="_top">http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></p>
</li>

<li>
<p>The <acronym class="ACRONYM">ACPI</acronym> 2.0 Specification <a
href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></p>
</li>

<li>
<p>FreeBSD Manual pages: <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpi</span>(4)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpi_thermal</span>(4)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpidump</span>(8)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">iasl</span>(8)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">acpidb</span>(8)</span></a></p>
</li>

<li>
<p><a href="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt"
target="_top"><acronym class="ACRONYM">DSDT</acronym> debugging resource</a>. (Uses
Compaq as an example but generally useful.)</p>
</li>
</ul>
</div>
</div>

<div class="NAVFOOTER">
<hr align="LEFT" width="100%" />
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="acpi-overview.html"
accesskey="P">Prev</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Home</a></td>
<td width="33%" align="right" valign="top"><a href="boot.html"
accesskey="N">Next</a></td>
</tr>

<tr>
<td width="33%" align="left" valign="top">Power and Resource Management</td>
<td width="34%" align="center" valign="top"><a href="config-tuning.html"
accesskey="U">Up</a></td>
<td width="33%" align="right" valign="top">FreeBSD 開機流程篇</td>
</tr>
</table>
</div>

<p align="center"><small>本文及其他文件，可由此下載：<a
href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p>

<p align="center"><small>若有 FreeBSD 方面疑問，請先閱讀 <a
href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
&#60;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&#62;。<br />
關於本文件的問題，請洽詢 &#60;<a
href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&#62;。</small></p>
</body>
</html>


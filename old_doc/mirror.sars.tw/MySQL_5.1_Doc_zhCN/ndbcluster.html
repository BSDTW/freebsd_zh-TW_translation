<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Chapter 17. MySQL Cluster</title><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="MySQL 5.1 Reference Manual"><link rel="up" href="index.html" title="MySQL 5.1 Reference Manual"><link rel="prev" href="custom-engine.html" title="Chapter 16. Writing a Custom Storage Engine"><link rel="next" href="partitioning.html" title="Chapter 18. Partitioning">
<style>
<!--
span.quote
	{}
 table.MsoNormalTable
	{mso-style-parent:"";
	font-size:10.0pt;
	
	}
 li.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	font-size:12.0pt;
	
	; margin-left:0cm; margin-right:0cm; margin-top:0cm}
-->
</style>
</head><body><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ndbcluster"></a>
	第17章：MySQL叢集</h2></div></div></div><div class="toc"><p><b>
	目錄</b></p><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-overview">17.1. 
		MySQL叢集概述</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-basics">
		17.2. MySQL叢集的基本概念</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-computer">
		17.3. 多計算機的簡單基礎知識</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#multi-hardware-software-network">
			17.3.1. 硬件、軟件和聯網</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-install">
			17.3.2. 安裝</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-config">
			17.3.3. 配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-initial">
			17.3.4. 首次啟動</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-load-data-queries">
			17.3.5. 加載示範數據並執行查詢</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-shutdown-restart">
			17.3.6. 安全關閉和重啟</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-configuration">17.4. 
		MySQL叢集的配置</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-building">
			17.4.1. 從原始碼建立MySQL叢集</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-installing">
			17.4.2. 安裝軟件</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-quick">
			17.4.3. MySQL叢集的快速測試設置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-file">17.4.4. 
			配置檔案</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-process-management">
		17.5. MySQL叢集中的程序管理</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysqld-process">
			17.5.1. 用於MySQL叢集的MySQL伺服器程序使用</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-process">17.5.2. <span><strong class="command">
			ndbd</strong></span>，儲存引擎節點程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-process">17.5.3. <span><strong class="command">
			ndb_mgmd</strong></span>，「管理伺服器」程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-process">17.5.4. <span><strong class="command">
			ndb_mgm</strong></span>，「管理客戶端」程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-command-options">
			17.5.5. 用於MySQL叢集程序的命令選項</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-management">
		17.6. MySQL叢集的管理</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-startup-phases">17.6.1. 
			MySQL叢集的啟動階段</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mgm-client-commands">
			17.6.2. 「管理客戶端」中的命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-event-reports">
			17.6.3. MySQL叢集中生成的事件報告</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-single-user-mode">
			17.6.4. 單用戶模式</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup">
			17.6.5. MySQL叢集的聯機備份</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-interconnects">
		17.7. 使用與MySQL叢集的高速互連</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#sci-sockets">
			17.7.1. 配置MySQL叢集以使用SCI套接字</a></span></dt><dt><span class="section"><a href="ndbcluster.html#performance-figures">
			17.7.2. 理解叢集互連的影響</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-limitations">
		17.8. MySQL叢集的已知限制</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-roadmap">17.9. 
		MySQL叢集發展的重要歷程</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-5-0-cluster-changes">17.9.1. 
			MySQL 5.0中的MySQL叢集變化</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-5-1-cluster-roadmap">
			17.9.2. 關於MySQL叢集的MySQL 5.1發展歷程</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-faq">17.10. 
		MySQL叢集常見問題解答</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-glossary">17.11. 
		MySQL叢集術語資料表</a></span></dt></dl></div>
	<p><span>MySQL</span>叢集是<span>MySQL</span>適合於分佈式計算環境的高實用、高冗余版本。它採用了<span><span>NDB</span>叢集儲存引擎，允許在<span>1</span>個叢集中運行多個</span><span>MySQL</span>伺服器。在<span>MySQL 
	5.1</span>二進製版本中、以及與最新的<span>Linux</span>版本兼容的<span>RPM</span>中提供了該儲存引擎。（注意，要想獲得<span>MySQL</span>叢集的功能，必須安裝<span>mysql-server</span>和<span>mysql-max</span><span> 
	RPM</span>）。</p>
	<p>目前能夠運行<span>MySQL</span>叢集的作業系統有<span>Linux</span>、<span>Mac 
	OS X</span>和<span>Solaris</span>。（一些用戶通報成功地在<span>FreeBSD</span>上運行了<span>MySQL</span>叢集，但<span>MySQL 
	AB</span>公司尚未正式支援該特性）。我們正在努力，以便使<span>MySQL</span>叢集能運行在<span>MySQL</span>支援的所有作業系統上，包括<span>Windows</span>，而且當支援新的平台時，將更新該頁面。</p>
	<p>本章介紹了正在進行的工作，其內容將隨著<span>MySQL</span>叢集的不斷演化而變化。關於<span>MySQL</span>叢集的更多訊息，請訪問<span>MySQL 
	AB</span>公司的網站<span><a target="_top"  href="http://www.mysql.com/products/cluster/">http://www.mysql.com/products/cluster/</a></span>。</p>
	<p>或許您也希望使用<span>MySQL AB</span>提供的兩種額外資源：</p>
	<p>
	<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	</span></span><span>MySQL</span>叢集<span><a target="_top"  href="http://lists.mysql.com/cluster"><span>郵件列資料表</span></a></span>。</p>
	<p>
	<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	</span></span><span>MySQL</span>用戶論壇上的<span><a target="_top"  href="http://forums.mysql.com/list.php?25"><span>叢集主題區</span></a></span>。</p>
	<p>關於叢集的一些常見問題，請參見<a href="ndbcluster.html#mysql-cluster-faq" title="17.10. MySQL Cluster FAQ">17.10節，「MySQL叢集常見問題解答」</a>。如果您是<span>MySQL</span>叢集的新手，請閱讀我方開發人員區的文章<span><a target="_top"  href="http://dev.mysql.com/tech-resources/articles/mysql-cluster-for-two-servers.html"><span>如何為兩個伺服器設置</span>MySQL<span>叢集</span></a></span>，這會有所幫助。</p>
	<div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-overview"></a>
		17.1.&nbsp;MySQL叢集概述</h2></div></div></div>
		<p><em><span>MySQL</span><span>叢集</span></em>是一種技術，該技術允許在無共享的系統中部署「內存中」資料庫的叢集。通過無共享體系結構，系統能夠使用廉價的硬件，而且對軟硬件無特殊要求。此外，由於每個組件有自己的內存和磁盤，不存在單點故障。</p>
		<p><span>MySQL</span>叢集將標準的<span>MySQL</span>伺服器與名為<span>NDB</span>的「內存中」叢集式儲存引擎集成了起來。在我們的文檔中，術語<span><span>NDB</span>指的是與儲存引擎相關的設置部分，</span>而術語「<span class="quote"><span>MySQL</span>叢集</span>」指的是<span>MySQL</span>和<span><span>NDB</span>儲存引擎的組合。</span></p>
		<p><span>MySQL</span>叢集由一組計算機構成，每台計算機上均運行著多種程序，包括<span>MySQL</span>伺服器，<span>NDB</span>叢集的數據節點，管理伺服器，以及（可能）專門的數據訪問程式。關於叢集中這些組件的關係，請參見下圖：</p>
		<p><img src="images/cluster-components-1.png" alt="MySQL Cluster Components"></p>
		<p>所有這些程式一起構成了<span>MySQL</span>叢集。將數據保存到<span>NDB</span>叢集儲存引擎中時，資料表將保存在數據節點內。能夠從叢集中所有其他<span>MySQL</span>伺服器直接訪問這些資料表。因此，在將數據保存在叢集內的工資資料表應用程式中，如果某一應用程式更新了<span>1</span>位僱員的工資，所有查詢該數據的其他<span>MySQL</span>伺服器能立刻發現這種變化。</p>
		<p>對於<span>MySQL</span>叢集，保存在數據節點內的數據可被映射，叢集能夠處理單獨數據節點的故障，除了少數事務將因事務狀態丟失而被放棄外，不會產生其他影響。由於事務性應用程式能夠處理事務失敗事宜，因而它不是問題源。</p>
		<p>通過將<span>MySQL</span>叢集引入開放原始碼世界，<span>MySQL</span>為所有需要它的人員提供了具有高可用性、高性能和可縮放性的叢集數據管理。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-basics"></a>
		17.2.&nbsp;MySQL叢集的基本概念</h2></div></div></div>
		<p><strong><span>NDB</span></strong>是一種「內存中」儲存引擎，它具有可用性高和數據一致性好的特點。</p>
		<p>能夠使用多種故障切換和負載平衡選項配置<span>NDB</span>儲存引擎，但以叢集層面上的儲存引擎開始最簡單。<span>MySQL</span>叢集的<span>NDB</span>儲存引擎包含完整的數據集，僅取決於叢集本身內的其他數據。</p>
		<p>下面，我們介紹了設置由<span>NDB</span>儲存引擎和一些<span>MySQL</span>伺服器構成的<span>MySQL</span>叢集的設置方法。</p>
		<p>目前，<span>MySQL</span>叢集的叢集部分可獨立於<span>MySQL</span>伺服器進行配置。在<span>MySQL</span>叢集中，叢集的每個部分被視為<span>1</span>個節點。</p>
		<p><strong><span>註釋：</span></strong>在很多情況下，術語「節點」用於指計算機，但在討論<span>MySQL</span>叢集時，它資料表示的是程序。在單台計算機上可以有任意數目的節點，為此，我們採用術語<strong><span>叢集主機</span></strong>。</p>
		<p>有三類叢集節點，在最低的<span>MySQL</span>叢集配置中，至少有三個節點，這三類節點分別是：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>管理<span>(<span>MGM</span>)</span>節點：這類節點的作用是管理<span>MySQL</span>叢集內的其他節點，如提供配置數據、啟動並停止節點、運行備份等。由於這類節點負責管理其他節點的配置，應在啟動其他節點之前首先啟動這類節點。<span>MGM</span>節點是用命令<strong><span>ndb_mgmd</span></strong>啟動的。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>數據節點：</span></strong>這類節點用於保存叢集的數據。數據節點的數目與副本的數目相關，是片段的倍數。例如，對於兩個副本，每個副本有兩個片段，那麼就有<span>4</span>個數據節點。沒有必要有一個以上的副本。數據節點是用命令<strong><span>ndbd</span></strong>啟動的。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>SQL</span><span>節點：</span></strong>這是用來訪問叢集數據的節點。對於<span>MySQL</span>叢集，客戶端節點是使用<span>NDB</span>叢集儲存引擎的傳統<span>MySQL</span>伺服器。典型情況下，<span>SQL</span>節點是使用命令<strong><span>mysqld
		</span><span>–<span>ndbcluster</span></span></strong>啟動的，或將<span><span>ndbcluster</span>新增到<span>my.cnf</span>後使用</span><strong><span>mysqld</span></strong>啟動。</p>
		<p>叢集配置包括對叢集中單獨節點的配置，以及設置節點之間的單獨通信鏈路。對於目前設計的<span>MySQL</span>叢集，其意圖在於，從處理器的能力、內存空間和帶寬來講，儲存節點是同質的，此外，為了提供單一的配置點，作為整體，叢集的所有配置數據均位於<span>1</span>個配置檔案中。</p>
		<p>管理伺服器<span>(MGM</span>節點<span>)</span>負責管理叢集配置檔案和叢集日誌。叢集中的每個節點從管理伺服器檢索配置數據，並請求確定管理伺服器所在位置的方式。當數據節點內出現有趣的事件時，節點將關於這類事件的訊息傳輸到管理伺服器，然後，將這類訊息寫入叢集日誌。</p>
		<p>此外，可以有任意數目的叢集客戶端程序或應用程式。它們分為兩種類型：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>標準<span>MySQL</span>客戶端：</span></strong>對於<span>MySQL</span>叢集，它們與標準的（非叢集類）<span>MySQL</span>沒有區別。換句話講，能夠從用<span>PHP</span>、<span>Perl</span>、<span>C</span>、<span>C++</span>、<span>Java</span>、<span>Python</span>、<span>Ruby</span>等編寫的現有<span>MySQL</span>應用程式訪問<span>MySQL</span>叢集。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>管理客戶端</span></strong>：這類客戶端與管理伺服器相連，並提供了優雅地啟動和停止節點、啟動和停止消息跟蹤（僅對調試版本）、顯示節點版本和狀態、啟動和停止備份等的命令。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="multi-computer"></a>
		17.3.&nbsp;多計算機的簡單基礎知識</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#multi-hardware-software-network">
			17.3.1. 硬件、軟件和聯網</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-install">
			17.3.2. 安裝</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-config">
			17.3.3. 配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-initial">
			17.3.4. 首次啟動</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-load-data-queries">
			17.3.5. 加載示範數據並執行查詢</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-shutdown-restart">
			17.3.6. 安全關閉和重啟</a></span></dt></dl></div>
		<p>本節介紹了如何規劃、安裝、配置和運行<span>MySQL</span>叢集的基本知識。與<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>中給出的示範不同，按照下面介紹的步驟和指南，所得的結果應是有用的<span>MySQL</span>叢集，它滿足對數據可用性和安全防護的最低要求。</p>
		<p>在本節中，我們介紹了下述內容：硬件和軟件要求，聯網事宜，<span>MySQL</span>叢集的安裝，配置事宜，叢集的啟動、停止和重啟，加載樣本資料庫，以及執行查詢的方法。</p>
		<p><strong><span>基本假定</span></strong> </p>
		<p>本節作了如下假定：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>我們將建立具有<span>4</span>個節點的叢集，每個節點位於不同的主機上，而且在典型的以太網中具有固定的網絡地址，如下所述：</p>
		<table border="1" cellpadding="0" id="table1">
			<tr>
				<td>
				<p><strong><span>節點</span></strong></td>
				<td>
				<p><strong>
				<span>IP</span><span>地址</span></strong></td>
			</tr>
			<tr>
				<td>
				<p>管理<span>(MGM)</span>節點</td>
				<td>
				<p><span>192.168.0.10</span></td>
			</tr>
			<tr>
				<td>
				<p><span>MySQL</span>伺服器<span>(SQL)</span>節點</td>
				<td>
				<p><span>192.168.0.20</span></td>
			</tr>
			<tr>
				<td>
				<p>數據<span>(NDBD)</span>節點<span>&quot;A&quot;</span></td>
				<td>
				<p><span>192.168.0.30</span></td>
			</tr>
			<tr>
				<td>
				<p>數據<span>(NDBD)</span>節點<span>&quot;B&quot;</span></td>
				<td>
				<p><span>192.168.0.40</span></td>
			</tr>
		</table>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>通過下圖可更清楚的表明這點：</p>
		<ol start="3" type="1">
			<li><span><img src="images/multi-comp-1.png" alt="MySQL Cluster Multi-Computer
            Setup"></span></li>
		</ol>
		<p>
		<span>4.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>註釋：</span></strong>出於簡單性（以及可靠性）方面的考慮，在本基本知識介紹中我們僅使用數值<span>IP</span>地址。但是，如果在您的網絡中具備<span>DNS</span>解析功能，在配置叢集的過程中，可使用主機名代替<span>IP</span>地址。作為可選方式，也能使用<span><span>/etc/hosts</span>檔案，或能提供主機查詢的作業系統的等效物（如果可用的話）。</span></p>
		<p><span>
		5.<span>&nbsp;&nbsp;&nbsp; </span>
		</span>在我們的場景中，每台主機均是基於<span>Intel</span>的桌面<span>PC</span>，<span>PC</span>上運行的是常見的一般性<span>Linux</span>版本，作業系統以標準配置安裝在磁盤上，未運行任何不必要的服務。具備標準<span>TCP/IP</span>聯網客戶端的核心作業系統應足以符合我們的要求。此外，為了簡單性，我們還假定所有主機上的檔案系統是等同的。如果這些主機上的檔案系統不同，就需對這些說明作相應的調整。</p>
		<p><span>6.<span>&nbsp;&nbsp;&nbsp;
		</span></span>在每台機器上安裝了標準的<span>100 Mbps</span>或<span>1</span>吉比特以太網卡，為每塊網卡安裝了恰當的驅動程式，並用標準的以太網聯網裝置（如交換器等）將<span>4</span>台主機連接起來（所有機器應使用具有相同容量的網卡，也就是說，叢集中的所有<span>4</span>台機器應全部使用<span>100M</span>網卡，或全部使用<span>1G</span>網卡）。<span>MySQL</span>叢集將工作在<span>100 
		Mbps</span>網絡中，但吉比特以太網能提供更好的性能。</p>
		<p>注意，<span>MySQL</span>叢集不適合於連通性低於<span>100 
		Mbps</span>的網絡。出於該原因（尤其是），在公共網絡如<span>Internet</span>上運行<span>MySQL</span>叢集很難成功，也不推薦這樣做。</p>
		<p><span>7.<span>&nbsp;&nbsp;&nbsp;
		</span></span>對於樣本數據，我們將使用世界資料庫，該資料庫可從<span>MySQL AB</span>公司的網站上下載。由於該資料庫佔用的空間相對較小，我們假定每台機器有<span>256 
		MB RAM</span>，這足以運行作業系統、主機<span>NDB</span>程序、以及儲存資料庫（對於數據節點）。</p>
		<p>儘管在本基本介紹中採用的是<span>Linux</span>作業系統，但對這裡給出的說明和步驟來說，僅過簡單的修改，也能適用於<span>Solaris</span>或<span>Mac 
		OS X</span>。此外，我們還假定您已掌握了安裝和配置具備聯網功能的作業系統的基本知識，或能夠在需要的時候獲得幫助。</p>
		<p>下一節，我們更詳細地討論了<span>MySQL</span>叢集的硬件、軟件和聯網要求。（請參見<a href="ndbcluster.html#multi-hardware-software-network" title="17.3.1. Hardware, Software, and Networking">17.3.1節，「硬件、軟件和聯網」</a>）。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-hardware-software-network"></a>
			17.3.1.&nbsp;硬件、軟件和聯網</h3></div></div></div>
			<p><span>MySQL</span>叢集的一個強大優點在於，它能運行在普通硬件上，除了需要較大的<span>RAM</span>外在這點上沒有特殊要求，這是因為實際的數據儲存均是在內存中進行的。（注意，未來這點會改變，我們打算在未來的<span>MySQL</span>叢集版本中實現基於磁盤的儲存）。顯然，多個<span>CPU</span>和更快的<span>CPU</span>能增強性能。對於叢集程序來說，對內存的要求相對較少。</p>
			<p>叢集的軟件要求程度適中。主機作業系統不需要任何特殊模塊、服務、應用程式、或配置就能支援<span>MySQL</span>叢集。對於<span>Mac 
			OS X</span>或<span>Solaris</span>，標準安裝就已足夠。對於<span>Linux</span>，標準的「<span class="quote">即開即用</span>」安裝應是所需的全部。<span>MySQL</span>軟件要求很簡單：<span>MySQL-max 
			5.1</span>的生產版就是所需的全部，要想獲得叢集支援，必須使用<span>MySQL</span>的<span><span>-max</span>版本</span>。無需自己編譯<span>MySQL</span>就能使用叢集。在本節中，我們假定您使用了與<span>Linux</span>相適應的<span><span>-max</span>二進製版本。對於</span><span>Solaris</span>或<span>Mac 
			OS X</span>作業系統，相應的部分可通過<span>MySQL</span>軟件下載頁面獲得，<span><a target="_top"  href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a></span>。</p>
			<p>對於節點之間的通信，叢集支援採用標準拓撲方案的<span>TCP/IP</span>聯網，對於每台主機的預期最低要求是<span>1</span>塊標準的<span>100 
			Mbps</span>以太網卡，對於作為整體的叢集，還需加上交換器、網絡集線器或路由器以提供網絡連通性。我們強烈建議，應在其自己的子網內運行<span>MySQL</span>叢集，不與非叢集機器共享該子網，原因如下：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>安全性：</span></strong>叢集節點之間的通信未採用任何特殊加密或防護。對<span>MySQL</span>叢集內傳輸的唯一保護方法是，在受保護的網絡上運行叢集。如果打算將<span>MySQL</span>叢集用於<span>Web</span>應用，叢集應明確地位於防火牆後面，而且不應位於網絡的非軍事區（<span><a target="_top"  href="http://compnetworking.about.com/cs/networksecurity/g/bldef_dmz.htm">DMZ</a></span>）或其他地方。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>效率：</span></strong>在專有的或受保護的網絡上設置<span>MySQL</span>叢集，這樣，叢集就能獨享叢集主機之間的帶寬。為<span>MySQL</span>叢集使用單獨的交換器不僅能防止對叢集數據的非法訪問，而且還能確保叢集節點不受網絡上其他計算機之間訊息傳輸的干擾。為了增強可靠性，可以使用雙交換器和雙卡，以防止網絡出現單點故障，對於這類通信鏈路，很多設備驅動均支援故障切換功能。</p>
			<span>也能與<span>MySQL</span>叢集一起使用高速<span>SCI</span>（規模可延伸的計算機接口），但這不是要求的。關於該協議的更多訊息，以及它與<span>MySQL</span>叢集的用法，請參見</span><a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7節，「使用與MySQL叢集的高速互連」</a>
        </div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-install"></a>
			17.3.2.&nbsp;安裝</h3></div></div></div>
			<p>對於每台運行儲存或<span>SQL</span>節點的<span>MySQL</span>叢集主機計算機，必須在其上安裝<span>MySQL-max</span>二進製版本。對於管理節點，沒有必要安裝<span>MySQL</span>伺服器二進製版本，但應安裝<span>MGM</span>伺服器端口監督程式和客戶端二進製版本（分別是<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>）。在本節中，我們介紹了為每種叢集節點安裝正確的二進製版本所需的步驟。</p>
			<p><span>MySQL AB</span>提供了預編譯的二進制檔案，它們支援叢集，您不需要自己編譯這些檔案（如果您確實需要定制的二進制檔案，請參見<a href="installing.html#installing-source-tree" title="2.8.3. Installing from the Development Source Tree">2.8.3節，「從開發原始碼樹安裝」</a>）。因此，對於每台叢集主機，安裝程序的第一步是從<span><a target="_top"  href="http://dev.mysql.com/downloads/">MySQL<span>下載區</span></a></span>下載檔案<span>mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz</span>。我們假定您將該檔案放在各機器的<span>/var/tmp</span>目錄下。</p>
			<p>對於<span>32</span>位和<span>64</span>位<span>Linux</span>平台，均有相應的<span>RPM</span>，<span>RPM</span>安裝的<span><span>-max</span>二進制檔案支援<span>NDB</span>叢集儲存引擎。如果您選擇使用它們而不是二進制檔案，務必在運行叢集節點的所有機器上安裝<span>-server</span>和<span>-max</span>軟件包</span>（關於使用<span>RPM</span>安裝<span>MySQL</span>的更多訊息，請參見<a href="installing.html#linux-rpm" title="2.4. Installing MySQL on Linux">2.4節，「在Linux下安裝MySQL」</a>）。使用<span>RPM</span>完成安裝後，仍需對叢集進行配置，請參見<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3節，「配置」</a>。</p>
			<p><strong><span>註釋：</span></strong>完成安裝後，不啟動任何二進制檔案。配置完所有節點後，我們將向您介紹執行這類操作的方法。</p>
			<p><strong><span>儲存節點和<span>SQL</span>節點安裝</span></strong></p>
			<p>在設計為運行儲存節點或<span>SQL</span>節點的三台機器的每一台上，以系統根用戶身份執行下述步驟：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>檢查您的<span>/etc/passwd</span>和<span>/etc/group</span>檔案（或使用作業系統提供的用於管理用戶和組的工具），查看在系統上是否已存在<span><span>mysql</span>組</span>和<span>mysql</span>用戶，這是因為某些作業系統會將其作為安裝程序的一部分予以建立。如果它們不存在，建立新的<span><span>mysql</span>用戶組</span>，然後為該組新增<span>1</span>個<span>mysql</span>用戶。</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>groupadd mysql</span></pre>
			<pre><span>3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>useradd -g mysql mysql</span></pre>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>進入包含下載檔案的目錄，解包檔案檔案，並建立與<span>mysql-max</span>可執行檔案的<span>symlink</span>。注意，根據<span>MySQL</span>的版本號，實際的檔案名和目錄名會有所不同。</p>
			<pre><span>5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /var/tmp</span></pre>
			<pre><span>6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tar -xzvf -C /usr/local/bin mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz</span></pre>
			<pre><span>7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ln -s /usr/local/bin/mysql-max-5.1.2-alpha-pc-linux-gnu-i686 mysql</span></pre>
			<p>
			<span>8.<span>&nbsp;&nbsp;&nbsp;
			</span></span>進入<span><span>mysql</span>目錄，</span>運行所提供的用於建立系統資料庫的指令：</p>
			<pre><span>9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd mysql</span></pre>
			<pre><span>10.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>scripts/mysql_install_db --user=mysql</span></pre>
			<p>
			<span>11.</span>為<span>MySQL</span>伺服器和數據目錄設置必要的權限：</p>
			<pre><span>12.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chown -R root .</span></pre>
			<pre><span>13.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chown -R mysql data</span></pre>
			<pre><span>14.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chgrp -R mysql .</span></pre>
			<p>注意，在每台運行數據節點的機器上，數據目錄是<span><span>/usr/local/mysql/data</span>。配置管理節點時將用到這類訊息</span>（請參見<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3節，「配置」</a>）。</p>
			<p>
			<span>15.</span>將<span>MySQL</span>啟動指令拷貝到恰當的目錄下，使之成為可執行的指令，並設置它以便在啟動作業系統時啟動：</p>
			<pre><span>16.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cp support-files/mysql.server /etc/rc.d/init.d/</span></pre>
			<pre><span>17.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chmod +x /etc/rc.d/init.d/mysql.server</span></pre>
			<pre><span>18.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chkconfig --add mysql.server</span></pre>
			<p>在此，我們使用<span>Red Hat</span>的<strong><span>chkconfig</span></strong>來建立與啟動指令的連結，請在您的作業系統上使用恰當的用於該目的的方式，如<span>Debian</span>上的<strong><span>update-rc.d</span><span>。</span></strong></p>
			<p>請記住，對於儲存節點或<span>SQL</span>節點所在的每台機器，必須分別指向上述步驟。</p>
			<p><strong><span>管理節點安裝</span></strong></p>
			<p>對於<span>MGM</span>（管理）節點，不需要安裝<strong><span>mysqld</span></strong>可執行檔案，僅需安裝用於<span>MGM</span>伺服器和客戶端的二進制檔案，這類檔案可在下載的<span><span>-max</span>檔案中找到。再次假定您將該檔案放在了<span>/var/tmp</span>目錄下，引導系統時</span>（也就是說使用<strong><span>sudo</span></strong><span>,
			<strong><span>su root</span></strong></span>或系統的等效命令後，假定具有系統管理員帳號的權限），執行下述步驟，在叢集管理節點主機上安裝<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>即如<span>/var/tmp</span>目錄，從檔案檔案中將<strong><span>ndb_mgm</span></strong>和<strong><span>ndb_mgmd</span></strong>提取到恰當的目錄下，如<span>/usr/local/bin</span>：</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /var/tmp</span></pre>
			<pre><span>3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tar -zxvf mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz /usr/local/bin &#39;*/bin/ndb_mgm*&#39;</span></pre>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>進入解包檔案所在的目錄，然後使這兩個檔案成為可執行的：</p>
			<pre><span>5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /usr/local/bin</span></pre>
			<pre><span>6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chmod +x ndb_mgm*</span></pre>
			<p>在<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3節，「配置」</a>中，我們將為示範叢集中的所有節點建立和編寫配置檔案。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-config"></a>
			17.3.3.&nbsp;配置</h3></div></div></div>
			<p>對於我們的<span>4</span>節點、<span>4</span>主機<span>MySQL</span>叢集，需要編寫<span>4</span>個配置檔案，每個節點<span>/</span>主機<span>1</span>個。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>每個數據節點或<span>SQl</span>節點需要<span>1</span>個<span><span>my.cnf</span>檔案，該檔案提供了兩類訊息</span>：<strong><span>connectstring</span></strong>（連接字串），用於通知節點到哪裡找到<span>MGM</span>節點；以及一行，用於通知該主機（容納數據節點的機器）上的<span>MySQL</span>伺服器運行在<span>NDB</span>模式下。</p>
			<p>關於連接字串的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2節，「MySQL叢集連接字串<code class="literal"></code>」</a>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>管理節點需要<span><span>config.ini</span>檔案，</span>該檔案通知節點有多少需要維護的副本，需要在每個數據節點上為數據和索引分配多少內存，數據節點的位置，在每個數據節點上保存數據的磁盤位置，以及<span>SQL</span>節點的位置。</p>
			<p><strong><span>配置儲存節點和<span>SQL</span>節點</span></strong></p>
			<p>數據節點所需的<span><span>my.cnf</span>檔案相當簡單。配置檔案應位於<span>/etc</span>目錄下，並能用任何文本編輯器進行編輯（如有必要，建立該檔案），例如：</span></p>
			<pre><span>vi /etc/my.cnf</span></pre>
			<p>對於本示範中的每個數據節點和<span>SQL</span>節點，<span><span>my.cnf</span>檔案類似於：</span></p>
			<pre><span># Options for mysqld process:</span></pre>
			<pre><span>[MYSQLD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>ndbcluster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # run NDB engine</span></pre>
			<pre><span>ndb-connectstring=192.168.0.10&nbsp; # location of MGM node</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for ndbd process:</span></pre>
			<pre><span>[MYSQL_CLUSTER]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>ndb-connectstring=192.168.0.10&nbsp; # location of MGM node</span></pre>
			<p>輸入上述內容後，保存檔案並退出文本編輯器。在容納數據節點「<span>A</span>」、數據節點「<span>B</span>」和<span>SQL</span>節點的機器上分別執行上述操作。</p>
			<p><strong><span>配置管理節點</span></strong></p>
			<p>配置<span>MGM</span>節點的第一步是建立目錄，該目錄用於存放配置檔案，然後建立配置檔案本身。例如（以根用戶身份運行）：</p>
			<pre><span>mkdir /var/lib/mysql-cluster</span></pre>
			<pre><span>cd /var/lib/mysql-cluster</span></pre>
			<pre><span>vi config.ini</span></pre>
			<p>在此使用了<span>vi</span>來建立檔案，不過，任何文本編輯器均應能勝任。</p>
			<p>對於我們的典型設置，<span><span>config.ini</span>檔案應類似於：</span></p>
			<pre><span># Options affecting ndbd processes on all data nodes:</span></pre>
			<pre><span>[NDBD DEFAULT]&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>NoOfReplicas=2&nbsp;&nbsp;&nbsp; # Number of replicas</span></pre>
			<pre><span>DataMemory=80M&nbsp;&nbsp; &nbsp;# How much memory to allocate for data storage</span></pre>
			<pre><span>IndexMemory=18M&nbsp;&nbsp; # How much memory to allocate for index storage</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # For DataMemory and IndexMemory, we have used the</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # default values. Since the &quot;world&quot; database takes up</span></pre>
			<pre><span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only about 500KB, this should be more than enough for</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # this example Cluster setup.</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># TCP/IP options:</span></pre>
			<pre><span>[TCP DEFAULT]&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>portnumber=2202&nbsp;&nbsp; # This the default; however, you can use any</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # port that is free for all the hosts in cluster</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Note: It is recommended beginning with MySQL 5.0 that</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # you do not specify the portnumber at all and simply allow</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # the default value to be used instead</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Management process options:</span></pre>
			<pre><span>[NDB_MGMD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address of MGM node</span></pre>
			<pre><span>datadir=/var/lib/mysql-cluster&nbsp; # Directory for MGM node logfiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for data node &quot;A&quot;:</span></pre>
			<pre><span>[NDBD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (one [NDBD] section per data node)</span></pre>
			<pre><span>hostname=192.168.0.30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>datadir=/usr/local/mysql/data&nbsp;&nbsp; # Directory for this data node&#39;s datafiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for data node &quot;B&quot;:</span></pre>
			<pre><span>[NDBD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>datadir=/usr/local/mysql/data&nbsp;&nbsp; # Directory for this data node&#39;s datafiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># SQL node options:</span></pre>
			<pre><span>[MYSQLD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (additional mysqld connections can be</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # specified for this node for various</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # purposes such as running ndb_restore)</span></pre>
			<p>（<strong><span>註釋：</span></strong><span>&quot;world&quot;</span>資料庫可從站點<span><a target="_top"  href="http://dev.mysql.com/doc/">http://dev.mysql.com/doc/</a></span>下載，它列在「示範」欄目下）。</p>
			<p>一旦建立了所有的配置檔案並指定了這些最低選項，可啟動叢集，並驗證所有程序均能正常運行。關於這方面的討論，請參見<a href="ndbcluster.html#multi-initial" title="17.3.4. Initial Startup">17.3.4節，「首次啟動」</a>。</p>
			<p>關於可用<span>MySQL</span>叢集配置參數以及其用法的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4節，「配置檔案」</a>和<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>。關於與進行備份有關的<span>MySQL</span>叢集配置，請參見<a href="ndbcluster.html#mysql-cluster-backup-configuration" title="17.6.5.4. Configuration for Cluster Backup">17.6.5.4節，「叢集備份的配置」</a>。</p>
			<p><strong><span>註釋：</span></strong>叢集管理節點的預設端口是<span>1186</span>，數據節點的預設端口<span>2202</span>。從<span>MySQL 
			5.0.3</span>開始，該限制已被放寬，叢集能夠根據空閒的端口自動地為數據節點分配端口。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-initial"></a>
			17.3.4.&nbsp;首次啟動</h3></div></div></div>
			<p>
			完成配置後，啟動叢集並不很困難。必須在數據節點所在的主機上分別啟動每個叢集節點程序。儘管能夠按任何順序啟動節點，但我們建議，應首先啟動管理節點，然後啟動儲存節點，最後啟動<span>SQL</span>節點：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>在管理主機上，從系統<span>shell</span>發出下述命令以啟動<span>MGM</span>節點程序：</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>shell&gt; <span><b>ndb_mgmd -f /var/lib/mysql-cluster/config.ini</b></span></span></pre>
			<p>注意，必須用「<span><span>-f」</span>或</span>「<span><span>--config-file」</span>選項，</span>告訴<strong><span>ndb_mgmd</span></strong>到哪裡找到配置檔案（詳情請參見<a href="ndbcluster.html#ndb-mgmd-process" title="17.5.3. ndb_mgmd, the Management Server Process">17.5.3節，「<span><strong class="command">ndb_mgmd</strong></span>，「管理伺服器」程序」</a>）。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>在每台數據節點主機上，對於首次啟動，運行下述命令啟動<span>NDBD</span>程序：</p>
			<pre><span>4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>shell&gt; <span><b>ndbd --initial</b></span></span></pre>
			<p>注意，僅應在首次啟動<strong><span>ndbd</span></strong>時，或在備份／恢復或配置變化後重啟<strong><span>ndbd</span></strong>時使用「<span>--initial</span>」參數，這很重要。原因在於，該參數會使節點刪除由早期<strong><span>ndbd</span><span>實例</span></strong>建立的、用於恢復的任何檔案，包括恢復用日誌檔案。</p>
			<p>
			<span>5.<span>&nbsp;&nbsp;&nbsp;
			</span></span>如果使用<span>RPM</span>在<span>SQL</span>節點所在的叢集主機上安裝了<span>MySQL</span>，能夠（也應當）使用安裝在<span><span>/etc/init.d</span>下的啟動指令在<span>SQL</span>節點上啟動</span><span>MySQL</span>伺服器程序。注意，要想運行「<span>-max</span>」伺服器二進制檔案，除了標準的<span>RPM</span>外，還需要安裝<span>-max</span>伺服器<span>RPM</span>。</p>
			<p>如果一切順利，並已正確設置了叢集，那麼叢集現在應能運行。通過使用<strong><span>ndb_mgm</span></strong>管理節點客戶端，可對其進行測試。其輸出應類似於：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm</b></span></span></pre>
			<pre><span>-- NDB Cluster -- Management Client --</span></pre>
			<pre><span>ndb_mgm&gt; SHOW</span></pre>
			<pre><span>Connected to Management Server at: localhost:1186</span></pre>
			<pre><span>Cluster Configuration</span></pre>
			<pre><span>---------------------</span></pre>
			<pre><span>[ndbd(NDB)]&nbsp;&nbsp;&nbsp;&nbsp; 2 node(s)</span></pre>
			<pre><span>id=2&nbsp;&nbsp;&nbsp; @192.168.0.30&nbsp; (Version: 5.1.2-alpha, Nodegroup: 0, Master)</span></pre>
			<pre><span>id=3&nbsp;&nbsp;&nbsp; @192.168.0.40&nbsp; (Version: 5.1.2-alpha, Nodegroup: 0)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[ndb_mgmd(MGM)] 1 node(s)</span></pre>
			<pre><span>id=1&nbsp;&nbsp;&nbsp; @192.168.0.10&nbsp; (Version: 5.1.2-alpha)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[mysqld(SQL)]&nbsp;&nbsp; 1 node(s)</span></pre>
			<pre><span>id=4&nbsp;&nbsp; (Version: 5.1.2-alpha)</span></pre>
			<p>具體的輸出內容可能會略有不同，這取決於您所使用的<span>MySQL</span>版本。</p>
			<p><strong><span>註釋：</span></strong>如果您正在使用較早的<span>MySQL</span>版本，您或許會看到引用為『<span>[mysqld(API)]</span>』的<span>SQL</span>節點。這是一種早期的用法，現已放棄。</p>
			<p>現在，應能在<span>MySQL</span>叢集中處理資料庫，資料表和數據。關於這方面的簡要討論，請參見<a href="ndbcluster.html#multi-load-data-queries" title="17.3.5. Loading Sample Data and Performing Queries">17.3.5節，「加載示範數據並執行查詢」</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-load-data-queries"></a>
			17.3.5.&nbsp;加載示範數據並執行查詢</h3></div></div></div>
			<p>與沒有使用叢集的<span>MySQL</span>相比，在<span>MySQL</span>叢集內操作數據的方式沒有太大的區別。執行這類操作時應記住兩點：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>資料表必須用<span>ENGINE=NDB</span>或<span><span>ENGINE=NDBCLUSTER</span>選項建立，或用<span>ALTER 
			TABLE</span>選項更改，以使用</span><span>NDB</span>叢集儲存引擎在叢集內複製它們。如果使用<strong><span>mysqldump</span></strong>的輸出從已有資料庫導入資料表，可在文本編輯器中打開<span>SQL</span>指令，並將該選項新增到任何資料表建立語句，或用這類選項之一替換任何已有的<span>ENGINE</span>（或<span><span>TYPE</span>）選項。</span>例如，假定在另一個<span>MySQL</span>伺服器（不支援<span>MySQL</span>叢集）上有樣本世界資料庫，而且您打算導出城市資料表的定義：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>mysqldump --add-drop-table world City &gt; city_table.sql</b></span></span></pre>
			<p>在所得的<span>city_table.sql</span>檔案中，將包含這條資料表建立語句（以及導入資料表數據所需的<span><span>INSERT</span>語句）：</span></p>
			<pre><span>DROP TABLE IF EXISTS City;</span></pre>
			<pre><span>CREATE TABLE City (</span></pre>
			<pre><span>ID int(11) NOT NULL auto_increment,</span></pre>
			<pre><span>Name char(35) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>CountryCode char(3) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>District char(20) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>Population int(11) NOT NULL default &#39;0&#39;,</span></pre>
			<pre><span>PRIMARY KEY&nbsp; (ID)</span></pre>
			<pre><span>) ENGINE=MyISAM;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>INSERT INTO City VALUES (1,&#39;Kabul&#39;,&#39;AFG&#39;,&#39;Kabol&#39;,1780000);</span></pre>
			<pre><span>INSERT INTO City VALUES (2,&#39;Qandahar&#39;,&#39;AFG&#39;,&#39;Qandahar&#39;,237500);</span></pre>
			<pre><span>INSERT INTO City VALUES (3,&#39;Herat&#39;,&#39;AFG&#39;,&#39;Herat&#39;,186800);</span></pre>
			<pre><span># (remaining INSERT statements omitted)</span></pre>
			<p>需要確認<span>MySQL</span>為該資料表使用了<span>NDB</span>儲存引擎。有兩種完成該任務的方法。其中一種方法是，在將資料表導入叢集資料庫之前更改其定義，使其類似於（仍使用「城市」作為示範）：</p>
			<pre><span>DROP TABLE IF EXISTS City;</span></pre>
			<pre><span>CREATE TABLE City (</span></pre>
			<pre><span>ID int(11) NOT NULL auto_increment,</span></pre>
			<pre><span>Name char(35) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>CountryCode char(3) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>District char(20) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>Population int(11) NOT NULL default &#39;0&#39;,</span></pre>
			<pre><span>PRIMARY KEY&nbsp; (ID)</span></pre>
			<pre><span>) ENGINE=NDBCLUSTER;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>INSERT INTO City VALUES (1,&#39;Kabul&#39;,&#39;AFG&#39;,&#39;Kabol&#39;,1780000);</span></pre>
			<pre><span>INSERT INTO City VALUES (2,&#39;Qandahar&#39;,&#39;AFG&#39;,&#39;Qandahar&#39;,237500);</span></pre>
			<pre><span>INSERT INTO City VALUES (3,&#39;Herat&#39;,&#39;AFG&#39;,&#39;Herat&#39;,186800);</span></pre>
			<pre><span># (etc.)</span></pre>
			<p>
			對於將成為叢集資料庫組成部份的每個資料表，均需要為其定義執行上述操作。完成該任務的最簡單方法是，簡單地在<span><span>world.sql</span>檔案上執行<span>「</span>搜尋<span>-</span>替換<span>」</span>，並用<span>ENGINE=NDBCLUSTER</span>替換所有的<span>TYPE=MyISAM</span>實例。如果您不打算更改該檔案，也可使用<span>ALTER 
			TABLE</span>。詳情請參見下面的介紹。</span></p>
			<p>假定您已在叢集的<span>SQL</span>節點上建立了名為「<span>world</span>」的資料庫，隨後可使用<strong><span>mysql</span></strong>命令行客戶端讀取<span>city_table.sql</span>，並按通常方式建立和填充對應的資料表：</p>
			<pre><span>shell&gt; <span><b>mysql world &lt; city_table.sql</b></span></span></pre>
			<p>請記住，上述命令必須在運行<span>SQL</span>節點的主機上執行，這點十分重要。對於本例，應在<span>IP</span>地址為<strong><span>192.168.0.20</span></strong>的機器上執行。</p>
			<p>要想在<span>SQL</span>節點上建立世界資料庫的副本，請將檔案保存到<span>/usr/local/mysql/data</span>，然後運行：</p>
			<pre><span>shell&gt; <span><b>cd /usr/local/mysql/data</b></span></span></pre>
			<pre><span>shell&gt; <span><b>mysql world &lt; world.sql</b></span></span></pre>
			<p>當然，<span>SQL</span>指令必須能被<span><span>mysql</span>系統用戶讀取。</span>如果將檔案保存到了不同的目錄下，請作相應的調整。</p>
			<p>注意，在<span>MySQL 5.1</span>中，<span>NDB</span>叢集不支援自動發現資料庫的功能，這點很重要（請參見<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8節，「MySQL叢集的已知限制」</a>）。這意味著，一旦在一個數據節點上建立了世界（<span>world</span>）資料庫和它的資料表，在叢集中的每個<span>SQL</span>節點上還需要發出命令<strong><span>CREATE 
			DATABASE world</span></strong>（從<span>MySQL 5.0.2</span>開始，可以使用<strong><span>CREATE 
			SCHEMA world</span><span>取而代之），</span></strong>後跟<strong><span>FLUSH 
			TABLES</span><span>。這樣，節點就能識別資料庫並讀取</span></strong>其資料表定義。</p>
			<p>在<span>SQL</span>節點上運行<strong><span>SELECT</span></strong>查詢與在<span>MySQL</span>伺服器的任何其他實例上運行查詢沒有區別。要想從命令行運行查詢，首先應按照通常方式登錄到<span>MySQL</span>監視器：</p>
			<pre><span>shell&gt; <span><b>mysql -u root -p</b></span></span></pre>
			<pre><span>Enter password:</span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>鍵入』<span>help;</span>』或』<span>\h</span>』獲取幫助。鍵入』<span>\c</span>』清空緩衝區。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt;</span></pre>
			<p>如果在導入<span>MySQL</span>指令之前未更改資料表定義中的<span><span>ENGINE=</span>子句，應在此時運行</span>下述命令：</p>
			<pre><span>mysql&gt; <span><b>USE world;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE City ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE Country ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE CountryLanguage ENGINE=NDBCLUSTER;</b></span></span></pre>
			<p>注意，在這裡我們簡單地使用了<span>MySQL</span>伺服器密碼為空的預設根用戶帳號。當然，在生產設置下，安裝<span>MySQL</span>伺服器時，總應遵守標準的安全方法措施，包括設置牢靠的根用戶密碼，並為用戶建立具有完成任務所需的權限的用戶帳號。關於這方面的更多訊息，請參見<a href="database-administration.html#privilege-system" title="5.7. The MySQL Access Privilege System">5.7節，「MySQL訪問權限系統」</a>。</p>
			<p>需要關注的是，當叢集節點彼此訪問時不使用<span>MySQL</span>的權限系統，設置或更改<span>MySQL</span>用戶帳號（包括根用戶帳號）不影響節點之間的交互，它們僅對訪問<span>SQL</span>節點的應用程式有效。</p>
			<p>能夠以通常的方式選擇資料庫，並對資料表執行<span>SELECT</span>查詢，就像退出<span>MySQL</span>監視器一樣：</p>
			<pre><span>mysql&gt; <span><b>USE world;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>SELECT Name, Population FROM City ORDER BY Population DESC LIMIT 5;</b></span></span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>| </span>名稱<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </span>人口<span> |</span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>| </span>孟買<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 10500000 |</span></pre>
			<pre><span>| </span>漢城<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9981619 |</span></pre>
			<pre><span>| </span>聖保羅<span>&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9968485 |</span></pre>
			<pre><span>| </span>上海<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9696300 |</span></pre>
			<pre><span>| </span>雅加達<span>&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9604900 |</span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>5 rows in set (0.34 sec)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>\q</b></span></span></pre>
			<pre><span>Bye</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>shell&gt;</span></pre>
			<p>使用<span>MySQL</span>的應用程式能夠使用標準的<span>API</span>。重要的是應記住，您的應用程式必須訪問<span>SQL</span>節點，而不是<span>MGM</span>或儲存節點。在下面的簡單示範中，介紹了使用<span>PHP 
			5</span>的<span><span>mysqli</span>延伸（運行在位於網絡中其他位置的<span>Web</span>伺服器上）執行相同查詢的方法：</span></p>
			<pre><span>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></pre>
			<pre><span>&nbsp; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span></pre>
			<pre><span>&lt;html&gt;</span></pre>
			<pre><span>&lt;head&gt;</span></pre>
			<pre><span>&nbsp; &lt;meta http-equiv=&quot;Content-Type&quot;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content=&quot;text/html; charset=iso-8859-1&quot;&gt;</span></pre>
			<pre><span>&nbsp; &lt;title&gt;SIMPLE mysqli SELECT&lt;/title&gt;</span></pre>
			<pre><span>&lt;/head&gt;</span></pre>
			<pre><span>&lt;body&gt;</span></pre>
			<pre><span>&lt;?php</span></pre>
			<pre><span>&nbsp; # connect to SQL node:</span></pre>
			<pre><span>&nbsp; $link = new mysqli(&#39;192.168.0.20&#39;, &#39;root&#39;, &#39;&#39;, &#39;world&#39;);</span></pre>
			<pre><span>&nbsp; # parameters for mysqli constructor are:</span></pre>
			<pre><span>&nbsp; #&nbsp;&nbsp; host, user, password, database</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; if( mysqli_connect_errno() )</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; die(&quot;Connect failed: &quot; . mysqli_connect_error());</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; $query = &quot;SELECT Name, Population</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM City</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORDER BY Population DESC</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LIMIT 5&quot;;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; # if no errors...</span></pre>
			<pre><span>&nbsp; if( $result = $link-&gt;query($query) )</span></pre>
			<pre><span>&nbsp; {</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&lt;table border=&quot;1&quot; width=&quot;40%&quot; cellpadding=&quot;4&quot; cellspacing =&quot;1&quot;&gt;</span></pre>
			<pre><span>&nbsp; &lt;tbody&gt;</span></pre>
			<pre><span>&nbsp; &lt;tr&gt;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; &lt;th width=&quot;10%&quot;&gt;City&lt;/th&gt;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; &lt;th&gt;Population&lt;/th&gt;</span></pre>
			<pre><span>&nbsp; &lt;/tr&gt;</span></pre>
			<pre><span>&lt;?</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; # then display the results...</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; while($row = $result-&gt;fetch_object())</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&lt;tr&gt;\n&nbsp; &lt;td align=\&quot;center\&quot;&gt;%s&lt;/td&gt;&lt;td&gt;%d&lt;/td&gt;\n&lt;/tr&gt;\n&quot;,</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $row-&gt;Name, $row-&gt;Population);</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&nbsp; &lt;/tbody</span></pre>
			<pre><span>&lt;/table&gt;</span></pre>
			<pre><span>&lt;?</span></pre>
			<pre><span>&nbsp; # ...and verify the number of rows that were retrieved</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; printf(&quot;&lt;p&gt;Affected rows: %d&lt;/p&gt;\n&quot;, $link-&gt;affected_rows);</span></pre>
			<pre><span>&nbsp; }</span></pre>
			<pre><span>&nbsp; else</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; # otherwise, tell us what went wrong</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; echo mysqli_error();</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; # free the result set and the mysqli connection object</span></pre>
			<pre><span>&nbsp; $result-&gt;close();</span></pre>
			<pre><span>&nbsp; $link-&gt;close();</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&lt;/body&gt;</span></pre>
			<pre><span>&lt;/html&gt;</span></pre>
			<p>我們假定運行在<span>Web</span>伺服器上的程序能夠訪問<span>SQL</span>節點的<span>IP</span>地址。</p>
			<p>採用類似的風格，可以使用<span>MySQL C 
			API</span>、<span>Perl-DBI</span>、<span>Python-mysql</span>、或<span>MySQL 
			AB</span>自己的連接器來執行數據定義和操控任務，就像正常使用<span>MySQL</span>那樣。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>另外還請記住，<em><span>每個</span></em><span><i><span>NDB</span>資料表</i></span><em><span>必須有一個主鍵</span></em>。如果在建立資料表時用戶未定義主鍵，<span><span>NDB</span>叢集儲存引擎將自動生成隱含的主鍵。（</span><strong><span>註釋：</span></strong>該隱含
			鍵也將佔用空間，就像任何其他的資料表索引一樣。由於沒有足夠的內存來容納這些自動建立的鍵，出現問題並不罕見）。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-shutdown-restart"></a>
			17.3.6.&nbsp;安全關閉和重啟</h3></div></div></div>
			<p>要想關閉叢集，可在<span>MGM</span>節點所在的機器上，在<span>Shell</span>中簡單地輸入下述命令：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm -e shutdown</b></span></span></pre>
			<p>該命令將恰當地中止<strong><span>ndb_mgm</span></strong>、<strong><span>ndb_mgmd</span></strong>以及任何<strong><span>ndbd</span></strong>程序。使用<strong><span>mysqladmin 
			shutdown</span></strong>或其他方法，可中止<span>SQL</span>節點。注意，這裡的「<span><span>-e」</span>選項用於將命令從<span>shell</span>傳遞到</span><strong><span>ndb_mgm</span></strong>客戶端。請參見<a href="using-mysql-programs.html#command-line-options" title="4.3.1. Using Options on the Command Line">4.3.1節，「在命令行上使用選項」</a>。</p>
			<p>要想重啟叢集，可簡單地運行下述命令：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在管理主機上（本設置中為<span><span>192.168.0.10</span>）：</span></p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>ndb_mgmd -f /var/lib/mysql-cluster/config.ini</b></span></span></pre>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在每台數據節點主機上（<span>192.168.0.30</span>和<span>192.168.0.40</span>）：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>ndbd</b></span></span></pre>
			<p>請記住，正常重啟<span>NDBD</span>節點時，不要用「<span>--initial</span>」選項使用該命令。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在<span>SQL</span>主機上（<span>192.168.0.20</span>）：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>mysqld &amp;</b></span></span></pre>
			<p>關於建立叢集備份的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-backup-using-management-server" title="17.6.5.2. Using The Management Server to Create a Backup">17.6.5.2節，「使用管理伺服器建立備份」</a>。</p>
			<p>要想從備份中恢復叢集，需要使用<strong><span>ndb_restore</span></strong>命令。請參見<a href="ndbcluster.html#mysql-cluster-restore" title="17.6.5.3. How to Restore a Cluster Backup">17.6.5.3節，「如何恢復叢集備份」</a>。</p>
			<p>關於配置<span>MySQL</span>叢集的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>。</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-configuration"></a>17.4. MySQL叢集的配置</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-building">
		17.4.1. 從原始碼建立MySQL叢集</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-installing">
		17.4.2. 安裝軟件</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-quick">
		17.4.3. MySQL叢集的快速測試設置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-file">17.4.4. 
		配置檔案</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
			作為<span>MySQL</span>叢集組成部份的<span>MySQL</span>伺服器僅在一個方面上與正常的（非叢集式）<span>MySQL</span>伺服器不同，它採用了<span><span>NDB</span>叢集儲存引擎。該引擎也簡單地稱為<span>NDB</span>，這兩個術語是同義詞。</span><p>
			為了避免不必要的資源分配，預設情況下，在伺服器的配置中將禁止<span>NDB</span>儲存引擎。要想啟用<span><span>NDB</span>，需要更改</span>伺服器的<span><span>my.cnf</span>配置檔案，或使用<span>「—ndbcluster」</span>選項啟動伺服器。</span></p>
			<p>由於<span>MySQL</span>伺服器是叢集的一部分，它也需要知道如何訪問<span>MGM</span>節點，以便獲得叢集配置數據。預設行為是搜尋本地主機上<span>MGM</span>節點。但是，如果需要另外指定它的位置，可在<span><span>my.cnf</span>檔案或</span><span>MySQL</span>伺服器命令行上進行。能夠使用<span><span>NDB</span>儲存引擎之前，至少應有一個<span>MGM</span>節點是可操作的，而且還應有</span>所需的數據節點。</p>
			<h3 class="title"><a name="mysql-cluster-building"></a>
			17.4.1.&nbsp;從原始碼建立MySQL叢集</h3></div></div></div>
			<p><span>對於</span><span>Linux</span>、<span>Mac 
			OS X</span>和<span>Solaris</span>，在其二進制分發版中均提供了<span><span>NDB</span>叢集儲存引擎。在<span>Windows</span>平台上尚不支援它，但我們打算在不遠的將來使其能用於</span><span>win32</span>和其他平台。</p>
			<p>如果選擇從原始碼<span>tarball</span>或<span>MySQL 5.1 
			BitKeeper</span>樹建立它，運行<strong><span>configure</span></strong>時，務必使用「<span><span>--with-ndbcluster」</span>選項。也可以使用</span><strong><span>BUILD/compile-pentium-max</span></strong>建立指令。注意，該指令包含<span>OpenSSL</span>，因此，要想成功建立，必須有或獲得<span>OpenSSL</span>，如不然，需要更改「<strong><span>compile-pentium-max</span></strong>」以便將該要求排除在外，當然，也能採用標準步驟來編譯您自己的二進制檔案，然後執行常規測試和安裝步驟。請參見<a href="installing.html#installing-source-tree" title="2.8.3. Installing from the Development Source Tree">2.8.3節，「從開發原始碼樹安裝」</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-installing"></a>
			17.4.2.&nbsp;安裝軟件</h3></div></div></div>
			<p>在下面的數節內，假定您已熟悉了<span>MySQL</span>的安裝方法，在此，我們僅介紹了<span>MySQL</span>叢集配置與不具備叢集功能的<span>MySQL</span>配置之間的差別。如果希望瞭解關於後者的更多訊息，請參見<a href="installing.html" title="Chapter 2. Installing MySQL">第2章：安裝MySQL</a>。</p>
			<p>如果首先運行了所有的管理和數據節點，您將發現叢集配置最簡單，這或許是最花時間的配置部分。編輯<span><span>my.cnf</span>檔案相對直接，在本節中，僅討論與</span>不具備叢集功能的<span>MySQL</span>配置不同的部分。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-quick"></a>
			17.4.3.&nbsp;MySQL叢集的快速測試設置</h3></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			為了幫助您熟悉基本概念，我們將介紹功能性<span>MySQL</span>叢集的最簡單的可能配置。然後，按照本章相關部分提供的訊息，您應能設計自己所需的配置。<p>
			首先，應以系統根用戶身份通過執行下述命令建立配置目錄，如<span>/var/lib/mysql-cluster</span>：</p>
			<pre><span>shell&gt; <span><b>mkdir /var/lib/mysql-cluster</b></span></span></pre>
			<p>在該目錄下，使用下述訊息建立名為<span><span>config.ini</span>的檔案</span>，針對系統的情況，用恰當的值替換<span>HostName</span>和<span><span>DataDir</span>。</span></p>
			<pre><span># file &quot;config.ini&quot; - showing minimal setup consisting of 1 data node,</span></pre>
			<pre><span># 1 management server, and 3 MySQL servers.</span></pre>
			<pre><span># The empty default sections are not required, and are shown only for</span></pre>
			<pre><span># the sake of completeness.</span></pre>
			<pre><span># Data nodes must provide a hostname but MySQL Servers are not required</span></pre>
			<pre><span># to do so.</span></pre>
			<pre><span># If you don&#39;t know the hostname for your machine, use localhost.</span></pre>
			<pre><span># The DataDir parameter also has a default value, but it is recommended to</span></pre>
			<pre><span># set it explicitly.</span></pre>
			<pre><span># Note: DB, API, and MGM are aliases for NDBD, MYSQLD, and NDB_MGMD</span></pre>
			<pre><span># respectively. DB and API are deprecated and should not be used in new</span></pre>
			<pre><span># installations.</span></pre>
			<pre><span>[NDBD DEFAULT]</span></pre>
			<pre><span>NoOfReplicas= 1</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[MYSQLD DEFAULT]</span></pre>
			<pre><span>[NDB_MGMD DEFAULT]</span></pre>
			<pre><span>[TCP DEFAULT]</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDB_MGMD]</span></pre>
			<pre><span>HostName= myhost.example.com</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>HostName= myhost.example.com</span></pre>
			<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<p>現在，能夠按下述方式啟動管理伺服器：</p>
			<pre><span>shell&gt; <span><b>cd /var/lib/mysql-cluster</b></span></span></pre>
			<pre><span>shell&gt; <span><b>ndb_mgmd</b></span></span></pre>
			<p>接下來，通過運行<strong><span>ndbd</span></strong>啟動單個<span>DB</span>節點。首次為給定的<span>DB</span>節點啟動<strong><span>ndbd</span></strong>時，應使用「<span><span>—initial」</span>選項，如下所示：</span></p>
			<pre><span>shell&gt; <span><b>ndbd --initial</b></span></span></pre>
			<p>對於後續的<strong><span>ndbd</span></strong>啟動，通常不需要使用該選項：</p>
			<pre><span>shell&gt; <span><b>ndbd</b></span></span></pre>
			<p>這是因為，<span><span>--initial</span>選項將刪除該數據節點的</span>所有已有數據和日誌檔案（以及所有的資料表元數據），並建立新的數據和日誌檔案。該規則的一項例外是：新增了新數據節點後重啟叢集並從備份進行恢復之時。</p>
			<p>預設情況下，<strong><span>ndbd</span></strong>將在端口<span>1186</span>上搜尋本地主機上的管理伺服器。</p>
			<p><strong><span>註釋：</span></strong>如果從二進制<span>tarball</span>安裝了<span>MySQL</span>，需要明確指定<strong><span>ndb_mgmd</span></strong>和<strong><span>ndbd</span></strong>伺服器的路徑。（正常情況下，它們位於<span>/usr/local/mysql/bin</span>目錄下）。</p>
			<p>最後，進入<span>MySQL</span>數據目錄（通常是<span>/var/lib/mysql</span>或<span><span>/usr/local/mysql/data</span>），並確保<span>my.cnf</span>檔案包含啟用<span>NDB</span>儲存引擎所需的選項：</span></p>
			<pre><span>[mysqld]</span></pre>
			<pre><span>ndbcluster</span></pre>
			<p>現在，您能按通常方式啟動<span>MySQL</span>伺服器：</p>
			<pre><span>shell&gt; <span><b>mysqld_safe --user=mysql &amp;</b></span></span></pre>
			<p>等待一段時間，確認<span>MySQL</span>伺服器正在恰當運行。如果發現通知用<span><span>mysql</span>停止，請檢查伺服器的<span>.err</span>檔案，找出錯誤。</span></p>
			<p>如果到目前為止一切正常，可使用叢集啟動它：</p>
			<pre><span>shell&gt; <span><b>mysql</b></span></span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha-Max</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>鍵入』<span>help;</span>』或』<span>\h</span>』獲取幫助。鍵入』<span>\c</span>』清空緩衝區。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>SHOW ENGINES\G</b></span></span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>...</span></pre>
			<pre><span>*************************** 12. row ***************************</span></pre>
			<pre><span>Engine: NDBCLUSTER</span></pre>
			<pre><span>Support: YES</span></pre>
			<pre><span>Comment: Clustered, fault-tolerant, memory-based tables</span></pre>
			<pre><span>*************************** 13. row ***************************</span></pre>
			<pre><span>Engine: NDB</span></pre>
			<pre><span>Support: YES</span></pre>
			<pre><span>Comment: Alias for NDBCLUSTER</span></pre>
			<pre><span>...</span></pre>
			<p>（注意，上例輸出中顯示的行號可能與您的系統上顯示的不同，具體情況取決於使用的<span>MySQL</span>版本，以及配置它的方式）。</p>
			<pre><span>shell&gt; <span><b>mysql</b></span></span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha-Max</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>鍵入』<span>help;</span>』或』<span>\h</span>』獲取幫助。鍵入』<span>\c</span>』清空緩衝區。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>USE test;</b></span></span></pre>
			<pre><span>Database changed</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>CREATE TABLE ctest (i INT) ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>Query OK, 0 rows affected (0.09 sec)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>SHOW CREATE TABLE ctest \G</b></span></span></pre>
			<pre><span>*************************** 1. row ***************************</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Table: ctest</span></pre>
			<pre><span>Create Table: CREATE TABLE `ctest` (</span></pre>
			<pre><span>&nbsp; `i` int(11) default NULL</span></pre>
			<pre><span>) ENGINE=ndbcluster DEFAULT CHARSET=latin1</span></pre>
			<pre><span>1 row in set (0.00 sec)</span></pre>
			<p>要想檢查是否恰當設置了節點，可啟動管理客戶端：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm</b></span></span></pre>
			<p>隨後，為了獲得關於叢集狀態的報告，可從管理客戶端內使用<strong><span>SHOW</span></strong>命令：</p>
			<pre><span>NDB&gt; SHOW</span></pre>
			<pre><span>Cluster Configuration</span></pre>
			<pre><span>---------------------</span></pre>
			<pre><span>[ndbd(NDB)]&nbsp;&nbsp;&nbsp;&nbsp; 1 node(s)</span></pre>
			<pre><span>id=2&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3, Nodegroup: 0, Master)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[ndb_mgmd(MGM)] 1 node(s)</span></pre>
			<pre><span>id=1&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[mysqld(API)]&nbsp;&nbsp; 3 node(s)</span></pre>
			<pre><span>id=3&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3)</span></pre>
			<pre><span>id=4 (not connected, accepting connect from any host)</span></pre>
			<pre><span>id=5 (not connected, accepting connect from any host)</span></pre>
			<p>此時，您成功地設置了工作的<span>MySQL</span>叢集。現在，您能使用由<span>ENGINE=NDBCLUSTER</span>或其別名<span><span>ENGINE=NDB</span>建立的資料表，將數據保存到叢集中。</span></p>
			<h3 class="title"><a name="mysql-cluster-config-file"></a>17.4.4. 配置檔案</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-example">
				17.4.4.1. MySQL叢集的配置示範</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-connectstring">
				17.4.4.2. MySQL叢集連接字串<code class="literal"></code></a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-computer-definition">
				17.4.4.3. 定義構成MySQL叢集的計算機</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-mgm-definition">
				17.4.4.4. 定義MySQL叢集管理伺服器</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-db-definition">
				17.4.4.5. 定義MySQL叢集數據節點</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-api-definition">
				17.4.4.6. 定義MySQL叢集內的SQL節點</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-tcp-definition">
				17.4.4.7. MySQL叢集TCP/IP連接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-direct-tcp-definition">17.4.4.8. 
				使用直接連接的MySQL叢集TCP/IP連接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-shm-definition">
				17.4.4.9. MySQL叢集共享內存連接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-sci-definition">
				17.4.4.10. MySQL叢集SCI傳輸連接</a></span></dt></dl></div>
			<p>配置<span>MySQL</span>叢集需要與兩個檔案打交道：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>my.cnf</span>：為所有的<span>MySQL</span>叢集可執行檔案指定了選項。您應熟悉了前面介紹的使用<span>MySQL</span>的方式，通過運行在叢集中的每個可執行檔案，必須能夠訪問該檔案。</p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>config.ini</span></span>：該檔案僅由<span>MySQL</span>叢集管理伺服器讀取，隨後管理伺服器會將包含該檔案的訊息分配給叢集中的所有程序。<span><span>config.ini</span>檔案包含對叢集中各節點的描述。包括數據節點的配置參數，以及叢集中所有節點間連接的配置參數。</span></p>
			<p>
			我們正在不斷改進叢集配置，並努力簡化該程序。儘管我們將盡量維護向後相容性，但在某些時候，可能也需要引入不兼容的變動。在這種情況下，我們將盡量讓叢集用戶事先瞭解該變動是否是向後兼容的。如果您發現了尚未記錄在文檔中的這類變動，請使用我們的<span><a target="_top"  href="http://bugs.mysql.com/"><span>問題資料庫</span></a></span>通報它。</p>
			<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-config-example"></a>
				17.4.4.1.&nbsp;MySQL叢集的配置示範</h4></div></div></div>
				<p>為了支援<span>MySQL</span>叢集，需要更新檔案<span><span>my.cnf</span>，如下例所示。注意，不應將這裡給出的選項與<span>config.ini</span>檔案中出現的選項混淆起來。此外，從命令行使用可執行檔案時，或許也應指定這些參數。</span></p>
				<pre><span># my.cnf</span></pre>
				<pre><span># example additions to my.cnf for MySQL Cluster</span></pre>
				<pre><span># (valid in MySQL 5.1)</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># enable ndbcluster storage engine, and provide connectstring for</span></pre>
				<pre><span># management server host (default port is 1186)</span></pre>
				<pre><span>[mysqld]</span></pre>
				<pre><span>ndbcluster</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide connectstring for management server host (default port: 1186)</span></pre>
				<pre><span>[ndbd]</span></pre>
				<pre><span>connect-string=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide connectstring for management server host (default port: 1186)</span></pre>
				<pre><span>[ndb_mgm]</span></pre>
				<pre><span>connect-string=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide location of cluster configuration file</span></pre>
				<pre><span>[ndb_mgmd]</span></pre>
				<pre><span>config-file=/etc/config.ini</span></pre>
				<p>（關於連接字元的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2節，「MySQL叢集連接字串<code class="literal"></code>」</a>）。</p>
				<pre><span># my.cnf</span></pre>
				<pre><span># example additions to my.cnf for MySQL Cluster</span></pre>
				<pre><span># (will work on all versions)</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># enable ndbcluster storage engine, and provide connectstring for management</span></pre>
				<pre><span># server host to the default port 1186</span></pre>
				<pre><span>[mysqld]</span></pre>
				<pre><span>ndbcluster</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com:1186</span></pre>
				<p>或許，您也可以使用叢集<span><span>my.cnf</span>中單獨的<span>[mysql_cluster]</span></span>部分，設置可被所有可執行檔案讀取的設置，並影響所有的可執行檔案：</p>
				<pre><span># cluster-specific settings</span></pre>
				<pre><span>[mysql_cluster]</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com:1186</span></pre>
				<p>目前，配置檔案採用的是<span>INI</span>格式，預設情況下被命名為<span><span>config.ini</span>。該檔案在啟動時由</span><strong><span>ndb_mgmd</span></strong>讀取，並能被置於任何地方。在命令行上與<strong><span>ndb_mgmd</span></strong>一起使用<span><span>--config-file=[<i>&lt;path&gt;</i>]<i>&lt;filename&gt;</i></span>，可指定其位置和名稱。如果未指定配置檔案，</span>預設情況下，<strong><span>ndb_mgmd</span></strong>將嘗試讀取位於當前工作目錄下的檔案<span>config.ini</span>。</p>
				<p>對於大多數參數，均定義了預設值，也能在<span><span>config.ini</span>檔案中指定預設值。</span>要想建立預設值部分，可簡單地將單詞<span><span>DEFAULT</span>新增到該部分的名稱上。</span>例如，數據節點是使用<span><span>[NDBD]</span>部分配置的。如果所有的數據節點使用相同大小的數據內存，而且該內存大小不同於預設的大小，應建立包含<span>DataMemory</span>行的<span>[NDBD 
				DEFAULT]</span>部分，為所有數據節點指定預設的數據內存大小。</span></p>
				<p><span>INI</span>格式包含多個部分，每一部分以該部分的標題（用方括號括住）開始，後跟恰當的參數名和值。與標準格式的不同之處在於，不能用冒號「<span>:</span>」和等號「<span>=</span>」隔開參數名和值；另一處不同是，這些部分並不是用名稱唯一標識的。其唯一性條目（如具有相同類型的兩個不同節點）是由唯一<span>ID</span>標識的。</p>
				<p>作為最低要求，配置檔案必須定義叢集中的計算機和節點，以及這些節點所在的計算機。下面給出了一個簡單的叢集配置檔案示範，該叢集包含<span>1</span>個管理伺服器，<span>2</span>個數據節點和<span>2</span>個<span>MySQL</span>伺服器：</p>
				<pre><span># file &quot;config.ini&quot; - 2 data nodes and 2 SQL nodes</span></pre>
				<pre><span># This file is placed in the startup directory of ndb_mgmd (the management</span></pre>
				<pre><span># server)</span></pre>
				<pre><span># The first MySQL Server can be started from any host. The second can be started</span></pre>
				<pre><span># only on the host mysqld_5.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD DEFAULT]</span></pre>
				<pre><span>NoOfReplicas= 2</span></pre>
				<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDB_MGMD]</span></pre>
				<pre><span>Hostname= ndb_mgmd.mysql.com</span></pre>
				<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD]</span></pre>
				<pre><span>HostName= ndbd_2.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD]</span></pre>
				<pre><span>HostName= ndbd_3.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[MYSQLD]</span></pre>
				<pre><span>[MYSQLD]</span></pre>
				<pre><span>HostName= mysqld_5.mysql.com</span></pre>
				<p>在該配置檔案中，有6個不同部分：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[COMPUTER]</span>：定義了叢集主機。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]</span>：定義了叢集的數據節點。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]</span>：定義了叢集的<span>MySQL</span>伺服器節點。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MGM]</span>或<span>[NDB_MGMD]</span>：定義了叢集的管理伺服器節點。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[TCP]</span>：定義了叢集中節點間的<span>TCP/IP</span>連接，<span>TCP/IP</span>是預設的連接協議。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]</span>：定義了節點間的共享內存連接。以前，這類連接僅能在使用「<span>--with-ndb-shm</span>」選項建立的二進制檔案中使用。在<span>MySQL 
				5.1-Max</span>中，預設情況下它是允許的，但仍應將其視為試驗性的。</p>
				<p>注意，每個節點在<span><span>config.ini</span>檔案中有自己的部分。例如，由於該叢集有兩個數據節點，在配置檔案中，也包含定義這些節點的部分。</span></p>
				<p>可以為每個部分定義<span><span>DEFAULT</span>值。所有的叢集參數名稱均區分大小寫。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-connectstring"></a>
				17.4.4.2.&nbsp;MySQL叢集連接字串<code class="literal"></code></h4></div></div></div>
				<p>除了<span>MySQL</span>叢集管理伺服器（<strong><span>ndb_mgmd</span></strong>），構成<span>MySQL</span>叢集的每個節點均需要<span>1</span>個連接字串，該連接字串指向管理伺服器所在的位置。它用於建立與管理伺服器的連接，並執行其他任務，這類其他任務取決於節點在叢集內扮演的角色。連接字串的語法如下：</p>
				<pre><span>&lt;connectstring&gt; :=</span></pre>
				<pre><span>&nbsp;&nbsp;&nbsp; [&lt;nodeid-specification&gt;,]&lt;host-specification&gt;[,&lt;host-specification&gt;]</span></pre>
				<pre><span>&nbsp;&nbsp;&nbsp; </span></pre>
				<pre><span>&lt;nodeid-specification&gt; := <span><i>node_id</i></span></span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>&lt;host-specification&gt; := <span><i>host</i></span>[:<span><i>port</i></span>]</span></pre>
				<p><span>node_id</span>是大於<span>1</span>的整數，用於確定<span><span>config.ini</span>中的節點。<i><span>port</span></i></span>是引用正常<span>Unix</span>端口的整數。<span><i><span>host</span></i></span>是代資料表有效<span>Internet</span>地址的字串。</p>
				<pre><span>example 1 (long):&nbsp;&nbsp;&nbsp; &quot;nodeid=2,myhost1:1100,myhost2:1100,192.168.0.3:1200&quot;</span></pre>
				<pre><span>example 2 (short):&nbsp;&nbsp; &quot;myhost1&quot;</span></pre>
				<p>如果未提供，所有節點均將使用<span>localhost:1186</span>作為預設的連接字串值。如果在連接字串中省略了<span>&lt;port&gt;</span>，預設端口為<span>1186</span>。該端口在網絡上總應是可用的，這是因為它是由<span>IANA</span>為該目的而指定的（詳情請參見<span><a target="_top"  href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></span>）。</p>
				<p>通過列出多個<span><span>&lt;host-specification&gt;</span>值，</span>能夠指定數個冗余管理伺服器。叢集節點將按照指定的順序嘗試連接到每台主機上的連續管理伺服器，直至成功建立起連接為止。</p>
				<p>有多種指定連接字串的不同方法：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>
				每個可執行檔案有自己的命令行選項，使用它，能夠在啟動時指定管理伺服器（關於各可執行程式的介紹，請參見相應的文檔）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>也能一次性地為叢集中的所有節點設置連接字串，方法是將其放在管理伺服器的<span><span>my.cnf</span>檔案的<span>[mysql_cluster]</span>部分。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>為了向後相容性，還提供了兩種其他選項，其使用的語法相同：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>設置<span>NDB_CONNECTSTRING</span>環境變數，使之包含<span>connectstring</span>（連接字串）。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>將針對各可執行檔案的<span>connectstring</span>（連接字串）寫入名為<span><span>Ndb.cfg</span>的文本檔案，並將該檔案放在可執行檔案的啟動目錄下。</span></p>
				<p>但是，這些方法目前已不再受重視，對於新安裝，不應使用它們。</p>
				<p>指定連接字串時，推薦的方法是在命令行上設置它，或為每個可執行檔案在<span><span>my.cnf</span>檔案中設置它。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-computer-definition"></a>
				17.4.4.3.&nbsp;定義構成MySQL叢集的計算機</h4></div></div></div>
				<p>除了用於避免為系統中的每個節點定義主機名外，<span><span>[COMPUTER]</span>部分沒有實際的重要意義。這裡所提到的所有參數都是需要的。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[COMPUTER]Id</span><span>
				</span></p>
				<p>這是整數值，用於引用位於配置檔案中別處的主機計算機。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[COMPUTER]HostName</span><span>
				</span></p>
				<p>這是計算機的主機名或<span>IP</span>地址。<span>
				</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-mgm-definition"></a>
				17.4.4.4.&nbsp;定義MySQL叢集管理伺服器</h4></div></div></div>
				<p><span><span>[NDB_MGMD]</span>部分</span>（或其別名<span>[MGM]</span>）用於配置管理伺服器的行為。下面列出的所有參數均能被忽略，如果是這樣，將使用其預設值。<strong><span>註釋：</span></strong>如果<span><span>ExecuteOnComputer</span>和<span>HostName</span>參數均未出現，</span>會為它們指定預設值<span><span>localhost</span>。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]Id</span><span>
				</span></p>
				<p>叢集中的每個節點都有唯一的標識，由從<span>1</span>到<span>63</span>的整數資料表示。所有的內部叢集消息使用該<span>ID</span>來定址結點。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ExecuteOnComputer</span><span>
				</span></p>
				<p>它引用在<span><span>[COMPUTER]</span>部分中定義的計算機之一。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]PortNumber</span><span>
				</span></p>
				<p>這是管理伺服器用於監聽配置請求和管理命令的端口號。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]LogDestination</span><span>
				</span></p>
				<p>該參數指定了將叢集登錄訊息發送到哪裡。有三種選項，<span>CONSOLE</span>、<span>SYSLOG</span>和<span>FILE</span>：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><span>
				CONSOLE</span>，將日誌輸出到標準輸出設備</span>（<span>stdout</span>）：</p>
				<pre><span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>CONSOLE</span></pre>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><span>
				SYSLOG</span>，將日誌發送到<span>syslog</span>（系統日誌）軟設備</span>，可能的值包括：<span>auth</span>、<span>authpriv</span>、<span>cron</span>、<span>daemon</span>、<span>ftp</span>、<span>kern</span>、<span>lpr</span>、<span>mail</span>、<span>news</span>、<span>syslog</span>、<span>user</span>、<span>uucp</span>、<span>local0</span>、<span>local1</span>、<span>local2</span>、<span>local3</span>、<span>local4</span>、<span>local5</span>、<span>local6</span>或<span>local7</span>。</p>
				<p><strong>
				<span>註釋：</span></strong>並非所有的作業系統均支援所有的軟設備。</p>
				<pre><span>SYSLOG:facility=syslog</span></pre>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>FILE</span>，將叢集日誌輸出導向相同機器上的正規檔案。可指定下述值：</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				filename</span>：日誌檔案的名稱。</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				maxsize</span>：日誌記錄切換到新檔案之前，檔案能增長到的最大尺寸。出現該情況時，將通過在檔案名上新增<span>.x</span>，重命名日誌檔案，其中，<span>x</span>是該名稱尚未使用的下一個數字。</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				maxfiles</span>：日誌檔案的最大數目。</p>
				<pre><span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>FILE:filename=cluster.log,maxsize=1000000,maxfiles=6</span></pre>
				<p>使用由分號分隔的字串，可以指定多個日誌目標，如下所示：</p>
				<pre><span>CONSOLE;SYSLOG:facility=local0;FILE:filename=/var/log/mgmd</span></pre>
				<p><span>
				<span>FILE</span>參數的預設值是<span>FILE:filename=ndb_<i>node_id</i>_cluster.log,maxsize=1000000,maxfiles=6</span></span>，其中，<span><span>node_id</span>是節點的<span>ID</span>。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ArbitrationRank</span><span>
				</span></p>
				<p>該參數用於定義哪個節點將扮演仲裁程式的角色。只有<span>MGM</span>節點和<span>SQL</span>節點能扮演仲裁程式的角色。<span>ArbitrationRank</span>可以取下述值之一：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>0</span>：該節點永遠不會用作仲裁程式。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>1</span>：該節點具有高的優先級，也就是說，與低優先級節點相比，它更容易成為仲裁程式。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>2</span>：表明節點具有低的優先級，僅當具有高優先級的節點無法用於該目的時，才能成為仲裁程式。</p>
				<p>通常情況下，應將<span><span>ArbitrationRank</span>設置為<span>1</span>（預設值），並將所有的<span>SQL</span>節點設置為<span>0</span>，</span>將管理伺服器配置為仲裁程式。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ArbitrationDelay</span><span>
				</span></p>
				<p>
				整數值，以毫秒為單位規定了管理伺服器對仲裁請求的延遲時間。預設情況下，該值為<span>0</span>，通常不需要改變它。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]DataDir</span><span>
				</span></p>
				<p>
				它用於設置保存管理伺服器輸出檔案的位置。這些檔案包括叢集日誌檔案、程序輸出檔案、以及端口監督程式的<span>pid</span>檔案（對於日誌檔案，可通過設置<span><span>[NDB_MGMD]LogDestination</span>的<span>FILE</span>參數覆蓋它，請參見本節前面的討論）。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-db-definition"></a>
				17.4.4.5.&nbsp;定義MySQL叢集數據節點</h4></div></div></div>
				<p><span>[NDBD]</span>部分用於配置叢集數據節點的行為。有很多可用於控制緩衝區大小、池大小、超時等的參數。強制性參數包括：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				ExecuteOnComputer</span>或<span>HostName</span><span>.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>參數<span>NoOfReplicas</span><span>
				</span></p>
				<p>這些參數需要在<span>[NDBD 
				DEFAULT]</span>部分中定義。<span> </span></p>
				<p>大多數數據節點參數是在<span><span>[NDBD 
				DEFAULT]</span>部分中設置的。只有那些明確聲明為能設置本地值的參數才能在<span>[NDBD]</span>部分中被更改。<span>HostName</span></span>、<span>Id</span>以及<span><span>ExecuteOnComputer</span>必須在本地<span>[NDBD]</span>部分中定義。</span></p>
				<p><strong><span>識別數據節點</span></strong>
				</p>
				<p>啟動節點時，可在命令行上分配<span><span>Id</span>值</span>（即數據節點<span>ID</span>），也能在配置檔案中分配<span>Id</span>值。</p>
				<p>對於各參數，能夠使用後綴<span>k</span>、<span>M</span>或<span>G</span>用於指明單位，分別資料表示<span>1024</span>、<span>1024*1024</span>或<span>1024*1024*1024</span>（例如，<span>100k</span>資料表示<span>100 
				* 1024 = 102400</span>）。目前，參數和值區分大小寫。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NBDB]Id</span><span>
				</span></p>
				<p>這是用作節點地址的節點<span>ID</span>，供有的叢集內部消息使用。這是介於<span>1</span>～<span>63</span>之間的整數。叢集中的每個節點均有唯一的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]ExecuteOnComputer</span><span>
				</span></p>
				<p>用於引用在<span><span>COMPUTER</span>部分中定義的計算機（主機）。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HostName</span><span>
				</span></p>
				<p>指定該參數的效果類似於指定<span>ExecuteOnComputer</span>。它定義了儲存節點所在計算機的主機名。指定除<span><span>localhost</span>之外的其他主機名時，需要</span>該參數或<span><span>ExecuteOnComputer</span>。</span><span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>(<em><span>OBSOLETE</span></em>)
				<span>[NDBD]ServerPort</span> </span>
				</p>
				<p>
				叢集中的各節點使用端口來與其他節點相連。該端口也用於連接建立階段中的非<span>TCP</span>傳輸器。由於預設端口是動態分配的，同一台計算機上的兩個節點具有不同的端口號，正常情況下不需要為該參數指定值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfReplicas</span><span>
				</span></p>
				<p>該全局參數僅能在<span><span>[NDBD 
				DEFAULT]</span>中設置，它定義了叢集中每個資料表保存的副本數。該參數還指定了節點組的大小。節點組指的是保存相同訊息的節點集合。</span></p>
				<p>節點組是以隱式方式構成的。第<span>1</span>個節點組由具有最低節點<span>ID</span>的數據節點集合構成，下一個節點組由具有次低節點<span>ID</span>的數據節點集合構成，依此類推。作為示範，截頂我們有<span>4</span>個數據節點，並將<span><span>NoOfReplicas</span>設置為<span>2</span>。這四個數據節點的<span>ID</span>分別是<span>2</span>、<span>3</span>、<span>4</span>、<span>5</span>。那麼第<span>1</span>個節點組由節點<span>2</span>和<span>3</span>構成，第<span>2</span>個節點組由節點<span>4</span>和<span>5</span>構成。重要的是對叢集進行相應的配置，使得同一節點組中的節點位於不同的計算機上，這是因為，如果位於相同的計算機上，單個硬件故障會導致整個叢集崩潰。</span></p>
				<p>如果未提供節點<span>ID</span>，那麼數據節點的順序將是節點組的決定因素。無論是否進行了明確的分配，可在管理客戶端<span>SHOW</span>命令的輸出中查看它們。</p>
				<p><span>
				<span>NoOfReplicas</span>沒有預設值，最大的可能值為<span>4</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]DataDir</span><span>
				</span></p>
				<p>該參數指定了存放跟蹤檔案、日誌檔案、<span>pid</span>檔案以及錯誤日誌的目錄。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]FileSystemPath</span><span>
				</span></p>
				<p>該參數指定了存放為元數據建立的所有檔案、<span>REDO</span>日誌、<span>UNDO</span>日誌和數據檔案的目錄。預設目錄是由<span><span>DataDir</span>指定的。注意，啟動</span><strong><span>ndbd</span></strong><span>程序之前，該目錄必須已存在。</span></p>
				<p>為<span>MySQl</span>叢集推薦的目錄層次包括<span><span>/var/lib/mysql-cluster</span>，在其下為節點的檔案系統建立<span>1</span>個為目錄。該子目錄包含節點<span>ID</span>。例如，如果節點<span>ID</span>為<span>2</span>，該子目錄的名稱為<span>ndb_2_fs</span></span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupDataDir</span><span>
				</span></p>
				<p>也能指定存放備份的目錄。預設情況下，該目錄是<span><i><span>FileSystemPath/</span></i><span>BACKUP</span></span>（請參見前面的介紹）。</p>
				<p><strong><span>數據內存和索引內存</span></strong><span>
				</span></p>
				<p><span>參數<span>DataMemory</span>和<span>IndexMemory</span>指定了存放實際記錄及其索引的內存段的大小。</span>這是它們的值時，重要的是應掌握使用<span><span>DataMemory</span>和<span>IndexMemory</span></span>的方式，這是因為，為了反映叢集的實際使用情況，常常需要更新它們：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]DataMemory</span><span>
				</span></p>
				<p>
				該參數定義了用於保存資料庫記錄的空間大小。全部空間均是分配在內存中的，因此，機器應具有足夠的物理內存來容納該值，這點極其重要。</p>
				<p>由<span><span>DataMemory</span>分配的內存用於保存實際記錄和索引。目前，每條記錄具有固定的大小（甚至<span>VARCHAR</span>列也保存為固定寬度列）。每條記錄的開銷為<span>16</span>字節，</span>此外，每條記錄還需要額外的空間，這是因為，這類記錄保存在具有<span>128</span>字節頁面開銷的<span>32KB</span>頁中（請參見下面的介紹）。由於每條記錄僅保存在<span>1</span>個頁中，因而每頁有少量的浪費。目前，最大記錄大小為<span>8052</span>字節。</p>
				<p>由<span><span>DataMemory</span>定義的內存空間也用於保存有序索引，對於每條記錄，索引約使用<span>10</span>字節。在有序索引中，資料表示了</span>每個資料表行。用戶常犯的一個錯誤是，想當然地認為所有的索引均保存在由<span><span>IndexMemory</span>分配的內存中，但情況並非如此：只有主鍵和唯一性混編索引使用該內存，有序索引使用的是</span>由<span><span>DataMemory</span>分配的內存。然而，建立主鍵或唯一性混編索引</span>時，也會在相同的
				鍵上建立有序索引，除非在索引建立語句中指定了<span><span>USING 
				HASH</span>。</span>通過在管理客戶端中運行<strong><span>ndb_desc 
				-d </span></strong><span><b><i>
				<span>db_name</span></i></b></span><strong><span>
				</span></strong><span><b><i>
				<span>table_name</span></i></b></span>，可對其進行驗證。</p>
				<p><span>
				<span>DataMemory</span>分配的內存空間由多個</span><span>32KB</span>頁構成，它們是為資料表片段分配的。通常情況下，為每一資料表劃分的資料表片段數目與叢集中的節點數目相同。因此，對於每一節點，片段數目與在<span><span>NoOfReplicas</span>中設置的相同。</span>一旦分配了<span>1</span>頁，目前無法將其返回到自由頁池中，除非刪除資料表。執行節點恢復也將壓縮分區，這是因為，所有記錄均會被插入到其他活動節點的空分區中。</p>
				<p><span>
				<span>DataMemory</span>內存空間也包含</span><span>UNDO</span>訊息：對於每一更新，未改變記錄的副本將被分配到<span><span>DataMemory</span>中。在有序資料表索引中，還有對每一副本的引用。僅當更新唯一性索引列時，才會更新唯一性混編索引，在該情況下，將在索引資料表中插入新的條目，並在提交時刪除舊的條目。因此，也有必要分配足夠的內存，以便處理由使用叢集的應用程式執行的最大事務。</span>在任何情況下，執行少量大的事務並不比使用眾多小的事務佔優，原因如下：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大事務的速度沒有較小事務的速度快。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大的事務會增加丟失操作的數目，一旦事務失敗，必須重複執行。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大的事務使用更多的內存。</p>
				<p><span>
				<span>DataMemory</span>的預設值是</span><span>80MB</span>，最小為<span>1MB</span>。沒有最大尺寸限制，但在實際使用過程中，最大限制應恰當，以便當達到最大限制時，程序不會啟動交換功能。該限制由機器上可用的物理<span>RAM</span>量、以及作業系統能提交給任何程序的內存量決定。對於<span>32</span>位作業系統，該限制值為每程序<span>2</span>～<span>4GB</span>，對於<span>64</span>位作業系統，該限制值更大。對於大的資料庫，出於該原因，最好使用<span>64</span>位作業系統。此外，在每台機器上也能運行一個以上的<strong><span>ndbd</span></strong>程序，在使用多<span>CPU</span>的機器上，該特性頗具優勢。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]IndexMemory</span><span>
				</span></p>
				<p>該參數用於控制<span>MySQL</span>叢集中哈希（混編）索引所使用的儲存量。哈希（混編）索引總用於主鍵索引、唯一性索引、以及唯一性約束。注意，定義主鍵和唯一性索引時，將建立兩條索引，其中一條是用於所有<span>tuple</span>訪問和鎖定處理的哈希（混編）索引。此外，它還能用於增強唯一性約束。</p>
				<p>哈希（混編）索引的大小是每記錄<span>25</span>字節，再加上主鍵的大小。對大於<span>32</span>字節的主鍵，還需加上<span>8</span>字節。</p>
				<p>考慮下例定義的資料表：</p>
				<pre><span>CREATE TABLE example (</span></pre>
				<pre><span>&nbsp; a INT NOT NULL,</span></pre>
				<pre><span>&nbsp; b INT NOT NULL,</span></pre>
				<pre><span>&nbsp; c INT NOT NULL,</span></pre>
				<pre><span>&nbsp; PRIMARY KEY(a),</span></pre>
				<pre><span>&nbsp; UNIQUE(b)</span></pre>
				<pre><span>) ENGINE=NDBCLUSTER;</span></pre>
				<p>有<span>12</span>字節的開銷（無可空列將節省<span>4</span>字節的開銷）加上每記錄<span>12</span>字節的數據。此外，在列<span>a</span>和<span>b</span>上有兩個有序索引，假定每記錄分別耗用約<span>10</span>字節的空間。在每記錄約使用<span>29</span>字節的基資料表上有<span>1</span>條主鍵哈希索引。唯一性約束由以<span>b</span>作為主鍵以及<span>a</span>作為列的單獨資料表實現。對於該資料表，每記錄將耗用額外的<span>29</span>字節索引內存，在示範資料表中，還包括<span>12</span>字節的開銷再加上<span>8</span>字節的記錄數據。</p>
				<p>因此，對於<span>100</span>萬條記錄，需要<span>58MB</span>的索引內存來處理用於主鍵和唯一性約束的哈希索引。還需要<span>64 
				MB</span>來處理基資料表和唯一索引資料表、以及兩個有序索引資料表的記錄。</p>
				<p>
				由此可見，哈希索引佔用了相當大的內存空間，但作為回報，它們提供了對數據的極快訪問。在<span>MySQl</span>叢集中，它們也用於處理唯一性約束。</p>
				<p>
				目前僅有的分區算法是散列法，有序索引對每個節點來說都是局部性的。因此，有序索引不能用於處理一般情況下的唯一性約束。</p>
				<p>對於<span><span>IndexMemory</span>和<span>DataMemory</span>，重要的是，總的資料庫大小是各節點組的所有數據內存和所有索引內存之和。每個節點組用於保存複製訊息，因此，如果有<span>4</span>個節點和<span>2</span>個副本，將有<span>2</span>個節點組。對於每個數據節點，可用的總數據內存是</span><span>2*<span>DataMemory</span></span><span>。</span></p>
				<p>強烈建議為所有的節點設置相同的<span><span>DataMemory</span>值和<span>IndexMemory</span></span>值。由於數據是平均分佈在叢集中的所有節點上，任何節點可用的最大空間不超過叢集中最小節點的可用空間。</p>
				<p>
				<span>DataMemory</span>和<span>IndexMemory</span>可被更改，但降低任何一個的值均會導致危險，如果這樣做，很容易使某一節點甚至整個叢集因缺少足夠的內存空間而無法重啟。增加它們的值應是可接受的，但建議採用與軟件升級相同的方式升級它，首先更新配置檔案，然後重啟管理伺服器，最後依次重啟每個數據節點。</p>
				<p>
				更新不會增加所用的索引內存。插入將立刻生效，但是，在提交事務之前並不會實際刪除行。</p>
				<p><span>
				<span>IndexMemory</span>的預設值是</span><span>18MB</span>。最小值為<span>1MB</span>。</p>
				<p><strong><span>事務參數</span></strong></p>
				<p>下面討論的三個參數十分重要，這是因為，它們會影響並發事務的數目，以及系統能夠處理的事務的大小。<span><span>MaxNoOfConcurrentTransactions</span>用於設置節點內可能的並發事務數目。<span>MaxNoOfConcurrentOperations</span></span>用於設置能同時出現在更新階段或同時鎖定的記錄數目。</p>
				<p>對於打算設定特定值、不使用預設值的用戶，這兩個參數可能正是他們所需的（尤其是<span><span>MaxNoOfConcurrentOperations</span>）。預設值是為使用小型事務的系統而設置的，</span>為的是確保這類事務不會使用過多的內存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentTransactions</span><span>
				</span></p>
				<p>對於叢集中的每個活動事務，必須在叢集節點之一中有<span>1</span>條記錄。對事務的協調任務是在各節點間進行的：在叢集中，事務記錄的總數等於任意給定節點中的事務數乘以叢集中的節點數。</p>
				<p>事務記錄被分配給單獨的<span>MySQL</span>伺服器。正常情況下，對於使用叢集中任何資料表的每個連接，必須為其分配至少<span>1</span>條事務記錄。出於該原因，應確保叢集中的事務記錄數大於叢集中所有<span>MySQL</span>伺服器的並發連接數。</p>
				<p>對於所有的叢集節點，必須將該參數設置為相同的值。<span>
				</span></p>
				<p>
				更改該參數不安全，如果這樣做，會導致叢集崩潰。當某一節點崩潰時，叢集中的一個節點（實際上是生存時間最久的節點）將為崩潰之時正在崩潰節點中運行的所有事務建立事務狀態。因此，重要的是，該節點的事務記錄數不低於失效節點中的事務記錄數。</p>
				<p>該參數的預設值為<span>4096.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentOperations</span><span>
				</span></p>
				<p>
				根據事務的大小和數目調整該參數的值，這個想法不錯。執行僅包含少量操作且不涉及很多記錄的事務時，不需要將該參數設置得很高。但在執行涉及大量記錄的大事務時，需要將該參數設置得較高。</p>
				<p>
				對於每次事務更新的叢集數據，均會保存記錄，並會將它們保存在事務協調器中以及執行實際更新的節點中。這些記錄包含所需的狀態訊息，這類訊息可用於為回滾操作找到<span>UNDO</span>記錄，用於鎖定查詢或其他目的。</p>
				<p>
				該參數應被設置為：事務中同時更新的記錄數除以叢集數據節點的數目。例如，在包含<span>4</span>個數據節點的叢集中，如果預期處理的、使用事務的並發更新數為<span>1000000</span>，就應將該值設置為<span>1000000 
				/ 4 = 250000</span>。</p>
				<p>
				設置鎖定的讀請求也會導致操作記錄的建立。在單獨節點內也會分配一些額外的空間，以便處理在節點間分配不完美的問題。</p>
				<p>
				當查詢使用唯一性哈希索引時，對於事務中的每條記錄，實際上將使用兩條操作記錄。第<span>1</span>條記錄代資料表在索引資料表中的讀，第<span>2</span>條記錄負責處理基資料表上的操作。</p>
				<p>該參數的預設值為<span>32768.
				</span></p>
				<p>該參數實際上處理的是能分別配置的兩個值。第<span>1</span>個值指定了將多少操作記錄放到事務協調器中，第<span>2</span>個值指定了多少操作記錄是資料庫的本地記錄。</p>
				<p>對於在<span>8</span>節點叢集上執行的特大事務，它要求事務協調器中的操作記錄數不少於事務中涉及的讀取、更新和刪除次數。然而，叢集中的操作記錄分佈在所有的<span>8</span>個節點上。因此，如果有必要為特大事務配置系統，良好的方法是分別配置該參數的兩個部分。<span><span>MaxNoOfConcurrentOperations</span>總會被用於計算</span>節點的事務協調器部分中的操作記錄數。</p>
				<p>應瞭解操作記錄對內存的要求，這點也很重要。每記錄約消耗<span>1KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfLocalOperations</span><span>
				</span></p>
				<p>預設情況下，將按照<span>1.1 *
				<span>MaxNoOfConcurrentOperations</span></span><span>計算該參數，它適合於具有很多並發事務但不存在特大事務的系統。</span>如果需要在某一時間處理特大事務而且有很多節點，最好通過明確指定該參數以覆蓋預設值。</p>
				<p><strong><span>事務臨時儲存</span></strong></p>
				<p>下一組參數用於決定執行作為叢集事務組成部分的查詢時所需的臨時儲存空間。查詢完成後將釋放所有記錄，叢集將等待提交或回滾事件。</p>
				<p>
				對於大多數情況，這些參數的預設值是恰當的。但是，如果需要支援涉及大量行或操作的事務，用戶或許應增大這些參數的值，以便在系統中獲得更好的平行性。對於需要相對較少事務的應用程式，用戶可降低這些參數的值，以便節省內存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentIndexOperations</span><span>
				</span></p>
				<p>
				對於使用唯一性哈希索引的查詢，在查詢執行期間，將使用操作記錄的另一個臨時集合。該參數用於設置記錄池的大小。因此，僅當執行查詢的某一部分時才會分配該記錄，一旦該部分執行完成，將釋放記錄。對於處理放棄和提交所需的狀態，它是由正常的操作記錄負責處理的，這類記錄的池大小由參數<span>MaxNoOfConcurrentOperations</span>設置。</p>
				<p>該參數的預設值為<span>8192</span>。只有在極其罕見的情況下，需要使用唯一性哈希索引執行極高的並行操作時，才有必要增大該值。如果<span>DBA</span>（資料庫管理員）確信該叢集不需要高的並行操作，可以使用較小的值並節省內存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfFiredTriggers</span><span>
				</span></p>
				<p>
				<span>MaxNoOfFiredTriggers</span>的預設值是<span>4000</span>，它足以應付大多數情況。在某些情況下，如果<span>DBA</span>認為在叢集中對並行操作的要求並不高，甚至還能降低它。</p>
				<p>
				執行會影響唯一哈希索引的操作時，將建立記錄。在具有哈希索引的資料表中插入或刪除記錄時，或更新作為唯一哈希索引組成部分的列時，均會觸發索引資料表中的插入或刪除操作。所獲得的記錄用於代資料表該索引資料表操作，同時等待促使其完成的初始操作。該操作的時間很短，但對於在基資料表（包含唯一哈希索引）上有很多並發寫操作的情形，仍需要在記錄池中有大量的記錄。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionBufferMemory</span><span>
				</span></p>
				<p>
				該參數影響的內存用於跟蹤更新索引資料表和讀取唯一索引時執行的操作。該內存用於保存關於這類操作的鍵和列訊息。幾乎不需要更改該參數的預設值。</p>
				<p>正常的讀和寫操作使用類似的緩衝區，其使用時間甚至更短。編譯時間參數<span>ZATTRBUF_FILESIZE</span>（在<span>ndb/src/kernel/blocks/Dbtc/Dbtc.hpp</span>中）被設為<span>4000*128</span>字節（<span>500KB</span>）。用於
				鍵訊息的類似緩衝區，<span>ZDATABUF_FILESIZE</span>（也在<span><span>Dbtc.hpp</span>中）包含</span><span>4000 
				* 16 = 62.5KB</span>的緩衝空間。<span><span>Dbtc</span>是用於處理事務協調的模塊。</span></p>
				<p><strong><span>掃瞄和緩衝</span></strong></p>
				<p>在<span><span>Dblqh</span>模塊中</span>（在<span>ndb/src/kernel/blocks/Dblqh/Dblqh.hpp</span>內）有很多附加參數，這些參數會影響讀和寫操作。這些參數包括：<span>ZATTRINBUF_FILESIZE</span>，預設值為<span>10000*128</span>字節（<span>1250KB</span>）；以及<span>ZDATABUF_FILE_SIZE</span>，預設的緩衝空間大小為<span>10000*16</span>字節（約<span>156KB</span>）。到目前為止，沒有任何跡象表明應增加這類編譯時間限制參數的值，無論是用戶報告還是我們自己的大量測試。</p>
				<p><span>
				TransactionBufferMemory</span>的預設值是<span>1MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentScans</span><span>
				</span></p>
				<p>
				該參數用於控制可在叢集中執行的並行掃瞄的數目。每個事務協調程式均能處理為該參數定義的並行掃瞄。對於每次執行的掃瞄查詢，將以並行方式掃瞄所有分區。每次分區掃瞄將使用分區所在節點內的掃瞄記錄，記錄數等於該參數的值乘以節點數。叢集應能支援從叢集內所有節點同時執行的<span><span>MaxNoOfConcurrentScans</span>掃瞄。</span></p>
				<p>掃瞄實際上是在兩種情況下執行的。第<span>1</span>種情況是，處理查詢時不存在哈希或有序索引，在該情況下，查詢是通過執行全資料表掃瞄進行的。第<span>2</span>種情況是，沒有支援查詢的哈希索引，但存在有序索引。使用有序索引意味著將執行並發範圍掃瞄。由於順序僅保存在本地分區上，需要在所有分區上執行索引掃瞄。</p>
				<p>
				<span>MaxNoOfConcurrentScans</span>的預設值是<span>256</span>。最大值為<span>500</span>。</p>
				<p>
				該參數指定了事務協調器中的可能掃瞄數。如果未提供本地掃瞄記錄的數目，會對其進行計算，等於<span><span>MaxNoOfConcurrentScans</span>乘以系統中數據節點的數目。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfLocalScans</span><span>
				</span></p>
				<p>如果很多掃瞄不是完全並行化的，指定本地掃瞄記錄的數目。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BatchSizePerLocalScan</span><span>
				</span></p>
				<p>
				該參數用於計算鎖定記錄的數目，要想處理很多並發掃瞄操作，需要這類記錄。</p>
				<p>預設值是<span>64</span>，該值與<span>SQL</span>節點中定義的<span>ScanBatchSize</span>關係密切。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LongMessageBuffer</span><span>
				</span></p>
				<p>
				這是用於在單獨節點內和節點之間傳遞消息的內部緩衝。儘管幾乎不需要改變它，但它仍是可配置的。預設情況下，它被設置為<span>1MB</span>。</p>
				<p><strong><span>日誌和<span>Checkpointing</span></span></strong></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfFragmentLogFiles</span><span>
				</span></p>
				<p>該參數用於設置節點的<span>REDO</span>日誌檔案的大小。<span>REDO</span>日誌檔案是按循環方式組織的。第<span>1</span>個和最後<span>1</span>個日誌檔案（有時也分別稱為「頭」日誌檔案和「尾」日誌檔案）不應相遇，這點極其重要，當它們彼此過於接近時，由於缺少新日誌記錄的空間，節點將開始放棄所有事務，包括更新。</p>
				<p>自插入日誌記錄開始，在三個本地檢查點完成之前，不會刪除<span>REDO</span>日誌記錄。檢查點的頻率由其自己的配置參數集決定，請參見本章的相應部分。</p>
				<p>預設的參數值為<span>8</span>，它資料表示有<span>8</span>個集合，每個集合有<span>4</span>個<span>16MB</span>檔案，總容量為<span>512MB</span>。換句話講，<span>REDO</span>日誌空間必須按<span>64MB</span>的塊大小分配。在需要大量更新的情況下，可能需要將<span><span>NoOfFragmentLogFiles</span>的值增加到<span>300</span>或更高，以便為<span>REDO</span>日誌提供足夠的空間。</span></p>
				<p>如果<span>checkpointing</span>很慢，並有很多對資料庫的寫操作以至於日誌檔案已滿，而且在沒有<span>jeapo 
				rdising</span>恢復功能的情況下無法截斷日誌尾部，那麼所有的更新日誌均將被放棄，並給出錯誤代碼<span>410</span>或缺少臨時日誌空間。該狀況將一直持續，直至完成了檢查點操作並能將日誌尾部向前移動為止。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfSavedMessages</span><span>
				</span></p>
				<p>
				該參數用於設置跟蹤檔案的最大數目，在覆蓋舊檔案之前，將保留這些跟蹤檔案。無論出於何種原因，當節點崩潰時將建立跟蹤檔案。</p>
				<p>預設為<span>25</span>個跟蹤檔案。</p>
				<p><strong><span>元數據對像</span></strong></p>
				<p>
				下一組參數為元數據對像定義了池的大小，可用於定義最大屬性數，資料表，索引，索引使用的觸發程式對象，事件，以及叢集之間的複製。注意，這些參數僅是對叢集的「建議」，任何未指定的參數均將採用其預設值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfAttributes</span><span>
				</span></p>
				<p>定義了可在叢集中定義的屬性數目。</p>
				<p>該參數的預設值為<span>1000</span>，最小的可能值為<span>32</span>。沒有最大值限制。對於每一屬性，每節點約需<span>200</span>字節的儲存空間，這是應為，所有的元數據將完整地複製到伺服器上。</p>
				<p>設置<span><span>MaxNoOfAttributes</span>時，應實現準備好打算在將來執行的任何<span>ALTER 
				TABLE</span>命令，這點很重要。這是因為下述事實，</span>在叢集資料表上執行<span><span>ALTER 
				TABLE</span>的過程中，所使用的屬性數目是原始資料表中的<span>3</span>倍。例如，</span>如果某一資料表需要<span>100</span>個屬性，而且您打算在以後更改它，那麼就需要將<span><span>MaxNoOfAttributes</span>的值設為<span>300</span>。有一個良好的經驗規則，如果您能在不出現問題的情況下建立所有所需的資料表，請將最大資料表中屬性數目的兩倍加到<span>MaxNoOfAttributes</span>上。完成該設置後，應通過執行實際的<span>ALTER 
				TABLE</span>操作，驗證該數目是足夠的。如果失敗，將原始值的倍數加到<span>MaxNoOfAttributes</span>上，並再次測試。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfTables</span><span>
				</span></p>
				<p>
				資料表對象是為每個資料表、唯一哈希索引和有序索引分配的。該參數為作為整體的叢集設置了最大資料表對像數目。</p>
				<p>對於具有<span>BLOB</span>數據類型的每個屬性，將使用額外的資料表來保存大部分<span>BLOB</span>數據。定義資料表的總數時，必須將這些資料表考慮在內。</p>
				<p>該參數的預設值為<span>128</span>。最小值為<span>8</span>，最大值為<span>1600</span>。每個資料表對像每節點約需<span>20KB</span>的空間。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfOrderedIndexes</span><span>
				</span></p>
				<p>對於叢集中的每個有序索引，將分配<span>1</span>個對象，該對像描述了編入索引的是什麼以及其儲存段。預設情況下，每個這樣定義的索引還將定義<span>1</span>個有序索引。每個唯一索引和主鍵既有<span>1</span>個有序索引還有<span>1</span>個哈希索引。</p>
				<p>該參數的預設值為<span>128</span>。每個對象每節點約需<span>10KB</span>的數據。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfUniqueHashIndexes</span><span>
				</span></p>
				<p>對於每個不是主鍵的唯一索引，將分配<span>1</span>個特殊資料表，該資料表將唯一鍵映射到索引資料表的主鍵上。預設情況下，對於每個唯一索引，還將定義<span>1</span>個有序索引。為了防止該情況，定義唯一索引時，必須使用<span><span>USING 
				HASH</span>選項。</span></p>
				<p>預設值是<span>64</span>。每個索引每節點約需<span>15KB</span>的空間。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfTriggers</span><span>
				</span></p>
				<p>
				對於每個唯一性哈希索引，將分配內部更新、插入、和刪除觸發程式（這意味著對於每個唯一性哈希索引，將建立三個觸發程式）。但是，<span>1</span>個有序索引僅需要<span>1</span>個觸發程式對象。對於叢集中每個正常資料表，備份也將使用三個觸發程式對象。</p>
				<p><strong>
				<span>註釋</span></strong>：支援叢集之間的複製時，也將使用內部觸發程式。</p>
				<p>該參數用於設置叢集中觸發程式對象的最大數目。</p>
				<p>該參數的預設值為<span>768.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfIndexes</span><span>
				</span></p>
				<p>在<span>MySQL 5.1</span>中，該參數已被放棄，應使用<span>MaxNoOfOrderedIndexes</span>和<span>MaxNoOfUniqueHashIndexes</span>取而代之。</p>
				<p>
				該參數僅供唯一性哈希索引使用。對於在叢集中定義的每個唯一性哈希索引，在該池中需要有<span>1</span>條記錄。</p>
				<p>該參數的預設值為<span>128.
				</span></p>
				<p><strong><span>布爾參數</span></strong></p>
				<p>數據節點的行為也會受具有布爾值的一組參數的影響。將其設為「<span>1</span>」或「<span>Y</span>」，可將這類參數設置為「真」，將其設為「<span>0</span>」或「<span>N</span>」，可將這類參數設置為「假」。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LockPagesInMainMemory</span><span>
				</span></p>
				<p>對於包括<span>Solaris</span>和<span>Linux</span>在內的很多作業系統，能夠將程序鎖定在內存中，以避免與磁盤的交換。使用它，可確保叢集的實時特性。</p>
				<p>預設情況下，該特性是被禁止的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StopOnError</span><span>
				</span></p>
				<p>出現錯誤時，該參數指定了<span>NDBD</span>程序是退出還是執行自動重啟。</p>
				<p>預設情況下，允許該特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]Diskless</span><span>
				</span></p>
				<p>能夠將<span>MySQL</span>叢集的資料表指定為「無磁盤的」，這意味著不會在磁盤上對資料表執行檢查點操作，也不會出現日誌操作。這類資料表僅存在於主內存中。使用「無磁盤」資料表的一個結果是，出現崩潰侯，不會保留這類資料表，也不會保留這類資料表中的任何記錄。但是，當工作在「無磁盤」模式下時，能夠在無盤計算機上運行<strong><span>ndbd</span><span>。</span></strong></p>
				<p><strong>
				<span>要點：</span></strong>該特性會使整個叢集運行在「無磁盤」模式下。</p>
				<p>允許該特性時，可執行備份操作，但不會實際保存備份數據。</p>
				<p>將「<span>Diskless</span>」設置為「<span>1</span>」或「<span>Y</span>」可允許該特性。預設情況下，禁止該特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]RestartOnErrorInsert</span><span>
				</span></p>
				<p>
				僅當建立調試版時才能訪問該特性，在執行作為測試組成部份的代碼塊的過程中，可以插入錯誤。</p>
				<p>預設情況下，該特性是被禁止的。</p>
				<p><strong><span>控制超時、間隔、和磁盤分頁</span></strong><span>
				</span></p>
				<p>有多種用於指定超時以及叢集數據節點中各種動作間時間間隔的參數。大多數超時值以毫秒為單位指定。任何例外均將在適用時指明。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenWatchDogCheck</span><span>
				</span></p>
				<p>
				為了防止主線程在某一點上陷入無限循環，採用了「看門狗」線程來檢查主線程。該參數以毫秒為單位指定了檢查之間的時間間隔。如果三次檢查之後程序仍保持在相同的狀態，它將被「看門狗」線程中止。</p>
				<p>
				出於試驗目的，可方便地更改該參數，也可以對其進行調整以適合本地條件。也可以按節點指定它，雖然這樣作的理由很少。</p>
				<p>預設超時為<span>4000</span>毫秒（<span>4</span>秒）。<span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartPartialTimeout</span><span>
				</span></p>
				<p>
				該參數指定了在使用叢集初始化子程式之前，叢集等待所有儲存節點出現的時間。該超時參數由於防止部分叢集啟動。</p>
				<p>預設值是<span>30000</span>毫秒（<span>30</span>秒）。<span><span>0</span>資料表示無限超時，換句話講，</span>僅當所有節點均可能時才會啟動叢集。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartPartitionedTimeout</span><span>
				</span></p>
				<p>等待了<span><span>StartPartialTimeout</span>毫秒後，如果叢集做好了啟動準備但仍可能處於隔離狀態，叢集將等待該超時時間結束。</span></p>
				<p>預設超時為<span>60000</span>毫秒（<span>60</span>秒）。 
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartFailureTimeout</span><span>
				</span></p>
				<p>
				如果數據節點在該參數指定的時間內未完成其啟動序列，節點啟動將失敗。如果將該參數設置為<span>0</span>，資料表示不採用數據節點超時。</p>
				<p>預設值是<span>60000</span>毫秒<span>(60</span>秒）。對於包含大量數據的數據節點，應增加該參數。例如，對於包含數<span>GB</span>數據的儲存節點，為了執行節點重啟，可能需要<span>10</span>～<span>15</span>分鐘（即<span>600000</span>～<span>1000000</span>毫秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HeartbeatIntervalDbDb</span><span>
				</span></p>
				<p>
				發現失敗節點的主要方法之一是使用「心跳」數。該參數指明了心跳信號的發送頻率，以及接收它們的頻率。如果在<span>1</span>行內丟失了三次心跳，節點將被宣告為死亡。因此，通過心跳機制發現故障的最大時間是心跳間隔的四倍。</p>
				<p>預設的心跳間隔為<span>1500</span>毫秒（<span>1.5</span>秒）。不得大幅度更改該參數，各節點間該參數的變化範圍也不得過寬。例如，如果某一節點使用了<span>5000</span>毫米的值，而觀察它的節點採用<span>1000</span>毫秒，很顯然，該節點很快就會被宣佈為死亡。能夠在軟件升級期間更改該參數，但增量應較小。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HeartbeatIntervalDbApi</span><span>
				</span></p>
				<p>每個數據節點會將心跳信號發送到各<span>MySQL</span>伺服器（<span>SQL</span>節點），以確保保持接觸。如果某一<span>MySQL</span>伺服器未能及時發出心跳信號，它將被宣佈為死亡。在這種情況下，所有正在進行的事務將結束並釋放所有資源。<span>SQL</span>節點不能重新連接，直至由以前的<span>MySQL</span>實例初始化的所有活動完成為止。用於該判斷的<span>3</span>心跳判據與<span><span>HeartbeatIntervalDbDb</span>描述的相同。</span></p>
				<p>預設時間間隔為<span>1500</span>毫秒（<span>1.5</span>秒）。不同的數據節點之間，該間隔可以有所不同，這是因為，每個儲存節點均會獨立於所有其他數據節點觀察與之相連的<span>MySQL</span>伺服器。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenLocalCheckpoints</span><span>
				</span></p>
				<p>
				該參數是一個例外，它未指定啟動新的本地檢查前應等待的時間，相反，它用於確保在出現相對較少更新的叢集內未執行本地檢查點操作。在具有較高更新率的大多數叢集內，很可能在前一個本地檢查點操作完成後立刻啟動一個新的檢查點操作。</p>
				<p>
				從前一個本地檢查點啟動後，所有已執行寫操作的大小將增加。該參數也是一個例外，原因在於它被指定為<span>4</span>字節字總數的以<span>2</span>為底數的對數，因此，預設值<span>20</span>資料表示<span>4MB 
				(4 </span>×<span> 2<sup>20</sup>)</span>寫操作，<span>21</span>資料表示<span>8MB</span>，依此類推，直至等同於<span>8GB</span>寫操作的最大值<span>31</span>。</p>
				<p>叢集中所有的寫操作將加在一起。將<span><span>TimeBetweenLocalCheckpoints</span>設置為<span>6</span>或更小資料表示本地檢查點操作將不停頓地連續執行，與叢集的工作負荷無關。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenGlobalCheckpoints</span><span>
				</span></p>
				<p>
				提交事務時，它被提交到存有鏡像數據的所有節點的主內存中。但是，事務日誌記錄不會作為提交程序的一部分寫入磁盤。其原因在於，在至少兩台獨立主機機器上安全體提交事務應能滿足關於關於持久性的合理標準。</p>
				<p>
				另一個很重要的方面是，應確保即使在最差情況下（叢集完全崩潰），也能進行恰當地處理。為了確保這點，在給定時間間隔內出現的所有事務均會被放到全局檢查點，可將其視為寫入磁盤的已提交事務的集合。換句話講，作為提交程序的組成部分，事務將被放入全局檢查點組；稍後，該組的日誌記錄將被寫入磁盤，然後將整個事務組安全地提交到叢集內所有計算機的磁盤上。。</p>
				<p>該參數定義了全局檢查點操作之間的時間間隔。預設值為<span>2000</span>毫秒。<span> 
				milliseconds. </span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenInactiveTransactionAbortCheck</span><span>
				</span></p>
				<p>
				對於該參數指定的每個時間間隔，通過檢查每個事務的定時器來執行超時處理。因此，如果該參數被設為<span>1000</span>毫秒，每隔<span>1</span>秒就會對事務進行檢查。</p>
				<p>該參數的預設值為<span>1000</span>毫秒（<span>1</span>秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionInactiveTimeout</span><span>
				</span></p>
				<p>
				如果事務目前未執行任何查詢，而是等待進一步的用戶輸入，該參數指明了放棄事務之前用戶能夠等待的最長時間。</p>
				<p>該參數的預設值是<span>0</span>（無超時）。對於需要確保無任何事務鎖定了過長時間的資料庫，應將參數設置為較小的值。單位為毫秒。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionDeadlockDetectionTimeout</span><span>
				</span></p>
				<p>
				當節點執行涉及事務的查詢時，在繼續之前，節點將等待叢集中其他節點作出回應。如果出現下述原因，將無法予以回應：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>節點「死亡」。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>操作進入鎖定隊列。</p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>被請求執行動作的節點負荷過重。</p>
				<p>
				該超時參數指明了放棄事務之前，事務協調器等候另一節點執行查詢的時間長短，該參數在節點失敗處理和死鎖檢測方面十分重要。在涉及死鎖和節點失敗的情形下，如果將其設置的過高，會導致不合需要的行為。</p>
				<p>預設的超時值為<span>1200</span>毫秒（<span>1.2</span>秒）。<span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskAfterRestartTUP</span><span>
				</span></p>
				<p>
				執行本地檢查點操作時，相應的算法會將所有數據頁寫入磁盤。如果追求盡快完成該操作而不是適中，很可能會對處理器、網絡和磁盤帶來過重負擔。為了控制寫入速度，該參數指明了每<span>100</span>毫秒可寫入多少數據頁。在本情形下，<span>1</span>個數據頁定義為<span>8KB</span>，因而該參數的單位是每秒<span>80KB</span>。因此，如果將<span><span>NoOfDiskPagesToDiskAfterRestartTUP</span>設置為<span>20</span>，</span>那麼在執行本地檢查點操作期間，要求每秒想磁盤寫入<span>1.6MB</span>的數據。該值包括針對數據頁的<span>UNDO</span>日誌記錄寫入，也就是說，該參數能處理來自數據內存的寫入限制。置於針對索引頁的<span>UNDO</span>日誌記錄，它們是由參數<span>NoOfDiskPagesToDiskAfterRestartACC</span>處理的（關於索引頁的更多訊息，請參見關於<span><span>IndexMemory</span>的條目）。</span></p>
				<p>簡而言之，該參數指定了執行本地檢查點操作的速度，並能與<span>NoOfFragmentLogFiles</span>、<span>DataMemory</span>和<span>IndexMemory</span>一起使用。</p>
				<p>預設值是<span>40</span>（每秒<span>3.2MB</span>的數據頁）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskAfterRestartACC</span><span>
				</span></p>
				<p>該參數使用的單位與<span><span>NoOfDiskPagesToDiskAfterRestartTUP</span>的相同，工作方式也類似，但限制的是從索引內存進行的索引頁寫入速度。</span></p>
				<p>該參數的預設值為每秒<span>20</span>個索引內存頁（<span>1.6MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskDuringRestartTUP</span><span>
				</span></p>
				<p>該參數的工作方式類似於<span>NoOfDiskPagesToDiskAfterRestartTUP</span>和<span><span>NoOfDiskPagesToDiskAfterRestartACC</span>，</span>但僅對重啟節點時在節點內執行的本地檢查點操作有效。作為所有節點重啟的組成部份，總會執行本地檢查點操作。在節點重啟過程中，能夠以比其他時間更快的速度執行磁盤寫入操作，這是因為，此時在節點內執行的活動數較少。</p>
				<p>該參數涉及從數據內存寫入的頁。</p>
				<p>預設值是<span>40</span>（<span>3.2MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskDuringRestartACC</span><span>
				</span></p>
				<p>
				在節點重啟的本地檢查點階段，對能夠寫入到磁盤的索引內存頁的數目進行控制。</p>
				<p>與<span>NoOfDiskPagesToDiskAfterRestartTUP</span>和<span>NoOfDiskPagesToDiskAfterRestartACC</span>一樣，該參數的值採用的單位也是每<span>100</span>毫秒寫入<span>8KB</span>（<span>80KB/</span>秒）。</p>
				<p>預設值是<span>20 (1.6MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]ArbitrationTimeout</span><span>
				</span></p>
				<p>
				該參數指定了數據節點等待仲裁程式對仲裁消息的回應的時間。如果超過了該時間，將假定網絡已中斷。</p>
				<p>預設值是<span>1000</span>毫秒（<span>1</span>秒）。</p>
				<p><strong><span>緩衝和日誌功能</span></strong></p>
				<p>
				一些與以前的編譯時間參數對應的配置參數仍可用。使用這些參數，高級用戶能夠對節點程序使用的資源進行更多的控制，並能根據需要調整各種緩衝區大小。</p>
				<p>
				將日誌記錄寫入磁盤時，這些緩衝區用作檔案系統的前端。如果節點運行在無盤模式下，那麼可以將這些參數設置為它們的最小值而不會造成負面影響，這是因為，磁盤寫入是由<span>NDB</span>儲存引擎的檔案系統提取層虛擬的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]UndoIndexBuffer</span><span>
				</span></p>
				<p>該緩衝用於本地檢查點操作執行期間。<span><span>NDB</span>儲存引擎</span>採用了一種恢復方案，該方案建立在檢查點一致性以及操作性<span>REDO</span>日誌值上。為了在不隔斷整個系統的寫操作的情況下獲得一致的檢查點，在執行本地檢查點操作的同時，將執行<span>UNDO</span>日誌操作。<span>UNDO</span>日誌功能每次是在單個資料表偏短上觸發的。由於資料表全部保存在主內存中，該最佳化是可能的。</p>
				<p><span>UNDO</span>索引緩衝用於主鍵哈希索引上的更新。插入和刪除操作會導致哈希索引的重新排列，<span>NDB</span>儲存引擎將映射了所有物理變化的<span>UNDO</span>日誌記錄寫入索引頁，以便能在系統重啟時撤銷這些變化。它還能記錄啟動本地檢查點操作時對每個偏短的所有插入操作。</p>
				<p>
				讀取和更新能夠設置鎖定位，並更新哈希索引條目中的標題。這類變更由頁寫入算法負責處理，以確保這些操作不需要<span>UNDO</span>日誌。</p>
				<p>該緩衝的預設大小為<span>2MB</span>。最小值為<span>1MB</span>，對於大多數應用，最小值已足夠。對於執行極大和／或大量插入和刪除操作、並處理大事務和大主鍵的應用程式，或許有必要增大該緩衝。如果該緩衝過小，<span>NDB</span>儲存引擎會發出錯誤代碼<span>677</span>「索引<span>UNDO</span>緩衝過載」<span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]UndoDataBuffer</span><span>
				</span></p>
				<p><span>UNDO</span>數據緩衝的作用與<span>UNDO</span>索引緩衝的相同，不同之處在於，它作用在數據內存上而不是索引內存上。對於插入、刪除和更新，該緩衝是在片段的本地檢查點階段使用的。</p>
				<p>由於<span>UNDO</span>日誌條目會隨著所記錄操作的增加而增大，該緩衝大於與之對應的索引內存緩衝，預設值為<span>16MB</span>。</p>
				<p>
				對於某些應用程式，該內存可能過大。在這種情況下，可降低它的值，最小為<span>1MB</span>。</p>
				<p>
				需要增加該緩衝的情況十分罕見。如果確實有這方面的要求，較好的方式是，檢查磁盤是否能實際處理資料庫更新活動所產生的負荷。如果缺少足夠的磁盤空間，即使增加該緩衝的大小也不能解決問題。</p>
				<p>如果該緩衝過小並變得「擁擠不堪」，<span>NDB</span>儲存引擎將發出錯誤代碼<span>891</span>「數據<span>UNDO</span>緩衝過載」。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]RedoBuffer</span><span>
				</span></p>
				<p>
				所有的更新活動也需要被記錄到日誌中。使用這類日誌，當系統重啟時，能夠重現這類更新。<span>NDB</span>恢復算法採用了「模糊」數據檢查點和<span>UNDO</span>日誌，然後使用<span>REDO</span>日誌再現所有變化直至到達恢復點。</p>
				<p>該緩衝的預設大小是<span>8MB</span>。最小值為<span>1MB</span>。</p>
				<p>如果該緩衝過小，<span>NDB</span>儲存引擎將發出錯誤代碼<span>1221</span>「<span><span>REDO</span>日誌緩衝過載<span>」</span>。</span></p>
				<p>在管理叢集的過程中，應能控制為各種事件類型發送至標準輸出裝置的日誌消息的數目，這點十分重要。有<span>16</span>種可能的事件級別（編號從<span>0</span>到<span>15</span>）。如果將給定事件類別的事件通報級別設置為<span>15</span>，那麼該類別中的所有事件報告均會被發送至標準輸出裝置，如果將其設置為<span>0</span>，資料表示在該類別中的沒有事件報告。</p>
				<p>預設情況下，僅會將啟動消息發送至標準輸出裝置，其餘的事件通報級別預設為<span>0</span>。這樣做的原因在於，這些消息也會被發送至管理伺服器的叢集日誌。</p>
				<p>對於管理客戶端，也能設置類似的級別，用以確定在叢集日誌中記錄哪些級別的事件。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelStartup</span><span>
				</span></p>
				<p>通報級別，用於程序啟動過程中生成的事件。</p>
				<p>預設級別為<span>1. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelShutdown</span><span>
				</span></p>
				<p>通報級別，用於作為節點恰當關閉程序組成部分而生成的事件。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelStatistic</span><span>
				</span></p>
				<p>
				通報級別，用於統計事件，如主鍵法讀取次數，更新數目，插入數目，與緩衝使用有關的訊息等。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelCheckpoint</span><span>
				</span></p>
				<p>通報級別，用於由本地和全局檢查點操作生成的事件。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelNodeRestart</span><span>
				</span></p>
				<p>通報級別，用於在節點重啟過程中生成的事件。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelConnection</span><span>
				</span></p>
				<p>通報級別，用於由叢集節點間的連接生成的事件。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelError</span><span>
				</span></p>
				<p>
				通報級別，用於由在整個叢集內的錯誤和警告生成的事件。這類錯誤不會導致任何節點失敗，當仍值得通報。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelInfo</span><span>
				</span></p>
				<p>通報級別，用於為叢集的一般狀態訊息而生成的事件。</p>
				<p>預設級別為<span>0. </span>
				</p>
				<p><strong><span>備份參數</span></strong></p>
				<p>本節討論的參數定義了與線上備份執行有關的內存緩衝集。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupDataBufferSize</span><span>
				</span></p>
				<p>
				在建立備份的過程中，為了將數據發送到磁盤，將使用兩類緩衝。備份數據緩衝用於填充由掃瞄節點的資料表而記錄的數據。一旦將該緩衝填充到了指定的水平<span>BackupWriteSize</span>（請參見下面的介紹），就會將頁發送至磁盤。在將頁寫入磁盤的同時，備份程序能夠繼續填充該緩衝，直至其空間消耗完為止。出現該情況時，備份程序將暫停掃瞄，直至一些磁盤寫入操作完成並釋放了內存為止，然後掃瞄繼續。</p>
				<p>該參數的預設值為<span>2MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupLogBufferSize</span><span>
				</span></p>
				<p>
				備份日誌緩衝扮演的角色類似於備份數據緩衝，不同之處在於，它用於生成備份執行期間進行的所有資料表寫入的日誌。相同的原理也適用於備份數據緩衝情形下的頁寫入，不同之處在於，當備份日誌緩衝中沒有多餘空間時，備份將失敗。出於該原因，備份日誌緩衝的大小應足以處理執行備份時產生的負載。</p>
				<p>
				該參數的預設值對於大多數應用程式均是適當的。事實上，備份失敗的原因更可能是因為磁盤寫入速度不夠，而不是備份日誌緩衝變滿。如果沒有為應用程式產生的寫負載配置磁盤子系統，叢集很可能無法執行所需的操作。</p>
				<p>最好按恰當的方式配置叢集，使得處理器成為瓶頸而不是磁盤或網絡連接。</p>
				<p>預設值是<span>2MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupMemory</span><span>
				</span></p>
				<p>該參數是<span><span>BackupDataBufferSize</span>和<span>BackupLogBufferSize</span></span>之和。</p>
				<p>預設值是<span>2MB + 2MB = 
				4MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupWriteSize</span><span>
				</span></p>
				<p>該參數指定了由備份日誌緩衝和備份數據緩衝寫入磁盤的消息大小。</p>
				<p>預設值是<span>32KB. </span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-api-definition"></a>
				17.4.4.6.&nbsp;定義MySQL叢集內的SQL節點</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				在<span><span>config.ini</span>檔案的<span>[MYSQLD]</span>部分中，定義了用於訪問叢集數據的<span>MySQL</span>伺服器（<span>SQL</span>節點）的行為</span>。不需要其中所給出的參數。如果未提供計算機或主機名，那麼任何主機均能使用該<span>SQL</span>節點。<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]Id</span><span> </span></p>
				<p>該值用作節點的地址，供所有的叢集內部消息使用，它必須是介於<span>1</span>和<span>63</span>之間的整數。在叢集內，每個叢集節點必須有唯一的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]ExecuteOnComputer</span><span> </span>
				</p>
				<p>它引用的是在配置檔案的<span><span>[COMPUTER]</span>部分定義的主機（計算機）之一。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]ArbitrationRank</span><span>
				</span></p>
				<p>該參數用於定義可作為仲裁程式的節點。<span>MGM</span>節點和<span>SQL</span>節點均能成為仲裁程式。如果值為<span><span>0</span>，表明給定的節點永遠不會用作仲裁程式，如果值為<span>1</span>，表明給定的節點在成為仲裁程式方面具有高的優先級，如果值為<span>2</span>，表明給定的節點在成為仲裁程式方面具有低的優先級</span>。對於正常配置，使用管理伺服器作為仲裁程式，將它的<span><span>ArbitrationRank</span>設置為<span>1</span>（預設），並將所有<span>SQL</span>節點的<span>ArbitrationRank</span>設置為<span>0</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]ArbitrationDelay</span><span> </span>
				</p>
				<p>如果將該參數設置為除<span>0</span>（預設值）以外的其他值，資料表示仲裁程式對仲裁請求的相應將被延遲設定的毫秒數。通常不需要更改該值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]BatchByteSize</span><span> </span></p>
				<p>
				對於轉換為全資料表掃瞄或對索引的範圍掃瞄的查詢，要想獲得最佳性能，重要的是以恰當的大小獲取記錄。能夠以記錄數為單位（<span>BatchSize</span>）和字節為單位（<span><span>BatchByteSize</span>）設置恰當的大小。</span>實際的批大小由兩個參數限定。</p>
				<p>查詢的執行速度可能會出現<span>40</span>％的變化，具體情況取決於該參數的設置。在未來的版本中，<span>MySQL</span>伺服器將根據查詢類型恰當地設置與批大小相關的參數。</p>
				<p>該參數以字節為單位，預設值是<span>32KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]BatchSize</span><span>
				</span></p>
				<p>該參數以記錄數為單位，預設值是<span>64</span>。最大值為<span>992</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]MaxScanBatchSize</span><span>
				</span></p>
				<p>
				批大小指的是從各數據節點發送的每批數據的大小。大多數掃瞄均是以並行方式執行的，目的是為了防止<span>MySQL</span>伺服器收到來自眾多節點的過多數據，該參數對所有節點上的總的批大小進行了限制。</p>
				<p>該參數的預設值為<span>256KB</span>。其最大大小為<span>16MB</span>。</p>
				<h4 class="title"><a name="mysql-cluster-tcp-definition"></a>
				17.4.4.7.&nbsp;MySQL叢集TCP/IP連接</h4></div></div></div>
				<p>在<span>MySQL</span>叢集中，<span>TCP/IP</span>是用於建立連接的預設傳輸協議。正常情況下不需要定義連接，這是因為，叢集能自動建立數據節點間、數據節點與所有<span>MySQL</span>伺服器節點、以及數據節點與管理伺服器之間的連接（關於該規則的例外，，請參見<a href="ndbcluster.html#mysql-cluster-direct-tcp-definition" title="17.4.4.8. MySQL Cluster TCP/IP Connections Using Direct Connections">17.4.4.8節，「使用直接連接的MySQL叢集TCP/IP連接」</a><span>)</span>。</p>
				<p>如果打算覆蓋預設的連接參數，才需要定義連接。在這種情況下，至少需要定義<span><i><span>NodeId1</span></i></span>、<span><i><span>NodeId2</span></i></span>、以及打算更改的參數。</p>
				<p>通過在<span><span>[TCP 
				DEFAULT]</span>部分進行設置，也能更改這些參數的預設值。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[TCP]<i>NodeId1</i></span><span> ,
				<span>[TCP]<i>NodeId2</i></span> </span>
				</p>
				<p>要想確定兩個節點之間的連接，需要在配置檔案的〔<span>TCP</span>〕部分中提供每個節點的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]SendBufferMemory</span><span>
				</span></p>
				<p>在向作業系統發出使用請求之前，<span>TCP</span>傳輸器採用緩衝來保存所有的消息。當該緩衝達到<span>64KB</span>時，將發送其內容，執行完一組消息循環後，也將發送這些內容。為了處理臨時過載情況，也能定義一個較大的發送緩衝。發送緩衝的預設值是<span>256KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]SendSignalId</span><span>
				</span></p>
				<p>為了能夠回掃分佈式消息圖，需要確定每條消息。將該參數設置為「<span>Y</span>」時，將通過網絡傳輸消息<span>ID</span>。預設情況下禁止該特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]Checksum</span><span>
				</span></p>
				<p>該參數也是一個布爾參數（<span>Y</span><span>/<span>N</span></span>或<span>1</span><span>/<span>0</span></span>），預設情況下是禁止的。啟用了該參數時，在將所有消息置於發送緩衝之前，將為所有參數計算校驗和。使用該特性，當消息等候在發送緩衝中時，可以確保消息不會損壞，也能確保消息不會被傳輸機制破壞。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]PortNumber</span><span>
				</span></p>
				<p>
				（已過時）以前，該參數指定了用於監聽來自其他節點的連接的端口號。不應再使用嘎參數。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]ReceiveBufferMemory</span><span>
				</span></p>
				<p>指定了從<span>TCP/IP</span>套接字接收數據時所使用的緩衝大小。幾乎不需要更改該參數的預設值，預設值為<span>64KB</span>，但是如果打算節省內存，也能更改它。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-direct-tcp-definition"></a>17.4.4.8. 使用直接連接的MySQL叢集TCP/IP連接</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			使用數據節點之間的直接連接建立叢集時，需要在叢集<span><span>config.ini</span>檔案的<span>[TCP]</span>部分中</span>明確指定如此連接的數據節點的交叉<span>IP</span>地址。<p>
			在下面的示範中，假定叢集具有至少<span>4</span>台主機，<span>1</span>台用於管理伺服器，一台用於<span>SQL</span>節點，兩台用於數據節點。作為整體，叢集位於<span>LAN</span>的<span>172.23.72.*</span>子網內。除了通常的網絡連接外，兩個數據節點使用標準的交叉電纜直接相連，並使用範圍在<span><span>1.1.0.*</span>的</span><span>IP</span>地址彼此間直接通信，如下所示：</p>
			<pre><span># Management Server</span></pre>
			<pre><span>[NDB_MGMD]</span></pre>
			<pre><span>Id=1</span></pre>
			<pre><span>HostName=172.23.72.20</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># SQL Node</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>Id=2</span></pre>
			<pre><span>HostName=172.23.72.21</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Data Nodes</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>Id=3</span></pre>
			<pre><span>HostName=172.23.72.22</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>Id=4</span></pre>
			<pre><span>HostName=172.23.72.23</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># TCP/IP Connections</span></pre>
			<pre><span>[TCP]</span></pre>
			<pre><span>NodeId1=3</span></pre>
			<pre><span>NodeId2=4</span></pre>
			<pre><span>HostName1=1.1.0.1</span></pre>
			<pre><span>HostName2=1.1.0.2</span></pre>
			<p>使用數據節點間的直接連接能夠改善叢集的整體效率，使用該方式，數據節點能繞過以太網設備，如交換器、<span>Hub</span>、路由器等，從而減少了叢集的等待時間。注意，對於兩個以上的數據節點，要想充分利用這類直接連接的優點，需要為各數據節點建立與相同節點組內的其他數據節點間的直接連接。</p>
			<h4 class="title"><a name="mysql-cluster-shm-definition"></a>
			17.4.4.9.&nbsp;MySQL叢集共享內存連接</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				<span>MySQL</span>叢集將嘗試使用共享內存傳輸器，並在可能的情況下自動配置它，尤其是在相同的叢集主機上同時運行著<span>1</span>個以上的節點時。在<span>MySQL</span>叢集的早期版本中，僅當使用<span><span>--with-ndb-shm</span>建立了<span>-max</span>二進製版本時，才支援共享內存段。明確地將共享內存定義為連接方法時，至少需要定義<span>NodeId1</span></span>、<span>NodeId2</span>和<span>ShmKey</span>。對於所有其他參數，應具有在大多數情況下均良好工作的預設值。<p>
				<strong><span>註釋：</span></strong><span>SHM</span>支援仍應被視為試驗性的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[SHM]NodeId1</span><span>,
				<span>[SHM]NodeId2</span> </span></p>
				<p>要想確定兩個節點之間的連接，需要為每個節點提供節點<span>ID</span>，<span>NodeId1</span>和<span>NodeId2</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]ShmKey</span><span>
				</span></p>
				<p>設置共享內存段時，節點<span>ID</span>用於唯一地確定通信所用的共享內存段。它以整數資料表示，沒有預設值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]ShmSize</span><span>
				</span></p>
				<p>每個<span>SHM</span>連接均有一個共享內存段，發送方將節點之間的消息置於該處，讀取方從該處讀取這類消息。<span>gai
				</span>共享內存段的大小由<span>ShmSize</span>定義。預設值是<span>1MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[SHM]SendSignalId</span><span> </span></p>
				<p>為了回掃分佈式消息的路徑，需要為每條消息提供唯一性<span>ID</span>。如果將該參數設置為「<span>Y</span>」，也能在網絡上傳輸這類消息<span>ID</span>。<span>預設情況下，該特性是禁止的。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]Checksum</span><span>
				</span></p>
				<p>該參數也是一種<span>Y</span><span>/<span>N</span></span><span>參數，預設情況下處於禁止狀態。如果允許該參數，在將所有消息置於發送緩衝之前，對為所有消息計算校驗和。</span></p>
				<p>
				使用該特性，當消息等候在發送緩衝中時，能防止消息損壞。此外，它還能用於在傳輸過程中檢查損壞的數據。</p>
				<h4 class="title"><a name="mysql-cluster-sci-definition"></a>
				17.4.4.10.&nbsp;MySQL叢集SCI傳輸連接</h4></div></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		僅當使用<span>--with-ndb-sci=<i>/your/path/to/SCI</i></span>建立了<span>MySQL-Max</span>二進製版本時，在<span>MySQL</span>叢集中才支援使用<span>SCI</span>傳輸器來連接節點。<span><i><span>path</span></i></span>應指向包含最低庫的目錄，並應包括含<span>SISCI</span>庫和頭檔案的目錄。<p>
		此外，<span>SCI</span>要求專用硬件。</p>
		<p>強烈建議，僅應為<span>ndbd</span>程序之間的通信使用<span>SVI</span>傳輸器。注意，使用<span>SCI</span>傳輸器意味著<span>ndbd</span>程序永不停止。因此，僅應在具有至少兩塊專供<span>ndbd</span>程序使用的<span>CPU</span>的機器上使用<span>SCI</span>傳輸器。每個<span>ndbd</span>程序至少應有<span>1</span>塊<span>CPU</span>，至少還應有<span>1</span>塊<span>CPU</span>用於處理作業系統的活動。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]NodeId1</span><span>,
		<span>[SCI]NodeId2</span> </span></p>
		<p>為了確定兩個節點之間的連接，需要為每個節點提供節點<span>ID</span>，<span>NodeId1</span>和<span>NodeId2</span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host1SciId0</span><span> </span></p>
		<p>它用於確定第<span>1</span>個叢集節點上的<span>SCI</span>節點<span>ID</span>（由<span>NodeId1</span>確定）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host1SciId1</span><span> </span></p>
		<p>能夠為兩塊<span>SCI</span>卡間的故障切換設置<span>SCI</span>傳輸器，這兩塊卡應使用節點之間的不同網絡。它用於確定節點<span>ID</span>，以及在第<span>1</span>個節點上使用的第<span>2</span>塊<span>SCI</span>卡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host2SciId0</span><span> </span></p>
		<p>它用於確定第<span>2</span>個叢集節點上的<span>SCI</span>節點<span>ID</span>（由<span>NodeId2</span>確定）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host2SciId1</span><span> </span></p>
		<p>使用兩塊<span>SCI</span>卡來提供故障切換功能時，該參數用於確定將在第<span>2</span>個節點上使用的第<span>2</span>塊<span>SCI</span>卡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SharedBufferSize</span><span>
		</span></p>
		<p>每個<span>SCI</span>傳輸器均有<span>1</span>個用於兩節點間通信的共享內存段。可將該共享內存段設置為預設的<span>1 
		MB</span>，這足以應對大多數應用程式。如果使用較小的值，當執行大量並行插入操作時，會出現問題，如共享緩衝過小，還會導致<span>ndbd</span>程序崩潰。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SendLimit</span><span>
		</span></p>
		<p><span>SCI</span>媒介前面的小緩衝用於保存消息，在通過<span>SCI</span>網絡傳輸這類消息前，會將它們保存在該緩衝內。它的預設值為<span>8kB</span>。按照我們的基準，在<span>64KB</span>時性能最好，但<span>16kB</span>僅有少量提升，即使大於<span>8KB</span>有好處，好處也不大。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SendSignalId</span><span>
		</span></p>
		<p>為了跟蹤分佈式消息，需要唯一地確定每條消息。將該參數設置為「<span>Y</span>」時，就能在網絡上傳輸消息<span>ID</span>。預設情況下禁止該特性。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]Checksum</span><span>
		</span></p>
		<p><span>T</span>該參數也是一種布爾值，預設情況下，該參數是被禁止的。啟用了<span><span>Checksum</span>（校驗和）時，</span>在將所有消息置於發送緩衝之前，將為所有參數計算校驗和。使用該特性，當消息等候在發送緩衝中時，可以確保消息不會損壞。此外，它還能用於在傳輸過程中檢查損壞的數據。</p>
		<h2 class="title"><a name="mysql-cluster-process-management"></a>
		17.5.&nbsp;MySQL叢集中的程序管理</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysqld-process">
			17.5.1. 用於MySQL叢集的MySQL伺服器程序使用</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-process">17.5.2. <span><strong class="command">
			ndbd</strong></span>，儲存引擎節點程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-process">17.5.3. <span><strong class="command">
			ndb_mgmd</strong></span>，「管理伺服器」程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-process">17.5.4. <span><strong class="command">
			ndb_mgm</strong></span>，「管理客戶端」程序</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-command-options">
			17.5.5. 用於MySQL叢集程序的命令選項</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
			要想掌握管理<span>MySQL</span>叢集的方法，需要瞭解<span>4</span>種基本程序。在本章下面的幾節內，介紹了這些程序在叢集內的作用，它們的使用方法，以及每種程序可用的啟動選項。<h3 class="title"><a name="mysqld-process"></a>
			17.5.1.&nbsp;用於MySQL叢集的MySQL伺服器程序使用</h3></div></div></div>
			<p><strong><span>mysqld</span></strong>是傳統的<span>MySQL</span>伺服器程序。要想與<span>MySQL</span>叢集一起使用，所建立的<strong><span>mysqld</span></strong>應支援<span><span>NDB</span>叢集儲存引擎，就像在預編譯的<span>-max</span>二進製版本中那樣，</span><span><a target="_top"  href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a></span>。</p>
			<p>即使採用該方式建立了<strong><span>mysqld</span></strong>二進製版本，在預設情況下，<span><span>NDB</span>叢集儲存引擎仍處於禁止狀態。要想啟用<span>NDB</span>叢集儲存引擎，可使用兩種可能的選項之一：</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>啟動<b><span>mysqld</span></b>時，將「—<span>ndbcluster</span>」用作啟動選項。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在<span><span>my.cnf</span>檔案的<span>[mysqld]</span>部分插入包含<span>ndbcluster</span>的<span>1</span>行內容。</span></p>
			<p>驗證運行的伺服器是否啟用了<span><span>NDB</span>叢集儲存引擎的簡單方法是，在<span>MySQL</span>監視器（<span>mysql</span>）中發出命令<span>SHOW 
			ENGINES</span>。在列出<span>NDBCLUSTER</span>的行中應能看到值<span>YES</span>，如果在該行上看到<span>NO</span>（或在輸出中未顯示該行），您所運行的是未啟用<span>NDB</span>功能的<span>MySQl</span>版本。如果在該行上看到<span>DISABLED</span>，就需採用上述兩種方法之一啟用它。</span></p>
			<p>為了讀取叢集配置數據，<span>MySQL</span>伺服器至少需要<span>3</span>種訊息：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>MySQL</span>伺服器自己的叢集節點<span>ID</span>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>管理伺服器（<span>MGM</span>節點）的主機名或<span>IP</span>地址。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>與管理伺服器相連的端口。</p>
			<p>節點<span>ID</span>可動態分配，因此不一定需要明確指定它們。</p>
			<p><strong><span>mysqld</span></strong>參數<span><span>ndb-connectstring</span>用於指定連接字串，或是在啟動</span><strong><span>mysqld</span></strong>時在命令行上指定，或是在<span><span>my.cnf</span>檔案中指定。連接字串包含主機名或<span>IP</span>地址，</span>以及能夠發現管理伺服器的端口。</p>
			<p>在下面的示範中，<span>ndb_mgmd.mysql.com</span>是管理伺服器所在的主機，管理伺服器在端口<span>1186</span>上監聽叢集消息。</p>
			<pre><span>shell&gt; <span><b>mysqld --ndb-connectstring=ndb_mgmd.mysql.com:1186</b></span></span></pre>
			<p>關於連接字串的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2節，「MySQL叢集連接字串<code class="literal"></code>」</a>。</p>
			<p>給定該訊息，<span>MySQL</span>伺服器將成為叢集中的完全參與者。（有時，我們也將運行在該方式下的<strong><span>mysqld</span></strong>程序稱為<span>SQL</span>節點）。它能完全瞭解所有的叢集數據節點以及它們的狀態，並能建立與所有數據節點的連接。在這種情形下，它能將任何數據節點用作事務協調器，並能訪問數據節點以執行讀取和更新操作。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndbd-process"></a>17.5.2. <span><strong class="command">ndbd</strong></span>，儲存引擎節點程序</h3></div></div></div>
			<p><strong><span>ndbd</span></strong>是使用<span>NDB</span>叢集儲存引擎處理資料表中所有數據的程序。通過該程序，儲存節點能夠實現分佈式事務處理，節點恢復，對磁盤的檢查點操作，線上備份，以及相關的任務。</p>
			<p>在<span>MySQL</span>叢集中，一組<strong><span>ndbd</span></strong>程序能夠共同處理數據。這些程序可以在相同的計算機（主機）上執行，也能在不同的計算機上執行。數據節點和叢集主機之間的通信是完全可配置的。</p>
			<p><strong><span>Ndbd</span></strong>將生成一組日誌檔案，這些檔案位於由配置檔案中<span><span>DataDir</span>指定的目錄下。下面列出了這些日誌檔案。注意，<i><span>node_id</span></i></span>代資料表節點的唯一<span>ID</span>。例如，<span><span>ndb_2_error.log</span>是由節點<span>ID</span>為<span>2</span>的儲存節點生成的錯誤日誌。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_error.log</span>是包含所引用<span>ndbd</span>程序所遇到的所有崩潰記錄的檔案。該檔案中的每條記錄均包含<span>1</span>個簡要的錯誤字串，以及對該崩潰跟蹤檔案的引用。該檔案的典型條目與下面給出的類似：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Date/Time: Saturday 30 July 2004 - 00:20:01</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Type of error: error</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Message: Internal program error (failed ndbrequire)</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Fault ID: 2341</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Problem data: DbtupFixAlloc.cpp</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Object of reference: DBTUP (Line: 173)</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>ProgramName: NDB Kernel</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>ProcessID: 14909</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>TraceFile: ndb_2_trace.log.2</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>***EOM***</span></pre>
			<p><strong>
			<span>註釋：</span></strong><em><span>請記住，錯誤日誌檔案中的最後<span>1</span>個條目並不必然是最新的（也不太可能），這點很重要</span><span>。</span></em>錯誤日誌中的條目不是按時間順序排列的，而是與<span><span>ndb_<i>node_id</i>_trace.log.next</span>（請參見下面的介紹）中定義的跟蹤檔案的順序對應。因此，錯誤日誌條目是按循環方式而不是順序方式覆蓋的。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_trace.log.<i>trace_id</i></span>是準確描述了錯誤出現之時所發生情況的跟蹤檔案。該訊息在<span>MySQL</span>叢集開發團隊進行分析時很有幫助。</p>
			<p>能夠對覆蓋舊檔案之前建立的跟蹤檔案的數目進行配置。<span><i><span>trace_id</span></i></span>是為每個連續的跟蹤檔案增加的編號。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_trace.log.next</span>是記錄了要指定的下一個跟蹤檔案編號的檔案。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_out.log</span>是包含<span>ndbd</span>程序的任何數據輸出的檔案。僅當將<span>ndbd</span>啟動為端口監督程式時才會建立該檔案。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>.pid</span>是包含啟動時作為端口監督程式的<span>ndbd</span>程序的程序<span>ID</span>的檔案。它還能起到鎖定檔案的作用，以防止啟動具有相同<span>ID</span>的節點。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_signal.log</span>是僅在<span>ndbd</span>調試版下使用的檔案，它能跟蹤<span>ndbd</span>程序中所有的入站、出站和內部消息。以及它們的數據。</p>
			<p>建議不要使用通過<span>NFS</span>安裝的目錄，這是因為在某些情況下，如果<span>pid-file</span>上的鎖定依舊有效，即使當程序中止後也會產生問題。</p>
			<p>啟動<strong><span>ndbd</span></strong>時，或許需要指定管理伺服器的主機名以及監聽的端口號。作為可選方式，也可以指定程序將使用的節點<span>ID</span>。</p>
			<pre><span>shell&gt; <span><b>ndbd --connect-string=&quot;nodeid=2;host=ndb_mgmd.mysql.com:1186&quot;</b></span></span></pre>
			<p>關於這方面的額外訊息，請參見<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2節，「MySQL叢集連接字串<code class="literal"></code>」</a>。</p>
			<p>啟動<strong><span>ndbd</span></strong>時，它實際上將啟動兩種程序。第<span>1</span>種程序稱為「<span class="quote"><span>angel 
			process</span></span>」（天使程序），它的唯一任務是發現執行程序在何時完成，然後重啟<span>ndbd</span>程序（如果作了該配置的話）。因此，如果您打算使用<span>Unix</span>的<span>kill</span>命令殺死<span>ndbd</span>程序，就需要殺死這兩個程序。中止<span>ndbd</span>程序的更恰當方法是使用管理客戶端，並通過該管理客戶端停止程序。</p>
			<p>執行程序採用了<span>1</span>個線程，用於讀取、寫入和掃瞄數據，以及所有其他任務。該線程是異步實施的，以便能方便地處理數以千計的並發活動。此外，看門狗線程負責監督執行線程，以確保執行線程不會陷入無限循環。線程池負責處理檔案<span>I/O</span>，每個線程均能處理一個打開的檔案。這些線程也能被<span>ndbd</span>程序中的傳輸器用作傳輸器連接。在執行包含更新在內的大量操作的系統中，如果允許，<span>ndbd</span>程序能佔用<span>2</span>個<span>CPU</span>。對於擁有多<span>CPU</span>的機器，建議使用屬於不同節點組的數個<span>ndbd</span>程序。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndb-mgmd-process"></a>17.5.3. <span><strong class="command">ndb_mgmd</strong></span>，「管理伺服器」程序</h3></div></div></div>
			<p>
			管理伺服器是這樣一種程序，它讀取叢集配置檔案，並將該訊息分配給叢集中所有請求該訊息的節點。它還負責維護叢集活動的日誌。管理客戶端能夠連接到管理伺服器，並檢查叢集的狀態。</p>
			<p>啟動管理伺服器時，不是一定需要指定連接字串。但是，如果使用了<span>1</span>個以上的管理伺服器，應提供連接字串，而且叢集中的每個節點應明確指定自己的節點<span>ID</span>。</p>
			<p>下述檔案是由<strong><span>ndb_mgmd</span></strong>在其啟動目錄下建立或使用的，並會被置於配置檔案中指定的<span><span>DataDir</span>中。在下面的列資料表中，<i><span>node_id</span></i></span>是唯一性節點<span>ID</span>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>
			config.ini</span>是作為整體的叢集的配置檔案。該檔案由用戶建立並由管理伺服器讀取。在<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>中，討論了設置該檔案的方法。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_cluster.log</span>是叢集事件日誌檔案。這類事件的例子包括：檢查點操作的啟動和完成，節點啟動事件，節點故障，以及內存使用水平。關於叢集事件的完整列資料表和描述，請參見<a href="ndbcluster.html#mysql-cluster-management" title="17.6. Management of MySQL Cluster">17.6節，「MySQL叢集的管理」</a>。</p>
			<p>當叢集日誌的大小達到<span>1MB</span>時，檔案將被重命名為<span>ndb_<i>node_id</i>_cluster.log.<i>seq_id</i></span>，其中<span><i><span>seq_id</span></i></span>是叢集日誌檔案的序列號（例如，如果編號<span>1</span>、<span>2</span>、<span>3</span>已存在，下一個日誌檔案將用<span>4</span>命名）。</p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_out.log</span>是將管理伺服器用作端口監督程式時用於<span>stdout</span></span>和<span><span>stderr</span>的檔案。</span></p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>.pid</span>是將管理伺服器用作端口監督程式時所使用的<span>PID</span>檔案。</span></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndb-mgm-process"></a>17.5.4. <span><strong class="command">ndb_mgm</strong></span>，「管理客戶端」程序</h3></div></div></div>
			<p>
			對於叢集的運行，實際上不需要管理客戶端的程序。其價值在於它提供了一組命令，這組命令可用於檢查叢集的狀態、啟動備份、並執行其他管理功能。管理客戶端使用<span>C 
			API</span>來訪問管理伺服器，高級用戶也能使用<span>C API</span>來編製專用的管理程序來執行任務，這類任務與<strong><span>ndb_mgm</span></strong>執行的類似。</p>
			<p>啟動管理客戶端時，需要提供管理伺服器的主機名和端口號，如下例所示。預設值是<span>localhost</span>和<span>1186</span>。</p>
			<pre><span>shell&gt; <span><b>ndb_mgm localhost 1186</b></span></span></pre>
			<p>關於使用<strong><span>ndb_mgm</span></strong>的更多訊息，請參見<a href="ndbcluster.html#ndb-mgm-command-options" title="17.5.5.4. Command Options for ndb_mgm">17.5.5.4節，「ndb_mgm的命令選項<span><strong class="command"></strong></span>」</a>和<a href="ndbcluster.html#mgm-client-commands" title="17.6.2. Commands in the Management Client">17.6.2節，「管理客戶端」中的命令</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-command-options"></a>
			17.5.5.&nbsp;用於MySQL叢集程序的命令選項</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#new-mysqld-command-options">
				17.5.5.1. 用於mysqld的與MySQL有關的命令選項<span><strong class="command"></strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-command-options">
				17.5.5.2. ndbd命令選項<span><strong class="command"></strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-command-options">
				17.5.5.3. ndb_mgmd的命令選<span><strong class="command">項</strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-command-options">
				17.5.5.4. ndb_mgm的命令選項<span><strong class="command"></strong></span></a></span></dt></dl></div>
			<p>所有<span>MySQL</span>叢集的可執行檔案（除<strong><span>mysqld</span></strong>）均使用下述選項。早期<span>MySQL</span>叢集版本的用戶應注意，這些選項開關中的一些與<span>MySQL 
			4.1</span>叢集中的相比有所改變，為的是保持它們之間的一致性，以及與<strong><span>mysqld</span></strong>的一致性。可以使用<span><span>-?</span>開關來查看支援的選項列資料表。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-?</span><span>,
			<span>--usage</span>,
			<span>--help</span> </span></p>
			<p>給出簡明清單，以及可用命令選項的描述。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-V</span><span>,
			<span>--version</span> </span></p>
			<p>給出<strong><span>ndbd</span></strong>程序的版本號。該版本號是<span>MySQL</span>叢集的版本號。版本號有一定的作用，這是因為並非所有的版本均能一起使用，而且在啟動時，<span>MySQL</span>叢集程序將驗證二進制檔案的版本是否能在同一叢集內共存。執行<span>MySQL</span>叢集的線上升級時，它也很重要（請參見<span><span>MySQL</span>叢集的軟件升級）。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-c <i>
			connect_string</i></span><span>,
			<span>--connect-string</span> </span></p>
			<p><span><i>
			<span>connect_string</span></i></span>作為命令選項，用於設置與管理伺服器的連接字串。</p>
			<pre><span>shell&gt; <span><b>ndbd --connect-string=&quot;nodeid=2;host=ndb_mgmd.mysql.com:1186&quot;</b></span></span></pre>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>
			--debug[=<i>options</i>]</span><span> </span></p>
			<p>該選項僅能用於具有調試功能的版本。使用它，能夠以與<strong><span>mysqld</span><span>程序</span></strong>相同的方式允許來自調試使用的輸出。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-e</span><span>,
			<span>--execute</span> </span></p>
			<p>使用它，能夠從系統<span>shell</span>將命令發送至叢集執行程式，如：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm -e show</b></span></span></pre>
			<p>或</p>
			<pre><span>shell&gt; <span><b>ndb_mgm --execute=&quot;SHOW&quot;</b></span></span></pre>
			<p>等效於</p>
			<pre><span>NDB&gt; SHOW;</span></pre>
			<p>它類似於「<span><span>-e」</span>選項與</span><strong><span>mysql</span></strong>命令行客戶端一起工作的方式。請參見<a href="using-mysql-programs.html#command-line-options" title="4.3.1. Using Options on the Command Line">4.3.1節，「在命令行上使用選項」</a>。</p>
			<div class="itemizedlist">&nbsp;</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-mysqld-command-options"></a>
			17.5.5.1.&nbsp;用於mysqld的與MySQL有關的命令選項<span><strong class="command"></strong></span></h4></div></div></div><div class="itemizedlist">
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--ndbcluster</span><span>
				</span></p>
				<p>如果二進製版本包含對<span><span>NDB</span>叢集儲存引擎的支援，可使用該選項覆蓋對<span>NDB</span>叢集儲存引擎（簡稱為<span>NDB</span>儲存引擎）的預設禁止設置。使用<span>MySQL</span>叢集時，<span>NDB</span>叢集儲存引擎是必要的。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--skip-ndbcluster</span><span> </span></p>
				<p>禁止<span><span>NDB</span>叢集儲存引擎。對於包含該功能的二進製版本，在預設情況下，該功能是被禁止的，換句話講，<span>NDB</span>叢集儲存引擎處於禁止狀態，直至使用<span>「—ndbcluster」</span>選項激活了它為止。僅當所編譯的伺服器支援<span>NDB</span>叢集儲存引擎時，才能使用該選項。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--ndb-connectstring=<i>connect_string</i></span><span>
				</span></p>
				<p>使用<span><span>NDB</span>儲存引擎時，通過設置該選項，能夠指定分配叢集配置數據的管理伺服器。</span></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndbd-command-options"></a>
				17.5.5.2.&nbsp;ndbd命令選項<span><strong class="command"></strong></span></h4></div></div></div>
				<p>關於某些常見選項的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5節，「用於MySQL叢集程序的命令選項」</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-d</span><span>,
				<span>--daemon</span> </span></p>
				<p>通知<strong><span>ndbd</span></strong>作為<span>daemon</span>（端口監督程式）程序執行（預設行為）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nodaemon</span><span>
				</span></p>
				<p>指明<strong><span>ndbd</span></strong>不得作為<span>daemon</span>（端口監督程式）程序啟動。調試<span>ndbd</span>以及希望將輸出重定向到屏幕時，它很有用。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--initial</span><span> </span></p>
				<p>通知<strong><span>ndbd</span></strong>執行初始化啟動。初始化啟動將刪除以前<span>ndbd</span>實例為恢復目的建立的任何檔案。它還能重新建立恢復用日誌檔案。注意，在某些作業系統上，該程序可能會佔用較長的時間。</p>
				<p>僅在首次啟動<span>ndbd</span>程序時才應使用<span><span>—initial</span>啟動，這是因為它將刪除叢集檔案系統的所有檔案，並再次建立所有的<span>REDO</span>日誌檔案。</span>該規則的例外如下：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>執行那些會更改檔案內容的軟件升級時。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>用新的<span>ndbd</span>版本重啟節點時。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>
				出於某種原因，節點重啟或系統重啟不斷失敗時的最後手段。在這類情形下，請注意，由於數據檔案的損壞，不能使用該節點來恢復數據。</p>
				<p>該選項不影響那些已被受影響節點建立的備份檔案。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nostart</span><span>
				</span></p>
				<p>指示<strong><span>ndbd</span></strong>不自動啟動。使用該選項時，<strong><span>ndbd</span></strong>連接到管理伺服器，從管理伺服器獲取配置數據，並初始化通信對象。但是，在管理伺服器特別要求之前，它不會實際啟動執行引擎。通過向管理客戶端發出恰當的命令，可完成該任務。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndb-mgmd-command-options"></a>
				17.5.5.3.&nbsp;ndb_mgmd的命令選<span><strong class="command">項</strong></span></h4></div></div></div>
				<p>關於某些常見選項的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5節，「用於MySQL叢集程序的命令選項」</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-f
				<i>filename</i>, --config-file=<i>filename</i></span><span>, 
				(<strong><span>OBSOLETE</span></strong>):
				<span>-c <i>filename</i></span> </span>
				</p>
				<p>
				通知管理伺服器應使用哪個檔案作為其配置檔案。必須指定該選項。檔案名預設為<span><span>config.ini</span>。注意，</span>「<span><span>-c」</span>快捷方式已過時，不應在新的安裝實例中使用它。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-d</span><span>,
				<span>--daemon</span> </span></p>
				<p>指示<strong><span>ndb_mgmd</span></strong>作為端口監督程式啟動。這是預設行為。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nodaemon</span><span>
				</span></p>
				<p>指示管理伺服器不作為端口監督程式啟動。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndb-mgm-command-options"></a>
				17.5.5.4.&nbsp;ndb_mgm的命令選項<span><strong class="command"></strong></span></h4></div></div></div>
				<p>關於某些常見選項的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5節，「用於MySQL叢集程序的命令選項」</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[<i>host_name</i> 
				[<i>port_num</i>]]</span><span> </span></p>
				<p>
				要想啟動管理客戶端，需要指定管理伺服器所在的位置，即指定主機名和端口。預設的主機名是<span><span>localhost</span>，預設端口是<span>1186</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--try-reconnect=<i>number</i></span><span>
				</span></p>
				<p>如果與管理伺服器的連接中斷，每隔<span>5</span>秒，節點將嘗試再次連接到管理伺服器，直至成功。使用該選項，能夠將嘗試的字數限制在<span>number</span>指定的值，超過該限制後，將放棄嘗試並通報錯誤。</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-management"></a>
		17.6.&nbsp;MySQL叢集的管理</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-startup-phases">17.6.1. 
			MySQL叢集的啟動階段</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mgm-client-commands">
			17.6.2. 「管理客戶端」中的命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-event-reports">
			17.6.3. MySQL叢集中生成的事件報告</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-single-user-mode">
			17.6.4. 單用戶模式</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup">
			17.6.5. MySQL叢集的聯機備份</a></span></dt></dl></div>
		<p>管理<span>MySQL</span>叢集涉及眾多任務，首先是配置和啟動<span>MySQL</span>叢集。詳情請參見<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>和<a href="ndbcluster.html#mysql-cluster-process-management" title="17.5. Process Management in MySQL Cluster">17.5節，「MySQL叢集中的程序管理」</a>。</p>
		<p>下面介紹了<span>MySQL</span>叢集的管理事宜。</p>
		<p>有兩種積極管理<span>MySQL</span>叢集的基本方法。第<span>1</span>種方法是，使用在管理客戶端中輸入的命令，借此可檢查叢集的狀態，更改日誌級別，啟動和停止備份，以及啟動和停止節點。對於第<span>2</span>種方法，需要研究管理伺服器<span><span>DataDir</span>目錄下叢集日誌檔案<span>ndb_<i>node_id</i>_cluster.log</span>的內容。（<i><span>node_id</span></i></span>代資料表其活動已被記錄的節點的唯一<span>ID</span>）。叢集日誌包含由<strong><span>ndbd</span></strong>生成的事件報告。也能將叢集日誌條目發送到<span>Unix</span>的系統日誌中。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-startup-phases"></a>17.6.1. MySQL叢集的啟動階段</h3></div></div></div>
			<p>本節介紹了啟動叢集時涉及的步驟。</p>
			<p>有數種不同的啟動類型和模式，如下所述：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>首次啟動：</span></strong>在所有節點上與乾淨的檔案系統一起啟動叢集。這或是出現在首次啟動叢集時，或是使用「<span>--initial</span>」選項重啟叢集時。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>系統重啟：</span></strong>叢集啟動並讀取保存在數據節點中的數據。這出現在下述情況下：使用完後關閉了叢集，並希望從叢集的停止點恢復叢集操作時。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>節點重啟：</span></strong>這是在叢集運行的同時叢集節點的線上重啟。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>首次節點重啟：</span></strong>與節點重啟類似，差別在於將再次初始化節點，並與乾淨的檔案系統一起啟動。</p>
			<p>啟動之前，必須對每個節點進行初始化操作（<span><span>ndbd</span>程序）。這包括下述步驟：</span></p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>獲取節點<span>ID</span>。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>獲取配置數據。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>為節點間的通信分配端口。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>根據從配置檔案獲得的設置分配內存。</p>
			<p>一旦完成了對各節點的初始化操作，將進入叢集啟動程序。在該程序中，叢集將經歷下述階段：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>0</span></span></strong><span>
			</span></p>
			<p>清理叢集檔案系統。僅當使用「<span>--initial</span>」選項啟動叢集時，才會出現。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>1</span></span></strong><span>
			</span></p>
			<p>建立叢集連接，建立節點間的通信。啟動叢集「心跳」機制。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>2</span></span></strong><span>
			</span></p>
			<p>選舉仲裁程式節點。</p>
			<p>如果這是系統重啟階段，叢集將確定最近的可恢復全局檢查點。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>3</span></span></strong><span>
			</span></p>
			<p>該階段包括眾多內部叢集變數的初始化。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>4</span></span></strong><span>
			</span></p>
			<p>對於初始啟動或初始節點重啟，將建立<span>redo</span>日誌檔案。這類檔案的數目等於<span>NoOfFragmentLogFiles</span>／</p>
			<p>對於系統重啟：</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>讀取方案。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>從本地檢查點和<span>undo</span>日誌讀取數據。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>應用所有的<span>redo</span>訊息，直至到達最近的可恢復檢查點為止。</p>
			<p>對於節點重啟，找到<span>redo</span>日誌的末尾。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>5</span></span></strong><span>
			</span></p>
			<p>如果這是首次啟動，將建立<span>SYSTAB_0</span>和<span><span>NDB$EVENTS</span>內部系統資料表。</span></p>
			<p>對於節點重啟或首次節點重啟：</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>節點包含在事務處理操作中。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>將節點的方案與主伺服器的方案進行比較，並與其同步。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>對所收到的、來自本節點所在節點組內其他節點的、<span>INSERT</span>形式的數據進行同步。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>在任何情形下，等待由仲裁程式判定的本地檢查點操作的完成。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>6</span></span></strong><span>
			</span></p>
			<p>更新內部變數。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>7</span></span></strong><span>
			</span></p>
			<p>更新內部變數。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>8</span></span></strong><span>
			</span></p>
			<p>在系統重啟中，重建所有的索引。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>9</span></span></strong><span>
			</span></p>
			<p>更新內部變數。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>10</span></span></strong><span>
			</span></p>
			<p>在節點重啟或首次節點重啟的這一階段，<span>API</span>可能會連接到節點，並接收事件。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>階段<span>11</span></span></strong><span>
			</span></p>
			<p>
			在節點重啟或首次節點重啟的這一階段，將事件傳遞任務提交給加入叢集的節點。新加入的節點負責將其主要數據傳遞給訂方。</p>
			<p>
			對於首次啟動或系統重啟，一旦該程序完成，將啟用事務處理功能。對於節點重啟或首次節點重啟，啟動程序的完成意味著節點現在能夠成為事務協調程式。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mgm-client-commands"></a>
			17.6.2.&nbsp;「管理客戶端」中的命令</h3></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			除了中央配置檔案外，還能通過管理客戶端<strong><span>ndb_mgm</span></strong>提供的命令行界面對叢集進行控制。這是運行叢集的主要管理界面。<p>
			管理客戶端提供了下述基本命令。在下面給出的清單中，<span><i><span>node_id</span></i></span>指的是資料庫節點<span>ID</span>或關鍵字<span><span>ALL</span>，指明命令將應用到所有的叢集數據節點上。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>HELP</span><span>
			</span></p>
			<p>顯示關於所有可能命令的訊息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>SHOW</span><span>
			</span></p>
			<p>顯示關於叢集狀態的訊息。</p>
			<p><strong>
			<span>註釋：</span></strong>在使用多個管理節點的叢集中，該命令僅顯示與當前管理伺服器實際相連的數據節點的訊息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> START</span></span><span>
			</span></p>
			<p>啟動由<span><i><span>node_id</span></i></span>標識的數據節點（或所有數據節點）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> STOP</span></span><span>
			</span></p>
			<p>停止由<span><i><span>node_id</span></i></span>標識的數據節點（或所有數據節點）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> RESTART [-N] [-I]</span></span><span>
			</span></p>
			<p>重啟由<span><i><span>node_id</span></i></span>標識的數據節點（或所有數據節點）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> STATUS</span></span><span>
			</span></p>
			<p>顯示由<span><i><span>node_id</span></i></span>標識的數據節點（或所有數據節點）的狀態訊息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ENTER 
			SINGLE USER MODE <i>node_id</i></span><span> </span>
			</p>
			<p>進入單用戶模式，僅允許由節點<span>ID</span>「<span><i><span>node_id</span></i></span>」標識的<span>MySQL</span>伺服器訪問資料庫。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>EXIT 
			SINGLE USER MODE</span><span> </span></p>
			<p>退出單用戶模式，允許所有的<span>SQL</span>節點（即所有運行的<strong><span>mysqld</span></strong>程序）訪問資料庫。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>QUIT</span><span>
			</span></p>
			<p>中止管理客戶端。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>SHUTDOWN</span><span>
			</span></p>
			<p>關閉除<span>SQL</span>節點之外的所有叢集節點，並退出。</p>
			<p>在下一節中，介紹了用於事件日誌的命令。在這些議題的單獨一節中，介紹了用於建立備份以及從備份中恢復的命令。</p>
			<h3 class="title"><a name="mysql-cluster-event-reports"></a>
			17.6.3.&nbsp;MySQL叢集中生成的事件報告</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-logging-management-commands">
				17.6.3.1. 登記管理命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-log-events">
				17.6.3.2. 日誌事件</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
				在本節中，我們討論了<span>MySQL</span>叢集提供的事件日誌的類型，以及記錄的事件類型。<p>
				<span>MySQL</span>叢集提供了兩種事件日誌。它們是<strong><span>cluster 
				log</span></strong>和<strong><span>node 
				logs</span></strong>，<strong><span>cluster 
				log</span></strong>（叢集日誌）包括由所有叢集節點生成的事件，<strong><span>node 
				logs</span></strong>（節點日誌）僅記錄每個數據節點的本地事件。</p>
				<p>由叢集事件日誌功能生成的輸出可以有多個目的地，包括檔案、管理伺服器控制台窗口、或<span>syslog</span>。由節點事件日誌功能生成的輸出將被寫入數據節點的控制台窗口。</p>
				<p>可以對這兩類事件日誌進行設置，使之記錄不同的事件子集。</p>
				<p><strong><span>註釋：</span></strong>叢集日誌是為大多數使用場合推薦的日誌，這是因為它在<span>1</span>個檔案中提供了關於整個叢集的日誌訊息。節點日誌僅應在應用程式的開發過程中使用，或用於調試應用程式代碼。</p>
				<p>可根據三種不同的判據識別每個值得通報的事件：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Category</span></em>（類別）：可以是下述值之一：<span>STARTUP</span><span>,
				<span>SHUTDOWN</span>,
				<span>STATISTICS</span>,
				<span>CHECKPOINT</span>,
				<span>NODERESTART</span>,
				<span>CONNECTION</span>,
				<span>ERROR</span>,</span>或<span>INFO</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Priority</span></em>（優先級）：由從<span>1</span>到<span>15</span>的數字資料表示，「<span>1</span>」資料表示「最重要」，「<span>15</span>」資料表示「最不重要」。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Severity Level</span></em>（嚴重級別）：可以是下述值之一：<span>ALERT</span><span>,
				<span>CRITICAL</span>,
				<span>ERROR</span>,
				<span>WARNING</span>,
				<span>INFO</span>, </span>或<span>DEBUG</span>。</p>
				<p>無論是叢集日誌還是節點日誌，都能根據這些屬性進行過濾。</p>
				<h4 class="title"><a name="mysql-cluster-logging-management-commands"></a>
				17.6.3.1.&nbsp;登記管理命令</h4></div></div></div>
				<p>下述管理命令與叢集日誌有關：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG ON</span><span> </span></p>
				<p>打開叢集日誌。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG OFF</span><span> </span></p>
				<p>關閉叢集日誌。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG INFO</span><span> </span></p>
				<p>關於叢集日誌設置的訊息。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><i><span>
				node_id</span></i><span> CLUSTERLOG <i>category</i>=<i>threshold</i></span></span><span>
				</span></p>
				<p>用小於或等於<span><i><span>threshold</span></i></span>的優先級將<span><i><span>category</span></i></span>事件記錄到叢集日誌。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG FILTER <i>severity_level</i></span><span>
				</span></p>
				<p>將叢集事件日誌切換為指定的<span><i><span>severity_level</span></i></span>。</p>
				<p>在下資料表中，介紹了叢集日誌類別閾值的預設設置（對於所有數據節點）。如果事件的優先級值低於或等於優先級閾值，就會在叢集日誌中記錄。</p>
				<p>注意，事件是按數據節點通報的，可在不同的節點上設置不同的閾值。</p>
				<table border="1" cellpadding="0" id="table2">
					<tr>
						<td>
						<p><strong>
						<span>類別</span></strong></td>
						<td>
						<p><strong>
						<span>預設閾值（所有數據節點）</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>STARTUP</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>SHUTDOWN</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>STATISTICS</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>CHECKPOINT</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>NODERESTART</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>CONNECTION</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>ERROR</span></td>
						<td>
						<p><strong>
						<span>15</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>INFO</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
				</table>
				<p>閾值用於過濾每種類別中的事件。例如，對於優先級為<span>3</span>的<span><span>STARTUP</span>事件，</span>不會將其記錄到日誌中，除非將<span><span>STARTUP</span>的閾值更改為<span>3</span>或更小。如果閾值為<span>3</span>，僅發送優先級等於或小於<span>3</span>的事件。</span></p>
				<p>下面給出了事件的嚴重級別（註釋：它們與<span>Unix</span>的<span><span>syslog</span>級別對應；但<span>LOG_EMERG</span>和<span>LOG_NOTICE</span>除外，未使用或未映射它們）：</span></p>
				<table border="1" cellpadding="0" id="table3">
					<tr>
						<td>
						<p><strong>
						<span>1</span></strong></td>
						<td>
						<p>
						<span>ALERT</span></td>
						<td>
						<p>應立刻更正的狀況，如損壞的系統資料庫。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>2</span></strong></td>
						<td>
						<p>
						<span>CRITICAL</span></td>
						<td>
						<p>臨界狀況，如設備錯誤或資源不足。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>3</span></strong></td>
						<td>
						<p>
						<span>ERROR</span></td>
						<td>
						<p>應予以更正的狀況，如配置錯誤等。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>4</span></strong></td>
						<td>
						<p>
						<span>WARNING</span></td>
						<td>
						<p>不能稱其為錯誤的狀況，但仍需要特別處理。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>5</span></strong></td>
						<td>
						<p>
						<span>INFO</span></td>
						<td>
						<p>通報性消息。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>6</span></strong></td>
						<td>
						<p>
						<span>DEBUG</span></td>
						<td>
						<p>調試消息，用於<span><span>NDB</span>叢集開發。</span></td>
					</tr>
				</table>
				<p>
				可以打開或關閉事件嚴重級別。如果打開了事件嚴重級別，那麼優先級等於或低於類別閾值的事件均將被記錄。如果關閉了事件嚴重級別，那麼將不記錄屬於該嚴重級別的任何事件。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-log-events"></a>
				17.6.3.2.&nbsp;日誌事件</h4></div></div></div>
				<p>事件日誌中記錄的事件報告採用下述格式：<span><i><span>datetime</span></i><span> 
				[<i>string</i>] <i>severity</i> – <i>message</i></span></span>。例如：</p>
				<pre><span>09:19:30 2005-07-24 [NDB] INFO -- Node 4 Start phase 4 completed</span></pre>
				<p>本節討論了所有值得通報的事件，按類別以及每一類別中的嚴重級別排序。</p>
				<p><span><b><span>CONNECTION</span></b></span><strong><span>事件</span></strong></p>
				<p>這類事件與叢集節點之間的連接有關。</p>
				<table border="1" cellpadding="0" id="table4">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點已連接</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>數據節點已連接</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點中斷連接</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>數據節點中斷連接</td>
					</tr>
					<tr>
						<td>
						<p>通信關閉</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>SQL</span>節點或數據節點的連接已關閉</td>
					</tr>
					<tr>
						<td>
						<p>通信打開</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>SQL</span>節點或數據節點的連接已打開</td>
					</tr>
				</table>
				<p><span><b><span>CHECKPOINT</span></b></span><strong><span>事件</span></strong></p>
				<p>下面給出的日誌消息與檢查點有關。</p>
				<p>（註釋：<span>GCP =</span>全局檢查點，<span>LCP =</span>本地檢查點）。</p>
				<table border="1" cellpadding="0" id="table5">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>在<span>calc keep GCI</span>中，<span>LCP</span>已停止</td>
						<td>
						<p><span>0</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p><span>LCP</span>已停止</td>
					</tr>
					<tr>
						<td>
						<p>本地檢查點片段完成</td>
						<td>
						<p><span>11</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>片段上的<span>LCP</span>已完成</td>
					</tr>
					<tr>
						<td>
						<p>全局檢查點完成</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>GCP</span>完成</td>
					</tr>
					<tr>
						<td>
						<p>全局檢查點啟動</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>啟動<span>GCP</span>：將<span>REDO</span>日誌寫入磁盤</td>
					</tr>
					<tr>
						<td>
						<p>本地檢查點完成</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>LCP</span>已正常完成</td>
					</tr>
					<tr>
						<td>
						<p>本地檢查點啟動</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>啟動<span>LCP</span>：將數據寫入磁盤</td>
					</tr>
					<tr>
						<td>
						<p>報告<span>undo</span>日誌已封閉</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>UNDO</span>日誌已封閉：緩衝快要溢出</td>
					</tr>
				</table>
				<p><span><b><span>STARTUP</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件是在成功或失敗的節點啟動或叢集啟動時生成的。它們還提供了與啟動程序進展狀況有關的訊息，包括與日誌活動有關的訊息。</p>
				<table border="1" cellpadding="0" id="table6">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>收到內部啟動信號<span>STTORRY</span></td>
						<td>
						<p><span>15</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>重啟完成後收到的訊息塊</td>
					</tr>
					<tr>
						<td>
						<p><span>Undo</span>記錄已執行</td>
						<td>
						<p><span>15</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>新的<span>REDO</span>日誌已啟動</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>GCI</span>保持<span><i><span>X</span></i></span>，最新的可恢復<span>GCI
						<span><i>Y</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>新日誌已啟動</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>日誌部分<span><i><span>X</span></i></span>，啟動<span>MB
						<span><i>Y</i></span></span>，停止<span>MB
						<span><i>Z</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>拒絕將節點納入叢集中</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>由於配置錯誤、無法建立通信、或其他問題，不能將節點包含在叢集中。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點鄰居</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>顯示附近的數據節點。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點啟動階段<span>X</span>完成</td>
						<td>
						<p><span>4</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>數據節點啟動階段已完成。</td>
					</tr>
					<tr>
						<td>
						<p>節點已被叢集成功接納</td>
						<td>
						<p><span>3</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>顯示節點，管理節點，以及動態<span>ID</span>。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點啟動階段已開始</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>NDB</span>叢集節點正在啟動。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點的所有啟動階段已完成</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>NDB</span>叢集節點已啟動。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點關閉操作已啟動</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>數據節點的關閉操作已開始</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>節點關閉操作失敗</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>無法正常關閉數據節點。</td>
					</tr>
				</table>
				<p><span><b><span>NODERESTART</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件是在重啟節點時產生的，並與節點重啟程序的成功或失敗相關。</p>
				<table border="1" cellpadding="0" id="table7">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>節點失敗階段完成</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>通報節點失敗階段的完成</td>
					</tr>
					<tr>
						<td>
						<p>節點失敗，節點狀態為<span><i><span>X</span></i></span></td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>通報節點已失敗</td>
					</tr>
					<tr>
						<td>
						<p>通報仲裁程式結果</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>對於仲裁嘗試，有<span>8</span>種不同的可能結果：</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁檢查失敗，剩餘節點少於<span>1/2</span>。</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁檢查成功，節點組多數</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁檢查失敗，丟失節點組</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>網絡分區，要求仲裁</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁成功，來自節點<span><i><span>X</span></i></span>的正面回應</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁失敗，來自節點<span><i><span>X</span></i></span>的負面回應</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>網絡分區，無可用的仲裁程式</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>網絡分區，未配置仲裁程式</td>
					</tr>
					<tr>
						<td>
						<p>完成了片段複製</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了目錄訊息複製</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了分配訊息複製</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>開始複製片段</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了所有片段的複製</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>GCP</span>接收已啟動</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>GCP</span>接收已完成</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>LCP</span>接收已啟動</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>LCP</span>接收已完成（狀態<span>=
						<span><i>X</i></span></span>）</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>通報是否發現了仲裁程式</td>
						<td>
						<p><span>6</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>搜索仲裁程式時，有<span>7</span>種可能的結果：</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>管理伺服器重啟仲裁線程<span>[state=<span><i>X</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>準備仲裁程式節點<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>接收仲裁程式節點<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>啟動仲裁程式節點<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丟失了仲裁程式節點<span><i><span>X</span></i></span><span>
						</span>– 程序失敗<span> [state=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丟失了仲裁程式節點<span><i><span>X</span></i></span><span>
						</span>– 程序退出<span> [state=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丟失了仲裁程式節點<span><i><span>X</span></i></span><span> 
						&lt;error msg&gt; [state=<span><i>Y</i></span>]
						</span></td>
					</tr>
				</table>
				<p><span><b><span>STATISTICS</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件具有統計特性。它們提供了相應的訊息，如事務和其他操作的數目，低濃度節點發送或接收的數據量，以及內存使用率等。</p>
				<table border="1" cellpadding="0" id="table8">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>通報作業日程統計</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>平均的內部作業日程統計</td>
					</tr>
					<tr>
						<td>
						<p>發送的字節數</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>發送至節點<span><i><span>X</span></i></span>的平均字節數</td>
					</tr>
					<tr>
						<td>
						<p>接收的自己<span>#</span></td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>從節點<span><i><span>X</span></i></span>接收的平均字節數</td>
					</tr>
					<tr>
						<td>
						<p>通報事務統計</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>
						事務數目，提交次數，讀取次數，簡單讀取次數，寫入次數，並發操作數目。屬性訊息，以及放棄次數</td>
					</tr>
					<tr>
						<td>
						<p>通報操作</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>操作數目</td>
					</tr>
					<tr>
						<td>
						<p>通報資料表建立</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>內存使用</td>
						<td>
						<p><span>5</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>數據內存和索引內存的使用率（<span>80%</span>、<span>90%</span>和<span>100%</span>）</td>
					</tr>
				</table>
				<p><span><b><span>ERROR</span></b></span><strong><span>事件</span></strong></p>
				<p>這些事件與叢集錯誤和告警有關，如果出現<span>1</span>個或多個這類事件，表明出現了重大故障或失敗。</p>
				<table border="1" cellpadding="0" id="table9">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>因失去心跳而死亡</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>因失去心跳而聲明節點<span><i><span>X</span></i></span>死亡。</td>
					</tr>
					<tr>
						<td>
						<p>傳輸器錯誤</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>ERROR</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>傳輸器告警</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>失去心跳</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p>節點<span><i><span>X</span></i></span>失去心跳<span>#<span><i>Y</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>一般性告警事件</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
				</table>
				<p><span><b><span>INFO</span></b></span><strong><span>事件</span></strong></p>
				<p>這些事件給出了關於叢集狀態和叢集維護活動的一般訊息，如日誌和心跳傳輸等。</p>
				<table border="1" cellpadding="0" id="table10">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>優先級</span></strong></td>
						<td>
						<p><strong>
						<span>嚴重級別</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>發出心跳</td>
						<td>
						<p><span>12</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>將心跳發送至節點<span><i><span>X</span></i></span></td>
					</tr>
					<tr>
						<td>
						<p>建立日誌字節</td>
						<td>
						<p><span>11</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>日誌部分，日誌檔案，<span>MB</span></td>
					</tr>
					<tr>
						<td>
						<p>一般訊息事件</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
				</table>
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-single-user-mode"></a>
		17.6.4.&nbsp;單用戶模式</h3></div></div></div>
			<p>採用單用戶模式，資料庫管理員能夠將對資料庫系統的訪問限制在<span>1</span>個<span>MySQL</span>伺服器（<span>SQL</span>節點）。進入單用戶模式時，與所有其他<span>MySQL</span>伺服器的所有連接均將恰當關閉，而且所有正在運行的事務均將被放棄。不允許啟動任何新事務。</p>
			<p>一旦叢集進入單用戶模式，只有指定的<span>SQL</span>節點才有權訪問資料庫。使用<strong><span>ALL 
			STATUS</span></strong>命令，可查看叢集進入單用戶模式的時間。</p>
			<p>示範：</p>
			<pre><span>NDB&gt; <span><b>ENTER SINGLE USER MODE 5</b></span></span></pre>
			<p>執行該命令而且叢集進入單用戶模式後，節點<span>ID</span>為<span>5</span>的<span>SQL</span>節點將成為叢集中唯一允許的用戶。</p>
			<p>上述命令中指定的節點必須是<span>MySQL</span>伺服器節點，如果指定任何其他類型的節點，將被拒絕。</p>
			<p><strong><span>註釋：</span></strong>執行上述命令時，指定節點上所有正在運行的事務均將被放棄，連接關閉，而且必須重啟伺服器。</p>
			<p>使用<strong><span>EXIT SINGLE 
			USER MODE</span></strong>命令，能夠將叢集數據節點的狀態從單用戶模式更改為正常模式。對於等待連接的<span>MySQL</span>伺服器（即，對於即將準備就緒並可用的叢集），現在允許進行連接。在狀態變化期間和變化之後，指定為單用戶<span>SQL</span>節點的<span>MySQL</span>伺服器將繼續運行（如果仍連接的話）。</p>
			<p>示範：</p>
			<pre><span>NDB&gt; <span><b>EXIT SINGLE USER MODE</b></span></span></pre>
			<p>運行在單用戶模式下時，如果節點失敗，推薦的處理方法是：</p>
			<ul type="disc">
				<li><span>&nbsp;</span></li>
			</ul>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>結束所有的單用戶模式事務。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>發出<strong><span>EXIT 
			SINGLE USER MODE</span></strong>命令。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>重啟叢集的數據節點。</p>
			<p><em><span>或</span></em></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>進入單用戶模式之前重啟資料庫。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-backup"></a>
			17.6.5.&nbsp;MySQL叢集的聯機備份</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-concepts">
				17.6.5.1. 叢集備份概念</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-using-management-server">
				17.6.5.2. 使用管理伺服器建立備份</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-restore">
				17.6.5.3. 如何恢復叢集備份</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-configuration">
				17.6.5.4. 叢集備份的配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-troubleshooting">
				17.6.5.5. 備份故障診斷與排除</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
				在本節中，介紹了建立備份的方法，以及從備份恢復資料庫的方法。<h4 class="title"><a name="mysql-cluster-backup-concepts"></a>
				17.6.5.1.&nbsp;叢集備份概念</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				備份指的是在給定時間對資料庫的快照。備份包含三個主要部分：<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Metadata</span></strong>（元數據）：所有資料庫資料表的名稱和定義。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Table records</span></strong>（資料表記錄）：執行備份時實際保存在資料庫資料表中的數據。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Transaction log</span></strong>（事務日誌）：指明如何以及何時將數據保存在資料庫中的連續記錄。</p>
				<p>每一部分均會保存在參與備份的所有節點上。在備份過程中 ，每個節點均會將這三個部分保存在磁盤上的三個檔案中：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>.<i>node_id</i>.ctl</span><span>
				</span></p>
				<p>
				包含控制訊息和元數據的控制檔案。每個節點均會將相同的資料表定義（對於叢集中的所有資料表）保存在自己的該檔案中。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>-0.<i>node_id</i>.data</span><span>
				</span></p>
				<p>
				包含資料表記錄的數據檔案，它是按片段保存的，也就是說，在備份過程中，不同的節點會保存不同的片段。每個節點保存的檔案以指明了記錄所屬資料表的標題開始。在記錄清單後面有一個包含關於所有記錄校驗和的腳注。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>.<i>node_id</i>.log</span><span>
				</span></p>
				<p>
				包含已提交事務的記錄的日誌檔案。在日誌中，僅保存已在備份中保存的資料表上的事務。參與備份的節點將保存不同的記錄，這是因為，不同的節點容納了不同的資料庫片段。</p>
				<p>在上面所列的內容中，<span><i><span>backup_id</span></i></span>指的是備份<span>ID</span>，<span><i><span>node_id</span></i></span>是建立檔案的節點的唯一<span>ID</span>。</p>
				<h4 class="title"><a name="mysql-cluster-backup-using-management-server"></a>
				17.6.5.2.&nbsp;使用管理伺服器建立備份</h4></div></div></div>
				<p>開始備份前，請確保已為備份操作恰當地配置了叢集。（請參見<a href="ndbcluster.html#mysql-cluster-backup-configuration" title="17.6.5.4. Configuration for Cluster Backup">17.6.5.4節，「叢集備份的配置」</a>）。</p>
				<p>使用管理伺服器建立備份包含以下步驟：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>啟動管理伺服器<span>(<strong><span>ndb_mgm</span></strong>)</span>。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>執行命令<span>START 
				BACKUP</span>。</p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理伺服器將用消息「指示備份開始」作出應答。這意味著管理伺服器將請求提交給了叢集，但尚未收到任何回應。</p>
				<p>
				<span>4.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理伺服器回復「<span>備份<i><span>backup_id</span></i>開始<span>」</span>，其中，<i><span>backup_id</span></i></span>是該備份的唯一<span>ID</span>（如果未作其他配置，該<span>ID</span>還將保存在叢集日誌中）。這意味著叢集已收到並開始處理備份請求。它不資料表示備份已完成。</p>
				<p>
				<span>5.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理伺服器發出消息「<span>備份<i><span>backup_id</span></i>完成</span>」，通知備份操作已結束。</p>
				<p>要想放棄正在處理的備份：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>啟動管理伺服器。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>執行命令<span>ABORT 
				BACKUP <i>backup_id</i></span>。<span><i><span>backup_id</span></i></span>是當備份開始時包含在管理伺服器應大中的備份<span>ID</span>（在消息「備份<span><i><span>backup_id</span></i>啟動<span>」</span>中）。</span></p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理伺服器用消息「放棄指示的備份<span><i><span>backup_id</span></i></span>」確認放棄請求，注意，尚未收到對該請求的實際回應。</p>
				<p>
				<span>4.<span>&nbsp;&nbsp;&nbsp;
				</span></span>一旦放棄了備份，管理伺服器將通報「備份<span><i><span>backup_id</span></i>因<span>XYZ</span>而放棄</span>」。這意味著叢集中止了備份，並從叢集檔案系統中刪除了與該備份有關的所有檔案。</p>
				<p>在系統<span>shell</span>中使用下述命令，也能放棄正在執行的備份：</p>
				<pre><span>shell&gt; <span><b>ndb_mgm -e &quot;ABORT BACKUP <i>backup_id</i>&quot;</b></span></span></pre>
				<p><strong><span>註釋：</span></strong>執行放棄操作時，如果沒有<span>ID</span>為<span><i><span>backup_id</span></i></span>的備份，管理伺服器不會給出任何明確回應。但是，所發出的無效放棄命令將在叢集日誌中給出。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-restore"></a>
				17.6.5.3.&nbsp;如何恢復叢集備份</h4></div></div></div>
				<p>叢集恢復程式是作為單獨的命令行實用工具<strong><span>ndb_restore</span></strong>實現的，它將讀取由備份建立的檔案，並將保存的訊息插入資料庫。必須為每組備份檔案執行恢復程式，也就是說，執行次數與建立備份時運行的資料庫節點數相同。</p>
				<p>
				首次執行恢復程式時，還需要恢復元數據。換句話講，必須重新建立資料庫資料表（注意，開始執行恢復操作時，叢集中應有一個空資料庫）。恢復程式對於叢集來說相當於<span>API</span>，因此，需要一個空閒連接，以便與叢集相連。可使用<strong><span>ndb_mgm</span></strong>命令<strong><span>SHOW</span></strong>（在系統<span>shell</span>下使用<strong><span>ndb_mgm 
				-e SHOW</span><span>即可</span></strong>完成該操作）進行驗證。可以使用開關「<span>-c
				<i>connectstring</i></span>」來確定<span>MGM</span>節點的位置。（關於連接字串的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2節，「MySQL叢集連接字串<code class="literal"></code>」</a>。備份檔案必須位於恢復程式參量給定的目錄下。</p>
				<p>能夠使用與建立是所用配置不同的配置將備份恢復到資料庫。例如，對於備份<span>ID</span>為<span>12</span>的備份，該備份是在具有兩個資料庫節點（節點<span>ID</span>無惡<span>2</span>和<span>3</span>）的叢集中建立的，可以將其恢復到具有<span>4</span>個節點的叢集中。這樣，<strong><span>ndb_restore</span></strong>必須運行兩次，為建立備份時的每個資料庫節點運行一次。</p>
				<p><strong><span>註釋：</span></strong>對於快速恢復，能夠以並行方式恢復數據，但必須有足夠的可用叢集連接。然而，數據檔案必須始終前於日誌檔案。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-backup-configuration"></a>
				17.6.5.4.&nbsp;叢集備份的配置</h4></div></div></div>
				<p>有<span>4</span>個用於備份的基本配置參數：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupDataBufferSize</span><span> </span></p>
				<p>將數據寫入磁盤之前用於對數據進行緩衝處理的內存量。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupLogBufferSize</span><span> </span></p>
				<p>將日誌記錄寫入磁盤之前用於對其進行緩衝處理的內存量。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupMemory</span><span> </span></p>
				<p>
				在資料庫節點中為備份分配的總內存。它應是分配給備份數據緩衝的內存和分配給備份日誌緩衝的內存之和。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupWriteSize</span><span> </span></p>
				<p>寫入磁盤的塊大小。它適用於備份數據緩衝和備份日誌緩衝</p>
				<p>關於這些參數的更多細節，請參見<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4節，「MySQL叢集的配置」</a>。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-backup-troubleshooting"></a>
				17.6.5.5.&nbsp;備份故障診斷與排除</h4></div></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		如果在發出備份請求時返回了錯誤代碼，最可能的原因是內存不足，或磁盤空間不足。應檢查是否為備份分配了足夠的內存。此外，還應檢查在備份目標的硬盤分區上是否有足夠的空間。<p>
		<span>NDB</span>不支援重複的讀取操作，對於恢復程序，這類操作會導致問題。儘管備份程序「<span>hot</span>」，但從備份恢復<span>MySQL</span>叢集並不是<span>100</span>％「<span>hot</span>」的程序。其原因在於，在恢復程序執行期間，正在運行的事務會從已恢復的數據中獲取不可重複的讀。這意味著，當恢復正在進行時，數據的狀態是不一致的。</p>
		<h2 class="title"><a name="mysql-cluster-interconnects"></a>
		17.7.&nbsp;使用與MySQL叢集的高速互連</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#sci-sockets">
			17.7.1. 配置MySQL叢集以使用SCI套接字</a></span></dt><dt><span class="section"><a href="ndbcluster.html#performance-figures">
			17.7.2. 理解叢集互連的影響</a></span></dt></dl></div>
		<p>即使在<span>1996</span>年開始<span><span>NDB</span>叢集的設計之前，在建立並行資料庫的過程中遇到的一個主要問題顯然是網絡中節點之間的通信問題。正因為如此，從開始設計時，<span>NDB</span>叢集就允許使用多種不同的數據傳輸機制。在本手冊中，我們使用了術語</span><em><span>傳輸器</span></em>。</p>
		<p>目前，<span>MySQL</span>叢集代碼庫包含對四種不同傳輸器的支援。目前的大多數用戶採用的是以太網上的<span>TCP/IP</span>，這是因為它無處不在。它也是迄今為止在<span>MySQL</span>叢集中經過最佳測試的傳輸器。</p>
		<p>我們正在努力，以確保與<strong><span>ndbd</span></strong>程序的通信是盡可能大的「組塊」，這是因為，它有利於所有的數據傳輸類型。</p>
		<p>對於需要它的用戶，也能使用叢集互聯以進一步增強性能。實現它的方式有兩種：或使用能處理該情況的定制傳輸器，或使用能繞過<span>TCP/IP</span>堆棧的套接字實施方案。我們使用由<span><a target="_top"  href="http://www.dolphinics.com/">Dolphin</a></span>開發的<span>SCI</span>（規模可延伸的計算機連接接口）技術，對這兩類技術進行了試驗。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sci-sockets"></a>
			17.7.1.&nbsp;配置MySQL叢集以使用SCI套接字</h3></div></div></div>
			<p>在本節中，我們將介紹如何改編為常規<span>TCP/IP</span>通信配置的叢集，以使用<span>SCI</span>套接字。本文檔基於<span>2004</span>年<span>10</span>月<span>1</span>日發佈的<span>SCI</span>套接字<span>2.3.0</span>版。</p>
			<p><strong><span>前提條件</span></strong></p>
			<p>對於任何打算使用<span>SCI</span>套接字的機器，都必須配備<span>SCI</span>卡。</p>
			<p>能夠與任何版本的<span>MySQL</span>叢集一起使用<span>SCI</span>套接字。不需要特殊建立，這是因為它採用了<span>MySQL</span>叢集中已提供的正常套接字使用。但是，目前僅在<span>Linux 
			2.4</span>和<span>2.6</span>內核上才支援<span>SCI</span>套接字。儘管到目前為止我們僅在<span>Linux 
			2.4</span>上核實了這點，在一些其他作業系統上也成功測試了<span>SCI</span>傳輸器。</p>
			<p>對於<span>SCI</span>套接字，有四種基本要求：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>建立<span>SCI</span>套接字庫。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>安裝<span>SCI</span>套接字內核庫。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>安裝<span>1</span>個或<span>2</span>個配置檔案。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>必須為整個機器或啟動<span>MySQL</span>叢集程序的<span>shell</span>啟用<span>SCI</span>套接字庫。</p>
			<p>對於打算將<span>SCI</span>套接字用於節點間的通信的叢集，需要為叢集中的每台機器重複該程序。</p>
			<p>要想使<span>SCI</span>套接字工作，需要獲得兩個軟件包：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>包含用於<span>SCI</span>套接字庫的<span>DIS</span>支援庫的原始碼軟件包。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>用於<span>SCI</span>套接字庫本身的原始碼軟件包。</p>
			<p>目前，僅以原始碼格式提供了它們。編寫本文檔時可用的最新版本的軟件包分別是<span>DIS_GPL_2_5_0_SEP_10_2004.tar.gz</span>和<span>SCI_SOCKET_2_3_0_OKT_01_2004.tar.gz</span>。在下述站點，可找到它們（也可能找到更新的版本）：<span><a target="_top"  href="http://www.dolphinics.no/support/downloads.html">http://www.dolphinics.no/support/downloads.html</a></span>。</p>
			<p><strong><span>軟件包安裝</span></strong></p>
			<p>獲得庫軟件包後，接下來應將它們解包到恰當的目錄下，將<span>SCI</span>套接字庫解包到<span>DIS</span>代碼下的目錄中。然後，需要建立庫。在下面的示範中，給出了在<span>Linux/x86</span>平台上執行該任務所需的命令：</p>
			<pre><span>shell&gt; <span><b>tar xzf DIS_GPL_2_5_0_SEP_10_2004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd DIS_GPL_2_5_0_SEP_10_2004/src/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>tar xzf ../../SCI_SOCKET_2_3_0_OKT_01_2004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd ../adm/bin/Linux_pkgs</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./make_PSB_66_release</b></span></span></pre>
			<p>能夠為<span>64</span>位處理器建立這些庫。要想為使用<span>64</span>位延伸的<span>Opteron 
			CPU</span>建立這些庫，請運行<strong><span>make_PSB_66_X86_64_release</span></strong>而不是<strong><span>make_PSB_66_release</span></strong>。如果建立工作是在<span>Itanium</span>機器上進行的，應使用<strong><span>make_PSB_66_IA64_release</span></strong>。<span>X86-64</span>變體應能與<span>Intel 
			EM64T</span>體系結構一起工作，但這點尚未測試（就我們所知）。</p>
			<p>完成建立程序後，在<span>zipped tar</span>檔案中可發現已編譯好的庫，檔案的名稱符合<span>DIS-<i>&lt;operating-system&gt;</i>-<i>time</i>-<i>date</i></span>。現在，可將軟件包安裝到恰當位置。在本例中，我們使用的安裝目錄是<span>/opt/DIS</span>（註釋：您很可能需要以系統根用戶的身份運行下述命令）：</p>
			<pre><span>shell&gt; <span><b>cp DIS_Linux_2.4.20-8_181004.tar.gz /opt/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd /opt</b></span></span></pre>
			<pre><span>shell&gt; <span><b>tar xzf DIS_Linux_2.4.20-8_181004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>mv DIS_Linux_2.4.20-8_181004 DIS</b></span></span></pre>
			<p><strong><span>網絡配置</span></strong></p>
			<p>至此，所有的庫和二進制檔案均已安裝到了恰當的位置，還需確保<span>SCI</span>卡在<span>SCI</span>的地址空間範圍內擁有恰當的節點<span>ID</span>。</p>
			<p>進行後面的操作前，還需確定網絡結構。對於該情形，有三種可使用的網絡結構：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>一維單環網絡。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>1</span>個或多個<span>SCI</span>交換器，每個交換器端口有<span>1</span>個環形網。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>2</span>維或<span>3</span>維環面網。</p>
			<p>每類拓撲結構均有自己的、用於提供節點<span>ID</span>的方法。下面給出了簡要討論。</p>
			<p>單環網採用的節點<span>ID</span>是<span>4</span>的非<span>0</span>倍數，<span>4</span>，<span>8</span>，<span>12</span>…。</p>
			<p>下一個可行的選擇是<span>SCI</span>交換器。<span>1</span>個<span>SCI</span>交換器有<span>8</span>個端口，每個端口都能支援<span>1</span>個環形網。有必要確保不同的環形網使用了不同的節點<span>ID</span>空間。對於典型的配置，第<span>1</span>個端口使用的節點<span>ID</span>低於<span>64</span>（<span>4</span>～<span>60</span>），接下來的<span>64</span>個節點<span>ID</span>（<span>68</span>～<span>124</span>）指定給下一個端口，依此類推，節點<span>ID 
			452</span>～<span>508</span>將被指定給第<span>8</span>個端口。</p>
			<p>對於<span>2</span>維或<span>3</span>維環面網結構，每個節點位於各維中，在第<span>1</span>維中，各節點的增量為<span>4</span>，在第<span>2</span>維中，增量為<span>64</span>，在第<span>3</span>維中（如果適用的話），增量為<span>1024</span>。關於更詳盡的文檔，請參見<span><a target="_top"  href="http://www.dolphinics.com/support/index.html">Dolphin<span>的網站</span></a></span>。</p>
			<p>在我們的測試中，採用了交換器方式，但大多數大型叢集安裝應用使用的是<span>2</span>維或<span>3</span>維環面網結構。採用交換器方式具有的優點是：使用雙<span>SCI</span>卡和雙交換器，能夠相對容易地建立冗余網絡，<span>SCI</span>網絡上的平均故障切換時間在<span>100</span>毫秒量級。對於<span>SCI</span>套接字實施，<span>MySQl</span>叢集中的<span>SCI</span>傳輸器支援該結構，而且它也處於發展當中。</p>
			<p>對於<span>2D/3D</span>環面網，故障切換也是可能的，但需要向所有節點發送發出新的路由索引。然而，這僅需要<span>100</span>毫秒左右就能完成，對於大多數高可用性情形，這是可接受的。</p>
			<p>通過將叢集數據節點恰當地置於交換式體系結構中，能夠使用<span>2</span>個交換器來構建結構，將<span>16</span>台計算機互聯在一起，任何單點故障均不會妨礙<span>1</span>台以上的計算機。對於<span>32</span>台計算機和<span>2</span>台交換器，也能以這樣的方式配置叢集，任何單點故障均不會導致<span>2</span>個以上的節點丟失，在此情況下，也能知道那一對節點收到影響。因此，通過將兩個節點置於不同的節點組，就能建立「安全的」<span>MySQL</span>叢集。</p>
			<p>要想為<span>SCI</span>卡設置節點<span>ID</span>，可使用<span><span>/opt/DIS/sbin</span>目錄中的下述命令。在本例中，</span>「<span><span>-c 
			1」</span>指的是<span>SCI</span>卡的編號</span>（如果在機器上只有<span>1</span>塊卡，它總為<span>1</span>），「<span><span>-a 
			0」</span>指的是適配器<span>0</span>，</span>「<span><span>68」</span>是節點<span>ID</span>：</span></p>
			<pre><span>shell&gt; <span><b>./sciconfig -c 1 -a 0 -n 68</b></span></span></pre>
			<p>如果在同一台機器上有多塊<span>SCI</span>卡，使用下述命令（假定當前的工作目錄是<span>/opt/DIS/sbin</span>），可確定哪塊卡使用哪個插槽：</p>
			<pre><span>shell&gt; <span><b>./sciconfig -c 1 -gsn</b></span></span></pre>
			<p>它將給出<span>SCI</span>卡的序列號。然後用「<span><span>-c 
			2<span>」</span></span>重複該步驟，依此類推（對機器上的每塊卡）。一旦將每塊卡與</span><span>1</span>個插槽匹配後，可為所有卡設置節點<span>ID</span>。</p>
			<p>安裝了必要的庫和二進制檔案，並設置了<span>SCI</span>節點<span>ID</span>後，下一步是設置從主機名（或<span>IP</span>地址）到<span>SCI</span>節點<span>ID</span>的映射。該任務可在<span>SCI</span>套接字配置檔案中完成，該檔案應被保存為<span>/etc/sci/scisock.conf</span>。在該檔案中，通過恰當的<span>SCI</span>卡將<span>SCI</span>節點映射到與之通信的主機名或<span>IP</span>地址。這裡給出了一個很簡單的配置檔案示範：</p>
			<pre><span>#host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #nodeId</span></pre>
			<pre><span>alpha&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8</span></pre>
			<pre><span>beta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12</span></pre>
			<pre><span>192.168.10.20&nbsp;&nbsp; 16</span></pre>
			<p>也能對配置進行限制，使其僅應用在這些主機的可用端口子集上。也能使用額外的配置檔案<span><span>/etc/sci/scisock_opt.conf</span>完成該設置，如下所示：</span></p>
			<pre><span>#-key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -values</span></pre>
			<pre><span>EnablePortsByDefault&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yes</span></pre>
			<pre><span>EnablePort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2200</span></pre>
			<pre><span>DisablePort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2201</span></pre>
			<pre><span>EnablePortRange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2202 2219</span></pre>
			<pre><span>DisablePortRange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2220 2231</span></pre>
			<p><strong><span>驅動程式安裝</span></strong></p>
			<p>建立好了配置檔案後，可安裝驅動程式。</p>
			<p>首先應安裝底層驅動，然後安裝<span>SCI</span>套接字驅動：</p>
			<pre><span>shell&gt; <span><b>cd DIS/sbin/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./drv-install add PSB66</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./scisocket-install add</b></span></span></pre>
			<p>如果願意，可使用指令來核實<span>SCI</span>套接字配置檔案中的所有節點是否均能訪問，通過該方式檢查安裝：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/sbin/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./status.sh</b></span></span></pre>
			<p>如果發現錯誤並需要更改<span>SCI</span>套接字配置，需要使用<strong><span>ksocketconfig</span></strong>來完成該任務：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/util</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./ksocketconfig -f</b></span></span></pre>
			<p><strong><span>測試設置</span></strong></p>
			<p>為了確保<span>SCI</span>套接字已實際使用，可使用<strong><span>latency_bench</span></strong>測試程式。使用該實用工具的伺服器組件，客戶端能夠連接伺服器以測試連接的等待時間，通過觀察等待時間，可方便地判定是否啟用了<span>SCI</span>。（註釋：使用<strong><span>latency_bench</span></strong>之前，需要設置環境變數<span><span>LD_PRELOAD</span>，請參見本節後面的介紹）。</span></p>
			<p>要想設置伺服器，可使用下述命令：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/bin/socket</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./latency_bench -server</b></span></span></pre>
			<p>要想運行客戶端，再次使用<strong><span>latency_bench</span></strong>，但此時採用「<span><span>-client」</span>選項：</span></p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/bin/socket</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./latency_bench -client <i>server_hostname</i></b></span></span></pre>
			<p>到目前為止，應完成了<span>SCI</span>套接字配置，而且<span>MySQL</span>叢集已做好了使用<span>SCI</span>套接字和<span>SCI</span>傳輸器的準備（請參見<a href="ndbcluster.html#mysql-cluster-sci-definition" title="17.4.4.10. MySQL Cluster SCI Transport Connections">17.4.4.10節，「MySQL叢集SCI傳輸連接」</a>）。</p>
			<p><strong><span>啟動叢集</span></strong></p>
			<p>該程序接下來的步驟是啟動<span>MySQL</span>叢集。要想啟用<span>SCI</span>套接字，在啟動<strong><span>ndbd</span></strong>、<strong><span>mysqld</span></strong>和<strong><span>ndb_mgmd</span></strong>之前，需要設置環境變數<span>LD_PRELOAD</span>。該變數應指向用於<span>SCI</span>套接字的內核庫。</p>
			<p>要想在<span>bash shell</span>下啟動<strong><span>ndbd</span></strong>，可執行下述命令：</p>
			<pre><span>bash-shell&gt; export LD_PRELOAD=/opt/DIS/lib/libkscisock.so</span></pre>
			<pre><span>bash-shell&gt; ndbd</span></pre>
			<p>在<span>tcsh</span>環境下，可使用下述命令完成相同的任務：</p>
			<pre><span>tcsh-shell&gt; setenv LD_PRELOAD=/opt/DIS/lib/libkscisock.so</span></pre>
			<pre><span>tcsh-shell&gt; ndbd</span></pre>
			<p><strong><span>註釋：</span></strong><span>MySQL</span>叢集可以僅使用<span>SCI</span>套接字的內核變體。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="performance-figures"></a>
			17.7.2.&nbsp;理解叢集互連的影響</h3></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		<strong><span>ndbd</span></strong>程序有很多簡單的結構，它們可用於訪問<span>MySQL</span>叢集中的數據。我們建立了一個十分簡單的基準測試來檢查它們的性能，以及各種互聯方式對其性能的影響。<p>
		有四種訪問方法：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>主鍵訪問</span></strong></p>
		<p>
		通過其主鍵簡單地訪問記錄。在最簡單的情況下，一次僅訪問一條記錄，這意味著該單一請求需負擔設置眾多<span>TCP/IP</span>消息的全部開銷以及眾多的場景切換開銷。對於在一批中發出多個主鍵訪問請求的情況，這些訪問請求將分擔設置必要<span>TCP/IP</span>消息和場景切換的開銷。如果<span>TCP/IP</span>消息是面向不同目標的，還須設置額外的<span>TCP/IP</span>消息。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>唯一鍵訪問</span></strong></p>
		<p>
		唯一鍵訪問與主鍵訪問類似，差別在於，唯一鍵訪問是作為在索引資料表上的讀取操作執行的，然後是作用在資料表上的主鍵訪問。但是，<span>MySQL</span>伺服器僅發送一條請求，而且對索引資料表的讀取是由<strong><span>ndbd</span></strong>負責處理的。這類請求也受益於批處理法。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>全資料表掃瞄</span></strong></p>
		<p>對於資料表查詢，當不存在索引時，將執行全資料表掃瞄。這將作為單一請求被發送至<strong><span>ndbd</span></strong>程序，該程序隨後將資料表掃瞄分為在所有叢集<span>ndbd</span>程序上進行的一組並行掃瞄。在未來的<span>MySQL</span>叢集版本中，<span>SQL</span>節點能夠過濾某些掃瞄。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>使用有序索引的範圍掃瞄</span></strong></p>
		<p>使用有序索引時，它將使用與全資料表掃瞄相同的方式執行掃瞄，不同之處在於，它僅掃瞄位於<span>MySQL</span>伺服器（<span>SQL</span>節點）所傳輸查詢使用的範圍內的記錄。當所有綁定的索引屬性包含分區
		鍵中的所有屬性時，將以並行方式掃瞄所有分區。</p>
		<p>為了檢查這些訪問方法的基本性能，我們開發了一組基準。作為這類基準之一，<strong><span>testReadPerf</span></strong>能夠測試簡單的和批處理式主鍵和唯一鍵訪問。通過發出返回單一記錄的掃瞄請求，該基準還能測量範圍掃瞄的設置開銷。此外，還有<span>1</span>個該基準的變體，它採用了範圍掃瞄來獲取批量記錄。</p>
		<p>這樣，我們就能確定單鍵訪問的開銷，以及單記錄掃瞄訪問的開銷，並能根據基本訪問方法測量通信媒介的影響。</p>
		<p>在我們進行的測試中，為採用<span>TCP/IP</span>套接字的正常傳輸器和使用<span>SCI</span>套接字的類似設置進行了基本設置。下面給出的數字是關於少量訪問的，每次訪問<span>20</span>條記錄。使用<span>2KB</span>的記錄時，串行訪問和批式訪問之間的差異將降低<span>3</span>～<span>4</span>倍。對於<span>2KB</span>的記錄，未測試<span>SCI</span>套接字。測試是在下述叢集上進行的，該叢集有兩個數據節點，這兩個數據節點運行在<span>2</span>台雙<span>CPU</span>機器上，處理器為<span>AMD 
		MP1900+</span>。</p>
		<pre><span>Access type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TCP/IP sockets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SCI Socket</span></pre>
		<pre><span>Serial pk access:&nbsp;&nbsp;&nbsp; 400 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 160 microseconds</span></pre>
		<pre><span>Batched pk access:&nbsp;&nbsp;&nbsp; 28 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22 microseconds</span></pre>
		<pre><span>Serial uk access:&nbsp;&nbsp;&nbsp; 500 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 250 microseconds</span></pre>
		<pre><span>Batched uk access:&nbsp;&nbsp;&nbsp; 70 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 36 microseconds</span></pre>
		<pre><span>Indexed eq-bound:&nbsp;&nbsp; 1250 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 750 microseconds</span></pre>
		<pre><span>Index range:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 24 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12 microseconds</span></pre>
		<p>我們還執行了另一組測試，以檢查<span>SCI</span>套接字的性能以及<span>SCI</span>傳輸器的性能，並將這兩者與<span>TCP/IP</span>傳輸器的性能進行了比較。所有測試均採用了主鍵訪問方法，或採用串行多線程方式，或採用多線程批方式。</p>
		<p>測試結果表明，<span>SCI</span>套接字比<span>TCP/IP</span>約快<span>100</span>％。與<span>SCI</span>套接字相比，在大多數情況下，<span>SCI</span>傳輸器的速度更快。在具有很多線程的測試程式中出現了<span>1</span>個值得關注的情況，它表明，與<strong><span>mysqld</span></strong>程序一起使用時，<span>SCI</span>傳輸器的執行性能並不很好。</p>
		<p>我們得出的總體結論是，對於大多數基準，與<span>TCP/IP</span>相比，除了罕見的通信性能不成其為關注事宜的情況外，使用<span>SCI</span>套接字能將性能提升約<span>100</span>％。當掃瞄過濾器佔用大多數處理時間，或當執行大量的主鍵訪問，就會出現該情況。在這類情況下，<span>ndbd</span>程序中的<span>CPU</span>處理操作將佔用開銷的相當大部分。</p>
		<p>對於使用<span>SCI</span>傳輸器來取代<span>SCI</span>套接字，它僅對<span>ndbd</span>程序之間的通信有意義。如果<span>CPU</span>能專門用於<span>ndbd</span>程序，使用<span>SCI</span>傳輸器也也很有意義，這是因為<span>SCI</span>傳輸器能確保該程序永不休息。另一個重要特性是，它能確保對<span>ndbd</span>程序的優先級進行特定的設置，即使運行了很長的時間，其優先級也不會喪失，就像在<span>Linux 
		2.6</span>中通過將程序鎖定到<span>CPU</span>而能實現的那樣。如果這類配置是可能的，與使用<span>SCI</span>套接字相比，<span>ndbd</span>程序將獲得<span>10</span>～<span>70</span>％的性能提升（執行更新以及可能的並行掃瞄操作時，性能提升較大）。。</p>
		<p>對於計算機叢集，還有數種其他的最佳化套接字實施方案，包括<span>Myrinet</span>、吉比特以太網、<span>Infiniband</span>（無限帶寬）和<span>VIA</span>接口。迄今為止，我們僅與<span>SCI</span>套接字一起測試了<span>MySQL</span>叢集。我們還提供了上述文檔，其中，介紹了如何使用針對<span>MySQL</span>叢集的常規<span>TCP/IP</span>來設置<span>SCI</span>套接字的方法。</p>
		<h2 class="title"><a name="mysql-cluster-limitations"></a>
		17.8.&nbsp;MySQL叢集的已知限制</h2></div></div></div>
		<p>在本節中，我們列出了<span>5.1.x</span>系列中對<span>MySQL</span>叢集的一些已知限制，並與使用<span>MyISAM</span>和<span>InnoDB</span>儲存引擎時可用的特性進行了比較。目前，尚不打算在即將推出的<span>MySQL 
		5.1</span>版本中處理這些問題，但是，我們將在後續的版本系列中，提供這方面的補丁和修正。如果您檢查了<span>MySQL</span>問題資料庫（<span><a target="_top"  href="http://bugs.mysql.com">http://bugs.mysql.com</a></span>）中的「叢集」類別，可發現我們打算在即將推出的<span>MyAQL 
		5.1</span>版中更正的已知問題（如果標記為「<span>5.1</span>」的話）。</p>
		<p>（註釋：在本節末尾，列出了在當前版本中已解決的<span>MySQL 5.0</span>叢集中的一些事宜）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>語法中的不相容性</span></strong>（運行已有的應用程式時導致錯誤）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援文本索引。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援<span>Geometry</span>數據類型（<span><span>WKT</span>和<span>WKB</span>）。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>限制或行為中的不相容性</span></strong>（運行已有的應用程式時可能導致錯誤）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>沒有事務的部分回滾功能。重複鍵或類似錯誤會導致整個事務的回滾。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>存在很多可配置的硬限制，但能使用叢集中的可用主內存設置限制。關於配置參數的完整清單，請參見<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4節，「配置檔案」</a>。大多數配置參數可線上升級。這些硬限制包括：</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>資料庫內存大小和索引內存大小（分別是<span>DataMemory</span>和<span>IndexMemory</span>）。</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>對於能夠執行的最大事務數，可使用配置參數<span><span>MaxNoOfConcurrentOperations</span>進行設置。注意批量加載，<span>TRUNCATE 
		TABLE</span></span>和<span><span>ALTER 
		TABLE</span>是通過運行多個事務作為特殊情況進行處理的，因而不受該限制的約束。</span></p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>與資料表和索引有關的不同限制。例如，每資料表的最大有序索引數是由<span>MaxNoOfOrderedIndexes</span>確定的。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>在<span>NDB</span>資料表中，資料庫名稱、資料表名稱和屬性名稱不能與其他資料表處理程式中的一樣長。屬性名稱將被截短至<span>31</span>個字元，截短後如果不是唯一的，將導致錯誤。資料庫名稱和資料表名的總最大長度為<span>122</span>個字元（也就是說，<span>NDB</span>叢集資料表名的最大長度為<span>122</span>個字元減去該資料表所屬的資料庫的名稱中的字元數）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>所有的叢集資料表行具有固定長度。這意味著（例如），如果資料表中有僅包含相對較小值的<span>1</span>個或多個<span><span>VARCHAR</span>字段，與使用<span>MyISAM</span>引擎的相同資料表和數據相比，使用<span>NDB</span>儲存引擎時需要更多的內存和磁盤空間。換句話講，對於<span>VARCHAR</span>列，它所需的儲存空間與具有相同大小的<span>CHAR</span>列所需的相同。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>叢集資料庫中的最大資料表數目限制為<span>1792</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每資料表的最大屬性數限制為<span>128</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>任一行的最大允許大小為<span>8K</span>，<em><span>不包括保存在<span>BLOB</span>列中的數據。</span></em></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每鍵的最大屬性數為<span>32</span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>不支援的特性</span></strong>（不會導致錯誤，但不被支援或強制）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>外部鍵結構將被忽略，就像在<span>MyISAM</span>資料表中那樣。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>保存點以及對保存點的回滾將被忽略，就像在<span>MyISAM</span>中那樣。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>性能以及與限制有關的事宜</span></strong></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>由於對<span>NDB</span>儲存引擎的連續訪問，存在查詢性能問題，與<span>MyISAM</span>或<span><span>InnoDB</span>的情形相比，執行很多範圍掃瞄時，開銷相對昂貴。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援範圍統計中的記錄，在某些情況下，這會造成非最優查詢計劃。可採用<span>USE 
		INDEX</span>或<span><span>FORCE 
		INDEX</span>規避該問題。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>對於使用<span><span>USING 
		HASH</span>建立的唯一性哈希索引，如果<span>NULL</span>是鍵的一部分，不能使用這類索引訪問資料表。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>MySQL</span>叢集不支援磁盤上的持續提交。提交將被複製，但不保證在提交時會將日誌寫入磁盤。</p>
		<p><strong>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>丟失特性：</span></strong></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>唯一支援的隔離級別是<span>READ_COMMITTED</span>（<span>InnoDB</span>支援<span>READ_COMMITTED</span>、<span>READ_COMMITTED</span>、<span>REPEATABLE_READ</span>和<span><span>SERIALIZABLE</span>）。關於其如何影響叢集資料庫備份和恢復的更多訊息，請參見</span><a href="ndbcluster.html#mysql-cluster-backup-troubleshooting" title="17.6.5.5. Backup Troubleshooting">17.6.5.5節，「備份故障診斷與排除」</a>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援磁盤上的持續提交。提交將被複製，但不保證在提交時會將日誌寫入磁盤。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>與多<span>MySQL</span>伺服器有關的問題</span></strong>（與<span>MyISAM</span>或<span>InnoDB</span>無關）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>運行多個<span>MySQL</span>伺服器時，<span>ALTER 
		TABLE</span></span>未完全鎖定（無分佈式資料表鎖定）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>如果在多個<span>MySQL</span>伺服器上進行了更新，<span>MySQL</span>複製功能不能正確處理。但是，如果資料庫分區方案是在應用級別上完成的，而且在這些分區上非發生事務，那麼可使複製功能正確工作。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>對於訪問相同<span>MySQL</span>叢集的多<span>MySQL</span>伺服器，不支援資料庫的自動發現（<span>autodiscovery</span>）功能。但是，在情況下，支援對資料表的自動發現（<span>autodiscovery</span>）功能。這意味著，建立了名為<span><i><span>db_name</span></i></span>的資料庫後，或使用<span>1</span>個<span>MySQL</span>伺服器導入了該資料庫後，應在訪問相同<span>MySQL</span>叢集的每個額外<span>MySQL</span>伺服器上發出<span><span>CREATE 
		DATABASE <i>db_name</i></span>語句（從</span><span>MySQL 5.0.2<span>開始，您還能使用</span><span>CREATE 
		SCHEMA <i>db_name</i>;</span></span>）。一旦對給定<span>MySQL</span>伺服器完成了該操作，伺服器應能檢測到資料庫資料表，而不產生錯誤。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>僅與<span>MySQL</span>叢集有關的事宜</span></strong>（與<span><span>MyISAM</span>或<span>InnoDB</span></span>無關）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>叢集中使用的所有機器必須具有相同的體系結構，也就是說，所有承載節點的機器必須是<span>big-endian</span>或<span>little-endian</span>，不能混合使用這兩者。例如，不能用運行在<span>PPC</span>上的管理節點指揮運行在<span>x86</span>機器上的數據節點。該限制不適用於簡單運行<strong><span>mysql</span></strong>或其他客戶端（可能會訪問叢集的<span>SQL</span>節點）的機器。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不能像使用<span>ALTER 
		TABLE</span>或<span><span>CREATE 
		INDEX</span>完成的那樣</span>執行線上方案更改，這是因為<span><span>NDB</span>叢集不支援這類變更的自動檢測（但是，</span>能夠導入或建立使用不同儲存引擎的資料表，然後使用「<span>ALTER 
		TABLE <i>tbl_name</i> ENGINE=NDBCLUSTER;</span>」將其轉換為<span>NDB</span>。在這類情況下，需要發出<span><span>FLUSH 
		TABLES</span>命令，</span>強制叢集發現變化）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不能線上增加或捨棄節點（此時必須重啟叢集）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>使用多個管理伺服器時：</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>必須在連接字串中明確為節點指定<span>ID</span>，這是因為，在多個管理伺服器上，自動分配的節點<span>ID</span>不能正常工作。</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>必須十分小心，確保所有的管理伺服器具有相同的配置。叢集對此方面不進行任何特殊檢查，</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>要想使管理節點能發現彼此的存在，建立了叢集後必須重啟所有的數據節點（詳細解釋請參見<span><a target="_top"  href="http://bugs.mysql.com/13070">Bug 
		#13070</a></span>）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援用於數據節點的多個網絡接口。如果使用了這類接口，很容易導致問題，原因在於，在出現某一數據節點失敗的情況下，<span>SQL</span>節點將等待以確認該數據節點是否出現問題，但由於該數據節點的另一路徑仍保持打開狀態，<span>SQL</span>節點永遠不會收到該確認訊息。這會導致叢集無法工作。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>數據節點的最大數目為<span>48</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>MySQL</span>叢集中總的最大節點數為<span>63</span>。在該數值中包括所有的<span>MySQL</span>伺服器（<span>SQL</span>節點），數據節點和管理伺服器。</p>
		<p>考慮到本節開始時設定的條件，我們力圖使上面列出的訊息盡可能完全。您可以將任何遇到的差異通報到<span>MySQL</span>問題資料庫，<span><a  href="http://bugs.mysql.com/">http://bugs.mysql.com/</a></span>。如果我們不打算在<span>MySQL 
		5.1</span>中更正該問題，我們會將其新增到列資料表中。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-roadmap"></a>17.9. MySQL叢集發展的重要歷程</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-5-0-cluster-changes">17.9.1. 
		MySQL 5.0中的MySQL叢集變化</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-5-1-cluster-roadmap">
		17.9.2. 關於MySQL叢集的MySQL 5.1發展歷程</a></span></dt></dl></div><a class="indexterm" name="id2972967"></a><a class="indexterm" name="id2972976"></a><a class="indexterm" name="id2972986"></a>
		<p>在本節，我們討論了<span>MySQL 5.1</span>在<span>MySQL</span>叢集實施中的一些變化，並與<span>MySQL 
		5.0</span>進行了比較。我們還將討論對<span>MySQL</span>叢集的進一步重大改進，目前是為<span>MySQL 
		5.2</span>規劃的。</p>
		<p>在<span>MySQL 5.0</span>和<span>5.1</span>中，<span>NDB</span>叢集儲存引擎實施方案之間的變化相對較少，因此其升級相對快捷和簡單。</p>
		<p>為<span>MySQL</span>叢集開發的主要新特性均歸入了<span>MySQL 5.1</span>樹。在本節中，我們還提供了一些提示，介紹了在<span>MySQL 
		5.1</span>中叢集特性可能包含的方面（請參見<a href="ndbcluster.html#mysql-5-1-cluster-roadmap" title="17.9.2. MySQL 5.1 Development Roadmap for MySQL Cluster">17.9.2節，「關於MySQL叢集的MySQL 5.1發展歷程」</a>）。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-5-0-cluster-changes"></a>17.9.1. MySQL 
			5.0中的MySQL叢集變化</h3></div></div></div>
			<p><span>MySQL 5.0.3-beta</span>以及更新的版本包含一些有趣的新特性：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>下推條件：</span></strong>一種查詢，如：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>SELECT * FROM t1 WHERE non_indexed_attribute = 1;</span></pre>
			<p>
			它將使用全資料表掃瞄，並會在叢集的數據節點內評估條件。因此，不需要在網絡中發送用於評估的記錄（也就是說，採用函數傳輸而不是數據傳輸）。對於這種查詢類型，其速度快<span>5</span>～<span>10</span>倍。請注意，模目前該特性是預設禁止的（有待更徹底的測試），但在某些情況下也能良好工作。使用命令「<span>SET 
			engine-condition-pushdown=On;</span><span> command</span>」可啟用該特性。作為可選方式，您也可以用新的「<span>--engine-condition-pushdown</span>」選項標誌啟動<span>MySQL</span>伺服器，運行啟用了該特性的<strong><span>mysqld</span></strong>。</p>
			<p>可以使用<span><span>EXPLAIN</span>來判定在何時使用了下推條件。</span></p>
			<p>
			該變化的一項主要優點在於，能夠以並行方式執行查詢。這意味著，與以往相比，對非索引列的查詢要快<span>5</span>～<span>10</span>倍，乘以數據節點的數目。原因在於，多個<span>CPU</span>能以並行方式執行查詢。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>降低了</span></strong><span><b><span>IndexMemory</span></b></span><strong><span>使用：</span></strong>在<span>MySQL 
			5.1</span>中，每條記錄約消耗<span>25</span>字節的索引內存，每個唯一索引每記錄將使用<span>25</span>字節的索引內存（不含某些數據內存，這是因為它們保存在單獨資料表中）。這是因為在索引內存中，不再需要保存主鍵。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>為<span>MySQL</span>叢集啟用了查詢高速緩衝：</span></strong>關於配置和使用查詢高速緩衝的更多訊息，請參見<a href="database-administration.html#query-cache" title="5.13. The MySQL Query Cache">5.13節，「MySQL查詢高速緩衝」</a>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>新的最佳化</span></strong>：有一個需要給予特別關注的最佳化，即，目前在某些查詢中使用了批式讀取接口。例如，考慮下述查詢：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>SELECT * FROM t1 WHERE <span><i>primary_key</i></span> IN (1,2,3,4,5,6,7,8,9,10);</span></pre>
			<p>與以往的<span>MySQL</span>叢集版本相比，該查詢的執行速度快<span>2</span>～<span>3</span>倍，原因在於，全部<span>10</span>個
			鍵搜尋是在<span>1</span>個批次中發出的，而不是一次發送一個。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>限制元數據對象的數目：</span></strong>在<span>MySQL 
			4.1</span>中，每個叢集資料庫最多可能包含<span>1600</span>個元數據對象，包括資料庫資料表，系統資料表，索引和<span>BLOB</span>。在<span>MySQL 
			5.0</span>中，我們希望將該數值增加到<span>20320</span>。我們打算在<span>2005</span>年年中發佈的<span>MySQL 
			5.0.6 beta</span>版中實現該增強特性。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-5-1-cluster-roadmap"></a>
			17.9.2.&nbsp;關於MySQL叢集的MySQL 5.1發展歷程</h3></div></div></div>
			<p>這裡所介紹的內容是一份狀態報告，它基於最近提交到<span>MySQL 5.1</span>原始碼樹的內容。請注意，所有的<span>5.1</span>開發活動均可能隨時變化。</p>
			<p>目前，有四種為<span>MySQL 5.1</span>開發的主要新特性：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>將<span>MySQL</span>叢集集成到了<span>MySQL</span>複製中：</span></strong>這樣，就能從叢集中的任何<span>MySQL</span>伺服器執行更新，並由叢集中的<span>1</span>個<span>MySQL</span>伺服器處理<span>MySQL</span>複製，並保持了從伺服器端安裝的一致性。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>支援基於磁盤的記錄：</span></strong>將支援磁盤上的記錄。對於包含主鍵哈希索引的有索引字段，必須仍保存在<span>RAM</span>中，但可以將所有其他字段保存在磁盤上。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>大小可變的記錄：</span></strong>定義為<span><span>VARCHAR(255)</span>的列目前使用<span>260</span>字節的儲存空間，與任何特定記錄中保存的內容無關。</span>在<span>MySQL 
			5.1</span>叢集資料表中，只保存被記錄實際佔用的字段部分。這樣，在很多情況下，能夠將這類列的空間需求量降低<span>5</span>倍。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>用戶定義的分區功能：</span></strong>用戶能夠根據主關鍵的字段部分定義分區。<span>MySQL</span>伺服器能夠發現是否能將某些分區從<span><span>WHERE</span>子句中刪除。能夠根據<span>KEY</span></span>、<span>HASH</span>、<span>RANGE</span>和<span><span>LIST</span>處理程式執行分區操作和子分區操作。對於很多其他處理程式，也應能使用該特性。</span></p>
			<p>此外，對於叢集資料表中包含除<span>BLOB</span>或<span>TEXT</span>外的列類型的行，我們正準備增大<span>8K</span>的大小限制值。這是因為，行目前具有固定的大小，頁大小為<span>32768</span>字節（減去用於行標題的<span>128</span>字節）。在目前，這意味著，如果允許每記錄佔用的大小超過<span>8K</span>，剩餘的空間將為空（多達<span>14000</span>字節）。在<span>MySQL 
			5.1</span>中，我們打算更正該限制，從而使得在給定行中使用<span>8K</span>以上的空間不會導致頁剩餘部分的浪費。</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-faq"></a>17.10. MySQL叢集常見問題解答</h2>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用叢集與使用複製的區別是什麼？</span></em></p>
		<p>在複製設置中，主<span>MySQL</span>伺服器負責更新<span>1</span>個或多個從伺服器。事務按順序提交，較慢的事務會導致從伺服器滯後於主伺服器。這意味著，如果主伺服器失敗，從伺服器可能無法記錄最近的少數事務。如果使用了事務安全引擎，如<span>InnoDB</span>，要末是在從伺服器上完成事務，要末是根本就不記錄事務，但複製不保證主伺服器和從伺服器上的所有數據在任何時候都是一致的。在<span>MySQL</span>叢集中，所有的數據節點保持同步，任何一個數據節點提交的事務將被提交給所有的數據節點。當某一數據節點失敗時，所有剩餘的數據節點仍能保持一致的狀態。</p>
		<p>簡而言之，儘管標準的<span>MySQL</span>複製是異步的，但<span>MySQL</span>叢集是同步的。</p>
		<p>我們計劃在<span>MySQL 5.1</span>中為叢集實現（異步）複製功能。包括在兩個叢集之間，以及<span>MySQL</span>叢集和非叢集類<span>MySQL</span>伺服器之間的複製能力。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>為了運行叢集，我是否需要進行特殊的組網呢？（叢集中的計算機是如何通信的？）</span></em></p>
		<p><span>MySQL</span>叢集是為高帶寬環境下的使用而設計的，計算機通過<span>TCP/IP</span>相連。其性能直接取決於叢集計算機之間的連接速度。對於叢集，最低連接要求包括：典型的<span>100MB</span>以太網網絡或等效網絡。如果可能，建議使用<span>GB</span>以太網。</p>
		<p>也支援更快的<span>SCI </span>
		協議，但需要特殊硬件。關於<span>SCI</span>的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7節，「使用與MySQL叢集的高速互連」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>運行叢集需要多少台計算機？為什麼？</span></em></p>
		<p>要想運行可行的叢集，最少需要<span>3</span>台計算機。但在<span>MySQL</span>叢集中，推薦的最低計算機數目為<span>4</span>：<span>1</span>台負責運行管理節點，<span>1</span>台負責運行<span>SQL</span>節點，<span>2</span>台用作儲存節點。使用<span>2</span>個數據節點的目的是為了提供冗余性，管理節點必須運行在單獨的機器上，這樣，當<span>1</span>個數據節點失敗時，仍能保證連續的仲裁服務。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>叢集中不同計算機所負責的任務是什麼？</span></em></p>
		<p><span>MySQL</span>叢集包含物理和邏輯結構，計算機是其物理部件。叢集的邏輯或功能部件稱為節點，容納叢集節點的計算機有時也稱為叢集主機。在理想情況下，每台叢集主機將有<span>1</span>個節點，但在單個叢集主機上可運行多個節點。叢集中有三種節點，每一種節點均對應特定的角色。它們是：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>管理節點（<span>MGM</span>節點）：</span></strong>為整個叢集提供管理服務，包括啟動、停止、備份、以及為其他節點配置數據。管理節點伺服器是作為應用程式<strong><span>ndb_mgmd</span></strong>實現的，用於通過<span>MGM</span>節點控制<span>MySQL</span>叢集的管理客戶端是<strong><span>ndb_mgm</span></strong>。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>數據節點：</span></strong>保存和複製數據。數據節點的功能由<span>NDB</span>數據節點程序<span>ndbd</span>的實例負責處理。</p>
		<p><span>3.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>SQL</span><span>節點：</span></strong>這是用「<strong><span>--ndb-cluster</span></strong>」選項啟動的<span>MySQL</span>伺服器（<strong><span>mysqld</span></strong>）的一個實例。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>用什麼作業系統才能使用叢集呢？</span></em></p>
		<p>在<span>MySQL 5.1</span>中，在<span>Linux</span>、<span>Mac 
		OS X</span>和<span>Solaris</span>平台上均正式支援<span>MySQL</span>叢集。我們正在努力為其他平台增加叢集支援，包括<span>Windows</span>，我們的目標是，最終在支援<span>MySQL</span>本身的所有平台上實現<span>MySQL</span>叢集。</p>
		<p>在其他作業系統上運行叢集也是可能的。用戶告訴我們，他們在<span>FreeBSD</span>平台上超過運行了叢集。但是，除了前面介紹的三種作業系統外，在其他平台上運行的叢集應被視為<span>alpha</span>軟件（最好情況），不保證在生產環境下的可靠性，而且<em><span>不被<span>MySQL 
		AB</span>支援</span><span>。</span></em></p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>運行<span>MySQL</span>叢集的硬件要求是什麼？</span></em></p>
		<p>在叢集運行的任何平台上，應具有具備<span>NDB</span>功能的二進制檔案。顯而易見，更快的<span>CPU</span>和更多的內存能夠改善性能，<span>64</span>位<span>CPU</span>的效率很可能高於<span>32</span>位處理器。在用於數據節點的機器上必須有足夠的內存，以便容納各節點共享的資料庫部分。（更多訊息，請參見<strong><span>我需要多少內存？</span></strong>）。節點能通過標準的<span>TCP/IP</span>網絡和硬件進行通信。對於<span>SCI</span>支援，需要特殊的組網硬件。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>由於<span>MySQL</span>叢集使用了<span>TCP/IP</span>，這是否意味著我能在<span>Internet</span>上運行<span>1</span>個或多個節點位於遠程位置的叢集？</span></em></p>
		<p>請記住，在<span>MySQL</span>叢集中，節點間的通信並不安全，這點極其重要，這類通信未加密，也未採用任何防護機制。對於叢集，最安全的配置是位於防火牆後的專用網絡，不能從外部直接訪問任何叢集數據或管理節點（對於<span>SQL</span>節點，應採取相同的防護措施，就像在<span>MySQL</span>伺服器的其他實例中那樣）。</p>
		<p>無論是任何情況，在這類條件下叢集的可靠運行十分令人懷疑，這是因為設計和實施<span>MySQL</span>叢集時，假定它運行在能保證專用高速連通性的條件下，如使用<span>100MB</span>或<span>GB</span>以太網的<span>LAN</span>中（更傾向於後者）。對於低於該要求的任何環境，我們未作任何測試，也不保證其性能。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>
		要想使用叢集，我是否不得不學習新的編程語言或查詢語言？</span></em></p>
		<p>不。儘管使用了一些專用命令來管理和配置叢集本身，但對於下述操作，僅需要標準的<span>(My)SQL</span>查詢和命令：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>建立、更改和撤銷資料表。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>插入、更新和刪除資料表數據。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>建立、更改和撤銷主索引和唯一索引。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>配置和管理<span>SQL</span>節點（<span>MySQL</span>伺服器）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用叢集時，如何瞭解錯誤或警告消息的含義呢？</span></em></p>
		<p>有兩種完成它的方式：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>出現錯誤或告警狀況時，在<span>MySQL</span>監視器內，立刻使用<strong><span>SHOW 
		ERRORS</span></strong>或<strong><span>SHOW 
		WARNINGS</span></strong>。也能在<span>MySQL Query Browser</span>（查詢瀏覽器）中顯示它們。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>在系統<span>shell</span>提示符下，使用<strong><span>perror 
		--ndb </span></strong><span><b><i>
		<span>error_code</span></i></b></span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>MySQL</span><span>叢集是事務安全的嗎？支援什麼隔離級別？</span></em></p>
		<p><em><span>是</span></em>。對於用<span><span>NDB</span>儲存引擎建立的資料表，支援事務。</span>在<span>MySQL 
		5.1</span>中，叢集僅支援<span><span>READ_COMMITTED</span>事務隔離級別。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>叢集支援的資料表類型是什麼？</span></em></p>
		<p>
		<span>NDB</span>是僅有的支援叢集功能的<span>MySQL</span>儲存引擎。</p>
		<p>（能夠使用其他儲存引擎在用於叢集的<span>MySQL</span>伺服器上建立資料表，如<span>MyISAM</span>或<span>InnoDB</span>，但這類非<span><span>NDB</span>資料表不在叢集中</span>）。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>「</span></em><span class="quote"><i><span>NDB</span></i></span><em><span>」的含義是什麼？</span></em></p>
		<p>它是「<strong><span>N</span></strong><span class="quote"><span>etwork
		</span></span><strong><span>D</span></strong><span class="quote"><span>ata</span></span><strong><span>b</span></strong><span class="quote"><span>ase</span></span>」（網絡資料庫）的縮寫。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>哪些版本的<span>MySQL</span>軟件支援叢集？我必須從原始碼編譯嗎？</span></em></p>
		<p>在<span>5.1</span>系列的所有<span>MySQL-max</span>二進製版本中均支援叢集，但下面介紹的除外。使用命令<span>SHOW 
		VARIABLES LIKE &#39;have_%&#39;;</span>或<span><span>SHOW 
		ENGINES;</span>，可檢查您的伺服器是否支援<span>NDB</span></span>（更多訊息，請參見<a href="database-administration.html#mysqld-max" title="5.1.2. The mysqld-max Extended MySQL Server">5.1.2節，「mysq<span><strong class="command">ld-max延伸My</strong></span>SQL伺服器」</a>）。</p>
		<p><span>Linux</span>用戶請注意，<span><span>NDB</span>未包含在</span>標準的<span>MySQL</span>伺服器<span>RPM</span>中。對於<span>NDB</span>儲存引擎以及所附的管理工具和其他工具，有單獨的<span>RPM</span>軟件包。請參見<span>MySQL 
		5.1</span>下載頁上的<span>NDB RPM</span>下載部分（以前，您必須使用以<span><span>.tar.gz</span>檔案方式提供的<span>「-max」</span>二進制檔案。目前仍能這樣，但卻不是必須的，如果願意，可使用<span>Linux</span>分發版的<span>RPM</span>管理器）。通過從原始碼編譯<span>-max</span>二進制檔案，也能獲得<span>NDB</span>支援，但使用<span>MySQL</span>叢集時，不需要這樣。要想只下載</span>最新的<span>MySQL 
		5.1</span>系列的二進製版本、<span>RPM</span>、或原始碼分發版，請訪問<span><a target="_top"  href="http://dev.mysql.com/downloads/mysql/5.1.html">http://dev.mysql.com/downloads/mysql/5.1.html</a></span>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我需要多少<span>RAM</span>？是否能全部使用磁盤內存？</span></em></p>
		<p>在目前，叢集是僅「內存中」的。這意味著所有的資料表數據（包括索引）均保存在<span>RAM</span>中。因此，如果您的數據佔用了<span>1GB</span>的空間，而且打算在叢集中將它複製<span>1</span>次，需要<span>2GB</span>的內存。還應加上作業系統以及在叢集計算機上運行的應用程式所需的內存。</p>
		<p>可以使用下述公司粗略估計叢集中每個數據節點所需的<span>RAM</span>量：</p>
		<pre><span>(SizeofDatabase * NumberOfReplicas * 1.1 ) / NumberOfDataNodes</span></pre>
		<p>
		要想更準確地計算內存需求量，需要為叢集資料庫中的每個資料表確定每行所需的儲存空間（詳情請參見<a href="column-types.html#storage-requirements" title="11.5. Column Type Storage Requirements">11.5節，「列類型儲存需求」</a>），然後乘以占行數。還必須對列索引進行計算，方式如下：<span> </span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>對於為<span>NDB</span>叢集資料表建立的每個主鍵索引或哈希索引，每記錄需要<span>21-25</span>字節。這類索引使用<span>IndexMemory</span>（索引內存）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每個有序索引每記錄需要<span>10</span>字節的儲存空間，使用<span>DataMemory</span>（數據內存）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>建立主鍵或唯一索引時，還會建立<span>1</span>個有序索引，除非該索引是使用<span><span>USING 
		HASH</span>建立的。換句話講，</span>如果未使用<span><span>USING 
		HASH</span>建立它們，對於</span>叢集資料表上的每個鍵多因或唯一索引，在<span>MySQL 5.1</span>中，每記錄佔用<span>31-35</span>字節。</p>
		<p>注意，使用<span><span>USING 
		HASH</span>為所有主鍵和唯一索引建立</span><span>MySQL</span>叢集資料表時，通常還能使資料表的更新速度更快。這是因為，它需要較少的內存（因未建立有序索引），對<span>CPU</span>的佔用也較低（僅需讀取或更新較少的索引）。</p>
		<p>請記住，所有的<span>MySQL</span>叢集資料表必須有主鍵，這點極其重要。如果未定義，<span><span>NDB</span>儲存引擎將自動建立主鍵，而且該主鍵是在未使用<span>USING 
		HASH</span></span>的條件下建立的。</p>
		<p>很難準確確定叢集索引在任何給定時間用於儲存的內存量，但是，當可用<span>DataMemory</span>和<span>/</span>或<span><span>IndexMemory</span>的使用率到達<span>80</span>％時，會將警告消息寫入叢集日誌，到達<span>80</span>％、<span>90</span>％等時，也會寫入叢集日誌。</span></p>
		<p>
		我們經常遇到用戶通報的下述問題，當他們視圖填充叢集資料庫時，加載程序提前終止，並顯示下述錯誤消息：</p>
		<pre>錯誤<span>1114</span>：資料表<span>&#39;my_cluster_table&#39;</span>已滿。</pre>
		<p>出現該情況時，很可能是因為在您的設置中未為所有的資料表數據和索引提供足夠的<span>RAM</span>，<em><span>包括</span></em><span><i><span>NDB</span>儲存引擎所需的主鍵，以及資料表定義中不包含主鍵定義時自動建立的主鍵。</i></span></p>
		<p>此外還應注意，所有的數據節點應具有相同的<span>RAM</span>量，這是因為，叢集中任何數據節點所能使用的內存均不超過任意單獨數據節點的最低可用內存。換句話講，如果有三台運行叢集數據節點的計算機，在其中兩台計算機上，有<span>3GB</span>用於保存叢集數據的<span>RAM</span>，另一台計算機只有<span>1GB 
		RAM</span>，那麼每個數據節點僅能為叢集貢獻<span>1GB</span>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>出現災難性故障時，例如整個城市斷電而且我的<span>UPS</span>也出現故障，我會丟失所有的數據嗎？</span></em></p>
		<p>
		所有已提交的事務將被記錄。因此，在出現災難的情況下，某些數據可能會丟失，但相當有限。通過減少每事務的操作數，能夠進一步減少數據損失（在任何情形下，在每事務上執行大量操作都不是一個好主意）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>能夠與叢集一起使用</span></em><span><i><span>FULLTEXT</span>索引嗎？</i></span></p>
		<p>
		<span>FULLTEXT</span>索引功能目前不被<span><span>NDB</span>儲存引擎支援，也不被除<span>MyISAM</span>之外的任何儲存引擎支援。我們打算在未來的版本中增加該功能。</span></p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能在一台計算機上運行多個節點嗎？</span></em></p>
		<p>
		可以，但不建議這樣。運行叢集的主要原因之一是提供冗余，為了獲得冗余性的全部優點，每個節點應位於單獨的計算機上。如果將多個節點置於同一台機器，當該機器出現故障時，所有節點均將丟失。考慮到<span>MySQL</span>叢集能運行在常見的硬件上並利用廉價的作業系統（或不需費用），為了確保任務關鍵型數據的安全，值得為額外的機器戶花費開銷。此外還須注意，對運行管理節點的叢集主機的要求最低，使用<span>200 
		MHz Pentium CPU</span>，作業系統所需的足夠<span>RAM</span>，以及用於<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>程序的少量開銷，就能完成該任務。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>我能在不重啟的情況下為叢集增加節點嗎？</span></em></p>
		<p>目前不行。對於在叢集中新增新的<span>MGM</span>或<span>SQL</span>節點來說，簡單的重啟就是所需的一切。新增數據節點時，程序略微複雜些，需要採取下述步驟：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>對所有叢集數據進行完整備份。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>徹底關閉叢集和所有的叢集節點程序。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>使用「<span><span>—initial」</span>啟動選項重啟叢集。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>從備份中恢復所有叢集數據。</p>
		<p>在未來的<span>MySQL</span>叢集版本中，我們希望為<span>MySQL</span>叢集實現「熱」重配置功能，以便能夠將新增新節點時重啟叢集的要求降至最低（如果不能消除的話）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用叢集時有需要我瞭解的限制嗎？</span></em></p>
		<p><span>
		<span>MySQL</span>中的<span>NDB</span>資料表服從下述限制：</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>並非所有的字元編碼和校對均被支援。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>不支援<span>FULLTEXT</span>索引和前綴索引。</span>只能為完整的列設置索引。不支援<a href="spatial-extensions-in-mysql.html">第19章：</a><a href="spatial-extensions-in-mysql.html" title="Chapter 19. Spatial Extensions in MySQL"><i>MySQL中的空間延伸</i></a>中介紹的空間延伸。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>僅支援對事務的完整回滾。不支援部分回滾以及回滾至保存點。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每資料表允許的最大屬性數為<span>128</span>，而且屬性名稱不得超過<span>31</span>個字元。對於每個資料表，資料表和資料庫名稱的最大組合長度為<span>122</span>個字元。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>資料表行的最大大小為<span>8KB</span>，不包括<span>BLOB</span>。對於每資料表中的行數沒有限制，資料表的大小限制取決於多種因素，尤其是每個數據節點可用的<span>RAM</span>量。</p>
		<p>
		<span>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>NDB</span>引擎</span>不支援外部鍵約束。就像<span><span>MyISAM</span>資料表一樣，這些約束將被忽略。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支援查詢高速緩衝功能。</p>
		<p>關於叢集限制的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8節，「MySQL叢集的已知限制」</a>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>怎樣將已有的<span>MySQL</span>資料庫導入到叢集中？</span></em></p>
		<p>可以將資料庫導入到<span>MySQL</span>叢集中，就像用其他版本的<span>MySQL</span>那樣。除了前一問題所提到的限制外，僅有的特殊要求是，準備包含到叢集中的任何資料表必須使用<span>NDB</span>儲存引擎。這意味著，資料表必須是用<span>ENGINE=NDB</span>或<span><span>ENGINE=NDBCLUSTER</span>建立的。使用<span>ALTER 
		TABLE</span>，能夠將使用其他儲存引擎的現有資料表轉換為<span>NDB</span>叢集資料表，但需要採取額外避規措施，</span>詳情請參見<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8節，「MySQL叢集的已知限制」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>叢集節點是怎樣彼此通信的？</span></em><span>
		</span></p>
		<p>叢集節點能夠通過下述三種協議中的任何一種進行通信：<span>TCP/IP</span>、<span>SHM</span>（共享內存）和<span>SCI</span>（規模可延伸的計算機連接接口）。在適用的場合，對於位於相同叢集主機上的節點間通信，預設協議為<span>SHM</span>。<span>SCI</span>是高速（每秒<span>1GB</span>或更高）、高可用性協議，用於建立可延伸的多處理器系統，它需要特殊硬件和驅動。關於使用<span>SCI</span>作為叢集中傳輸機制的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7節，「使用與MySQL叢集的高速互連」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>什麼是「</span></em><span class="quote"><i><span>arbitrator</span></i></span><em><span>」（仲裁程式）</span></em>？</p>
		<p>如果叢集中的<span>1</span>個或多個節點失敗，並非所有的叢集節點均不能彼此「看到」，這是可能的。事實上，能夠在網絡分區中將兩個節點集合彼此隔離，也稱為「分裂大腦」。這類情形並不受歡迎，這是因為，每一個節點集合都試圖資料表現為代資料表整個叢集。</p>
		<p>當叢集節點出現問題時，有兩種可能性。如果剩餘節點的<span>50</span>％以上能夠彼此通信，那麼這就是我們有時稱之為的「多數支配」情形，該節點集合將被視為叢集。當節點數均等時，仲裁程式將介入：在該情形下，仲裁程式所屬的節點集合將被當作叢集，不屬於該節點集合的節點將被關閉。</p>
		<p>上述描述略為簡化，更完整的解釋需要考慮下面介紹的節點組：</p>
		<p>
		當至少一個節點組中的所有節點均有效時，網絡分區不是問題，這是因為，叢集中的任一個部分均不能構成<span>1</span>個功能性的叢集。當沒有一個節點組的所有成員均是有效的時，問題產生，在該情況下，網絡分區（「分裂大腦」情形）成為可能。隨後就需要仲裁程式。所有的叢集節點將相同的節點視為仲裁程式，通常是管理伺服器。但是，也能將叢集中的任何<span>MySQL</span>伺服器配置為仲裁程式。仲裁程式接受第一個與其接觸的叢集節點集合，並通知剩餘的集合關閉。對於<span>MySQL</span>伺服器和管理伺服器節點，仲裁程式的選擇是由<span><span>ArbitrationRank</span>配置參數控制的</span>（詳情請參見<a href="ndbcluster.html#mysql-cluster-mgm-definition" title="17.4.4.4. Defining the MySQL Cluster Management Server">17.4.4.4節，「定義MySQL叢集管理伺服器」</a>）。此外還應注意，仲裁程式不會對指定主機施加過多的要求，因此，仲裁程式主機不需要特別塊或擁有用於該目的的額外內存。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>MySQL</span><span>叢集支援的列類型是什麼？</span></em></p>
		<p><span>MySQL</span>叢集支援所有通常的<span>MySQL</span>列類型，但與<span>MySQL</span>空間延伸有關的例外（請參見<a href="spatial-extensions-in-mysql.html">第19章：</a><a href="spatial-extensions-in-mysql.html" title="Chapter 19. Spatial Extensions in MySQL"><i>MySQL中的空間延伸</i></a>）。此外，對於索引，當與<span>NDB</span>資料表一起使用時存在一些差別。<strong><span>註釋：</span></strong><span>MySQL</span>叢集資料表（即用<span><span>ENGINE=NDBCLUSTER</span>建立的資料表）</span>僅有固定寬度列。這意味著（例如）含有<span><span>VARCHAR(255)</span>列的每一條記錄需要</span><span>256</span>字節來保存列，無論列中保存的數據大小是多少。在未來的<span>MySQL</span>版本中，計劃更正它。</p>
		<p>關於這些方面的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8節，「MySQL叢集的已知限制」</a>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>如何啟動和停止<span>MySQL</span>叢集？</span></em></p>
		<p>需要按照下述順序分別啟動叢集中的每個節點：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>用<strong><span>ndb_mgmd</span></strong>命令啟動管理節點。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>用<strong><span>ndbd</span></strong>命令啟動每個數據節點。</p>
		<p><span>3.<span>&nbsp;&nbsp;&nbsp;
		</span></span>使用<strong><span>mysqld_safe 
		--user=mysql &amp;</span></strong>，啟動每個<span>MySQL</span>伺服器（<span>SQL</span>節點）。</p>
		<p>對於這類命令中的每一個，必須在受影響節點所在機器上的系統<span>shell</span>中執行。在容納<span>MGM</span>節點的機器上啟動管理客戶端<strong><span>ndb_mgm</span></strong>，可驗證叢集是否正在運行。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>當叢集關閉時，會對叢集數據有什麼影響？</span></em></p>
		<p>由叢集數據節點保存在內存中的數據將被寫入磁盤，並在下一次啟動叢集時重新裝入內存。</p>
		<p>要想關閉叢集，請在<span>MGM</span>節點所在的機器上、在<span>shell</span>下輸入下述命令：</p>
		<pre><span>shell&gt; <span><b>ndb_mgm -e shutdown</b></span></span></pre>
		<p>這樣就能恰當地中止<strong><span>ndb_mgm</span></strong>、<strong><span>ndb_mgm</span></strong>、以及任何<strong><span>ndbd</span></strong>程序。對於用作叢集<span>SQL</span>節點的<span>MySQL</span>伺服器，可使用<strong><span>mysqladmin 
		shutdown</span></strong>停止它。</p>
		<p>更多訊息，請參見<a href="ndbcluster.html#mgm-client-commands" title="17.6.2. Commands in the Management Client">17.6.2節，「管理客戶端」中的命令</a>和<a href="ndbcluster.html#multi-shutdown-restart" title="17.3.6. Safe Shutdown and Restart">17.3.6節，「安全關閉和重啟」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>叢集中有<span>1</span>個以上的管理節點是否有用？</span></em></p>
		<p>對於可靠性來說它確有幫助。在任何給定的時間，僅需<span>1</span>個<span>MGM</span>節點來控制叢集，但能夠將<span>1</span>個<span>MGM</span>配置為主節點，並配置<span>1</span>個或多個額外的管理節點，以便在主<span>MGM</span>節點出現故障時取代它。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>在叢集中能混合使用不同的硬件和作業系統嗎？</span></em></p>
		<p>是。只要所有的機器和作業系統均是相同的<span>endian</span>。也能在不同的節點上使用不同的<span>MySQL</span>叢集版本，但是，我們建議僅應將其作為滾動升級的一部分使用。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能在單台主機上運行兩個數據節點嗎？兩個<span>SQL</span>節點？</span></em></p>
		<p>
		是，能夠這樣。在有多個數據節點的情況下，每個節點必須使用不同的數據目錄。如果打算在一台機器上運行多個<span>SQL</span>節點，那麼每個<strong><span>mysqld</span></strong>實例必須使用不同的<span>TCP/IP</span>端口。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能與<span>MySQL</span>叢集一起使用主機名嗎？</span></em></p>
		<p>是，對於叢集主機，能夠使用<span>DNS</span>和<span>DHCP</span>。但是，如果您的應用程式要求「<span>99.999</span>％」的可用性，建議使用固定的<span>IP</span>地址。這是因為，依賴該服務的叢集節點間的通信會引入額外的故障點，故障點越少越好。</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-glossary"></a>17.11. MySQL叢集術語資料表</h2></div></div></div>
		<p>下面給出的術語對理解<span>MySQL</span>叢集有所幫助，而且在與<span>MySQL</span>叢集一起使用時有一定的特殊含義。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>叢集：</span></strong></p>
		<p>按照通常的理解，叢集是一個計算機集合，其功能相當於<span>1</span>個單位，一起工作以完成單一任務。</p>
		<p><span><b>
		<span>NDB</span></b></span><strong><span>叢集：</span></strong></p>
		<p>這是<span>MySQL</span>中使用的儲存引擎，用於實現數據儲存、檢索、以及多個計算機間分佈式管理。</p>
		<p><strong>
		<span>MySQL</span><span>叢集：</span></strong></p>
		<p>指的是使用<span>NDB</span>儲存引擎一起工作的一組計算機，以便在使用「內存中」儲存的非共享體系結構中支援分佈式<span>MySQL</span>資料庫。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>配置檔案：</span></strong></p>
		<p>
		包含與叢集、其主機和節點有關的指令和訊息的文本檔案。當叢集啟動時，這類檔案由叢集的管理節點負責讀取。詳情請參見<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4節，「配置檔案」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>備份：</span></strong></p>
		<p>所有叢集數據、事務和日誌的完整拷貝，保存在磁盤上或其他長期儲存介質上。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>恢復：</span></strong></p>
		<p>將叢集返回以前的狀態，與保存在備份中的相同。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>檢查點：</span></strong></p>
		<p>
		從廣義上講，將數據保存到磁盤時，即達到了檢查點。具體對於叢集來說，它是將所有已提交事務保存到磁盤的時間點。對於<span>NDB</span>儲存引擎，有兩種一起工作的檢查點，以確保維護叢集數據的一致性：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>本地檢查點（<span>LCP</span>）：</span></strong></p>
		<p>這是專門針對單一節點的檢查點，但是，<span>LCP</span>也會在叢集中的所有節點發生，同步性或強或弱。<span>LCP</span>包括將節點的所有數據保存到磁盤，通常每幾分鐘出現一次。準確的時間間隔會出現變化，具體情況取決於節點上保存的數據量，叢集活動的級別，以及其他因素。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>全局檢查點（<span>GCP</span>）：</span></strong></p>
		<p><span>GCP</span>每數秒出現一次，此時，將對所有節點的事務進行同步化處理，並將<span>redo</span>日誌保存到磁盤。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>叢集主機：</span></strong></p>
		<p>構成<span>MySQL</span>叢集組成部分的計算機。叢集具有物理結構和邏輯結構。從物理意義上講，叢集由多個計算機構成，這些計算機也稱為叢集主機（或主機）另請參見下面的<strong><span>節點</span></strong>和<strong><span>節點組</span></strong>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>節點：</span></strong></p>
		<p>它指的是<span>MySQL</span>叢集的邏輯或功能性單元，有時也稱為叢集節點。對於<span>MySQL</span>叢集，我們使用術語「節點」資料表示程序而不是叢集的物理部件。實施有效的<span>MySQL</span>叢集需要三種節點。它們是：</p>
		<p><strong>
		<span>
		o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>管理（<span>MGM</span>）節點：</span></strong></p>
		<p>
		負責管理叢集中的其他節點。它為其他節點提供了配置數據，負責啟動和停止節點，處理網絡分區事宜，建立備份和從備份恢復，等等。</p>
		<p><strong>
		<span>
		o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>SQL</span><span>（<span>MySQL</span>伺服器）節點：</span></strong></p>
		<p><span>MySQL</span>伺服器的實例，用作叢集數據節點所保存數據的前端。打算保存、檢索或更新數據的客戶端可訪問<span>SQL</span>節點，就像訪問其他<span>MySQL</span>伺服器一樣，採用通常的鑒定方法和<span>API</span>，節點組之間的基本數據分配對用戶和應用程式來說是透明的。<span>SQL</span>節點訪問作為整體的叢集資料庫，而不管數據在不同數據節點或叢集主機上的分佈情況。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>數據節點：</span></strong></p>
		<p>
		這些節點負責保存實際數據。資料表數據片段保存在節點組集合中，每個節點組保存資料表數據的不同子集。構成節點組的每個節點均保存了該節點組所負責片段的副本。目前，<span>1</span>個叢集能支援總數為<span>48</span>的數據節點。</p>
		<p><span>1</span>個以上的節點能共存於單台機器上（事實上，能夠在一台機器上設置完成的叢集，但在生產環境下幾乎沒人會這樣做）。請記住，使用<span>MySQL</span>叢集時，術語「主機」指的是叢集的物理部件，而「節點」指的是邏輯或功能部件（即程序），這很有幫助。</p>
		<p><strong><span>
		關於過時術語的註釋：</span></strong>在<span>MySQL</span>叢集文檔的早期版本中，數據節點有時也稱為「資料庫節點」、「<span class="quote"><span>DB</span>節點</span>」、或偶爾使用的「<span class="quote">儲存節點</span>」。此外，<span>SQL</span>節點有時也稱為「客戶端節點」或「<span>API</span>節點」。為了將混淆降至最低，這類早期術語已被放棄，為此，應避免使用它們。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>節點組：</span></strong></p>
		<p>
		數據節點的集合。位於節點組內的所有數據節點包含相同的數據（片段），而且單個組內的所有節點應位於不同的主機上。能夠對哪個節點術語哪個節點組進行控制。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>節點失敗：</span></strong></p>
		<p><span>MySQL</span>叢集並不僅取決於構成構成叢集的任一節點的功能，如果<span>1</span>個或多個節點失敗，叢集仍能運行。給定叢集能容忍的失敗節點的準確數目取決於節點的數目和叢集的配置。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>節點重啟：</span></strong></p>
		<p>重啟失敗叢集節點的程序。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>首次節點重啟：</span></strong></p>
		<p>不與其檔案系統一起啟動叢集節點的程序。有時用於軟件升級或其他特殊場合。</p>
		<p><strong>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>系統崩潰（或系統失敗）：</span></strong></p>
		<p>當很多叢集節點失敗並無法保證叢集的狀態時，就會出現該情況。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>系統重啟：</span></strong></p>
		<p>
		重啟叢集並根據磁盤日誌和檢查點重新初始化叢集狀態的程序。在叢集的計劃關閉或非計劃關閉後，通常需要執行該程序。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>片段：</span></strong></p>
		<p>資料庫資料表的一部分，在<span>NDB</span>儲存引擎中，將資料表分為眾多片段，並以片段方式保存。片段有時也稱為「分區」，但「片段」是更可取的術語。在<span>MySQL</span>叢集中，對資料表進行了片段化處理，從而簡化了機器和節點間的負載平衡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>副本：</span></strong></p>
		<p>在<span><span>NDB</span>儲存引擎下，每個資料表片段均有多個副本，這些副本保存在其他數據節點上，以提供冗余性。目前，每片段最多有<span>4</span>個副本。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>傳輸器：</span></strong></p>
		<p>提供節點間數據傳輸的協議。<span>MySQL</span>叢集目前提供了四種不同的傳輸器連接：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>TCP/IP</span>（本地）</p>
		<p>當然，這是廣為人知的網絡協議，它是<span>Internet</span>上<span>HTTP</span>、<span>FTP</span>等的基礎。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>TCP/IP</span>（遠程）</p>
		<p>同上，但用於遠程通信。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>SCI </span></p>
		<p><strong>
		<span>SCI</span></strong>（規模可延伸的計算機連接接口）是一種高速協議，由於構建多處理器系統和並行處理應用程式。與<span>MySQL</span>叢集一起使用<span>SCI</span>時，需要專門的硬件，具體討論請參見<a href="ndbcluster.html#sci-sockets" title="17.7.1. Configuring MySQL Cluster to use SCI Sockets">17.7.1節，「配置MySQL叢集以使用SCI套接字」</a>。關於<span>SCI</span>的基本介紹，請參見<span><a target="_top"  href="http://www.dolphinics.com/corporate/scitech.html">dolphinics.com<span>上的文章。</span></a></span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>SHM </span></p>
		<p><span>Unix</span>風格共享內存（<span>SHM</span>）段。在任何支援的場合下，將自動使用<span>SHM</span>來連接運行在相同主機上的節點。要想瞭解這方面的更多訊息，請參見<span><a target="_top"  href="http://www.scit.wlv.ac.uk/cgi-bin/mansec?2+shmop">關於shmop(2)的Unix手冊頁</a></span>。</p>
		<p><strong><span>註釋：</span></strong>叢集傳輸器是叢集內部的。使用<span>MySQL</span>叢集的應用程式與<span>SQL</span>節點進行通信，就像與其他版本的<span>MySQL</span>伺服器進行通信一樣（通過<span>TCP/IP</span>、或使用<span>Unix</span>套接字、或<span>Windows</span>命名管道）。可以使用標準的<span>MySQL 
		API</span>發出查詢並檢索結果。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span><b><span>NDB</span></b></span>：</p>
		<p>它是網絡資料庫（<strong><span>N</span></strong><span>etwork
		<strong><span>D</span></strong>ata<strong><span>b</span></strong>ase</span>）的縮寫，而且指的是用於啟用<span>MySQL</span>叢集的儲存引擎。<span><span>NDB</span>儲存引擎支援所有通常的<span>MySQL</span>列類型和<span>SQL</span>語句，</span>而且是<span>ACID</span>兼容的。該引擎還提供了對事務的完整支援（提交和回滾）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>無共享體系結構：</span></strong><span>
		</span></p>
		<p>用於<span>MySQL</span>叢集的理想體系結構。在真正的無共享設置下，每個節點運行在單獨的主機上。這類安排的優點在於，單個主機或節點不會造成單點故障，也不會成為系統整體的性能瓶頸。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>內存中儲存：</span></strong></p>
		<p>
		保存在每個數據節點中的數據均保存在節點宿主計算機的內存中。對於叢集中的每個數據節點，必須提供足夠的<span>RAM</span>，所需的<span>RAM</span>量為：資料庫的大小乘以副本數目，然後除以數據節點的數目。因此，如果資料庫佔用<span>1GB</span>的內存，而且您打算設置具有<span>4</span>個副本和<span>8</span>個數據節點的叢集，每節點所需的最小內存為<span>500 
		MB</span>。注意，還應加上作業系統所需的內存以及運行在主機上的應用程式所需的內存。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>資料表：</span></strong></p>
		<p>與關聯資料庫下的通常情況一樣，術語「資料表」指的是具有等同結構的記錄的集合。在<span>MySQL</span>叢集中，資料庫資料表以片段集合的方式保存在數據節點中，並將每個片段複製到額外的數據節點上。複製相同片段或片段集合的數據節點集合稱為節點組。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>叢集程式：</span></strong></p>
		<p>它們是命令行程式，用於運行、配置和管理<span>MySQL</span>叢集。它們包括兩種伺服器端口監督程式：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndbd</span></strong><span>:
		</span></p>
		<p>數據節點端口監督程式（運行數據節點程序）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_mgmd</span></strong><span>:
		</span></p>
		<p>管理伺服器端口監督程式（運行管理伺服器程序）。</p>
		<p>以及客戶端程式：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_mgm</span></strong><span>:
		</span></p>
		<p>管理客戶端（為執行管理命令提供了<span>1</span>個界面）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_waiter</span></strong><span>:
		</span></p>
		<p>用於驗證叢集中所有節點的狀態。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>
		ndb_restore</span></strong><span>: </span></p>
		<p>從備份中恢復叢集數據。</p>
		<p>關於這些程式及其用法的更多訊息，請參見<a href="ndbcluster.html#mysql-cluster-process-management" title="17.5. Process Management in MySQL Cluster">17.5節，「MySQL叢集中的程序管理」</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>事件日誌：</span></strong></p>
		<p><span>MySQL</span>叢集按照類別（啟動、停止、錯誤、檢查點等）、優先級和嚴重級別來記錄事件。關於所有可通報事件的完整列資料表，請參見<a href="ndbcluster.html#mysql-cluster-event-reports" title="17.6.3. Event Reports Generated in MySQL Cluster">17.6.3節，「MySQL叢集中生成的事件報告」</a>。事件日誌具有兩種類型：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>叢集日誌：</span></strong></p>
		<p>為作為整體的叢集記錄所有所需的、值得記錄的事件。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>節點日誌：</span></strong></p>
		<p>為每個單獨節點保存的單獨日誌。</p>
		<p>
		在正常情況下，僅需保存和檢查叢集日誌，這通常已足夠。節點日誌僅用於應用程式開發和調試目的。</p>
		<div class="itemizedlist">&nbsp;</div></div></div><div><hr>
	<p>這是MySQL參考手冊的翻譯版本，關於MySQL參考手冊，請訪問<a target="_top"  href="http://dev.mysql.com/doc/mysql/en">dev.mysql.com</a>。原始參考手冊為英文版，與英文版參考手冊相比，本翻譯版可能不是最新的。</div>
</body></html>

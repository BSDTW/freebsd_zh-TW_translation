<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Chapter 26. Modal Dialogs</title>
    <link rel="stylesheet" type="text/css" href="docbook-xsl-mymods.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.0" />
    <link rel="home" href="index.html" />
    <link rel="up" href="pt05.html" />
    <link rel="prev" href="ch25.html" />
    <link rel="next" href="pt06.html" />
  </head>
  <body>
    <div class="mattnotice">
      <p>As a courtesy, this is a <b>full free</b> rendering of my book, <i>Programming iOS 6</i>, by Matt Neuburg. Copyright 2013 Matt Neuburg. Please note that this book has now been completely superseded by two more recent books, <a href="http://shop.oreilly.com/product/0636920032465.do">iOS 7 Fundamentals</a> and <a href="http://shop.oreilly.com/product/0636920031017.do">Programming iOS 7</a>. If my work has been of help to you, please <b>consider purchasing</b> one or both of them. Thank you!
	</p>
    </div>
    <div class="navfooter">
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="ch25.html">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="pt05.html">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="pt06.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 25. Controls and Other Views </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Table of Contents</a>
          </td>
          <td width="40%" align="right" valign="top"> Part VI. Some Frameworks</td>
        </tr>
      </table>
    </div>
    <div class="chapter">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="chap_id26"></a>Chapter 26. Modal Dialogs</h2>
          </div>
        </div>
      </div>
      <p>A modal dialog demands attention; while it is present, the user can do nothing other than work within it or dismiss it. You might need to put up a simple modal dialog in order to give the user some information or to ask the user how to proceed. Two UIView subclasses construct and present rudimentary modal dialogs:<a id="idm441642801840" class="indexterm"></a>
<a id="idm441642800848" class="indexterm"></a></p>
      <div class="variablelist">
        <dl>
          <dt>
            <span class="term">
UIAlertView
</span>
          </dt>
          <dd>
            <p class="simpara">
A UIAlertView pops up unexpectedly with an elaborate animation and may be thought of as an attention-getting interruption. An alert is displayed in the center of the screen; it contains a title, a message, and some number of buttons, one of which may be the cancel button, meaning that it does nothing but dismiss the alert. In addition, an alert view may contain a text field, a password field, or both.
</p>
            <p class="simpara">Alert views are minimal, but intentionally so; they are intended for simple, quick interaction or display of information. Often there is only a cancel button, the primary purpose of the alert being to show the user the message (“You won the game”); the additional buttons may be used to give the user a choice of how to proceed (“You won the game; would you like to play another?” “Yes,” “No,” “Replay”). The text field and password field might allow the user to supply login credentials.</p>
          </dd>
          <dt>
            <span class="term">
UIActionSheet
</span>
          </dt>
          <dd>
            <p class="simpara">
A UIActionSheet may be considered the iOS equivalent of a menu. An action sheet is displayed arising from the interface: on the iPhone, it slides up from the bottom of the screen; on the iPad, it is typically shown in a popover. It consists of some number of buttons (there can be a title, optionally, but there usually isn’t); one may be the cancel button, which appears last, and one may be a “destructive” button, which appears first in red, emphasizing the severity of that option.
</p>
            <p class="simpara">Where a UIAlertView is an interruption, a UIActionSheet is a logical branching of what the user is already doing: it typically divides a single piece of interface into multiple possible courses of action. For example, in Apple’s Mail app, a single Action button summons an action sheet that lets the user reply to the current message, forward it, or print it (or cancel and do nothing).</p>
          </dd>
        </dl>
      </div>
      <p>One sees occasionally a misuse of the built-in dialogs to include additional interface. For example, a UIActionSheet is a UIView, so in theory you can add a subview to it. I cannot recommend such behavior; it clearly isn’t intended, and there’s no need for it. If what you want isn’t what a built-in dialog normally does, don’t use a built-in dialog. I’ll suggest some alternatives in the last part of this chapter.</p>
      <p>A local notification is an alert that the system presents at a predetermined time on your app’s behalf when your app isn’t frontmost. This alert can appear as a UIAlertView, so I discuss it in this chapter as well.</p>
      <p>New in iOS 6 is the activity view, a modal dialog displaying icons representing possible courses of action, and intended in certain circumstances to replace the action sheet. For example, Mobile Safari now presents an activity view from its Action button; the icons represent external modes of sharing a URL such as Mail, Message, and Twitter, as well as internal actions such as Bookmark and Add to Reading List. I’ll discuss activity views at the end of this chapter.</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="_alert_view"></a>Alert View</h2>
            </div>
          </div>
        </div>
        <p>The basic method for constructing an alert view (UIAlertView) is <code class="literal">initWithTitle:message:delegate:cancelButtonTitle:otherButtonTitles:</code>. The method for making a constructed alert view appear onscreen is <code class="literal">show</code>. The alert is automatically dismissed as soon as the user taps any button. Here’s an example (<a class="xref" href="ch26.html#FIGalert">Figure 26.1</a>):<a id="idm441642786912" class="indexterm"></a><a id="idm441642786032" class="indexterm"></a>
<a id="idm441642784736" class="indexterm"></a></p>
        <pre class="screen">UIAlertView* alert = [[UIAlertView alloc] initWithTitle:@"Not So Fast!"
    message:@"Do you really want to do this tremendously destructive thing?"
    delegate:self cancelButtonTitle:@"Yes"
    otherButtonTitles:@"No", @"Maybe", nil];
[alert show];</pre>
        <div class="figure">
          <a id="FIGalert"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2601.png" alt="figs/pios_2601.png" />
            </div>
          </div>
          <p class="title">Figure 26.1. An alert view</p>
        </div>
        <br class="figure-break" />
        <p>The <code class="literal">otherButtonTitles</code> parameter is of indefinite length, so it must be either nil or a nil-terminated list (not an array!) of strings. The cancel button needn’t be titled “Cancel”; it is drawn darker than the other buttons and comes last in a column of buttons, as you can see from <a class="xref" href="ch26.html#FIGalert">Figure 26.1</a>. If there are more than two <code class="literal">otherButtonTitles</code> and a nil <code class="literal">cancelButtonTitle</code>, the last of the <code class="literal">otherButtonTitles</code> is drawn as if it were a cancel button; this code, too, produces <a class="xref" href="ch26.html#FIGalert">Figure 26.1</a>:</p>
        <pre class="screen">UIAlertView* alert = [[UIAlertView alloc] initWithTitle:@"Not So Fast!"
    message:@"Do you really want to do this tremendously destructive thing?"
    delegate:self cancelButtonTitle:nil
    otherButtonTitles:@"No", @"Maybe", @"Yes", nil];</pre>
        <p>If an alert view is to contain a text field, it probably should have at most one or two buttons, with short titles such as “OK” and “Cancel”. Otherwise, there might not be room on the screen for the alert view and the keyboard. To add a text field to the alert view, modify its <code class="literal">alertViewStyle</code> before calling <code class="literal">show</code>. Your choices are:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">UIAlertViewStyleDefault</code>, the default (no text fields)
</li>
            <li class="listitem">
<code class="literal">UIAlertViewStylePlainTextInput</code>, one normal text field
</li>
            <li class="listitem">
<code class="literal">UIAlertViewStyleSecureTextInput</code>, one <code class="literal">secureTextEntry</code> text field
</li>
            <li class="listitem">
<code class="literal">UIAlertViewStyleLoginAndPasswordInput</code>, one normal text field and one <code class="literal">secureTextEntry</code> text field
</li>
          </ul>
        </div>
        <p>You can retrieve the text fields with <code class="literal">textFieldAtIndex:</code>; possible arguments are <code class="literal">0</code> and <code class="literal">1</code> (where <code class="literal">1</code> is the password field when the style is <code class="literal">UIAlertViewStyleLoginAndPasswordInput</code>). You can treat the text fields as you would any text field (see <a class="xref" href="ch23.html">Chapter 23</a>); for example, you can set the text field’s delegate, arrange to receive control events from the text field, determine the text field’s keyboard type, and so on:</p>
        <pre class="screen">UIAlertView* alert = [[UIAlertView alloc] initWithTitle:@"Enter a number:"
    message:nil delegate:self cancelButtonTitle:@"Cancel"
    otherButtonTitles:@"OK", nil];
alert.alertViewStyle = UIAlertViewStylePlainTextInput;
UITextField* tf = [alert textFieldAtIndex:0];
tf.keyboardType = UIKeyboardTypeNumberPad;
[tf addTarget:self action:@selector(textChanged:)
         forControlEvents:UIControlEventEditingChanged];
[alert show];</pre>
        <p>The alert dialog is modal, but the code that presents it is not: after the alert is shown, your code continues to run. If an alert consists of a single button (the cancel button), you might show it and forget about it, secure in the knowledge that the user must dismiss it sooner or later and that nothing can happen until then. But if you want to respond at the time the user dismisses the alert, or if there are several buttons and you want to know which one the user tapped to dismiss the alert, you’ll need to implement at least one of these delegate methods (UIAlertViewDelegate):</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">alertView:clickedButtonAtIndex:</code>
</li>
            <li class="listitem">
<code class="literal">alertView:willDismissWithButtonIndex:</code>
</li>
            <li class="listitem">
<code class="literal">alertView:didDismissWithButtonIndex:</code>
</li>
          </ul>
        </div>
        <p>The cancel button index is usually <code class="literal">0</code>, with the remaining button indexes increasing in the order in which they were defined. If you’re in any doubt, or if you need the button title for any other reason, you can call <code class="literal">buttonTitleAtIndex:</code>. Properties allow you to work out the correspondence between indexes and buttons without making any assumptions:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">cancelButtonIndex</code> (<code class="literal">-1</code> if none)
</li>
            <li class="listitem">
<code class="literal">firstOtherButtonIndex</code> (<code class="literal">-1</code> if none)
</li>
            <li class="listitem">
<code class="literal">numberOfButtons</code> (including the cancel button)
</li>
          </ul>
        </div>
        <p>You can also dismiss an alert view programmatically, with <code class="literal">dismissWithClickedButtonIndex:animated:</code>. When an alert view is dismissed programmatically, the delegate method <code class="literal">alertView:clickedButtonAtIndex:</code> is <span class="emphasis"><em>not</em></span> called, because no button was actually clicked by the user. But the button index you specify is still passed along to the two <code class="literal">dismiss</code> delegate methods. The button index you specify needn’t correspond to any existing button; thus, you could use it as a way of telling your delegate method that your code, and not the user, dismissed the alert.</p>
        <p>Two additional delegate methods notify you when the alert is initially shown:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">willPresentAlertView:</code>
</li>
            <li class="listitem">
<code class="literal">didPresentAlertView:</code>
</li>
          </ul>
        </div>
        <p>A further delegate method asks whether the first “other button” should be enabled:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">alertViewShouldEnableFirstOtherButton:</code>
</li>
          </ul>
        </div>
        <p>The delegate receives that message each time the state of things changes in the alert — in particular, when the alert appears and when the text in a text field changes. In this example, there’s a text field, my cancel button says “Cancel”, and my other button says “OK”; I enable the OK button only if there is text in the text field:</p>
        <pre class="screen">- (BOOL)alertViewShouldEnableFirstOtherButton:(UIAlertView *)alertView {
    UITextField* tf = [alertView textFieldAtIndex:0];
    return [tf.text length] &gt; 0;
}</pre>
        <p>One last delegate method notifies you if the alert is dismissed by the system:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">alertViewCancel:</code>
</li>
          </ul>
        </div>
        <p>Before iOS 4.0, this could happen because the user quit the app with the alert showing; the system dismissed the alert, and your code had a chance to respond before actually terminating. In the multitasking world, however, if the user clicks the Home button, your app is backgrounded without the system dismissing the alert, and <code class="literal">alertViewCancel:</code> may be a dead letter. It would thus be up to your code, as the app is backgrounded, whether to leave the alert there or to dismiss the alert and perhaps take some default action.</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="_action_sheet"></a>Action Sheet</h2>
            </div>
          </div>
        </div>
        <p>The basic method for constructing an action sheet (UIActionSheet) is <code class="literal">initWithTitle:delegate:cancelButtonTitle:destructiveButtonTitle:otherButtonTitles:</code>. There are various methods for summoning the actual sheet, depending on what part of the interface you want the sheet to arise from. The following are appropriate on the iPhone, where the sheet typically rises from the bottom of the screen:<a id="idm441642710992" class="indexterm"></a><a id="idm441642710096" class="indexterm"></a>
<a id="idm441642708800" class="indexterm"></a>
<a id="idxpopoversagain" class="indexterm"></a></p>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
<code class="literal">showInView:</code>
</span>
            </dt>
            <dd>
              <p class="simpara">
On the iPhone, far and away the most commonly used method. You will usually specify the root view controller’s view. Don’t specify a view whose view controller is contained by a view controller that hides the bottom of the interface, such as a tab bar controller or a navigation controller with a toolbar; if you do, some of the buttons may not function (and you get a helpful warning in the console: “Presenting action sheet clipped by its superview”).<a id="idm441642703920" class="indexterm"></a>
<a id="idm441642702704" class="indexterm"></a> Instead, specify the tab bar controller’s view itself, or the navigation controller’s view itself, or use one of the other methods. For example, in my Zotz! app, which has a tab bar interface, the settings view controller summons an action sheet like this (<a class="xref" href="ch26.html#FIGsheet">Figure 26.2</a>):
</p>
              <pre class="screen">[sheet showInView: self.tabBarController.view];</pre>
            </dd>
          </dl>
        </div>
        <div class="figure">
          <a id="FIGsheet"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2602.png" alt="figs/pios_2602.png" />
            </div>
          </div>
          <p class="title">Figure 26.2. An action sheet on the iPhone</p>
        </div>
        <br class="figure-break" />
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
<code class="literal">showFromTabBar:</code>
<br /></span>
              <span class="term">
<code class="literal">showFromToolbar:</code>
</span>
            </dt>
            <dd>
On the iPhone, these cause the sheet to rise from the bottom of the screen, just like <code class="literal">showInView:</code>, because the tab bar or toolbar is at the bottom of the screen; however, they avoid the clipping problem with <code class="literal">showInView:</code> described earlier.
</dd>
          </dl>
        </div>
        <p>On the iPad, you are more likely to use one of the following methods, which resemble the methods for presenting a popover (<a class="xref" href="ch22.html">Chapter 22</a>); they do in fact present the action sheet as a popover, with its arrow pointing to the specified part of the interface (<a class="xref" href="ch26.html#FIGsheetAsPopover">Figure 26.3</a>):</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">showFromRect:inView:animated:</code>
</li>
            <li class="listitem">
<code class="literal">showFromBarButtonItem:animated:</code>
</li>
          </ul>
        </div>
        <div class="figure">
          <a id="FIGsheetAsPopover"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2603.png" alt="figs/pios_2603.png" />
            </div>
          </div>
          <p class="title">Figure 26.3. An action sheet presented as a popover</p>
        </div>
        <br class="figure-break" />
        <p>(On the iPhone, those methods should be avoided; they don’t cause an error, and they do work — the sheet still ends up at the bottom at the screen — but they can do messy things to the interface.)</p>
        <p>On the iPad, there is usually no point including a cancel button title; if the alert sheet is shown as a popover, no cancel button will appear. This is because the popover is configured to be dismissed when the user taps outside it, which is the same as canceling it.</p>
        <p>Alternatively, it is possible on the iPad to show an alert sheet <span class="emphasis"><em>inside an existing popover</em></span>. In this scenario, we are already presenting the popover, and then we summon an action sheet within the popover’s view. The action sheet then behaves just as if the popover were an iPhone: you summon it with <code class="literal">showInView:</code>, it slides up from the bottom of the popover, and the cancel button, if specified, does appear (<a class="xref" href="ch26.html#FIGsheetInPopover">Figure 26.4</a>). The action sheet behaves like a presented view inside a popover, where <code class="literal">modalInPopover</code> is YES.</p>
        <div class="figure">
          <a id="FIGsheetInPopover"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2604.png" alt="figs/pios_2604.png" />
            </div>
          </div>
          <p class="title">Figure 26.4. An action sheet presented inside a popover</p>
        </div>
        <br class="figure-break" />
        <p>An action sheet also has a style, its <code class="literal">actionSheetStyle</code>:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">UIActionSheetStyleAutomatic</code>
</li>
            <li class="listitem">
<code class="literal">UIActionSheetStyleDefault</code>
</li>
            <li class="listitem">
<code class="literal">UIActionSheetStyleBlackTranslucent</code>
</li>
            <li class="listitem">
<code class="literal">UIActionSheetStyleBlackOpaque</code>
</li>
          </ul>
        </div>
        <p>These values are closely related to the possible styles (<code class="literal">barStyle</code>) of a UIToolbar (<a class="xref" href="ch25.html">Chapter 25</a>). However, an action sheet’s style depends also on the mode of presentation; my experimentation suggests, for example, that setting the <code class="literal">actionSheetStyle</code> of an action sheet that appears as a popover may make no perceptible difference, and that an action sheet that is shown from a tab bar will always be black opaque.</p>
        <p>In other respects an action sheet is managed in a manner completely parallel to an alert view. When one of its buttons is tapped, the sheet is dismissed automatically, but you’ll probably want to implement a delegate method (UIActionSheetDelegate) in order to learn which button it was:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">actionSheet:clickedButtonAtIndex:</code>
</li>
            <li class="listitem">
<code class="literal">actionSheet:willDismissWithButtonIndex:</code>
</li>
            <li class="listitem">
<code class="literal">actionSheet:didDismissWithButtonIndex:</code>
</li>
          </ul>
        </div>
        <p>If the action sheet is shown as a popover on the iPad, and if the popover is dismissed by the user tapping outside it, the button index is <code class="literal">-1</code>.</p>
        <p>To respond appropriately to the delegate methods without making assumptions about how the indexes correspond to the buttons, you can use the <code class="literal">buttonTitleAtIndex:</code> method, and these properties:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">cancelButtonIndex</code>
</li>
            <li class="listitem">
<code class="literal">destructiveButtonIndex</code>
</li>
            <li class="listitem">
<code class="literal">firstOtherButtonIndex</code>
</li>
            <li class="listitem">
<code class="literal">numberOfButtons</code>
</li>
          </ul>
        </div>
        <p>You can dismiss an action sheet programmatically with <code class="literal">dismissWithClickedButtonIndex:animated:</code>, in which case <code class="literal">actionSheet:clickedButtonAtIndex:</code> is not called, but the two <code class="literal">dismiss</code> delegate methods are. Two additional delegate methods notify you when the sheet is initially shown:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">willPresentActionSheet:</code>
</li>
            <li class="listitem">
<code class="literal">didPresentActionSheet:</code>
</li>
          </ul>
        </div>
        <p>A further delegate method, <code class="literal">actionSheetCancel:</code>, notifies you if the sheet is dismissed by the system, though in the multitasking world this is unlikely to happen; if your app is backgrounded with an action sheet showing, it’s up to you to decide how to proceed.</p>
        <p>Here’s the code that presents the action sheet shown in <a class="xref" href="ch26.html#FIGsheet">Figure 26.2</a>, along with the code that responds to its dismissal:</p>
        <pre class="screen">- (void) chooseLayout: (id) sender {
    UIActionSheet* sheet =
        [[UIActionSheet alloc] initWithTitle:@"Choose New Layout"
        delegate:self
        cancelButtonTitle:@"Cancel" destructiveButtonTitle:nil
        otherButtonTitles:@"3 by 3", @"4 by 3", @"4 by 4",
                          @"5 by 4", @"5 by 5", nil];
    [sheet showInView: self.tabBarController.view];
}

- (void)actionSheet:(UIActionSheet *)as clickedButtonAtIndex:(NSInteger)ix {
    if (ix == as.cancelButtonIndex)
        return;
    NSString* s = [as buttonTitleAtIndex:ix];
    // ...
}</pre>
        <p>On the iPad, an action sheet shown as a popover or inside an existing popover introduces the same issues with regard to the popover’s <code class="literal">passthroughViews</code> that I enumerated in <a class="xref" href="ch22.html">Chapter 22</a>. When an action sheet is shown as a popover from a bar button item in a toolbar, the toolbar becomes a passthrough view for the popover, and the user can now tap a bar button item without causing the action sheet’s popover to be dismissed (possibly even summoning another popover — perhaps even another instance of the same action sheet — simultaneously). You can’t solve this problem by adjusting the popover controller’s <code class="literal">passthroughViews</code>, because you’ve no access to the popover controller! One workaround is to implement the delegate methods to toggle user interaction with the toolbar:</p>
        <pre class="screen">- (IBAction)doButton:(id)sender { // sender is a bar button item
    UIActionSheet* act = [[UIActionSheet alloc]
        initWithTitle:nil delegate:self cancelButtonTitle:nil
        destructiveButtonTitle:nil
        otherButtonTitles:@"Hey", @"Ho", @"Hey Nonny No", nil];
    [act showFromBarButtonItem:sender animated:YES];
}

- (void)didPresentActionSheet:(UIActionSheet *)actionSheet {
    [self.toolbar setUserInteractionEnabled:NO];
}

- (void)actionSheet:(UIActionSheet *)actionSheet
        didDismissWithButtonIndex:(NSInteger)buttonIndex {
    [self.toolbar setUserInteractionEnabled:YES];
}</pre>
        <p>Similarly, an action sheet shown inside a popover causes the popover to behave as if <code class="literal">modalInPopover</code> is YES; thus, while the action sheet is showing, the user can’t dismiss the popover by tapping anywhere that isn’t listed in the popover’s <code class="literal">passthroughViews</code>. So far, so good. But you must take care that the popover’s <code class="literal">passthroughViews</code> make sense for this situation; setting the <code class="literal">passthroughViews</code> property to nil while the action sheet is present (if it isn’t nil already) might be a good idea. But the view controller that presents the action sheet might not have ready access to the popover controller in order to set its <code class="literal">passthroughViews</code>! This entire situation is just another maddening consequence of iOS’s poor built-in popover management.
<a id="idm441642632208" class="indexterm"></a></p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="_dialog_alternatives"></a>Dialog Alternatives</h2>
            </div>
          </div>
        </div>
        <p>Alert views and actions sheets are limited, inflexible, and inappropriate to any but the simplest cases. In more complex situations, it really isn’t that much work to implement an alternative.<a id="idm441642629200" class="indexterm"></a></p>
        <p>On the iPhone, the main alternative is to navigate to a new screenful of interface. This might be by way of a navigation interface, or using a presented view (<a class="xref" href="ch19.html">Chapter 19</a>). For example, in the Zotz! app, in the Settings view, when the user taps a color, I summon a presented view, using a UIViewController subclass of my own, ColorPickerController (<a class="xref" href="ch26.html#FIGcolorPicker">Figure 26.5</a>).</p>
        <div class="figure">
          <a id="FIGcolorPicker"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2605.png" alt="figs/pios_2605.png" />
            </div>
          </div>
          <p class="title">Figure 26.5. A presented view functioning as a modal dialog</p>
        </div>
        <br class="figure-break" />
        <p>On the desktop, the color picker in <a class="xref" href="ch26.html#FIGcolorPicker">Figure 26.5</a> might be presented as a secondary window acting as a dialog. On the small iPhone screen, where there are no secondary windows, the presented view <span class="emphasis"><em>is</em></span> the equivalent of a dialog. Indeed, one might argue that the action sheet shown in <a class="xref" href="ch26.html#FIGsheet">Figure 26.2</a> is not a very appropriate use of an action sheet; it’s intrusive and has too many buttons. It might have been better if I’d designed my own presented view. I probably picked an action sheet because it required just a few lines of code; basically, I was being lazy.</p>
        <p>On the iPad, a popover is virtually a secondary window, and can be truly modal. An action sheet is usually presented as a popover, but it’s limited, and you don’t get access to the popover controller; in many cases, you’ll probably be better off designing your own view to be presented in a popover. The popovers in <a class="xref" href="ch22.html#FIGpops">Figure 22.1</a>, for example, are effectively modal dialogs. A popover can internally display a secondary presented view or even an action sheet, as we’ve already seen. Also on the iPad, a presented view can use the <code class="literal">UIModalPresentationFormSheet</code> presentation style, which is effectively a dialog window smaller than the screen.</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="_local_notifications"></a>Local Notifications</h2>
            </div>
          </div>
        </div>
        <p>A <span class="emphasis"><em>local notification</em></span> is an alert to the user that can appear even if your app is not running. In one of its manifestations, it appears as a dialog on top of whatever the user is doing at that moment, which is why it is treated in this chapter. (If a local notification from some other app were to appear as a dialog while <span class="emphasis"><em>your</em></span> app is frontmost, your app would become inactive; see <a class="xref" href="ch11.html">Chapter 11</a> and the <code class="literal">applicationWillResignActive:</code> app delegate message.)<a id="idm441642613792" class="indexterm"></a>
<a id="idm441642612480" class="indexterm"></a><a id="idm441642611568" class="indexterm"></a><a id="idm441642610656" class="indexterm"></a>
<a id="idm441642609360" class="indexterm"></a></p>
        <div class="note" style="margin-left: 0; margin-right: 10%;">
          <h3 class="title">Note</h3>
          <p>This use of the term <span class="emphasis"><em>notification</em></span> has nothing to do with NSNotification (<a class="xref" href="ch11.html">Chapter 11</a>). The ambiguity is unfortunate.</p>
        </div>
        <p>Your app does not present a local notification alert: indeed, your app <span class="emphasis"><em>can’t</em></span> present a local notification alert, because if your app’s local notification alert appears, your app <span class="emphasis"><em>ex hypothesi</em></span> isn’t frontmost. Rather, your app hands a local notification to the system along with instructions about when the local notification should <span class="emphasis"><em>fire</em></span>. When the specified time arrives, if your app isn’t frontmost, the system presents the notification on your behalf.</p>
        <p>The user has several choices as to how a notification from your app should be presented. These choices appear in the Settings app, under Notifications. There is a <a id="idm441642603648" class="indexterm"></a>Notification Center, which appears when the user swipes downward from the very top of the screen, and the user can enable or disable your app’s notifications appearing there. A notification from your app can also appear as an alert, as a temporary banner at the top of the screen, or not at all. The user can also prohibit your app’s alerts from appearing in the lock screen. It is thus perfectly possible for the user to suppress your app’s alerts altogether!</p>
        <p>No matter the interface whereby a notification presents itself, it generally provides some way for the user to summon your app in response. If the notification is a banner, the user can tap it. If the notification is an alert, the user can tap its action button. If the notification appears in the lock screen, the user can slide the slider at the bottom of the lock screen. If the user does any of these things, your app will be brought to the front, launching it if it isn’t already suspended in the background. Your app may need to be concerned with detecting that it has been brought to the front under these special circumstances, and I’ll talk in a moment about how it can do that.</p>
        <p>To create a local notification, you configure a <a id="idm441642599936" class="indexterm"></a>UILocalNotification object and hand it <span class="keep-together">to the</span> system with UIApplication’s <code class="literal">scheduleLocalNotification:</code>. The UILocalNotification object has properties as follows:</p>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
<code class="literal">alertBody</code>
</span>
            </dt>
            <dd>
The message displayed in the notification.
</dd>
            <dt>
              <span class="term">
<code class="literal">alertAction</code>
</span>
            </dt>
            <dd>
This matters only if your notification is displayed as an alert; in that case, this is the text of the action button. If you don’t set <code class="literal">alertAction</code>, the text of the action button will be “Launch.”
</dd>
          </dl>
        </div>
        <div class="note" style="margin-left: 0; margin-right: 10%;">
          <h3 class="title">Note</h3>
          <p>According to the documentation, you should be able to set <code class="literal">hasAction</code> to NO to suppress the action button altogether, but in my testing, doing so has no effect.</p>
        </div>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
<code class="literal">soundName</code>
</span>
            </dt>
            <dd>
The name of a sound file at the top level of your app bundle, to be played when the alert appears. This should be an uncompressed sound (AIFF or WAV). Alternatively, you can specify the default sound, <code class="literal">UILocalNotificationDefaultSoundName</code>. If you don’t set this property, there won’t be a sound. Regardless of the value you supply here, the user can prevent your app’s notifications from emitting a sound.
</dd>
            <dt>
              <span class="term">
<code class="literal">userInfo</code>
</span>
            </dt>
            <dd>
An optional NSDictionary whose contents are up to you. Your app can retrieve this dictionary later on, if it receives the notification after the notification fires (more about that in a moment).
</dd>
            <dt>
              <span class="term">
<code class="literal">fireDate</code>, <code class="literal">timeZone</code>
</span>
            </dt>
            <dd>
When you want the local notification to fire. The <code class="literal">fireDate</code> is an NSDate (see <a class="xref" href="ch10.html">Chapter 10</a> and <a class="xref" href="ch25.html">Chapter 25</a> for examples of date manipulation). If you don’t include a <code class="literal">timeZone</code>, the date is measured against universal time; if you <span class="emphasis"><em>do</em></span> include a <code class="literal">timeZone</code>, the date is measured against the user’s local time zone, even if that time zone changes (because the user travels, for instance).
</dd>
            <dt>
              <span class="term">
<code class="literal">repeatInterval</code>, <code class="literal">repeatCalendar</code>
</span>
            </dt>
            <dd>
If set, the local notification will recur.
</dd>
          </dl>
        </div>
        <p>As I’ve already mentioned, you hand a configured local notification to the system with UIApplication’s <code class="literal">scheduleLocalNotification:</code>. Additional UIApplication methods let you manipulate the list of local notifications you’ve already scheduled. You can cancel one or all scheduled local notifications (<code class="literal">cancelLocalNotification:</code>, <code class="literal">cancelAllLocalNotifications:</code>); you can also manipulate the list directly by setting UIApplication’s <code class="literal">scheduledLocalNotifications</code>, an NSArray property.</p>
        <p><a class="xref" href="ch26.html#FIGlocal">Figure 26.6</a> shows an alert generated by the firing of a local notification. Here’s a simple example of creating and scheduling the local notification that resulted in that alert:</p>
        <pre class="screen">UILocalNotification* ln = [UILocalNotification new];
ln.alertBody = @"Time for another cup of coffee!";
ln.fireDate = [NSDate dateWithTimeIntervalSinceNow:15];
ln.soundName = UILocalNotificationDefaultSoundName;
[[UIApplication sharedApplication] scheduleLocalNotification:ln];</pre>
        <div class="figure">
          <a id="FIGlocal"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2606.png" alt="figs/pios_2606.png" />
            </div>
          </div>
          <p class="title">Figure 26.6. An alert posted by the system when a local notification fires</p>
        </div>
        <br class="figure-break" />
        <p>Now let’s talk about what happens when one of your scheduled local notifications fires. There are three possibilities, depending on the state of your app at that moment:</p>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
Your app is suspended in the background
</span>
            </dt>
            <dd>
If the user summons your app from a notification, your app is brought to the front; your app delegate will then receive <code class="literal">application:didReceiveLocalNotification:</code>, where the second parameter is the UILocalNotification, and your application’s <code class="literal">applicationState</code> will be <code class="literal">UIApplicationStateInactive</code>.
</dd>
            <dt>
              <span class="term">
Your app is frontmost
</span>
            </dt>
            <dd>
The user won’t be informed by the system that the notification has fired (though the notification may be stored in the Notification Center). Your app delegate will receive <code class="literal">application:didReceiveLocalNotification:</code>, where the second parameter is the UILocalNotification, and your application’s <code class="literal">applicationState</code> will be <code class="literal">UIApplicationStateActive</code>. The idea is that if your app wants to let the user know that something special is happening, that’s your app’s business and it can do it in its own way.
</dd>
            <dt>
              <span class="term">
Your app isn’t running
</span>
            </dt>
            <dd>
If the user summons your app from a notification, your app is launched; your app delegate will then receive, <span class="emphasis"><em>not</em></span> <code class="literal">application:didReceiveLocalNotification:</code>, but rather <code class="literal">application:didFinishLaunchingWithOptions:</code> with an NSDictionary parameter that includes the <code class="literal">UIApplicationLaunchOptionsLocalNotificationKey</code>, whose value is the UILocalNotification.
</dd>
          </dl>
        </div>
        <p>Thus, you should implement <code class="literal">application:didReceiveLocalNotification:</code> to check the UIApplication’s <code class="literal">applicationState</code>, and you should implement <code class="literal">application:didFinishLaunchingWithOptions:</code> to check its second parameter to see whether we are launching in response to a local notification. In this way, you will be able to distinguish the three different possibilities, and you can respond appropriately.</p>
        <p>In the first and third cases (your app is suspended in the background, or your app isn’t running), you may want to show the user some interface appropriate to the local notification’s situation. For example, you might want to push a particular view controller onto your navigation interface or present a particular view controller’s view. However, when your app is launched from scratch, the first thing the user sees is its launch image (<a class="xref" href="ch09.html">Chapter 9</a>); and when your app is activated from a suspended state, the first thing the user sees is a screenshot image of your app, taken by the system when your app was suspended. Thus, there may be a mismatch between these images and the interface that you’re about to show the user in this special situation; if so, the user will see an odd flash as the image is removed to reveal your app’s actual interface. To prevent this flash, you can include in the original UILocalNotification an <code class="literal">alertLaunchImage</code> to be presented instead of these images. The idea is that this <code class="literal">alertLaunchImage</code> should be a better match for the interface the user will actually see.</p>
        <p>(When your app is launched from scratch by a local notification, if you intend to respond by showing some special interface appropriate to the notification, and if you’re using the built-in state saving and restoration mechanism discussed in <a class="xref" href="ch19.html">Chapter 19</a>, you’ll want to take steps to prevent inappropriate parts of the interface from being restored automatically in this special situation.)</p>
        <p>There is a fourth possibility for what happens when a local notification fires. Under some special circumstances (addressed, for example, in <a class="xref" href="ch27.html">Chapter 27</a> and <a class="xref" href="ch35.html">Chapter 35</a>), your app might be running, <span class="emphasis"><em>not</em></span> suspended, in the background. In this case, the situation is similar to what happens when your app <span class="emphasis"><em>is</em></span> suspended: the user may be notified, and can summon your app to the front. Your running-in-the-background app can even schedule a notification to fire immediately with the convenience method <code class="literal">presentLocalNotificationNow:</code>.</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="_activity_view"></a>Activity View</h2>
            </div>
          </div>
        </div>
        <p>An activity view is the view belonging to a <a id="idm441642538592" class="indexterm"></a>UIActivityViewController (new in iOS 6).<a id="idm441642537760" class="indexterm"></a>
<a id="idm441642536448" class="indexterm"></a><a id="idm441642535552" class="indexterm"></a>
<a id="idm441642534256" class="indexterm"></a> You start with one or more pieces of data, such as an NSString, that you want the user to have the option of sharing or working with in your app. The activity view contains an icon for every activity (UIActivity) that can work with this type of data. There are nine built-in activities, and your app can provide more. The user may tap an icon in the activity view, and is then perhaps shown additional interface, belonging to the provider of the chosen activity. For example, as I mentioned earlier, the Action button in Mobile Safari presents an activity view (<a class="xref" href="ch26.html#FIGactivityView">Figure 26.7</a>).</p>
        <div class="figure">
          <a id="FIGactivityView"></a>
          <div class="figure-contents">
            <div class="mediaobject">
              <img src="figs/pios_2607.png" alt="figs/pios_2607.png" />
            </div>
          </div>
          <p class="title">Figure 26.7. An activity view</p>
        </div>
        <br class="figure-break" />
        <div class="note" style="margin-left: 0; margin-right: 10%;">
          <h3 class="title">Note</h3>
          <p>Don’t confuse UIActivityViewController, UIActivity, UIActivity­I⁠temProvider, and UIActivityItemSource, on the one hand, with UIActivityIndicatorView (<a class="xref" href="ch25.html">Chapter 25</a>) on the other. The similarity of the names is unfortunate.</p>
        </div>
        <p>Presenting an activity view is easy. You instantiate UIActivityViewController by calling <code class="literal">initWithActivityItems:applicationActivities:</code>, where the first parameter is an NSArray of objects to be shared, such as NSString or UIImage objects. Presumably these are objects associated somehow with the interface the user is looking at right now. You set the controller’s <code class="literal">completionHandler</code> to a block that will be called when the user’s interaction with the activity interface ends. Then you present the controller, as a presented controller on the iPhone or as a popover on the iPad. So, for example, on the iPhone:</p>
        <pre class="screen">UIActivityViewController* avc =
    [[UIActivityViewController alloc] initWithActivityItems:@[myCoolString]
                                      applicationActivities:nil];
avc.completionHandler = ^(NSString *activityType, BOOL completed) {
    // ...
};
[self presentViewController:avc animated:YES completion:nil];</pre>
        <p>And on the iPad:</p>
        <pre class="screen">UIActivityViewController* avc =
    [[UIActivityViewController alloc] initWithActivityItems:@[myCoolString]
                                      applicationActivities:nil];
avc.completionHandler = ^(NSString *activityType, BOOL completed) {
    // ...
};
UIPopoverController* pop =
    [[UIPopoverController alloc] initWithContentViewController:avc];
self.currentPop = pop;
[pop presentPopoverFromBarButtonItem:sender
    permittedArrowDirections:UIPopoverArrowDirectionAny animated:YES];
pop.passthroughViews = nil;</pre>
        <p>There is no Cancel button in the popover presentation of the activity view; the user cancels by tapping outside the popover. If you set a delegate for the UIPopoverController, it will be sent <code class="literal">popoverControllerDidDismissPopover:</code> if the user cancels, but <span class="emphasis"><em>not</em></span> if the user proceeds to an activity (this feels like a bug).</p>
        <p>The activity view is populated automatically with known system-wide activities that can handle any of the types of data you provided as activity items. These activities represent UIActivity types, and are designated by constants:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" type="disc">
            <li class="listitem">
<code class="literal">UIActivityTypePostToFacebook</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypePostToTwitter</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypePostToWeibo</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypeMessage</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypeMail</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypePrint</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypeCopyToPasteboard</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypeAssignToContact</code>
</li>
            <li class="listitem">
<code class="literal">UIActivityTypeSaveToCameraRoll</code>
</li>
          </ul>
        </div>
        <p>Consult the UIActivity class documentation to learn what types of activity item each of these activities can handle. For example, the <code class="literal">UIActivityTypeMail</code> activity will accept an NSString, a UIImage, or a file on disk (such as an image file) designated by an NSURL; it will present a mail composition interface with the activity item in the body of the email.</p>
        <p>Since the default is to include all the system-wide activities that can handle the provided data, if you <span class="emphasis"><em>don’t</em></span> want a certain system-wide activity included in the activity view, you must exclude it explicitly. You do this by setting the UIActivityViewController’s <code class="literal">excludedActivityTypes</code> property to an NSArray of any or all of the activity type constants.</p>
        <p>The purpose of the <code class="literal">applicationActivities:</code> parameter of <code class="literal">initWithActivityItems:applicationActivities:</code> is for you to list any additional activities implemented by your own app, so that their icons will appear as choices in the activity view as well. Each activity will be an instance of one of your own UIActivity subclasses.</p>
        <p>To illustrate, I’ll create a minimal (and nonsensical) activity called Be Cool that accepts NSString activity items. It is a UIActivity subclass called MyCoolActivity. So, to include Be Cool among the choices presented to the user by a UIActivityViewController, I’d say:</p>
        <pre class="screen">UIActivityViewController* avc =
    [[UIActivityViewController alloc]
        initWithActivityItems:@[myCoolString]
        applicationActivities:@[[MyCoolActivity new]]];</pre>
        <p>Now let’s implement MyCoolActivity. It has an NSArray property called <code class="literal">items</code>, for reasons that will be apparent in a moment. We need to arm ourselves with an image to represent this activity in the activity view; this must be a transparency mask, meaning that colors will be ignored — all that matters is the transparency of the various parts of the image — and should be no larger than 43×43 (55×55 on iPad). It can be smaller, and it needn’t be square, as it will be centered in the activity icon automatically.</p>
        <p>Here’s the preparatory part of the implementation of MyCoolActivity:</p>
        <pre class="screen">-(NSString *)activityType {
    return @"com.neuburg.matt.coolActivity"; // make up your own unique string
}

-(NSString *)activityTitle {
    return @"Be Cool";
}

-(UIImage *)activityImage {
    return self.image; // prepared beforehand
}

-(BOOL)canPerformWithActivityItems:(NSArray *)activityItems {
    for (id obj in activityItems) {
        if ([obj isKindOfClass: [NSString class]])
            return YES;
    }
    return NO;
}

-(void)prepareWithActivityItems:(NSArray *)activityItems {
    self.items = activityItems;
}</pre>
        <p>None of these methods actually asks us to perform the activity in question; we haven’t yet reached that phase. If we return YES from <code class="literal">canPerformWithActivityItems:</code>, then an icon for this activity, labeled Be Cool and displaying our <code class="literal">activityImage</code>, will appear in the activity view. If the user taps our icon, <code class="literal">prepareWithActivityItems:</code> will be called. We retain the <code class="literal">activityItems</code> into a property, because they won’t be arriving again when we are actually told to perform the activity.</p>
        <p>To perform the activity, we implement one of two methods:</p>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
<code class="literal">performActivity</code>
</span>
            </dt>
            <dd>
We simply perform the activity directly, using the activity items we’ve already retained. If the activity is time-consuming, the activity should be performed on a background thread (<a class="xref" href="ch38.html">Chapter 38</a>) so that we can return immediately; the activity view interface will be taken down and the user will be able to go on interacting with the app.
</dd>
            <dt>
              <span class="term">
<code class="literal">activityViewController</code>
</span>
            </dt>
            <dd>
We have further interface that we’d like to show the user as part of the activity, so we return a UIViewController subclass. The activity view mechanism will present this UIViewController for us in place of the activity view; it is not our job to present or dismiss it. (We may, however, present or dismiss dependent interface. For example, if our UIViewController is a navigation controller with a custom root view controller, we might push another view controller onto its stack while the user is working on the activity.)
</dd>
          </dl>
        </div>
        <p>No matter which of these two methods we implement, we <span class="emphasis"><em>must</em></span> eventually call this activity instance’s <code class="literal">activityDidFinish:</code>. This is the signal to the activity view mechanism that the activity is over. If the activity view mechanism is still presenting any interface, it will be taken down, and the argument we supply here, a BOOL signifying whether the activity completed successfully, will be passed into the block we supplied earlier as the activity view controller’s <code class="literal">completionHandler</code>. So, for example:</p>
        <pre class="screen">-(void)performActivity {
    // ... do something with self.items here ...
    [self activityDidFinish:YES];
}</pre>
        <p>If you’re supplying your own view controller from <code class="literal">activityViewController</code>, you’ll want to hand it a reference to <code class="literal">self</code> before returning it, so that the view controller can call its <code class="literal">activityDidFinish:</code> when the time comes. For example, suppose our activity involves letting the user draw a mustache on a photo of someone. Our view controller will provide interface for doing that, including some way of letting the user signal completion, such as a Cancel button and a Done button. When the user taps either of those, we’ll do whatever else is necessary (such as saving the altered photo somewhere if the user tapped Done) and then call <code class="literal">activityDidFinish:</code>. Thus, we could implement <code class="literal">activityViewController</code> like this:</p>
        <pre class="screen">-(UIViewController *)activityViewController {
    MustacheViewController* mvc = [MustacheViewController new];
    mvc.activity = self;
    mvc.items = self.items;
    return mvc;
}</pre>
        <p>And then MustacheViewController would have code like this:</p>
        <pre class="screen">- (IBAction)doCancel:(id)sender {
    [self.activity activityDidFinish:NO];

}
- (IBAction)doDone:(id)sender {
    [self.activity activityDidFinish:YES];

}</pre>
        <p>Unfortunately, I haven’t been able to get <code class="literal">activityViewController</code> to work properly on the iPad; the view controller is presented fullscreen (contrary to the documentation) and is never dismissed, and logging proves that there are all kinds of memory management issues behind the scenes. This seems to be a major bug. However, it works fine on the iPhone.</p>
      </div>
    </div>
    <div class="navfooter">
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="ch25.html">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="pt05.html">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="pt06.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 25. Controls and Other Views </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Table of Contents</a>
          </td>
          <td width="40%" align="right" valign="top"> Part VI. Some Frameworks</td>
        </tr>
      </table>
    </div>
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org" />
<title>硬碟、檔案系統、Boot Loader</title>
<meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.79" />
<link rel="HOME" title="FreeBSD 4.X、5.X、6.X 常見問答集" href="index.html" />
<link rel="PREVIOUS" title="kernel 設定" href="kernelconfig.html" />
<link rel="NEXT" title="系統管理" href="admin.html" />
<link rel="STYLESHEET" type="text/css" href="docbook.css" />
<meta http-equiv="Content-Type" content="text/html; charset=Big5" />
</head>
<body class="CHAPTER" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084"
alink="#0000FF">
<div class="NAVHEADER">
<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">FreeBSD 4.X、5.X、6.X 常見問答集</th>
</tr>

<tr>
<td width="10%" align="left" valign="bottom"><a href="kernelconfig.html"
accesskey="P">Prev</a></td>
<td width="80%" align="center" valign="bottom"></td>
<td width="10%" align="right" valign="bottom"><a href="admin.html"
accesskey="N">Next</a></td>
</tr>
</table>

<hr align="LEFT" width="100%" />
</div>

<div class="CHAPTER">
<h1><a id="DISKS" name="DISKS"></a>Chapter 9 硬碟、檔案系統、Boot Loader</h1>

<div class="QANDASET">
<dl>
<dt>9.1. <a href="disks.html#ADDING-DISKS">如何在 FreeBSD 內把新硬碟掛上去用呢？</a></dt>

<dt>9.2. <a href="disks.html#NEW-HUGE-DISK">How do I move my system over to my huge new
disk?</a></dt>

<dt>9.3. <a href="disks.html#DANGEROUSLY-DEDICATED">Will a “dangerously dedicated” disk
endanger my health?</a></dt>

<dt>9.4. <a href="disks.html#SAFE-SOFTUPDATES">Which partitions can safely use Soft
Updates? I have heard that Soft Updates on <tt class="FILENAME">/</tt> can cause
problems.</a></dt>

<dt>9.5. <a href="disks.html#INAPPROPRIATE-CCD">What is inappropriate about my
ccd?</a></dt>

<dt>9.6. <a href="disks.html#CCD-DISKLABEL">Why can I not edit the disklabel on my
ccd?</a></dt>

<dt>9.7. <a href="disks.html#MOUNT-FOREIGN-FS">Can I mount other foreign filesystems
under FreeBSD?</a></dt>

<dt>9.8. <a href="disks.html#MOUNT-DOS">How do I mount a secondary DOS
partition?</a></dt>

<dt>9.9. <a href="disks.html#CRYPTO-FILESYSTEM">Is there a cryptographic filesystem for
FreeBSD?</a></dt>

<dt>9.10. <a href="disks.html#NT-BOOTLOADER">How can I use the <span
class="TRADEMARK">Windows&nbsp;NT</span> loader to boot FreeBSD?</a></dt>

<dt>9.11. <a href="disks.html#LILO-BOOTLOADER">How do I boot FreeBSD and <span
class="TRADEMARK">Linux</span> from LILO?</a></dt>

<dt>9.12. <a href="disks.html#BOOTEASY-LOADER">How do I boot FreeBSD and <span
class="TRADEMARK">Linux</span> using BootEasy?</a></dt>

<dt>9.13. <a href="disks.html#CHANGING-BOOTPROMPT">How do I change the boot prompt from
<tt class="LITERAL">???</tt> to something more meaningful?</a></dt>

<dt>9.14. <a href="disks.html#REMOVABLE-DRIVES">I have a new removable drive, how do I
use it?</a></dt>

<dt>9.15. <a href="disks.html#MOUNT-CD-SUPERBLOCK">Why do I get “<tt
class="ERRORNAME">Incorrect super block</tt>” when mounting a CDROM?</a></dt>

<dt>9.16. <a href="disks.html#CDROM-NOT-CONFIGURED">Why do I get “<tt
class="ERRORNAME">Device not configured</tt>” when mounting a CDROM?</a></dt>

<dt>9.17. <a href="disks.html#CDROM-UNICODE-FILENAMES">Why do all non-English characters
in filenames show up as “?” on my CDs when mounted in FreeBSD?</a></dt>

<dt>9.18. <a href="disks.html#BURNCD-ISOFS">I burned a CD under FreeBSD and now I can not
read it under any other operating system. Why?</a></dt>

<dt>9.19. <a href="disks.html#COPY-CD">How can I create an image of a data CD?</a></dt>

<dt>9.20. <a href="disks.html#MOUNT-AUDIO-CD">Why can I not <tt
class="COMMAND">mount</tt> an audio CD?</a></dt>

<dt>9.21. <a href="disks.html#MULTI-SESSION-CD">How do I <tt class="COMMAND">mount</tt> a
multi-session CD?</a></dt>

<dt>9.22. <a href="disks.html#USER-FLOPPYMOUNT">How do I let ordinary users mount
floppies, CDROMs and other removable media?</a></dt>

<dt>9.23. <a href="disks.html#DU-VS-DF">The <tt class="COMMAND">du</tt> and <tt
class="COMMAND">df</tt> commands show different amounts of disk space available. What is
going on?</a></dt>

<dt>9.24. <a href="disks.html#ADD-SWAP-SPACE">How can I add more swap space?</a></dt>

<dt>9.25. <a href="disks.html#MANUFACTURER-DISK-SIZE">Why does FreeBSD see my disk as
smaller than the manufacturer says it is?</a></dt>

<dt>9.26. <a href="disks.html#DISK-MORE-THAN-FULL">How is it possible for a partition to
be more than 100% full?</a></dt>
</dl>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="ADDING-DISKS" name="ADDING-DISKS"></a><b>9.1.</b> 如何在 FreeBSD
內把新硬碟掛上去用呢？</p>
</div>

<div class="ANSWER">
<p><b></b>請參閱 <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/articles/formatting-media/index.html"
target="_top">磁碟格式化教學</a>。</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="NEW-HUGE-DISK" name="NEW-HUGE-DISK"></a><b>9.2.</b> How do I move my system
over to my huge new disk?</p>
</div>

<div class="ANSWER">
<p><b></b>理想的方式是先在新硬碟上重裝好作業系統，然後把使用者相關程式、資料搬過去就好。
This is highly recommended if you have been tracking -STABLE for more than one release,
or have updated a release instead of installing a new one. You can install booteasy on
both disks with <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">boot0cfg</span>(8)</span></a>, and dual
boot them until you are happy with the new configuration. Skip the next paragraph to find
out how to move the data after doing this.</p>

<p>Should you decide not to do a fresh install, you need to partition and label the new
disk with either <tt class="FILENAME">/stand/sysinstall</tt>, or <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">fdisk</span>(8)</span></a> and <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=disklabel&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">disklabel</span>(8)</span></a>. You
should also install booteasy on both disks with <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">boot0cfg</span>(8)</span></a>, so that
you can dual boot to the old or new system after the copying is done. See the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/articles/formatting-media/index.html"
target="_top">formatting-media article</a> for details on this process.</p>

<p>Now you have the new disk set up, and are ready to move the data. Unfortunately, you
cannot just blindly copy the data. Things like device files (in <tt
class="FILENAME">/dev</tt>), flags, and links tend to screw that up. You need to use
tools that understand these things, which means <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a>. Although it
is suggested that you move the data in single user mode, it is not required.</p>

<p>You should never use anything but <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a> and <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">restore</span>(8)</span></a> to move the
root filesystem. The <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">tar</span>(1)</span></a> command may
work - then again, it may not. You should also use <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a> and <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">restore</span>(8)</span></a> if you are
moving a single partition to another empty partition. The sequence of steps to use dump
to move a partitions data to a new partition is:</p>

<div class="PROCEDURE">
<ol type="1">
<li class="STEP">
<p>newfs the new partition.</p>
</li>

<li class="STEP">
<p>mount it on a temporary mount point.</p>
</li>

<li class="STEP">
<p>cd to that directory.</p>
</li>

<li class="STEP">
<p>dump the old partition, piping output to the new one.</p>
</li>
</ol>
</div>

<p>For example, if you are going to move root to <tt class="DEVICENAME">/dev/ad1s1a</tt>,
with <tt class="FILENAME">/mnt</tt> as the temporary mount point, it is:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">newfs /dev/ad1s1a</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount /dev/ad1s1a /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">dump 0af - / | restore xf -</kbd>
</pre>

<p>Rearranging your partitions with dump takes a bit more work. To merge a partition like
<tt class="FILENAME">/var</tt> into its parent, create the new partition large enough for
both, move the parent partition as described above, then move the child partition into
the empty directory that the first move created:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">newfs /dev/ad1s1a</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount /dev/ad1s1a /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">dump 0af - / | restore xf -</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd var</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">dump 0af - /var | restore xf -</kbd>
</pre>

<p>To split a directory from its parent, say putting <tt class="FILENAME">/var</tt> on
its own partition when it was not before, create both partitions, then mount the child
partition on the appropriate directory in the temporary mount point, then move the old
single partition:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">newfs /dev/ad1s1a</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">newfs /dev/ad1s1d</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount /dev/ad1s1a /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mkdir /mnt/var</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount /dev/ad1s1d /mnt/var</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /mnt</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">dump 0af - / | restore xf -</kbd>
</pre>

<p>You might prefer <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">cpio</span>(1)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">pax</span>(1)</span></a>, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">tar</span>(1)</span></a> to <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a> for user data.
At the time of this writing, these are known to lose file flag information, so use them
with caution.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="DANGEROUSLY-DEDICATED" name="DANGEROUSLY-DEDICATED"></a><b>9.3.</b> Will a
“dangerously dedicated” disk endanger my health?</p>
</div>

<div class="ANSWER">
<p><b></b><a id="DEDICATE" name="DEDICATE"></a>The installation procedure allows you to
chose two different methods in partitioning your hard disk(s). The default way makes it
compatible with other operating systems on the same machine, by using fdisk table entries
(called “slices” in FreeBSD), with a FreeBSD slice that employs partitions of its own.
Optionally, one can chose to install a boot-selector to switch between the possible
operating systems on the disk(s). The alternative uses the entire disk for FreeBSD, and
makes no attempt to be compatible with other operating systems.</p>

<p>So why it is called “dangerous”? A disk in this mode does not contain what normal PC
utilities would consider a valid fdisk table. Depending on how well they have been
designed, they might complain at you once they are getting in contact with such a disk,
or even worse, they might damage the BSD bootstrap without even asking or notifying you.
In addition, the “dangerously dedicated” disk's layout is known to confuse many BIOSes,
including those from AWARD (e.g. as found in HP Netserver and Micronics systems as well
as many others) and Symbios/NCR (for the popular 53C8xx range of SCSI controllers). This
is not a complete list, there are more. Symptoms of this confusion include the “<tt
class="ERRORNAME">read error</tt>” message printed by the FreeBSD bootstrap when it
cannot find itself, as well as system lockups when booting.</p>

<p>Why have this mode at all then? It only saves a few kbytes of disk space, and it can
cause real problems for a new installation. “Dangerously dedicated” mode's origins lie
in a desire to avoid one of the most common problems plaguing new FreeBSD installers -
matching the BIOS “geometry” numbers for a disk to the disk itself.</p>

<p>“Geometry” is an outdated concept, but one still at the heart of the PC's BIOS and
its interaction with disks. When the FreeBSD installer creates slices, it has to record
the location of these slices on the disk in a fashion that corresponds with the way the
BIOS expects to find them. If it gets it wrong, you will not be able to boot.</p>

<p>“Dangerously dedicated” mode tries to work around this by making the problem
simpler. In some cases, it gets it right. But it is meant to be used as a last-ditch
alternative - there are better ways to solve the problem 99 times out of 100.</p>

<p>So, how do you avoid the need for “DD” mode when you are installing? Start by making
a note of the geometry that your BIOS claims to be using for your disks. You can arrange
to have the kernel print this as it boots by specifying <code class="OPTION">-v</code> at
the <tt class="LITERAL">boot:</tt> prompt, or using <tt class="COMMAND">boot -v</tt> in
the loader. Just before the installer starts, the kernel will print a list of BIOS
geometries. Do not panic - wait for the installer to start and then use scrollback to
read the numbers. Typically the BIOS disk units will be in the same order that FreeBSD
lists your disks, first IDE, then SCSI.</p>

<p>When you are slicing up your disk, check that the disk geometry displayed in the FDISK
screen is correct (ie. it matches the BIOS numbers); if it is wrong, use the <b
class="KEYCAP">g</b> key to fix it. You may have to do this if there is absolutely
nothing on the disk, or if the disk has been moved from another system. Note that this is
only an issue with the disk that you are going to boot from; FreeBSD will sort itself out
just fine with any other disks you may have.</p>

<p>Once you have got the BIOS and FreeBSD agreeing about the geometry of the disk, your
problems are almost guaranteed to be over, and with no need for “DD” mode at all. If,
however, you are still greeted with the dreaded “<tt class="ERRORNAME">read error</tt>”
message when you try to boot, it is time to cross your fingers and go for it - there is
nothing left to lose.</p>

<p>To return a “dangerously dedicated” disk for normal PC use, there are basically two
options. The first is, you write enough NULL bytes over the MBR to make any subsequent
installation believe this to be a blank disk. You can do this for example with</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">dd if=/dev/zero of=/dev/rda0 count=15</kbd>
</pre>

<p>Alternatively, the undocumented DOS “feature”</p>

<pre class="SCREEN">
<samp class="PROMPT">C:\&gt;</samp> <kbd class="USERINPUT">fdisk /mbr</kbd>
</pre>

<p>will to install a new master boot record as well, thus clobbering the BSD
bootstrap.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="SAFE-SOFTUPDATES" name="SAFE-SOFTUPDATES"></a><b>9.4.</b> Which partitions can
safely use Soft Updates? I have heard that Soft Updates on <tt class="FILENAME">/</tt>
can cause problems.</p>
</div>

<div class="ANSWER">
<p><b></b>Short answer: you can usually use Soft Updates safely on all partitions.</p>

<p>Long answer: There used to be some concern over using Soft Updates on the root
partition. Soft Updates has two characteristics that caused this. First, a Soft Updates
partition has a small chance of losing data during a system crash. (The partition will
not be corrupted; the data will simply be lost.) Also, Soft Updates can cause temporary
space shortages.</p>

<p>When using Soft Updates, the kernel can take up to thirty seconds to actually write
changes to the physical disk. If you delete a large file, the file still resides on disk
until the kernel actually performs the deletion. This can cause a very simple race
condition. Suppose you delete one large file and immediately create another large file.
The first large file is not yet actually removed from the physical disk, so the disk
might not have enough room for the second large file. You get an error that the partition
does not have enough space, although you know perfectly well that you just released a
large chunk of space! When you try again mere seconds later, the file creation works as
you expect. This has left more than one user scratching his head and doubting his sanity,
the FreeBSD filesystem, or both.</p>

<p>If a system should crash after the kernel accepts a chunk of data for writing to disk,
but before that data is actually written out, data could be lost or corrupted. This risk
is extremely small, but generally manageable. Use of IDE write caching greatly increases
this risk; it is strongly recommended that you disable IDE write caching when using Soft
Updates.</p>

<p>These issues affect all partitions using Soft Updates. So, what does this mean for the
root partition?</p>

<p>Vital information on the root partition changes very rarely. Files such as <tt
class="FILENAME">/kernel</tt> and the contents of <tt class="FILENAME">/etc</tt> only
change during system maintenance, or when users change their passwords. If the system
crashed during the thirty-second window after such a change is made, it is possible that
data could be lost. This risk is negligible for most applications, but you should be
aware that it exists. If your system cannot tolerate this much risk, do not use Soft
Updates on the root filesystem!</p>

<p><tt class="FILENAME">/</tt> is traditionally one of the smallest partitions. By
default, FreeBSD puts the <tt class="FILENAME">/tmp</tt> directory on <tt
class="FILENAME">/</tt>. If you have a busy <tt class="FILENAME">/tmp</tt>, you might see
intermittent space problems. Symlinking <tt class="FILENAME">/tmp</tt> to <tt
class="FILENAME">/var/tmp</tt> will solve this problem.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="INAPPROPRIATE-CCD" name="INAPPROPRIATE-CCD"></a><b>9.5.</b> What is
inappropriate about my ccd?</p>
</div>

<div class="ANSWER">
<p><b></b>The symptom of this is:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">ccdconfig -C</kbd>
ccdconfig: ioctl (CCDIOCSET): /dev/ccd0c: Inappropriate file type or format
</pre>

<p>This usually happens when you are trying to concatenate the <tt class="LITERAL">c</tt>
partitions, which default to type <tt class="LITERAL">unused</tt>. The ccd driver
requires the underlying partition type to be FS_BSDFFS. Edit the disklabel of the disks
you are trying to concatenate and change the types of partitions to <tt
class="LITERAL">4.2BSD</tt>.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="CCD-DISKLABEL" name="CCD-DISKLABEL"></a><b>9.6.</b> Why can I not edit the
disklabel on my ccd?</p>
</div>

<div class="ANSWER">
<p><b></b>The symptom of this is:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">disklabel ccd0</kbd>
(it prints something sensible here, so let us try to edit it)
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">disklabel -e ccd0</kbd>
(edit, save, quit)
disklabel: ioctl DIOCWDINFO: No disk label on disk;
use "disklabel -r" to install initial label
</pre>

<p>This is because the disklabel returned by ccd is actually a “fake” one that is not
really on the disk. You can solve this problem by writing it back explicitly, as in:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">disklabel ccd0 &gt; /tmp/disklabel.tmp</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">disklabel -Rr ccd0 /tmp/disklabel.tmp</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">disklabel -e ccd0</kbd>
(this will work now)
</pre>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MOUNT-FOREIGN-FS" name="MOUNT-FOREIGN-FS"></a><b>9.7.</b> Can I mount other
foreign filesystems under FreeBSD?</p>
</div>

<div class="ANSWER">
<p><b></b>FreeBSD supports a variety of other filesystems.</p>

<div class="VARIABLELIST">
<dl>
<dt>Digital UNIX</dt>

<dd>
<p>UFS CDROMs can be mounted directly on FreeBSD. Mounting disk partitions from Digital
UNIX and other systems that support UFS may be more complex, depending on the details of
the disk partitioning for the operating system in question.</p>
</dd>

<dt><span class="TRADEMARK">Linux</span>&reg;</dt>

<dd>
<p>FreeBSD supports <tt class="LITERAL">ext2fs</tt> partitions. See <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_ext2fs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_ext2fs</span>(8)</span></a> for
more information.</p>
</dd>

<dt><span class="TRADEMARK">Windows&nbsp;NT</span>&reg;</dt>

<dd>
<p>FreeBSD includes a read-only NTFS driver. For more information, see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_ntfs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_ntfs</span>(8)</span></a>.</p>
</dd>

<dt>FAT</dt>

<dd>
<p>FreeBSD includes a read-write FAT driver. For more information, see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_msdosfs</span>(8)</span></a>.</p>
</dd>
</dl>
</div>

<p>FreeBSD also supports network filesystems such as NFS (see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_nfs</span>(8)</span></a>), NetWare
(see <a href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nwfs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_nwfs</span>(8)</span></a>), and
Microsoft-style SMB filesystems (see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_smbfs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_smbfs</span>(8)</span></a>).</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MOUNT-DOS" name="MOUNT-DOS"></a><b>9.8.</b> How do I mount a secondary DOS
partition?</p>
</div>

<div class="ANSWER">
<p><b></b>The secondary DOS partitions are found after ALL the primary partitions. For
example, if you have an “E” partition as the second DOS partition on the second SCSI
drive, you need to create the special files for “slice 5” in <tt
class="FILENAME">/dev</tt>, then mount <tt class="DEVICENAME">/dev/da1s5</tt>:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /dev</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">sh MAKEDEV da1s5</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">mount -t msdos /dev/da1s5 /dos/e</kbd>
</pre>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> You can omit this step if you are running FreeBSD 5.0-RELEASE or newer
with <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;manpath=FreeBSD+6-current">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">devfs</span>(5)</span></a>
enabled.</p>
</blockquote>
</div>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="CRYPTO-FILESYSTEM" name="CRYPTO-FILESYSTEM"></a><b>9.9.</b> Is there a
cryptographic filesystem for FreeBSD?</p>
</div>

<div class="ANSWER">
<p><b></b>Yes. If you are running FreeBSD 5.0 or later, see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">gbde</span>(8)</span></a>. For earlier
releases, see the <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/security/cfs/pkg-descr"><tt
class="FILENAME">security/cfs</tt></a> port.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="NT-BOOTLOADER" name="NT-BOOTLOADER"></a><b>9.10.</b> How can I use the <span
class="TRADEMARK">Windows&nbsp;NT</span> loader to boot FreeBSD?</p>
</div>

<div class="ANSWER">
<p><b></b>The general idea is that you copy the first sector of your native root FreeBSD
partition into a file in the DOS/<span class="TRADEMARK">Windows&nbsp;NT</span>
partition. Assuming you name that file something like <tt
class="FILENAME">c:\bootsect.bsd</tt> (inspired by <tt
class="FILENAME">c:\bootsect.dos</tt>), you can then edit the <tt
class="FILENAME">c:\boot.ini</tt> file to come up with something like this:</p>

<pre class="PROGRAMLISTING">
[boot loader]
timeout=30
default=multi(0)disk(0)rdisk(0)partition(1)\WINDOWS
[operating systems]
multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Windows NT"
C:\BOOTSECT.BSD="FreeBSD"
C:\="DOS"
</pre>

<p>If FreeBSD is installed on the same disk as the <span
class="TRADEMARK">Windows&nbsp;NT</span> boot partition simply copy <tt
class="FILENAME">/boot/boot1</tt> to <tt class="FILENAME">C:\BOOTSECT.BSD</tt>. However,
if FreeBSD is installed on a different disk <tt class="FILENAME">/boot/boot1</tt> will
not work, <tt class="FILENAME">/boot/boot0</tt> is needed.</p>

<p><tt class="FILENAME">/boot/boot0</tt> needs to be installed using sysinstall by
selecting the FreeBSD boot manager on the screen which asks if you wish to use a boot
manager. This is because <tt class="FILENAME">/boot/boot0</tt> has the partition table
area filled with NULL characters but sysinstall copies the partition table before copying
<tt class="FILENAME">/boot/boot0</tt> to the MBR.</p>

<div class="WARNING">
<blockquote class="WARNING">
<p><b>Warning:</b> <span class="emphasis"><i class="EMPHASIS">Do not simply copy <tt
class="FILENAME">/boot/boot0</tt> instead of <tt class="FILENAME">/boot/boot1</tt>; you
will overwrite your partition table and render your computer un-bootable!</i></span></p>
</blockquote>
</div>

<p>When the FreeBSD boot manager runs it records the last OS booted by setting the active
flag on the partition table entry for that OS and then writes the whole 512-bytes of
itself back to the MBR so if you just copy <tt class="FILENAME">/boot/boot0</tt> to <tt
class="FILENAME">C:\BOOTSECT.BSD</tt> then it writes an empty partition table, with the
active flag set on one entry, to the MBR.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="LILO-BOOTLOADER" name="LILO-BOOTLOADER"></a><b>9.11.</b> How do I boot FreeBSD
and <span class="TRADEMARK">Linux</span> from LILO?</p>
</div>

<div class="ANSWER">
<p><b></b>If you have FreeBSD and <span class="TRADEMARK">Linux</span> on the same disk,
just follow LILO's installation instructions for booting a non-<span
class="TRADEMARK">Linux</span> operating system. Very briefly, these are:</p>

<p>Boot <span class="TRADEMARK">Linux</span>, and add the following lines to <tt
class="FILENAME">/etc/lilo.conf</tt>:</p>

<pre class="PROGRAMLISTING">
other=/dev/hda2
        table=/dev/hda
        label=FreeBSD
</pre>

<p>(the above assumes that your FreeBSD slice is known to <span
class="TRADEMARK">Linux</span> as <tt class="DEVICENAME">/dev/hda2</tt>; tailor to suit
your setup). Then, run <tt class="COMMAND">lilo</tt> as <tt class="USERNAME">root</tt>
and you should be done.</p>

<p>If FreeBSD resides on another disk, you need to add <tt
class="LITERAL">loader=/boot/chain.b</tt> to the LILO entry. For example:</p>

<pre class="PROGRAMLISTING">
other=/dev/dab4
        table=/dev/dab
        loader=/boot/chain.b
        label=FreeBSD
</pre>

<p>In some cases you may need to specify the BIOS drive number to the FreeBSD boot loader
to successfully boot off the second disk. For example, if your FreeBSD SCSI disk is
probed by BIOS as BIOS disk 1, at the FreeBSD boot loader prompt you need to specify:</p>

<pre class="SCREEN">
Boot: <kbd class="USERINPUT">1:da(0,a)/kernel</kbd>
</pre>

<p>On FreeBSD 2.2.5 and later, you can configure <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">boot</span>(8)</span></a> to
automatically do this for you at boot time.</p>

<p>The <a href="http://sunsite.unc.edu/LDP/HOWTO/mini/Linux+FreeBSD.html"
target="_top"><span class="TRADEMARK">Linux</span>+FreeBSD mini-HOWTO</a> is a good
reference for FreeBSD and <span class="TRADEMARK">Linux</span> interoperability
issues.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="BOOTEASY-LOADER" name="BOOTEASY-LOADER"></a><b>9.12.</b> How do I boot FreeBSD
and <span class="TRADEMARK">Linux</span> using BootEasy?</p>
</div>

<div class="ANSWER">
<p><b></b>Install LILO at the start of your <span class="TRADEMARK">Linux</span> boot
partition instead of in the Master Boot Record. You can then boot LILO from BootEasy.</p>

<p>If you are running <span class="TRADEMARK">Windows</span>&reg; 95 and <span
class="TRADEMARK">Linux</span> this is recommended anyway, to make it simpler to get
<span class="TRADEMARK">Linux</span> booting again if you should need to reinstall <span
class="TRADEMARK">Windows</span> 95 (which is a Jealous Operating System, and will bear
no other Operating Systems in the Master Boot Record).</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="CHANGING-BOOTPROMPT" name="CHANGING-BOOTPROMPT"></a><b>9.13.</b> How do I
change the boot prompt from <tt class="LITERAL">???</tt> to something more
meaningful?</p>
</div>

<div class="ANSWER">
<p><b></b>You can not do that with the standard boot manager without rewriting it. There
are a number of other boot managers in the <tt class="FILENAME">sysutils</tt> ports
category that provide this functionality.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="REMOVABLE-DRIVES" name="REMOVABLE-DRIVES"></a><b>9.14.</b> I have a new
removable drive, how do I use it?</p>
</div>

<div class="ANSWER">
<p><b></b>Whether it is a removable drive like a <span class="TRADEMARK">Zip</span>&reg;
or an EZ drive (or even a floppy, if you want to use it that way), or a new hard disk,
once it is installed and recognized by the system, and you have your
cartridge/floppy/whatever slotted in, things are pretty much the same for all
devices.</p>

<p>(this section is based on <a href="http://www.vmunix.com/mark/FreeBSD/ZIP-FAQ.html"
target="_top">Mark Mayo's ZIP FAQ</a>)</p>

<p>If it is a ZIP drive or a floppy, you have already got a DOS filesystem on it, you can
use a command like this:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">mount -t msdos /dev/fd0c /floppy</kbd>
</pre>

<p>if it is a floppy, or this:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount -t msdos /dev/da2s4 /zip</kbd>
</pre>

<p>for a ZIP disk with the factory configuration.</p>

<p>For other disks, see how they are laid out using <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">fdisk</span>(8)</span></a> or <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">sysinstall</span>(8)</span></a>.</p>

<p>The rest of the examples will be for a ZIP drive on da2, the third SCSI disk.</p>

<p>Unless it is a floppy, or a removable you plan on sharing with other people, it is
probably a better idea to stick a BSD filesystem on it. You will get long filename
support, at least a 2X improvement in performance, and a lot more stability. First, you
need to redo the DOS-level partitions/filesystems. You can either use <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">fdisk</span>(8)</span></a> or <tt
class="FILENAME">/stand/sysinstall</tt>, or for a small drive that you do not want to
bother with multiple operating system support on, just blow away the whole FAT partition
table (slices) and just use the BSD partitioning:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">dd if=/dev/zero of=/dev/rda2 count=2</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">disklabel -Brw da2 auto</kbd>
</pre>

<p>You can use disklabel or <tt class="FILENAME">/stand/sysinstall</tt> to create
multiple BSD partitions. You will certainly want to do this if you are adding swap space
on a fixed disk, but it is probably irrelevant on a removable drive like a ZIP.</p>

<p>Finally, create a new filesystem, this one is on our ZIP drive using the whole
disk:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">newfs /dev/rda2c</kbd>
</pre>

<p>and mount it:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount /dev/da2c /zip</kbd>
</pre>

<p>and it is probably a good idea to add a line like this to <tt
class="FILENAME">/etc/fstab</tt> (see <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">fstab</span>(5)</span></a>) so you can
just type <tt class="COMMAND">mount /zip</tt> in the future:</p>

<pre class="PROGRAMLISTING">
/dev/da2c /zip ffs rw,noauto 0 0
</pre>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MOUNT-CD-SUPERBLOCK" name="MOUNT-CD-SUPERBLOCK"></a><b>9.15.</b> Why do I get
“<tt class="ERRORNAME">Incorrect super block</tt>” when mounting a CDROM?</p>
</div>

<div class="ANSWER">
<p><b></b>You have to tell <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount</span>(8)</span></a> the type of
the device that you want to mount. This is described in the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html"
target="_top">Handbook section on optical media</a>, specifically the section <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html#MOUNTING-CD"
target="_top">Using Data CDs</a>.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="CDROM-NOT-CONFIGURED" name="CDROM-NOT-CONFIGURED"></a><b>9.16.</b> Why do I get
“<tt class="ERRORNAME">Device not configured</tt>” when mounting a CDROM?</p>
</div>

<div class="ANSWER">
<p><b></b>This generally means that there is no CDROM in the CDROM drive, or the drive is
not visible on the bus. Please see the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html#MOUNTING-CD"
target="_top">Using Data CDs</a> section of the Handbook for a detailed discussion of
this issue.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="CDROM-UNICODE-FILENAMES" name="CDROM-UNICODE-FILENAMES"></a><b>9.17.</b> Why do
all non-English characters in filenames show up as “?” on my CDs when mounted in
FreeBSD?</p>
</div>

<div class="ANSWER">
<p><b></b>Your CDROM probably uses the “Joliet” extension for storing information about
files and directories. This is discussed in the Handbook chapter on <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html"
target="_top">creating and using CDROMs</a>, specifically the section on <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html#MOUNTING-CD"
target="_top">Using Data CDROMs</a>.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="BURNCD-ISOFS" name="BURNCD-ISOFS"></a><b>9.18.</b> I burned a CD under FreeBSD
and now I can not read it under any other operating system. Why?</p>
</div>

<div class="ANSWER">
<p><b></b>You most likely burned a raw file to your CD, rather than creating an ISO 9660
filesystem. Take a look at the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html"
target="_top">Handbook chapter on creating CDROMs</a>, particularly the section on <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html#RAWDATA-CD"
target="_top">burning raw data CDs</a>.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="COPY-CD" name="COPY-CD"></a><b>9.19.</b> How can I create an image of a data
CD?</p>
</div>

<div class="ANSWER">
<p><b></b>This is discussed in the Handbook section on <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html#IMAGING-CD"
target="_top">duplicating data CDs</a>. For more on working with CDROMs, see the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/creating-cds.html"
target="_top">Creating CDs Section</a> in the Storage chapter in the Handbook.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MOUNT-AUDIO-CD" name="MOUNT-AUDIO-CD"></a><b>9.20.</b> Why can I not <tt
class="COMMAND">mount</tt> an audio CD?</p>
</div>

<div class="ANSWER">
<p><b></b>If you try to mount an audio CD, you will get an error like “<tt
class="ERRORNAME">cd9660: /dev/acd0c: Invalid argument</tt>”. This is because <tt
class="COMMAND">mount</tt> only works on filesystems. Audio CDs do not have filesystems;
they just have data. You need a program that reads audio CDs, such as the <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/audio/xmcd/pkg-descr"><tt
class="FILENAME">audio/xmcd</tt></a> port.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MULTI-SESSION-CD" name="MULTI-SESSION-CD"></a><b>9.21.</b> How do I <tt
class="COMMAND">mount</tt> a multi-session CD?</p>
</div>

<div class="ANSWER">
<p><b></b>By default, <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount</span>(8)</span></a> will attempt
to mount the last data track (session) of a CD. If you would like to load an earlier
session, you must use the <code class="OPTION">-s</code> command line argument. Please
see <a href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">mount_cd9660</span>(8)</span></a> for
specific examples.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="USER-FLOPPYMOUNT" name="USER-FLOPPYMOUNT"></a><b>9.22.</b> How do I let
ordinary users mount floppies, CDROMs and other removable media?</p>
</div>

<div class="ANSWER">
<p><b></b>Ordinary users can be permitted to mount devices. Here is how:</p>

<div class="PROCEDURE">
<ol type="1">
<li class="STEP">
<p>As <tt class="USERNAME">root</tt> set the sysctl variable <code
class="VARNAME">vfs.usermount</code> to <tt class="LITERAL">1</tt>.</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">sysctl -w vfs.usermount=1</kbd>
</pre>
</li>

<li class="STEP">
<p>As <tt class="USERNAME">root</tt> assign the appropriate permissions to the block
device associated with the removable media.</p>

<p>For example, to allow users to mount the first floppy drive, use:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">chmod 666 /dev/fd0</kbd>
</pre>

<p>To allow users in the group <tt class="GROUPNAME">operator</tt> to mount the CDROM
drive, use:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">chgrp operator /dev/acd0c</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">chmod 640 /dev/acd0c</kbd>
</pre>
</li>

<li class="STEP">
<p>If you are running FreeBSD 5.X or later, you will need to alter <tt
class="FILENAME">/etc/devfs.conf</tt> to make these changes permanent across reboots.</p>

<p>As <tt class="USERNAME">root</tt>, add the necessary lines to <tt
class="FILENAME">/etc/devfs.conf</tt>. For example, to allow users to mount the first
floppy drive add:</p>

<pre class="PROGRAMLISTING">
# Allow all users to mount the floppy disk.
own       /dev/fd0    root:operator
perm      /dev/fd0    0666
</pre>

<p>To allow users in the group <tt class="GROUPNAME">operator</tt> to mount the CD-ROM
drive add:</p>

<pre class="PROGRAMLISTING">
# Allow members of the group operator to mount CD-ROMs.
own       /dev/acd0   root:operator
perm      /dev/acd0   0660
</pre>
</li>

<li class="STEP">
<p>Finally, add the line <tt class="LITERAL"><code
class="VARNAME">vfs.usermount</code>=1</tt> to the file <tt
class="FILENAME">/etc/sysctl.conf</tt> so that it is reset at system boot time.</p>
</li>
</ol>
</div>

<p>All users can now mount the floppy <tt class="DEVICENAME">/dev/fd0</tt> onto a
directory that they own:</p>

<pre class="SCREEN">
<samp class="PROMPT">%</samp> <kbd class="USERINPUT">mkdir ~/my-mount-point</kbd>
<samp class="PROMPT">%</samp> <kbd
class="USERINPUT">mount -t msdos /dev/fd0 ~/my-mount-point</kbd>
</pre>

<p>Users in group <tt class="GROUPNAME">operator</tt> can now mount the CDROM <tt
class="DEVICENAME">/dev/acd0c</tt> onto a directory that they own:</p>

<pre class="SCREEN">
<samp class="PROMPT">%</samp> <kbd class="USERINPUT">mkdir ~/my-mount-point</kbd>
<samp class="PROMPT">%</samp> <kbd
class="USERINPUT">mount -t cd9660 /dev/acd0c ~/my-mount-point</kbd>
</pre>

<p>Unmounting the device is simple:</p>

<pre class="SCREEN">
<samp class="PROMPT">%</samp> <kbd class="USERINPUT">umount ~/my-mount-point</kbd>
</pre>

<p>Enabling <code class="VARNAME">vfs.usermount</code>, however, has negative security
implications. A better way to access <span class="TRADEMARK">MS-DOS</span>&reg; formatted
media is to use the <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/emulators/mtools/pkg-descr"><tt
class="FILENAME">emulators/mtools</tt></a> package in the ports collection.</p>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Note:</b> The device name used in the previous examples must be changed according
to your configuration.</p>
</blockquote>
</div>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="DU-VS-DF" name="DU-VS-DF"></a><b>9.23.</b> The <tt class="COMMAND">du</tt> and
<tt class="COMMAND">df</tt> commands show different amounts of disk space available. What
is going on?</p>
</div>

<div class="ANSWER">
<p><b></b>You need to understand what <tt class="COMMAND">du</tt> and <tt
class="COMMAND">df</tt> really do. <tt class="COMMAND">du</tt> goes through the directory
tree, measures how large each file is, and presents the totals. <tt
class="COMMAND">df</tt> just asks the filesystem how much space it has left. They seem to
be the same thing, but a file without a directory entry will affect <tt
class="COMMAND">df</tt> but not <tt class="COMMAND">du</tt>.</p>

<p>When a program is using a file, and you delete the file, the file is not really
removed from the filesystem until the program stops using it. The file is immediately
deleted from the directory listing, however. You can see this easily enough with a
program such as <tt class="COMMAND">more</tt>. Assume you have a file large enough that
its presence affects the output of <tt class="COMMAND">du</tt> and <tt
class="COMMAND">df</tt>. (Since disks can be so large today, this might be a <span
class="emphasis"><i class="EMPHASIS">very</i></span> large file!) If you delete this file
while using <tt class="COMMAND">more</tt> on it, <tt class="COMMAND">more</tt> does not
immediately choke and complain that it cannot view the file. The entry is simply removed
from the directory so no other program or user can access it. <tt class="COMMAND">du</tt>
shows that it is gone -- it has walked the directory tree and the file is not listed. <tt
class="COMMAND">df</tt> shows that it is still there, as the filesystem knows that <tt
class="COMMAND">more</tt> is still using that space. Once you end the <tt
class="COMMAND">more</tt> session, <tt class="COMMAND">du</tt> and <tt
class="COMMAND">df</tt> will agree.</p>

<p>Note that Soft Updates can delay the freeing of disk space; you might need to wait up
to 30 seconds for the change to be visible!</p>

<p>This situation is common on web servers. Many people set up a FreeBSD web server and
forget to rotate the log files. The access log fills up <tt class="FILENAME">/var</tt>.
The new administrator deletes the file, but the system still complains that the partition
is full. Stopping and restarting the web server program would free the file, allowing the
system to release the disk space. To prevent this from happening, set up <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">newsyslog</span>(8)</span></a>.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="ADD-SWAP-SPACE" name="ADD-SWAP-SPACE"></a><b>9.24.</b> How can I add more swap
space?</p>
</div>

<div class="ANSWER">
<p><b></b>In the <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/config-tuning.html"
target="_top">Configuration and Tuning</a> section of the Handbook, you will find a <a
href="http://www.FreeBSD.org/doc/zh_TW.Big5/books/handbook/adding-swap-space.html"
target="_top">section</a> describing how to do this.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="MANUFACTURER-DISK-SIZE" name="MANUFACTURER-DISK-SIZE"></a><b>9.25.</b> Why does
FreeBSD see my disk as smaller than the manufacturer says it is?</p>
</div>

<div class="ANSWER">
<p><b></b>Disk manufacturers calculate gigabytes as a billion bytes each, whereas FreeBSD
calculates them as 1,073,741,824 bytes each. This explains why, for example, FreeBSD's
boot messages will report a disk that supposedly has 80GB as holding 76319MB.</p>

<p>Also note that FreeBSD will (by default) <a
href="disks.html#DISK-MORE-THAN-FULL">reserve</a> 8% of the disk space.</p>
</div>
</div>

<div class="QANDAENTRY">
<div class="QUESTION">
<p><a id="DISK-MORE-THAN-FULL" name="DISK-MORE-THAN-FULL"></a><b>9.26.</b> How is it
possible for a partition to be more than 100% full?</p>
</div>

<div class="ANSWER">
<p><b></b>A portion of each UFS partition (8%, by default) is reserved for use by the
operating system and the <tt class="USERNAME">root</tt> user. <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">df</span>(1)</span></a> does not count
that space when calculating the <tt class="LITERAL">Capacity</tt> column, so it can
exceed 100%. Also, you will notice that the <tt class="LITERAL">Blocks</tt> column is
always greater than the sum of the <tt class="LITERAL">Used</tt> and <tt
class="LITERAL">Avail</tt> columns, usually by a factor of 8%.</p>

<p>For more details, look up the <code class="OPTION">-m</code> option in <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span
class="CITEREFENTRY"><span class="REFENTRYTITLE">tunefs</span>(8)</span></a>.</p>
</div>
</div>
</div>
</div>

<div class="NAVFOOTER">
<hr align="LEFT" width="100%" />
<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="kernelconfig.html"
accesskey="P">Prev</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Home</a></td>
<td width="33%" align="right" valign="top"><a href="admin.html"
accesskey="N">Next</a></td>
</tr>

<tr>
<td width="33%" align="left" valign="top">kernel 設定</td>
<td width="34%" align="center" valign="top">&nbsp;</td>
<td width="33%" align="right" valign="top">系統管理</td>
</tr>
</table>
</div>

<p align="center"><small>This, and other documents, can be downloaded from <a
href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p>

<p align="center"><small>For questions about FreeBSD, read the <a
href="http://www.FreeBSD.org/docs.html">documentation</a> before contacting &#60;<a
href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&#62;.<br />
For questions about this documentation, e-mail &#60;<a
href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&#62;.</small></p>
</body>
</html>


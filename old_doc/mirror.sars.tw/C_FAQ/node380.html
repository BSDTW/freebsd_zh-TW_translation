<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>21.30 什麼是&nbsp;``達夫設備" (Duff's Device)？</TITLE>
<META NAME="description" CONTENT="21.30 什麼是&nbsp;``達夫設備" (Duff's Device)？">
<META NAME="keywords" CONTENT="ccfaq">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="ccfaq.css">

<LINK REL="next" HREF="node381.html">
<LINK REL="previous" HREF="node379.html">
<LINK REL="up" HREF="node350.html">
<LINK REL="next" HREF="node381.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><table width=100%> <COLGROUP><COL width="25%"><COL width="25%"><col width="25%"><col width="25%"></colgroup><tr><td align=left>
<A NAME="tex2html5397"
  HREF="node379.html">
<IMG WIDTH="62" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A></td><td align=center>
<A NAME="tex2html5403"
  HREF="node350.html">
<IMG WIDTH="61" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A></td><td align=center>&nbsp;
<A NAME="tex2html5405"
  HREF="node1.html">
<IMG WIDTH="63" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>&nbsp;</td><td align=right>
<A NAME="tex2html5407"
  HREF="node381.html">
<IMG WIDTH="62" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A></td></tr></table>
</DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION0022300000000000000000"></A>
<A NAME="q:20.35"></A>
<BR>
<SPAN CLASS="arabic">21</SPAN>.<SPAN CLASS="arabic">30</SPAN> 什麼是&nbsp;``達夫設備" (Duff's Device)？
</H1>
這是個很棒的迂迴循環展開法, 由&nbsp;Tom Duff&nbsp;在&nbsp;Lucasfilm&nbsp;時所設計。
它的&nbsp;``傳統"&nbsp;形態, 是用來複製多個字節:
<PRE>
    register n = (count + 7) / 8;   /* count &gt; 0 assumed */
    switch (count % 8)
    {
    case 0:    do { *to = *from++;
    case 7:     *to = *from++;
    case 6:     *to = *from++;
    case 5:     *to = *from++;
    case 4:     *to = *from++;
    case 3:     *to = *from++;
    case 2:     *to = *from++;
    case 1:     *to = *from++;
          } while (--n &gt; 0);
    }
</PRE>
這裡&nbsp;count&nbsp;個字節從&nbsp;from&nbsp;指向的數組複製到&nbsp;to&nbsp;指向的
內存地址&nbsp;(這是個內存映射的輸出寄存器, 這也是為什麼它沒有被增加)。它把
&nbsp;swtich&nbsp;語句和複製&nbsp;8&nbsp;個字節的循環交織在一起, 從而解決了剩餘字節的
處理問題&nbsp;(當&nbsp;count&nbsp;不是&nbsp;8&nbsp;的倍數時)。相信不相信, 像這樣的把
&nbsp;case&nbsp;標誌放在嵌套在&nbsp;swtich&nbsp;語句內的模塊中是合法的。
當他公佈這個技巧給&nbsp;C&nbsp;的開發者和世界時,&nbsp;Duff&nbsp;注意到&nbsp;C&nbsp;的&nbsp;swtich&nbsp;
語法, 特別是&nbsp;``跌落"&nbsp;行為, 一直是被爭議的, 而&nbsp;``這段代碼在爭論中形成了某種
論據, 但我不清楚是贊成還是反對"。

<P>

<DIV CLASS="navigation"><HR> <table width=100%> <COLGROUP><COL width="25%"><COL width="25%"><col width="25%"><col width="25%"></colgroup><tr><td align=left>
<A NAME="tex2html5397"
  HREF="node379.html">
<IMG WIDTH="62" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A></td><td align=center>
<A NAME="tex2html5403"
  HREF="node350.html">
<IMG WIDTH="61" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A></td><td align=center>&nbsp;
<A NAME="tex2html5405"
  HREF="node1.html">
<IMG WIDTH="63" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>&nbsp;</td><td align=right>
<A NAME="tex2html5407"
  HREF="node381.html">
<IMG WIDTH="62" HEIGHT="25" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A></td></tr></table>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<small>翻譯朱群英、孫雲, LaTeX2HTML 編譯 朱群英 (2005-06-23)</small>
</ADDRESS>
</BODY>
</HTML>

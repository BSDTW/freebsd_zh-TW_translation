<HTML>
<HEAD>
<TITLE>組成 Regular Expression 的元素</TITLE>
</HEAD>
<BODY>
<a href=".">目錄</a> | <a href="ch1.html">Why Regular Expression</a> | <a href="ch3.html">使用 Regular Expression 時的注意事項</a>
<HR><P>

<H2> 組成 Regular Expression 的元素</H2>

 Regular Expression 是由普通字元、及一組具有特殊意義
 的字元所構成. 本節主要介紹各種特殊字元所代表的意義及
 其用法. 讀者學習時應留心 : 有時, 同一特殊字元, 會因出
 現在字串中不同的位置或連接其它特殊字元, 而有不同的意義.
 本文中為有別於一般的字串, 所有 Regular Expression  
 都以粗體字體表示, 且加註``Regexp''於其前方.<p>

 組成 Regular Expression 的元素及所代表的意義如下 :<p>

<UL>
<LI>[普通字元]  除了``.''、``[''、``]''、``*''、``+''、``?''、
                 ``|''、``^''、``$''、``{''、``}''、``\''、
                ``&lt;''、``&gt;''、``(''、``)'' 
                 外之所有<a href="#n2">字元</a>.<p>

 由普通字元所組成的 Regular Expression 其意義與原字串字
面意義相同. 例如  :<p>

<UL>
<LI>   普通字元``A''也可當成一個 Regular Expression.  
               Regexp ``<b> A</b>'' 與一般字元``A''代表相同的意義.

<LI> Regexp ``<b> the</b>'' 與一般字串``the''代表相同的意義.
</UL>

<LI>[<b> .</b>] Metacharacter 用以代表任意一個字元.
  
         須留心 UNIX Shell 中使用``?''表示任意一個字元, 使用``*''代表任意長
         度的字串(這是另一種稱為 ``Pattern Matching Notation'' 的字串表示法).
         Regular Expression 中則使用``<b> .</b>'' 來代表``一個''任意字元(注
	 意: 並非任意長度的字串). 而 Regular Expression 中``<b> *</b>''另有
	 其它涵意, 並不代表任意長度的字串. 例如 <p> 
<UL>
<LI>  Regexp ``<b> .</b>'' 可用以代表任意一個字元. 如 
       ``A''、``1''、``+''、...
<LI>  Regexp ``<b> ...</b>'' 則代表一個由任意3個字元所的字串. 譬如 
       ``123''、``abc''、``# 1''、...
</UL>

<LI>[<b> ^</b>] 限制字串必須出現於行首. (用法見下例)  
<LI>[<b> $</b>] 限制字串必須出現於行末.  

<UL>
<LI> [例如 :] 
Regexp ``<b> ^The</b>'' 用以表示所有出現於行首的字串``The''. 
Regexp ``<b> The$</b>'' 用以表示所有出現於行末的字串``The''.
Regexp ``<b> ^The$</b>'' 則用以表示一個僅含字串``The''的資料列. 
Regexp ``<b> ^$</b>'' 表示一個空白的資料列（行首與行尾之間未存在任一字元）.
</UL><p>

<LI>[<b> \</b>] 將特殊字元還原成字面意義的字元.
       Regular Expression 中 特殊字元 將被解釋成特定的意義. 
	若要表示特殊字元的字面(literal meaning) 意義時, 在
	特殊字元之前加上 ``<b>\</b>'' 即可.<p>

<UL>
<LI>[例如 :]
       使用 Regular Expression 來表示字串``a.out''時, 不可寫成 
       Regexp ``<b> a.out</b>''. 因為``<b> .</b>''在 Regular 
       Expression 中是特殊字元, 表示任一字元.<br>
	可合乎(match) Regexp ``<b> a.out</b>'' 的字串將不只
       ``a.out'' 一個; 字串``a2out'',``a3out'', ``aaout''... 
       都合於 Regexp ``<b> a.out</b>''. <br> 
       正確的表示法應為 : Regexp ``<b> a\.out</b>''<p>
</UL>
   ``<b> \</b>'' 在 Regular Expression 中的另一個意
    義是當成 Escape character.<p>
<UL>
<LI>[例如 :]
     ``<b> \t</b>'' 用以表示 tab. 
     ``<b> \n</b>'' 表示換行符號.
</UL>

<LI><b> [...]</b> 『字元集合』, 用以表示兩中括號間
       所有的字元當中的任一個.

<UL>
<LI>[例如 : ]
               Regexp ``<b> [123]</b>'' 可用以表示字元 ``1''、``2'' 或 ``3''.
               Regexp ``<b> [Tt]</b>'' 可用以表示字元 ``T'' 或 ``t''.
               所以, Regexp "<b> [Tt]he</b>" 表示字串 "The" 或 "the".
               (注意 : 一個字元集合僅代表``一個''字元.)
</UL>               
         使用時, 需留心字元集合<b> [ ]</b> 內不可隨意留空白.<p>
<UL>
<LI>例如 : 
             Regexp ``<b> [ Tt ]</b>''  中括號內有空白字元, 故除了可用
             以表示字元``T''或``t''", 也可代表一個 `` ''(空白字元).
</UL>

<LI><b> -</b>  字元集合中可使用 ``<b> -</b>'' 來指定字元的區間, 
            其用法如下:<p>

         Regexp ``<b> [0-9]</b>'' 等於 Regexp ``<b> [0123456789]</b>''
         用以表示任意 "一個" 阿拉伯數字. 同理 Regexp ``<b> [A-Z]</b>'' 
         用以表示任意 "一個" 大寫英文字母.<p>

         但應留心 :<p>
<UL>
<LI>  Regexp "<b> [0-9a-z]</b>" 並不等於 Regexp "<b> [0-9][a-z]</b>";
      前者表示一個字元(阿拉伯數字或小寫英文字母), 後者表示二個字元.
<LI>  Regexp "<b> [-9]</b>" 或 "<b> [9-]</b>" 僅用以代表字元 ``9''或 ``-''.
</UL>

<LI>[<b> [\^{</b>}...<b> ]</b>] 使用<b> [\^{</b>...]} 
       產生字元集合的補集(complement set). 其用法如下 :<p>

<UL>
<LI>    Regexp ``<b> [^M]</b>'' 用以表示除字元``M''外的``一個''任意字元
<LI>    字元集合 ``<b> [Tt]</b>''表示字元 ``T'' 或 ``t''.
              若要指定 ``T'' 或 ``t'' 之外的任一個字元, 可用Regexp 
               ``<b> [^Tt]</b>'' 表示.
<LI>    Regexp ``<b> [^a-zA-Z]</b>''表示英文字母之外的任一個字元.
</UL>
          需留心 ``<b> ^</b>''之位置; ``<b> ^</b>'' 必須緊接於 
          ``<b> [</b>'' 之後, 才代表字元集合的補集.<p>
<UL>
<LI>[例如 :]  Regexp ``<b> [0-9^]</b>'' 表示一個阿拉伯數字或字元 
                ``<b> ^</b>'', 並非代表阿伯數字外的任意字元.
</UL>

<LI><b>  *</b>  用以形容其前的字元或字元集合可重複任意次數的特殊字元.<br>
``<b> *</b>'' 形容它前方之字元(或字元集合)可出現 1 次或多次, 或不出現.
例如 :<p>
<UL>
<LI> Regexp ``ab*'' 中, ``<b> *</b>'' 形容它前方的字元 ``b'' 可出現 1 次或多次, 
      或不出現. 所以, Regexp ``ab*'' 可表示字串 ``a''、``ab''、``abb''、
      ``abbb''、... 

<LI>  Regexp ``<b> T[0-9]*\.c</b>'' 中, 使用 ``<b> *</b>''
       形容其前的字元集合 ``<b> [0-9]</b>''(一個阿拉伯數字)出現的次數 : 可為 0 
       次或多次.  <p>
       故 Regexp ``<b> T[0-9]*\.c</b>''可用以表示 ``T.c''、``T0.c''、
       ``T1.c''、``T2.c''、...、``T9.c''、``T00.c''、``T01.c''、``T02.c''、...、
       ``T09.c''、``T10.c''、...``T99.c''、``T000.c''、...<p>
</UL>

<LI>[<b> \&lt;</b>]   ``<b> \&lt;</b><i> Regexp</i>'' 
       表示一個出現於"字首"且又合於(match)該 <i>Regexp</i> 的字串 (用法見下例).
<LI>[<b> \&gt;</b>]  ``<i>Regexp</i><b> \&gt;</b>'' 
       表示一個出現於"字末"且又合於(match)該 <i>Regexp</i> 的字串.<br>

      這裡所謂的``字(word)''係指被 tab、逗點、句點或空白字元(space) 所分隔開的字串.

<UL>
<LI> [例如 :]<p>
             資料 ``One is red, and the other is white.'' 中
             字串 ``One'', ``is'', ``red'', ``and'', ``the'', ``other'', 
             ``is'', ``white'' 便是所謂的 "字(word)". 而該資料列中,<br>
             合於 Regexp ``<b>[Tt]he</b>''的字串如下(粗體字標示)<br>
   ``One is red, and <b> the other</b> is white.''<br>
             合於 Regexp ``<b> \&lt;[Tt]he\&gt;</b>''卻僅有(粗體字標示)<br>
   ``One is red, and <b> the</b> other is white.''<br>
             因同時使用``<b> \&lt;</b>''及``<b> \&gt;</b>'' 
             限制合於 Regexp ``<b> [Tt]he</b>''的字串, 必須緊接於字首及字尾之間;
             故 ``other''中的子字串 ``the''並不合於這個 Regular Expression.
</UL>
<UL>
<LI>[註 :] <b> \&lt;, \&gt;</b> 這二個特殊字元,
             並不是很通用. 請參考 <a href="appa.html">Appendix A </a>中的附表.
</UL>

<UL>
<LI><b> \( ... )\</b>   於 Regular Expression 中使用 
       ``<b> \(</b>''``{ \)}''來括住一部分的 Regular Expression;
       其後可用 ``<b> \1</b>'''來表示第一次被``<b> \(</b>'' ``<b> \)</b>'' 
	括住的部份. 若 Regular Expression 中使用了數次``<b> \(</b>''
       ``<b> \)</b>'' 來括住不同的部分, 則依次使用 ``<b>\1</b>'', 
	``<b> \2</b>'', ``<b> \3</b>'' ,...(最多可用到 ``<b> \9</b>'')來
       表示之前括住的 Regular Expression.  其用法如下 :<p>
</UL>

<UL>
<LI>[用法一.]
  <UL>
      <LI>例如: 欲表示像``aa'',``bb'',``cc'',...``zz'' 等字串.<br> 
               使用 Regexp ``<b> [a-z]</b>''則表示任一個小寫的英文字母.<br>
               使用 Regexp ``<b> [a-z][a-z]</b>''則表示二個任意的小寫英文字母. 
               它除表示 ``aa'',``bb'',``cc'',...``zz''等字串外, 也可表示``ab'',
               ``ac'',``ad'',...等字串(這不是題意所要求的字串).<br>
               這時可以``<b> \(</b>'' ``<b> \)</b>'' 來括住第一個
               ``<b> [a-z]</b>'' (Regular Expression 解譯的程式, 會暫時記錄實際找尋
               到的英文字母).  之後, 便可以 Regexp ``<b>\1</b>'' 來指定適才被記
		錄下的英文字母即為所要找尋字串的第二個字元. 故正確的表示法如下 : <p>
        Regexp ``<b> \([a-z]\)\1</b>'' 

     <LI> 例如 : 欲表示像 ``789w987'', ``abcwcba'', ``theweht'',....等具對稱性
	的字串.(該字串的特徵是 ``w''之前後三個字元相互對稱) 該類字串的表示法如
	下 :<p>
 Regexp ``<b> \(.\)\(.\)\(.\)w\3\2\1</b>"
             Regexp中``<b> .</b>''表示任意一個字元. 因字元``w''之前出現的三個字元並無
             任何限制, 故可用 ``<b> ...</b>''表之.  但每個``<b> .</b>''分別用 
             ``<b> \(</b>'',``<b> \)</b>'' 括住, 之後便可使用 ``<b> \1</b>'',
             ``<b> \2</b>'', ``<b> \3</b>'' 分別代表將來實際匹配到的前三個字元.<p>
</UL>
<LI>用法二.  進行字串找尋並置換(Replace)時, 若將被置入的新字串不是一個固定的字串,
                與被找到的原字串有關時(見下例說明). 此時, 可先以
                <b> \(  \)</b>來括住一部分的Regular Expression; 
                再於將被新置入的字串中使用``<b> \1</b>'',
                ``<b> \2</b>'',... 來表示當時被找到的字串(或其子字串).
<UL>
<LI>例 :  欲找出檔案中具有 ``prog12.c'', ``prog9.c'', ``prog832.c'',... 等式樣的字串,
             並將其置換成(以上列三個字串為例) ``[ note 12]'', ``[ note 9]'',
             ``[ note 832]''. 在這例子中, 因事先不知道所找尋到的字串(prog數字.c)中的
             數字 為何, 故無法事先決定應換成什麼新字串. 
              合於本例所要找尋的字串其 Regular Expression 為 : <br>
               Regexp ``<b> prog[0-9][0-9]*\.c</b>''
               上式中 ``<b> [0-9][0-9]*</b>'' 表一位或一位以上的阿拉伯數字, 因
               執行前並不知道該部分實際會匹配什麼數值, 故找到的字串將來應置換
               成什麼, 事前無法指定. 這情況, 也可用``<b> \(</b>'',``<b> \)</b>''
               來括住 ``<b> [0-9][0-9]* </b>'', 在置換的新字串中再以 <b> \1</b>
               表示找尋時實際匹配到的數字.<p>
 </UL>
               讀者可編輯一資料檔, 再以sed執行下列命令, 觀察其執行結果.<p>
</UL>

    $sed -e 's/<b> prog\([0-9][0-9]*\)\.c</b>/[ note <b> \1</b>]/g'  資料檔名<p>

<UL>
<LI> \{<b> 數字, 數字</b>\} 一種於 Regular Expression 中形容其前的字元或字元
	集合出現次數的表示法. 其型態與用法如下 :<p>
</UL>
<UL>
<LI> \{<b>下限數字, 上限數字</b>\} <br>
  例如 : Regexp "[0-9]\{2,4\}"用以表示2到4位的阿拉伯數字.
<LI>{<b> 數字</b>}<br>
            例如 : Regexp `` ax\{<b>99</b>\}'' 用以表示一個
                     ``a'' 之後接上99個 ``x'' 所組成的字串.
<LI> \{<b>下限數字, </b>\}
             例如 : Regexp ``<b> ax\{2,</b>\}'' 用以表示一個
              ``a'' 之後接上2個或更多的 ``x''所組成的字串.
</UL>

<LI><b> + </b> 形容其前的字元或字元集合出現一次或一次以上(註三).<br>

 例如 : Regexp ``<b> [0-9]+</b>'' 用以表示一位或一位以上的數字.<br>

<LI><b> ?</b>  形容其前的字元或字元集合可出現一次或不出現(註三).<br>
<UL>
<LI> [例如 :] Regexp ``[+-]?[0-9]+'' 表示數字(一位以上)之前可出現一個正負號
              或不出現正負號.
</UL>

<LI>[<b>  (...)</b>]  用以括住一群字元,且將之視成一個group(見下面說明)(註三)

<UL>
<LI>例如 :<br>
 Regexp ``<b> 12+</b>''  表示字串 "12","122","1222","12222",...<br>
 Regexp ``<b> (12)+</b>'' 表示字串 "12","1212","1212","1212"....<br>
</UL>
           上式中字串 ``12''以( )括住,整個視為一個group, 故被重覆符號``+''
           所形容的是``12''而非 ``2'', 重複出現的也是 ``12''.<br>

<LI><b> |</b> 表示邏輯上的 "or" (註三)
<UL>
<LI> 例如 :  Regexp ``<b> Oranges?|apples?|water</b>''
                可用以表示字串``Orange'', ``Oranges''<br>
                            或 ``apple'',  ``apples''<br>
                            或 ``water''<br>
</UL>
<UL>
<LI> 註三 : 上列 <b> + , ?, (...), | </b> 等用法, 為 
            Extended Regular Expression 中新增列的用法. awk 及 egrep 
           中所使用的 Regular Expression  即為 Extended Regular Expression.
           但 vi, sed, grep,...等軟體中並無這些用法.
</UL>
<LI><b> &</b>  ``&''並非 Regular Expression 中的特殊字元.  但以
                 Regular Expression 進行字串找尋置換(Replace)時, 常會用到 ``\&''.
                 \ 在許多 Unix tool 中, 當 ``\&''出現在『將被置入的新字串』時, 
                 它用以表示 ``實際被找到合於所指定的 Regular Expression 的字串''
                 (見下例說明)
<UL>
<LI> 例如 : 找出檔案中所有合乎 Regexp ``a[0-9]*\.c'' 的字串, 並在其前後加上小
               括號.依題意要求, 檔案中所有如 ``a12.c'', ``a932.c'', ``a45.c''
               ,...等字串都應置換為 ``(a12.c)'', ``(a932.c)'', ``(a45.c)'',..
               . . 遇到這情況,可令『將被置入的新字串』為 ``<b> (&)</b>''
               此時, ``&''便是用來表示實際上被找到合於  Regexp ``a[0-9]*\.c'' 的字串.
</UL>

 下列是使用 UNIX 上不同的工具, 來處理本例要求的字串置換.<p>
<UL>
<LI><b>vi</b>  以 vi 編輯該檔案,並在 vi 命令輸入模式下輸入 <br>
         : s/a[0-9]*\.c/<b>(&)</b>/g
<LI><b>sed</b>  執行如下命令 ( $ 表 Shell 命令列的提示符號 )<br>
        $ sed -e 's/a[0-9]*\.c/<b> (&)</b>/g'   資料檔名稱
<LI><b>awk</b>  執行如下命令 ( $ 表 Shell 命令列的提示符號 )<br> 
        $ awk '{ gsub(/a[0-9]*\.c/, "<b>(&)</b>"); print }'  資料檔名稱
</UL>
</UL>

<HR><P><DL>
<DT><a name="n2">Note 2: </a>
<dd>上列字元在 Regular Expression 中代表特殊意義, 稱之為 特殊字元.
但 Unix 中不同的指令對 Regular Expression 的解釋能力不儘相同,
故對特殊字元也有不同的認定. 請參考<a href="appa.html">尾頁附表</a>.  
</DL>
<P><HR><P>
<a href=".">目錄</a> | <a href="ch1.html">Why Regular Expression</a> | <a href="ch3.html">使用 Regular Expression 時的注意事項</a>
</BODY>
</HTML>
